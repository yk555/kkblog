{"meta":{"version":1,"warehouse":"4.0.1"},"models":{"Asset":[{"_id":"themes/volantis/source/css/Readme.md","path":"css/Readme.md","modified":0,"renderable":1},{"_id":"themes/volantis/source/css/first.styl","path":"css/first.styl","modified":0,"renderable":1},{"_id":"themes/volantis/source/css/style.styl","path":"css/style.styl","modified":0,"renderable":1},{"_id":"themes/volantis/source/js/app.js","path":"js/app.js","modified":0,"renderable":1},{"_id":"themes/volantis/source/js/plugins/aplayer.js","path":"js/plugins/aplayer.js","modified":0,"renderable":1},{"_id":"themes/volantis/source/js/plugins/parallax.js","path":"js/plugins/parallax.js","modified":0,"renderable":1},{"_id":"themes/volantis/source/js/plugins/rightMenu.js","path":"js/plugins/rightMenu.js","modified":0,"renderable":1},{"_id":"themes/volantis/source/js/plugins/rightMenus.js","path":"js/plugins/rightMenus.js","modified":0,"renderable":1},{"_id":"themes/volantis/source/js/search/hexo.js","path":"js/search/hexo.js","modified":0,"renderable":1},{"_id":"themes/volantis/source/js/plugins/tags/contributors.js","path":"js/plugins/tags/contributors.js","modified":0,"renderable":1},{"_id":"themes/volantis/source/js/plugins/tags/friends.js","path":"js/plugins/tags/friends.js","modified":0,"renderable":1},{"_id":"themes/volantis/source/js/plugins/tags/sites.js","path":"js/plugins/tags/sites.js","modified":0,"renderable":1},{"_id":"themes/volantis/source/img/back.jpg","path":"img/back.jpg","modified":0,"renderable":1},{"_id":"themes/volantis/source/img/kk.jpg","path":"img/kk.jpg","modified":0,"renderable":1},{"_id":"themes/volantis/source/img/favicon.ico","path":"img/favicon.ico","modified":0,"renderable":1},{"_id":"themes/volantis/source/img/logo.png","path":"img/logo.png","modified":0,"renderable":1},{"_id":"themes/volantis/source/img/logo2.png","path":"img/logo2.png","modified":0,"renderable":1}],"Cache":[{"_id":"source/_posts/hello-world.md","hash":"acad91ace80b80295b11a9b7ad4c29a2dcfdd8fb","modified":1658368330206},{"_id":"source/_posts/硬件结构.md","hash":"dead2abe6093c318f3e945fcb12fc70e7cb0a5fd","modified":1658481369048},{"_id":"source/tags/index.md","hash":"1de76d6cd3eee65a7ce4bc2cd035e340e26552cb","modified":1658474351553},{"_id":"themes/stun/.commitlintrc.js","hash":"4d6f90e0c056abfd011315003b47debd7b352e4f","modified":1658391893813},{"_id":"themes/stun/.editorconfig","hash":"8a427ba0adde052cb562ee790bb6b80c270fa55a","modified":1658391893814},{"_id":"themes/stun/.cz-config.js","hash":"8b2799bd6d9c9069f5e8bad48a8b349344b9992f","modified":1658391893813},{"_id":"themes/stun/.eslintrc","hash":"eb9ab913dd95b3712f19b9b1f884f8fbceb6f72e","modified":1658391893815},{"_id":"themes/stun/.gitignore","hash":"6f961e080d4e0d167fc0459464d280d63e888195","modified":1658391893822},{"_id":"themes/stun/.prettierrc","hash":"a9a62bfb68859d94c9e8e153a6d6ab104c98dd60","modified":1658391893823},{"_id":"themes/stun/.stylintrc","hash":"5d6395f53b8f451986358a4c0326c48bb5cd5dd2","modified":1658391893823},{"_id":"themes/stun/FAQ.md","hash":"8b6ea6b1dcfb80a8702eb730095f24de475f33da","modified":1658391893824},{"_id":"themes/stun/LICENSE","hash":"0758a784b2748505aaa2298c9d3af67a1a6563ba","modified":1658391893825},{"_id":"themes/stun/CHANGELOG.md","hash":"23bd12aa00635e9ed3a311b045e1b2f76d2701d8","modified":1658391893824},{"_id":"themes/stun/README_en-US.md","hash":"7d01ba57ba1eb511369ccbb2916b613a1eab1fd4","modified":1658391893826},{"_id":"themes/stun/README.md","hash":"e925832834d98c5691d334c5c470ad7a0364f392","modified":1658391893826},{"_id":"themes/stun/_config.yml","hash":"6f00b8818e3a1017f3005c77c0bf0b60e61fd5be","modified":1658394728434},{"_id":"themes/stun/package.json","hash":"5da5d259d9ebf208010548e0bc641010cbcf52c7","modified":1658391893877},{"_id":"themes/stun/.github/FUNDING.yml","hash":"707c2ecd695c49e608916bf8c969241622404187","modified":1658391893816},{"_id":"themes/stun/.idea/.gitignore","hash":"b1bb9ef735193499852c8636e2e15bc06dd4d2bd","modified":1658391957807},{"_id":"themes/stun/.idea/misc.xml","hash":"a1a111b0d6a5ebccf970dfd074782074ab8a2c52","modified":1658391957653},{"_id":"themes/stun/.idea/stun.iml","hash":"402e38def734b476c4c697c9a36892567ab6af8b","modified":1658391957632},{"_id":"themes/stun/.idea/modules.xml","hash":"69d45443c700a8facf10146c832d50f39c648c6d","modified":1658391957643},{"_id":"themes/stun/.idea/vcs.xml","hash":"e692344d8c981d4806a673b29b1a6dc3b6b6d345","modified":1658391957662},{"_id":"themes/stun/.idea/workspace.xml","hash":"2bb72702e9e94488c586194ce49e31a779ea7040","modified":1658395642781},{"_id":"themes/stun/languages/en.yml","hash":"12631f9f2a7f4a814ed8a11104fbe091273376f0","modified":1658391893828},{"_id":"themes/stun/languages/es.yml","hash":"22f563f9ba8075352c7c8f771aaadf10f5ff88df","modified":1658391893829},{"_id":"themes/stun/languages/zh-CN.yml","hash":"4d7170553fa2171054fd856da9d4cb10a55f594d","modified":1658391893829},{"_id":"themes/stun/languages/zh-HK.yml","hash":"a47aefed5c15c763aa356fd477f23092df1f3d80","modified":1658391893830},{"_id":"themes/stun/layout/_layout.pug","hash":"62d330da7c43134ed0ab21b68ecb41e9e34eed23","modified":1658395077678},{"_id":"themes/stun/layout/archive.pug","hash":"9aa9b30e43fa14dd01f55dcdc3ba379af1e884eb","modified":1658391893870},{"_id":"themes/stun/layout/index.pug","hash":"df40cf1f051fd29f0f51ace74e9f7394f6ea2ab7","modified":1658395064828},{"_id":"themes/stun/layout/page.pug","hash":"55a96c04aac274088f0641e5c8a778c2756889ac","modified":1658391893872},{"_id":"themes/stun/layout/category.pug","hash":"c849ba60901506bcc1b2e8293455f45f78a0a0ad","modified":1658391893871},{"_id":"themes/stun/layout/tag.pug","hash":"f26d4de2523946fff7fcfd6c701adda3c004c70e","modified":1658391893873},{"_id":"themes/stun/layout/post.pug","hash":"6a27bd2c14e2ef20e4ff29d12ba9a813727c74c7","modified":1658391893873},{"_id":"themes/stun/scripts/merge-config.js","hash":"65dabee746834b112b2a496c9c7d4a90e6ed4970","modified":1658391893883},{"_id":"themes/stun/scripts/engine.js","hash":"41250b58e354d0500e2fffe9ad0ff9c99f534b50","modified":1658391893878},{"_id":"themes/stun/.github/ISSUE_TEMPLATE/bug-report_en.md","hash":"c81aa8866f9d67d59af4174c79c11bc25b1dce66","modified":1658391893817},{"_id":"themes/stun/.github/ISSUE_TEMPLATE/bug-report_zh.md","hash":"4f67fa27c6f0b149680abfe57f448851b9139ea8","modified":1658391893817},{"_id":"themes/stun/.github/ISSUE_TEMPLATE/feature-request_zh.md","hash":"662943353c4488450ed7ab164cdc9bd161ca1d80","modified":1658391893819},{"_id":"themes/stun/.github/ISSUE_TEMPLATE/other_en.md","hash":"20cd29abeefe18be3a374c78e63d69570fc1f5cd","modified":1658391893819},{"_id":"themes/stun/.github/ISSUE_TEMPLATE/other_zh.md","hash":"90555989a81d8c16760779c450656bd73e989f0a","modified":1658391893820},{"_id":"themes/stun/.github/ISSUE_TEMPLATE/feature-request_en.md","hash":"597b8ae27ce734681a898cdfc66182deba91fcee","modified":1658391893818},{"_id":"themes/stun/.github/workflows/codeql-analysis.yml","hash":"6f6b55946dda82dc41f24af837dc4e1d47f436bf","modified":1658391893821},{"_id":"themes/stun/.github/workflows/files-shaking.yml","hash":"a417f17f752c4be06b29b01cb3dc4c7cdfd2aea1","modified":1658391893822},{"_id":"themes/stun/.idea/codeStyles/Project.xml","hash":"33135b6348faa54a2b0d99756692181ab1826c68","modified":1658391957676},{"_id":"themes/stun/.idea/codeStyles/codeStyleConfig.xml","hash":"6bfbf32a784820a54c84c4512e6cbf86335b9265","modified":1658391957684},{"_id":"themes/stun/.idea/inspectionProfiles/Project_Default.xml","hash":"c67af73b29b0c9258f7cae1ced74069025874001","modified":1658391957524},{"_id":"themes/stun/layout/_mixins/gallery.pug","hash":"fdb9f7ecdecba26ccafb295063990807a66f3813","modified":1658391893832},{"_id":"themes/stun/layout/_mixins/menu-item.pug","hash":"4a76652315e5ea734ca8eef4f87a1fce91d032ab","modified":1658391893832},{"_id":"themes/stun/layout/_mixins/meta-item.pug","hash":"333ad56f6fa8e93d27ae3b09ffc62269c82bca70","modified":1658391893833},{"_id":"themes/stun/layout/_mixins/post-header.pug","hash":"8c32cdbe8d5d8799d2e53bb8bd9a3fea6d060a6b","modified":1658391893834},{"_id":"themes/stun/layout/_mixins/timeline.pug","hash":"0108c63e79bf71b9744db1ffb749adc143a9c9bb","modified":1658391893835},{"_id":"themes/stun/layout/_partials/config.pug","hash":"b7b5cc6740c6d4c2d4e97a68dd94e5f514c6adc6","modified":1658391893837},{"_id":"themes/stun/layout/_partials/profile.pug","hash":"1d850bd28df08c22b53cb401abdc8c75388d4349","modified":1658393458754},{"_id":"themes/stun/layout/_scripts/stun.pug","hash":"b20216a1fe3c72f9b57119c25a9952ae8ab8f605","modified":1658391893852},{"_id":"themes/stun/layout/_scripts/vendors.pug","hash":"782bdc337a76614f3291ff159cb669e322380065","modified":1658391893853},{"_id":"themes/stun/layout/_third-party/quicklink.pug","hash":"edf08485d02f8f9efe902704bfabb34bb78ecd32","modified":1658391893867},{"_id":"themes/stun/layout/_third-party/pjax.pug","hash":"9d31399baa47d599e3bd0f451004b256b6cc4254","modified":1658391893867},{"_id":"themes/stun/source/css/animation.css","hash":"c4e2db2429742bb1120ac96e165a2682b918ec33","modified":1658371294683},{"_id":"themes/stun/source/css/index.styl","hash":"7abf7869aabb5f726093f4981b7a58ae2536d854","modified":1658391893927},{"_id":"themes/stun/source/css/style.css","hash":"5b2d45f80be2f1eeeb683bb4a7c01b77502ac72e","modified":1658376347117},{"_id":"themes/stun/source/images/algolia.svg","hash":"90322f80db6ad0daf26ea3ec71dea6f691a8b2f1","modified":1658391893928},{"_id":"themes/stun/source/images/cc-by-nc-nd.svg","hash":"017ad912874686a982ebceae359299b8f2a492e2","modified":1658391893929},{"_id":"themes/stun/source/images/cc-by-nc-sa.svg","hash":"71d035c34219f924dbf1bf852166ee8fb58d2f24","modified":1658391893930},{"_id":"themes/stun/source/images/cc-by-nd.svg","hash":"20c66ae3c393903e6eab3bc8cf7c3be6d753f9f8","modified":1658391893931},{"_id":"themes/stun/source/images/cc-by-sa.svg","hash":"0455a8857ba096925d4145a56e8d10537fccb378","modified":1658391893931},{"_id":"themes/stun/source/images/cc-by-nc.svg","hash":"4608189edbe7636dd651df65473298a3c5afb20d","modified":1658391893930},{"_id":"themes/stun/source/images/cc-by.svg","hash":"77f74c241902447424207869c74cb9d9264bdced","modified":1658391893932},{"_id":"themes/stun/source/images/loading.svg","hash":"32a6e770d217ae6c0cf0f6beef3172f1b5b9a0a2","modified":1658391893935},{"_id":"themes/stun/source/js/header.js","hash":"efc852fd053ae6c8163f575cefc8c0a68bbf63e6","modified":1658391893936},{"_id":"themes/stun/source/js/main.js","hash":"071fceaaa3884b7a13630eb89468eed732c979f5","modified":1658371294717},{"_id":"themes/stun/source/js/sidebar.js","hash":"81d1b9313afcb75d4991d0f79a8bcbda49aa8129","modified":1658391893938},{"_id":"themes/stun/source/js/scroll.js","hash":"7b0342d95f7fe21e57b3ba093870f7b0bf7821a2","modified":1658391893937},{"_id":"themes/stun/source/js/stun-boot.js","hash":"fb2737d595f4be58e3a4fc136c94b306942bae87","modified":1658391893938},{"_id":"themes/stun/source/js/utils.js","hash":"df9066589273219d78353291f6db0d0be101b63b","modified":1658391893939},{"_id":"themes/stun/src/js/init.js","hash":"5961a1a3e398752d3ba466db219050c3eb975fcd","modified":1658371294721},{"_id":"themes/stun/src/js/fancybox.js","hash":"c5db137daa9b88160b261d8a35c6f7910f117619","modified":1658371294720},{"_id":"themes/stun/src/js/main.js","hash":"af67c1dfc39ab67aff3ea148992820e1054eb13d","modified":1658371294722},{"_id":"themes/stun/src/js/scroll.js","hash":"649a7a6342de6abcd595380b02ad577d521c8de5","modified":1658371294724},{"_id":"themes/stun/src/scss/_global-css.scss","hash":"c0922bbc74d9bf7e902d9a044aa784110df22208","modified":1658371294740},{"_id":"themes/stun/src/scss/_mixin.scss","hash":"cf22ef503068d24c18cc0b3d367c083dc3c62061","modified":1658371294741},{"_id":"themes/stun/src/scss/_normalize.scss","hash":"f6c830207cf51c9677e34134829d379e4915bae2","modified":1658371294742},{"_id":"themes/stun/src/scss/_page.scss","hash":"32b4a340c7ac217488fb6a518eee1b1dabc3c002","modified":1658371294743},{"_id":"themes/stun/src/scss/_variables.scss","hash":"eff35a1a9dd8e2eb1666c8678dea3bdcd3ceae5d","modified":1658371294744},{"_id":"themes/stun/src/scss/mobile.scss","hash":"6e3bc6ed9e5c6c9e48e911c8cac8b9b27acc9152","modified":1658371294745},{"_id":"themes/stun/src/scss/style.scss","hash":"0d075d67663695f56df429c44d1a97ef5700efbc","modified":1658371294746},{"_id":"themes/stun/scripts/filters/external-link.js","hash":"3863dc2fb671c8520d8632185fb255159ec8ab47","modified":1658391893879},{"_id":"themes/stun/scripts/filters/image-setting.js","hash":"4434cb64de9bcc7f51427855ca3d49334ba19ae5","modified":1658391893880},{"_id":"themes/stun/scripts/filters/lazyload.js","hash":"125b93da90c302b7cb21f5e58824ace5034ec496","modified":1658391893880},{"_id":"themes/stun/scripts/filters/post-heading.js","hash":"c4fb7d225c095c7de0ab9fa51eaf8bac5f06ed4b","modified":1658391893881},{"_id":"themes/stun/scripts/filters/shake-file.js","hash":"b4fb3713f126b4970521ebdc71828d7b4f048322","modified":1658391893882},{"_id":"themes/stun/scripts/filters/wrap-table.js","hash":"fcd26a87a024f719d0b3920a3e1734b04ef52c1b","modified":1658391893882},{"_id":"themes/stun/scripts/tags/button.js","hash":"6ade46b62d7761a72c518aa0b261e592b67f2f21","modified":1658391893884},{"_id":"themes/stun/scripts/tags/friends.js","hash":"8a5a38437d621845f1f9749d558d457360ccfc35","modified":1658391893884},{"_id":"themes/stun/scripts/tags/table.js","hash":"33120450cf9be28c9167417ea2ab8dc9bf8fc68c","modified":1658391893886},{"_id":"themes/stun/scripts/tags/note.js","hash":"fb45de53daa8bd4b2dc910ae082ee9ccf15b20d4","modified":1658391893885},{"_id":"themes/stun/layout/_partials/analytics/busuanzi.pug","hash":"df7a5a7b0b59da113ad8d702b42ce5da438cdae4","modified":1658391893836},{"_id":"themes/stun/layout/_partials/head/head.pug","hash":"b7c79acc2b9b8bd9d166aadfeb3d287bbec89154","modified":1658391893839},{"_id":"themes/stun/layout/_partials/footer/footer.pug","hash":"f1ebea686f66165294643a03252650118a09c496","modified":1658391893838},{"_id":"themes/stun/layout/_partials/head/kill-old-ie.pug","hash":"cd384f25aba5beb774b8a010619c342c3ebfe596","modified":1658391893839},{"_id":"themes/stun/layout/_partials/header/header.pug","hash":"381afbb33e25171521eddb162ab4cbc11d76d98f","modified":1658391893840},{"_id":"themes/stun/layout/_partials/post/post-list.pug","hash":"258a97d25c610b2b17018951dece5f23f570cfa0","modified":1658391893841},{"_id":"themes/stun/layout/_partials/search/algolia.pug","hash":"7da35d4ec40dcbfb9925ad592ec8f91239d905d1","modified":1658391893842},{"_id":"themes/stun/layout/_partials/search/assist-btns.pug","hash":"549a139a4deda9989527d20cf8da330cef8cb21a","modified":1658391893843},{"_id":"themes/stun/layout/_partials/search/index.pug","hash":"178d6eee822776ad80e384442b60fd9a68d35f28","modified":1658391893844},{"_id":"themes/stun/layout/_partials/search/localsearch.pug","hash":"85a07868967a98a4223ab41bd804ac8237ce326d","modified":1658391893844},{"_id":"themes/stun/layout/_partials/sidebar/sidebar.pug","hash":"871888f51bef0988b4e4a27d857689684e67f0ea","modified":1658391893845},{"_id":"themes/stun/layout/_partials/widgets/back2top.pug","hash":"07fc07a80bde44ebc6684e921c4c1a4f7787733e","modified":1658391893846},{"_id":"themes/stun/layout/_partials/widgets/comments.pug","hash":"5ce95f71c91f4be3400c800e5dc31a820257367b","modified":1658391893847},{"_id":"themes/stun/layout/_partials/widgets/copyright.pug","hash":"273998efc25fadd7a819b055dd0414b687885827","modified":1658391893848},{"_id":"themes/stun/layout/_partials/widgets/loading-bar.pug","hash":"1acace606b1348eaf7a4a32b97d85a717dbe93b8","modified":1658391893848},{"_id":"themes/stun/layout/_partials/widgets/paginator.pug","hash":"4d6fef24e8cf30ac12928b4ce34e9e6caff16f9c","modified":1658391893850},{"_id":"themes/stun/layout/_partials/widgets/night-mode.pug","hash":"3a6175601ada6ba2ca146607571456414de965c8","modified":1658391893849},{"_id":"themes/stun/layout/_partials/widgets/reward.pug","hash":"ffae863a4d9397f9e28790a747221b7dad6b5745","modified":1658391893850},{"_id":"themes/stun/layout/_partials/widgets/share.pug","hash":"77d2ded368e6c98f43d5a69f8fb286cdd601eb1f","modified":1658391893851},{"_id":"themes/stun/layout/_third-party/advertising/google-adsense.pug","hash":"0da6d167bf79105ae1575a2ee27f6053ce6a30da","modified":1658391893855},{"_id":"themes/stun/layout/_third-party/advertising/index.pug","hash":"889ca81727a656b0a36d9f736f2b1aabc59e3491","modified":1658391893855},{"_id":"themes/stun/layout/_partials/widgets/sticky-top.pug","hash":"fc3d256854f27b5b6f2adc107957a23f743a4f21","modified":1658391893851},{"_id":"themes/stun/layout/_third-party/analytics/busuanzi.pug","hash":"c95cdb7b9014ac25f1cdf8dffb2ec1451d431bf4","modified":1658391893857},{"_id":"themes/stun/layout/_third-party/analytics/baidu-analytics.pug","hash":"249c8464277d6fdb7941076cea476666c25fffa5","modified":1658391893856},{"_id":"themes/stun/layout/_third-party/analytics/google-analytics.pug","hash":"7820dfaf4eb1a80d12d40a9b1ee58e729d8fbbce","modified":1658391893858},{"_id":"themes/stun/layout/_third-party/math/index.pug","hash":"217d4fe3a03bf85c432bb0ef5d66c3ec646bf85b","modified":1658391893865},{"_id":"themes/stun/layout/_third-party/analytics/index.pug","hash":"cd76ef83f14fbc00c3e92d2f713ecf20cb25f4d6","modified":1658391893858},{"_id":"themes/stun/layout/_third-party/math/mathjax.pug","hash":"3447a97c4d5711251555c18068e88dd11b6d720f","modified":1658391893866},{"_id":"themes/stun/layout/_third-party/comments/disqus.pug","hash":"35196069417c027eb3c9c27dd22b1d09aa28ce4f","modified":1658391893859},{"_id":"themes/stun/layout/_third-party/math/katex.pug","hash":"9ba568a9899d21706ea8842291c7b6c9cb1ca169","modified":1658391893866},{"_id":"themes/stun/layout/_third-party/comments/fbcomments.pug","hash":"d8abecfa3a205591d763f24491e9b643c156615c","modified":1658391893860},{"_id":"themes/stun/layout/_third-party/comments/gitalk.pug","hash":"3fdb845f2f62533062c04a67925ebd9926f1b177","modified":1658391893860},{"_id":"themes/stun/layout/_third-party/comments/index.pug","hash":"0ff0832063ea7e630d30bf4ec051f5736f348022","modified":1658391893861},{"_id":"themes/stun/layout/_third-party/comments/utterances.pug","hash":"753808a22eff7dca5b34aaab08d4debca583fdee","modified":1658391893863},{"_id":"themes/stun/layout/_third-party/comments/livere.pug","hash":"772519ebddb05400e6099d51727f5e3f3f07df36","modified":1658391893862},{"_id":"themes/stun/layout/_third-party/comments/valine.pug","hash":"439cbadd7b87862d552d47083a4a4c367f7e5f9f","modified":1658391893863},{"_id":"themes/stun/layout/_third-party/comments/waline.pug","hash":"88a3cf35036e94cf988ee4f0321e9d794fe2e429","modified":1658391893864},{"_id":"themes/stun/layout/_third-party/comments/minivaline.pug","hash":"44b700fda7b498da9f255cc0a6b25f98b2b263fa","modified":1658391893862},{"_id":"themes/stun/layout/_third-party/search/algolia.pug","hash":"102bdcd972f74a53976427636506a639b48138c0","modified":1658391893868},{"_id":"themes/stun/layout/_third-party/search/index.pug","hash":"178d6eee822776ad80e384442b60fd9a68d35f28","modified":1658391893869},{"_id":"themes/stun/layout/_third-party/search/localsearch.pug","hash":"c7df8230de3c127bb680239bafcc76950b6e5504","modified":1658391893870},{"_id":"themes/stun/source/css/_common/index.styl","hash":"016426a8b8363393b5b7a77ad23482b3baa46736","modified":1658391893918},{"_id":"themes/stun/source/css/_common/responsive.styl","hash":"a7672c735539c4828cd4c54a1fca28a5fc6b756e","modified":1658391893921},{"_id":"themes/stun/source/css/_custom/index.styl","hash":"aba3f8f2dec84b604985093cd65bf43770076cea","modified":1658391893925},{"_id":"themes/stun/source/css/_mixins/index.styl","hash":"4d0757a1565936ca5ad9eed49c35c001a96af273","modified":1658391893926},{"_id":"themes/stun/source/css/_variables/index.styl","hash":"a3e1083b04fd6ffc963f4a3bf4ca0747ef228552","modified":1658391893927},{"_id":"themes/stun/source/images/icons/favicon-16x16.png","hash":"7bfd64eac26e17ea162f0c399a4a40164c26b412","modified":1658391893933},{"_id":"themes/stun/source/images/icons/stun-logo.svg","hash":"069dc7590ad152373f1c346d892e32faa2bbdd87","modified":1658391893934},{"_id":"themes/stun/source/images/icons/favicon-32x32.png","hash":"02fead07726920400ede57ddfdbf071dd7203fd5","modified":1658391893934},{"_id":"themes/stun/source/img/assets/cat.png","hash":"a7349c7e55e288820856742a3dee55772d31f5d4","modified":1658371294695},{"_id":"themes/stun/source/img/assets/favicon.ico","hash":"63014c6c90c1440bce506c68593a233a8a8f52b8","modified":1658372528896},{"_id":"themes/stun/source/img/assets/kk.jpg","hash":"fe497d04280799886e30956fc8ee5b3cab04aee4","modified":1658371861788},{"_id":"themes/stun/source/img/intro/index-bg.png","hash":"2250b98a986baff6ec6a4113feabb4c85b5801f8","modified":1658371294714},{"_id":"themes/stun/source/css/_common/components/index.styl","hash":"36cbf4c963972dde6680f21064b3d69fd36828c3","modified":1658391893895},{"_id":"themes/stun/source/css/_common/outline/macro.styl","hash":"eadd5a0c5d2ba86178384b24dfd2c72effe7886e","modified":1658391893920},{"_id":"themes/stun/source/css/_common/outline/index.styl","hash":"34cd9f24602550fb5172cf5cf61f1466e96b3037","modified":1658391893919},{"_id":"themes/stun/source/css/_common/scaffolding/base.styl","hash":"e8003f897e0ee5cd886df4402c0c28cd27d80a73","modified":1658391893922},{"_id":"themes/stun/source/css/_common/scaffolding/normalize.styl","hash":"0b06abb4739e5da44058cd5147be173e8f801cf6","modified":1658391893923},{"_id":"themes/stun/source/css/_common/scaffolding/index.styl","hash":"d30385d3e3a68fbff0e4560c5b520d572121aa69","modified":1658391893923},{"_id":"themes/stun/src/scss/_compontents/_post/_code.scss","hash":"24d91b5b3df3a442e63515a8b0d6d2818ee43d91","modified":1658371294739},{"_id":"themes/stun/src/scss/_compontents/_partial/_footer.scss","hash":"0b722ea1e5b2f0f5e8b0c22f4b0d67ff747e87c3","modified":1658371294729},{"_id":"themes/stun/source/css/_common/scaffolding/utils.styl","hash":"1d658ff634b2da6b8b4818ffc1084acb65a36ca8","modified":1658391893924},{"_id":"themes/stun/src/scss/_compontents/_partial/_nav.scss","hash":"f6a86bf8f8e0dbeefaf84f06c02ffb16f3be9faf","modified":1658371294731},{"_id":"themes/stun/src/scss/_compontents/_partial/_post-page.scss","hash":"d2ed2359c99e6a2655aa0f7bbe152ebcd6267425","modified":1658371294734},{"_id":"themes/stun/src/scss/_compontents/_partial/_page-nav.scss","hash":"b9c07166afdbb6bdee78dffbb56aa46b45056bdf","modified":1658371294732},{"_id":"themes/stun/src/scss/_compontents/_partial/_profile.scss","hash":"01a8e8b9bb100d60e7038317ed8877faef2926aa","modified":1658371294735},{"_id":"themes/stun/src/scss/_compontents/_partial/_recent-posts.scss","hash":"9f74b1292815482989a0406a74f9731dd66e612e","modified":1658371294736},{"_id":"themes/stun/src/scss/_compontents/_partial/_tag.scss","hash":"b33f8ebef0b86cf61c45ba3416f1a1ef198ad807","modified":1658371294737},{"_id":"themes/stun/source/css/_common/components/analytics/busuanzi.styl","hash":"beafc7d7c1685ac73fa263cffae37bf699a8f269","modified":1658391893888},{"_id":"themes/stun/src/scss/_compontents/_partial/_header.scss","hash":"d334d0082d85c8510c19a9b0e967486d334454bb","modified":1658371294730},{"_id":"themes/stun/source/css/_common/components/analytics/index.styl","hash":"055fac810c3b76562482681d1aaa174a98234b5e","modified":1658391893889},{"_id":"themes/stun/source/css/_common/components/highlight/diff.styl","hash":"660f90a9fa59ec83f4192dc603d4cc40e0fffca5","modified":1658391893892},{"_id":"themes/stun/source/css/_common/components/highlight/highlight.styl","hash":"e0bdb2e6ef1feb8a4efd9bda322277f18085023e","modified":1658391893893},{"_id":"themes/stun/source/css/_common/components/footer/index.styl","hash":"2d3ff81f11520710927efd5698b5dd9b145cb3a5","modified":1658391893890},{"_id":"themes/stun/source/css/_common/components/highlight/theme.styl","hash":"ab775fefb98c48906dfd05d368b7c2f985048f3f","modified":1658391893894},{"_id":"themes/stun/source/css/_common/components/plugins/button.styl","hash":"db6e8c5327da58642cf999e2843734ff2109438f","modified":1658391893898},{"_id":"themes/stun/source/css/_common/components/highlight/index.styl","hash":"429b41bc2c38d10df7d38c494c8ffe9fe7ad22b4","modified":1658391893894},{"_id":"themes/stun/source/css/_common/components/plugins/friends.styl","hash":"8b976b58cbfb4f8b5a4c35476d745f02637b382b","modified":1658391893899},{"_id":"themes/stun/source/css/_common/components/plugins/index.styl","hash":"5db42006efac1d1a328ed035c266c921ef5043d2","modified":1658391893899},{"_id":"themes/stun/source/css/_common/components/header/index.styl","hash":"43676e5a64dcc6fae4031695cad116cff570513f","modified":1658391893891},{"_id":"themes/stun/source/css/_common/components/pages/index.styl","hash":"84e8bef33970281e9e89500676b13b86e59ab1e8","modified":1658391893896},{"_id":"themes/stun/source/css/_common/components/plugins/table.styl","hash":"b3eaa86f013301451e46d7c2553b4f7259a51e5d","modified":1658391893901},{"_id":"themes/stun/source/css/_common/components/plugins/note.styl","hash":"04742a9f12b8b7f06b74f022cb0ea63cd6e75c45","modified":1658391893900},{"_id":"themes/stun/source/css/_common/components/pages/page.styl","hash":"04540885ffd7c79141869f0adeef4474bd25514d","modified":1658391893897},{"_id":"themes/stun/source/css/_common/components/pages/timeline.styl","hash":"55e23326e31a055babc4c2db7c03591cf1b5092a","modified":1658391893897},{"_id":"themes/stun/source/css/_common/components/post/post.styl","hash":"cff8d1ced73a4e02aae6f0bcb68e3801acbe19d7","modified":1658391893903},{"_id":"themes/stun/source/css/_common/components/post/index.styl","hash":"3adfb147fd1d71bcdf28ba46221145fe5616bcd6","modified":1658391893902},{"_id":"themes/stun/source/css/_common/components/sidebar/index.styl","hash":"721e62acc60b8b138279ec05059ad0fcafa2d739","modified":1658391893907},{"_id":"themes/stun/source/css/_common/components/widgets/back2top.styl","hash":"a251aaccd8e36f4335c2d9d61d21c219a9649dc4","modified":1658391893908},{"_id":"themes/stun/source/css/_common/components/post/post-list.styl","hash":"0d94d87e37b990e89cbce6a48dfe98582d410cc8","modified":1658391893902},{"_id":"themes/stun/source/css/_common/components/widgets/copyright.styl","hash":"5a7f6546d66474fa45aac2b4789c0ddd78ab9bbf","modified":1658391893910},{"_id":"themes/stun/source/css/_common/components/widgets/copy-button.styl","hash":"cb969ab21d4f255d05e3203d7edb01e15bcbc64a","modified":1658391893910},{"_id":"themes/stun/source/css/_common/components/widgets/ending.styl","hash":"8ef8d3a399262fa54bc5242aa79bc7c7f4a319c7","modified":1658391893911},{"_id":"themes/stun/source/css/_common/components/widgets/comments.styl","hash":"ab24673e566e303ffb348374229a6d80c43b941a","modified":1658391893909},{"_id":"themes/stun/source/css/_common/components/widgets/font-icon.styl","hash":"766457aed4cdf1d2898e5b2b1302b47aa342bb78","modified":1658391893912},{"_id":"themes/stun/source/css/_common/components/widgets/lazyload.styl","hash":"c15af8c457531c3adc11e46e6ff35c2b05bae928","modified":1658391893914},{"_id":"themes/stun/source/css/_common/components/widgets/fancybox.styl","hash":"d414daca2e7400dd074146437ab37a063a6f5081","modified":1658391893911},{"_id":"themes/stun/source/css/_common/components/widgets/gallery-image.styl","hash":"124e289f660cf68219dfb09fe3cb7857228c33aa","modified":1658391893912},{"_id":"themes/stun/source/css/_common/components/widgets/index.styl","hash":"679a0ce0cd66ac8f562279153011d2d00dea4c08","modified":1658391893913},{"_id":"themes/stun/source/css/_common/components/widgets/loading-bar.styl","hash":"8b8323bf45e3b1be99f0b162b32cecc20c1964d4","modified":1658391893914},{"_id":"themes/stun/source/css/_common/components/widgets/night-mode.styl","hash":"1c8bd075913a85d45cdf693955ecc4d6959d9d5c","modified":1658391893915},{"_id":"themes/stun/source/css/_common/components/widgets/sticky-top.styl","hash":"4d9df7b1f1f8e6b08129479dd00603921c377f33","modified":1658391893917},{"_id":"themes/stun/source/css/_common/components/widgets/zoom-image.styl","hash":"638c127108f95213cfa749923d880d9e52801e8d","modified":1658391893918},{"_id":"themes/stun/source/css/_common/components/widgets/paginator.styl","hash":"4167ff6c8e9e74f98fb1ce8ce234547fc9b2d24f","modified":1658391893915},{"_id":"themes/stun/source/css/_common/components/widgets/share.styl","hash":"3d47efc51a13a9fd8cca6da07a7bdec14b79aefe","modified":1658391893917},{"_id":"themes/stun/source/css/_common/components/widgets/reward.styl","hash":"ddde7e7966acf313c87319a4d371a2854fbea0ca","modified":1658391893916},{"_id":"themes/stun/source/css/_common/components/search/algolia.styl","hash":"50c2cd66822a001c2ad7cf6e154ea3841fca6b86","modified":1658391893904},{"_id":"themes/stun/source/css/_common/components/search/common.styl","hash":"c969a0c307352b80c262c7d8ccc5a3c4b3b53b9a","modified":1658391893905},{"_id":"themes/stun/source/css/_common/components/search/index.styl","hash":"1c6c29cee4534935fa899078cd73d8fee56aa144","modified":1658391893905},{"_id":"themes/stun/source/css/_common/components/search/localsearch.styl","hash":"2fa5ec7db3c6e969628253aa226de50b72b88c74","modified":1658391893906},{"_id":"themes/stun/source/font/Oswald-Regular.ttf","hash":"965d729546a43a8490ad4cf33c25ac475682100c","modified":1658371294688},{"_id":"themes/stun/source/font/SourceCodePro-Regular.ttf.woff","hash":"12eef75e1ad3eca9dae42b65505010ce4464a315","modified":1658371294690},{"_id":"themes/stun/source/font/SourceCodePro-Regular.ttf.woff2","hash":"f5991289ec17884cb641da0646d278d36702a190","modified":1658371294691},{"_id":"themes/stun/source/img/assets/hexo.jpg","hash":"9e0487b49f442a0c66084dcf6b39c10d77d2a8fa","modified":1658371294699},{"_id":"themes/stun/source/img/demo/demo.png","hash":"731029b93f78c148817c8f2eef5dd6aefdbfd0aa","modified":1658371294708},{"_id":"themes/stun/source/img/intro/back.jpg","hash":"57f5631599aa37b9649c62d116585681a7c90587","modified":1658123289857},{"_id":"themes/stun/source/img/intro/index-bg.jpg","hash":"295646ceca0ef995c074d1340315af0619b64f90","modified":1658371294713},{"_id":"themes/stun/source/img/assets/nodejs.png","hash":"acba1689fd4be9632f76647732175eaeb97c9562","modified":1658371294704},{"_id":"themes/stun/package-lock.json","hash":"3f133d00628b2dfc7dc3adf6bb673e120b84394c","modified":1658392258319},{"_id":"themes/Cxo/layout/includes/sidebar/sidebar.pug","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1658371294674},{"_id":"themes/Cxo/LICENSE","hash":"2345167397c7215337deaccdc920baea10700072","modified":1658371294643},{"_id":"themes/Cxo/.babelrc","hash":"653a83dde81a0001cc6103ba1ff038c39cc9ff92","modified":1658371294640},{"_id":"themes/Cxo/.eslintrc.json","hash":"5cafd14d04a991c12e3be2a4b5c1eb4f77b0820a","modified":1658371294641},{"_id":"themes/Cxo/README.md","hash":"9d4f1e6f7dd3784fc9e8cf480b5a13c53f3a8161","modified":1658371294645},{"_id":"themes/Cxo/.gitignore","hash":"1160f8cc9ee341a8d34dc1f4bc45fc895e659156","modified":1658371294642},{"_id":"themes/Cxo/_config.yml","hash":"93fc400613c1ceb3c23e1fc21cb44a33362ed362","modified":1658384111145},{"_id":"themes/Cxo/README_CN.md","hash":"c34dbd5338e9e251571c738f2a4658cf370622ea","modified":1658371294646},{"_id":"themes/Cxo/package.json","hash":"20fbe1ec5da119fd0782d402b9eb18fd80c790c6","modified":1658371294680},{"_id":"themes/Cxo/webpack.config.js","hash":"34f0fdb19aa61961e950936932b03fb7f6b93cc4","modified":1658371294747},{"_id":"themes/Cxo/.idea/Cxo.iml","hash":"402e38def734b476c4c697c9a36892567ab6af8b","modified":1658371535196},{"_id":"themes/Cxo/.idea/.gitignore","hash":"2651f4f8d4c0bf5a32b70ebda7b00cbbe08d36a0","modified":1658371539006},{"_id":"themes/Cxo/.idea/misc.xml","hash":"a1a111b0d6a5ebccf970dfd074782074ab8a2c52","modified":1658371535220},{"_id":"themes/Cxo/.idea/modules.xml","hash":"20a66459907c4a74f0c265ae36ac0b3031d92453","modified":1658371535207},{"_id":"themes/Cxo/.idea/vcs.xml","hash":"e692344d8c981d4806a673b29b1a6dc3b6b6d345","modified":1658371535233},{"_id":"themes/Cxo/layout/archive.pug","hash":"73335d88ac2a5c9b9809a8c692878c31fa688fa5","modified":1658371294649},{"_id":"themes/Cxo/.idea/workspace.xml","hash":"752e85df1dabf937b2102f637ef293b67fe79fe4","modified":1658396123383},{"_id":"themes/Cxo/layout/index.pug","hash":"a5678a2e53564fd7d0e1830013155d6d0e347a8b","modified":1658371294675},{"_id":"themes/Cxo/layout/category.pug","hash":"28616e3084253b0b20ce07d0cbbdd1d8a5e091eb","modified":1658371294650},{"_id":"themes/Cxo/layout/page.pug","hash":"f374332e728197d223fa269be1d3977b37375849","modified":1658371294676},{"_id":"themes/Cxo/layout/post.pug","hash":"64c80ca6b3109872b024c11d654304d3825e98bd","modified":1658371294678},{"_id":"themes/Cxo/.idea/codeStyles/Project.xml","hash":"136b0ad8cd10b014835262c2b70554dab78e43e9","modified":1658371622804},{"_id":"themes/Cxo/layout/tag.pug","hash":"4ca1d2293cc5cdd702c0b0eae7488d5ef47f8e06","modified":1658371294679},{"_id":"themes/Cxo/.idea/codeStyles/codeStyleConfig.xml","hash":"6bfbf32a784820a54c84c4512e6cbf86335b9265","modified":1658371622816},{"_id":"themes/Cxo/layout/includes/layout.pug","hash":"ab756317a04deeebfa377f5b51b3e067332d08ab","modified":1658371294657},{"_id":"themes/Cxo/.idea/inspectionProfiles/Project_Default.xml","hash":"1bf9da79ce2b05fbd07ef1a56a6e15b44e002507","modified":1658371535163},{"_id":"themes/Cxo/source/css/animation.css","hash":"c4e2db2429742bb1120ac96e165a2682b918ec33","modified":1658371294683},{"_id":"themes/Cxo/layout/includes/recent-posts.pug","hash":"3acfc48a21baececd73813fc5eb2d307d48657ab","modified":1658371294672},{"_id":"themes/Cxo/source/css/style.css","hash":"5b2d45f80be2f1eeeb683bb4a7c01b77502ac72e","modified":1658376347118},{"_id":"themes/Cxo/src/js/scroll.js","hash":"649a7a6342de6abcd595380b02ad577d521c8de5","modified":1658371294724},{"_id":"themes/Cxo/source/js/main.js","hash":"071fceaaa3884b7a13630eb89468eed732c979f5","modified":1658371294717},{"_id":"themes/Cxo/src/scss/_mixin.scss","hash":"cf22ef503068d24c18cc0b3d367c083dc3c62061","modified":1658371294741},{"_id":"themes/Cxo/src/scss/_global-css.scss","hash":"c0922bbc74d9bf7e902d9a044aa784110df22208","modified":1658371294740},{"_id":"themes/Cxo/src/scss/_normalize.scss","hash":"f6c830207cf51c9677e34134829d379e4915bae2","modified":1658371294742},{"_id":"themes/Cxo/src/scss/_page.scss","hash":"32b4a340c7ac217488fb6a518eee1b1dabc3c002","modified":1658371294743},{"_id":"themes/Cxo/src/scss/_variables.scss","hash":"eff35a1a9dd8e2eb1666c8678dea3bdcd3ceae5d","modified":1658371294744},{"_id":"themes/Cxo/src/scss/mobile.scss","hash":"6e3bc6ed9e5c6c9e48e911c8cac8b9b27acc9152","modified":1658371294745},{"_id":"themes/Cxo/src/scss/style.scss","hash":"0d075d67663695f56df429c44d1a97ef5700efbc","modified":1658371294746},{"_id":"themes/Cxo/layout/includes/comment/disqus.pug","hash":"4c7cc4dc4aceaf6d7de970873dba2f54a9fb2575","modified":1658371294654},{"_id":"themes/Cxo/layout/includes/comment/changyan.pug","hash":"745ba5633767cd60e7848be7e9e568fafc409c06","modified":1658371294653},{"_id":"themes/Cxo/layout/includes/comment/gitment.pug","hash":"3581b32be9184a2f785ee423104316f61f723dc3","modified":1658371294655},{"_id":"themes/Cxo/layout/includes/comment/livere.pug","hash":"b7ad4e70bee0f5087fc3b6bf4883e9c6e22c0f37","modified":1658371294656},{"_id":"themes/Cxo/layout/includes/partial/footer.pug","hash":"f817a083e4f05b0118e845207b5013134457f1ff","modified":1658385167976},{"_id":"themes/Cxo/layout/includes/mixins/article-sort.pug","hash":"594ec8c8fae6c6a15105760a048eccec5f5f4985","modified":1658371294659},{"_id":"themes/Cxo/layout/includes/partial/head.pug","hash":"c8cf872ec79fa51a4cd9a078f8ccf6631f29daeb","modified":1658371294662},{"_id":"themes/Cxo/layout/includes/partial/header.pug","hash":"cc3417d0e06bc158b1d373de813218f0e7b654df","modified":1658371294663},{"_id":"themes/Cxo/layout/includes/partial/nav.pug","hash":"0f7ed9de347624aaa6298778737841527721ee34","modified":1658371294664},{"_id":"themes/Cxo/layout/includes/partial/page-nav.pug","hash":"8200660e0a996b5437c1bfc6e22efd741b4d577a","modified":1658371294665},{"_id":"themes/Cxo/layout/includes/partial/post-nav.pug","hash":"36af19e57952fafc63750d70a0a43f60b23d75fb","modified":1658371294666},{"_id":"themes/Cxo/layout/includes/partial/preload.pug","hash":"0576a16987f9642ebb7a07c5a320db0a61a704d1","modified":1658371294668},{"_id":"themes/Cxo/layout/includes/partial/profile.pug","hash":"7a8bbb10163db1bba4912a191ac31e07202b7636","modified":1658387797563},{"_id":"themes/Cxo/layout/includes/partial/social.pug","hash":"aa86a81713d7975563ae289add526fa809dc7873","modified":1658371294670},{"_id":"themes/Cxo/layout/includes/partial/tag.pug","hash":"c9a4bc7667a96b7061c29b96a4ad13fcc92a6ae5","modified":1658371294671},{"_id":"themes/Cxo/source/img/assets/cat.png","hash":"a7349c7e55e288820856742a3dee55772d31f5d4","modified":1658371294695},{"_id":"themes/Cxo/source/img/assets/favicon.ico","hash":"63014c6c90c1440bce506c68593a233a8a8f52b8","modified":1658372528896},{"_id":"themes/Cxo/source/img/assets/kk.jpg","hash":"fe497d04280799886e30956fc8ee5b3cab04aee4","modified":1658371861788},{"_id":"themes/Cxo/source/img/intro/index-bg.png","hash":"2250b98a986baff6ec6a4113feabb4c85b5801f8","modified":1658371294714},{"_id":"themes/Cxo/src/js/fancybox.js","hash":"c5db137daa9b88160b261d8a35c6f7910f117619","modified":1658371294720},{"_id":"themes/Cxo/src/scss/_compontents/_partial/_footer.scss","hash":"0b722ea1e5b2f0f5e8b0c22f4b0d67ff747e87c3","modified":1658371294729},{"_id":"themes/Cxo/src/js/main.js","hash":"af67c1dfc39ab67aff3ea148992820e1054eb13d","modified":1658371294722},{"_id":"themes/Cxo/src/scss/_compontents/_partial/_header.scss","hash":"d334d0082d85c8510c19a9b0e967486d334454bb","modified":1658371294730},{"_id":"themes/Cxo/src/scss/_compontents/_partial/_page-nav.scss","hash":"b9c07166afdbb6bdee78dffbb56aa46b45056bdf","modified":1658371294732},{"_id":"themes/Cxo/src/scss/_compontents/_partial/_nav.scss","hash":"f6a86bf8f8e0dbeefaf84f06c02ffb16f3be9faf","modified":1658371294731},{"_id":"themes/Cxo/src/scss/_compontents/_partial/_post-page.scss","hash":"d2ed2359c99e6a2655aa0f7bbe152ebcd6267425","modified":1658371294734},{"_id":"themes/Cxo/src/scss/_compontents/_post/_code.scss","hash":"24d91b5b3df3a442e63515a8b0d6d2818ee43d91","modified":1658371294739},{"_id":"themes/Cxo/src/scss/_compontents/_partial/_profile.scss","hash":"01a8e8b9bb100d60e7038317ed8877faef2926aa","modified":1658371294735},{"_id":"themes/Cxo/src/scss/_compontents/_partial/_tag.scss","hash":"b33f8ebef0b86cf61c45ba3416f1a1ef198ad807","modified":1658371294737},{"_id":"themes/Cxo/src/scss/_compontents/_partial/_recent-posts.scss","hash":"9f74b1292815482989a0406a74f9731dd66e612e","modified":1658371294736},{"_id":"themes/Cxo/source/font/Oswald-Regular.ttf","hash":"965d729546a43a8490ad4cf33c25ac475682100c","modified":1658371294688},{"_id":"themes/Cxo/source/font/SourceCodePro-Regular.ttf.woff","hash":"12eef75e1ad3eca9dae42b65505010ce4464a315","modified":1658371294690},{"_id":"themes/Cxo/source/font/SourceCodePro-Regular.ttf.woff2","hash":"f5991289ec17884cb641da0646d278d36702a190","modified":1658371294691},{"_id":"themes/Cxo/src/js/init.js","hash":"5961a1a3e398752d3ba466db219050c3eb975fcd","modified":1658371294721},{"_id":"themes/Cxo/source/img/demo/demo.png","hash":"731029b93f78c148817c8f2eef5dd6aefdbfd0aa","modified":1658371294708},{"_id":"themes/Cxo/source/img/assets/hexo.jpg","hash":"9e0487b49f442a0c66084dcf6b39c10d77d2a8fa","modified":1658371294699},{"_id":"themes/Cxo/source/img/intro/back.jpg","hash":"57f5631599aa37b9649c62d116585681a7c90587","modified":1658123289857},{"_id":"themes/Cxo/source/img/intro/index-bg.jpg","hash":"295646ceca0ef995c074d1340315af0619b64f90","modified":1658371294713},{"_id":"themes/Cxo/source/img/assets/nodejs.png","hash":"acba1689fd4be9632f76647732175eaeb97c9562","modified":1658371294704},{"_id":"themes/Cxo/package-lock.json","hash":"7b08215691522cfec99ccbe01de36a38e0472d26","modified":1658396007883},{"_id":"public/tags/index.html","hash":"be8489eeaeaeb1e6ca3d723be03a0c94e5cf226d","modified":1659402212944},{"_id":"public/2022/07/21/硬件结构/index.html","hash":"3853e8efe94fea0106c6bb5091a78e1d82fa55dd","modified":1658478824753},{"_id":"public/archives/index.html","hash":"04c7d185f9669e947f76992809b9236bcb0b42fa","modified":1659402212944},{"_id":"public/2022/07/21/hello-world/index.html","hash":"da40a0963d2a446e282625b570cfacba009ca446","modified":1658731099580},{"_id":"public/archives/2022/index.html","hash":"1563710fad61ad02bccb19a724190483e27be8c3","modified":1659402212944},{"_id":"public/archives/2022/07/index.html","hash":"745a0451116aa972c510c49d5b86ca49c030b313","modified":1658731099580},{"_id":"public/tags/操作系统/index.html","hash":"688db8bc3df4ba230f6be802a929335096d922bd","modified":1658731099580},{"_id":"public/index.html","hash":"98da99f312ab9d15b70392b584bb66d99e1e6f93","modified":1659402212944},{"_id":"public/img/assets/cat.png","hash":"a7349c7e55e288820856742a3dee55772d31f5d4","modified":1658449750742},{"_id":"public/img/assets/favicon.ico","hash":"63014c6c90c1440bce506c68593a233a8a8f52b8","modified":1658449750742},{"_id":"public/img/assets/kk.jpg","hash":"fe497d04280799886e30956fc8ee5b3cab04aee4","modified":1658449750742},{"_id":"public/img/intro/index-bg.png","hash":"2250b98a986baff6ec6a4113feabb4c85b5801f8","modified":1658449750742},{"_id":"public/font/SourceCodePro-Regular.ttf.woff","hash":"12eef75e1ad3eca9dae42b65505010ce4464a315","modified":1658449750742},{"_id":"public/font/Oswald-Regular.ttf","hash":"965d729546a43a8490ad4cf33c25ac475682100c","modified":1658449750742},{"_id":"public/font/SourceCodePro-Regular.ttf.woff2","hash":"f5991289ec17884cb641da0646d278d36702a190","modified":1658449750742},{"_id":"public/css/animation.css","hash":"21549baef6973b6b62e82c73b8273990951b3ba5","modified":1658449750742},{"_id":"public/js/main.js","hash":"071fceaaa3884b7a13630eb89468eed732c979f5","modified":1658449750742},{"_id":"public/css/style.css","hash":"f268a7bd68fc560e2657fffe8664424741fe9535","modified":1658497177895},{"_id":"public/img/demo/demo.png","hash":"731029b93f78c148817c8f2eef5dd6aefdbfd0aa","modified":1658449750742},{"_id":"public/img/assets/hexo.jpg","hash":"9e0487b49f442a0c66084dcf6b39c10d77d2a8fa","modified":1658449750742},{"_id":"public/img/intro/back.jpg","hash":"57f5631599aa37b9649c62d116585681a7c90587","modified":1658449750742},{"_id":"public/img/intro/index-bg.jpg","hash":"295646ceca0ef995c074d1340315af0619b64f90","modified":1658449750742},{"_id":"public/img/assets/nodejs.png","hash":"acba1689fd4be9632f76647732175eaeb97c9562","modified":1658449750742},{"_id":"themes/hexo-theme-volantis/layout/_partial/_cover/blank.ejs","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1658449169297},{"_id":"themes/hexo-theme-volantis/.gitignore","hash":"3b15373c917e42e63a86b5b06853c582c350f233","modified":1658449169278},{"_id":"themes/hexo-theme-volantis/.npmignore","hash":"04b4b0d1e72dfb0f80cc763b8d010b5c080def0a","modified":1658449169279},{"_id":"themes/hexo-theme-volantis/CHANGELOG.md","hash":"3945674b48b1035d531952efcf0dacd902563452","modified":1658449169280},{"_id":"themes/hexo-theme-volantis/LICENSE","hash":"e0cbf6906cab5926a34f17852db6c05187ee1f68","modified":1658449169280},{"_id":"themes/hexo-theme-volantis/README.md","hash":"6b6b43b65883630f87fa50c8c1aaea00efc374c7","modified":1658449169281},{"_id":"themes/hexo-theme-volantis/.github/PULL_REQUEST_TEMPLATE.md","hash":"75aee6f4de93379c21ff1a2faf185def4349eb83","modified":1658449169266},{"_id":"themes/hexo-theme-volantis/package.json","hash":"4c0de9378fd829133a84a4152195d44f9ed8c97b","modified":1658449169403},{"_id":"themes/hexo-theme-volantis/.github/config.yml","hash":"bffc5c3d4fb49467779092628519cfc456362a67","modified":1658449169267},{"_id":"themes/hexo-theme-volantis/.idea/.gitignore","hash":"2651f4f8d4c0bf5a32b70ebda7b00cbbe08d36a0","modified":1658449191445},{"_id":"themes/hexo-theme-volantis/.github/dependabot.yml","hash":"0529bb1480346534a85f86cfc6173e245c6ddd42","modified":1658449169268},{"_id":"themes/hexo-theme-volantis/.github/labeler.yml","hash":"59e05f201e2486e163ea1b5ab51a722609b83869","modified":1658449169269},{"_id":"themes/hexo-theme-volantis/.github/label-commenter-config.yml","hash":"8ccc1a5153d9343507b533df9afd7d063e7b5a2b","modified":1658449169268},{"_id":"themes/hexo-theme-volantis/.idea/hexo-theme-volantis.iml","hash":"402e38def734b476c4c697c9a36892567ab6af8b","modified":1658449191255},{"_id":"themes/hexo-theme-volantis/.github/publish.sh","hash":"f382bbecb7b806e3b609bc11ed4666d6c17a0b01","modified":1658449169270},{"_id":"themes/hexo-theme-volantis/.idea/vcs.xml","hash":"e692344d8c981d4806a673b29b1a6dc3b6b6d345","modified":1658449191287},{"_id":"themes/hexo-theme-volantis/languages/en.yml","hash":"f95a675710e4d803e1ca3cf733456b0943b7df17","modified":1658449169283},{"_id":"themes/hexo-theme-volantis/.idea/misc.xml","hash":"a1a111b0d6a5ebccf970dfd074782074ab8a2c52","modified":1658449191277},{"_id":"themes/hexo-theme-volantis/.idea/workspace.xml","hash":"e28ec3d7afa34db2ccfaecb83346aaab1098e7ff","modified":1658449583227},{"_id":"themes/hexo-theme-volantis/languages/zh-CN.yml","hash":"a797d98b1e9d44e6bf135984f1689269e5dfb3e7","modified":1658449169284},{"_id":"themes/hexo-theme-volantis/.idea/modules.xml","hash":"62d6890aab46321c87e3295f109ff068f9c7ebf5","modified":1658449191266},{"_id":"themes/hexo-theme-volantis/languages/zh-TW.yml","hash":"bebc38190efd292e78fecc89fd503d5e9d055864","modified":1658449169285},{"_id":"themes/hexo-theme-volantis/layout/404.ejs","hash":"64e4710cac866085ae8a1dff9520253a848ba7ef","modified":1658449169286},{"_id":"themes/hexo-theme-volantis/layout/archive.ejs","hash":"5a8469b31996ff6afd88d5e6b64e626453821c37","modified":1658449169396},{"_id":"themes/hexo-theme-volantis/_config.yml","hash":"bfac9cda619f2512b90f9dc74ec8a3f29434e54e","modified":1658449169282},{"_id":"themes/hexo-theme-volantis/layout/docs.ejs","hash":"2ebefc2d265d4ffafbd96108d5e04fe84e2a5a4d","modified":1658449169397},{"_id":"themes/hexo-theme-volantis/layout/_pre.ejs","hash":"89a0d5adfaa111a31922bc3fb919ea3388d66726","modified":1658449169380},{"_id":"themes/hexo-theme-volantis/layout/category.ejs","hash":"f85e15253c53ea05df113df7310f065c1cfc3a19","modified":1658449169397},{"_id":"themes/hexo-theme-volantis/layout/friends.ejs","hash":"022496003b447057da2eb3678ee017fd63dbcaa3","modified":1658449169398},{"_id":"themes/hexo-theme-volantis/layout/index.ejs","hash":"570368d44c0011236671f2c043c7b5de76f7d9b9","modified":1658449169399},{"_id":"themes/hexo-theme-volantis/layout/layout.ejs","hash":"1594191f99b6e1c3f68e278290ec99775047a772","modified":1658449169399},{"_id":"themes/hexo-theme-volantis/layout/page.ejs","hash":"2ebefc2d265d4ffafbd96108d5e04fe84e2a5a4d","modified":1658449169401},{"_id":"themes/hexo-theme-volantis/layout/list.ejs","hash":"4d9f954c92ebd50a875d5474514a78b220b82166","modified":1658449169400},{"_id":"themes/hexo-theme-volantis/layout/tag.ejs","hash":"8f422a11b651a03c6798a768d8fa5fb4e55dbdd2","modified":1658449169402},{"_id":"themes/hexo-theme-volantis/layout/post.ejs","hash":"2ebefc2d265d4ffafbd96108d5e04fe84e2a5a4d","modified":1658449169402},{"_id":"themes/hexo-theme-volantis/.github/ISSUE_TEMPLATE/zh-cn-1-help.yaml","hash":"92563e9f789d93587687b4ef7fbfdff51b4a7af3","modified":1658449169263},{"_id":"themes/hexo-theme-volantis/.github/workflows/label-commenter.yml","hash":"988e3ae3cdb5c60b8123405a3094be836c5a2a7d","modified":1658449169271},{"_id":"themes/hexo-theme-volantis/.github/ISSUE_TEMPLATE/config.yml","hash":"4704c14711bda8ffc88e6470e84112a571ffb15b","modified":1658449169262},{"_id":"themes/hexo-theme-volantis/.github/workflows/merge-conflicts.yml","hash":"c195cf4c97c0cfbb55b39fccf2f9e71b27c9b07b","modified":1658449169273},{"_id":"themes/hexo-theme-volantis/.github/workflows/labeler.yml","hash":"a8ea19facf61b6689b99cb63df271f1d0c349038","modified":1658449169272},{"_id":"themes/hexo-theme-volantis/.github/workflows/merge-squash-main.yml","hash":"052c849e9781dfeef2baa19dcadc8c0a74711e92","modified":1658449169274},{"_id":"themes/hexo-theme-volantis/.github/ISSUE_TEMPLATE/zh-cn-8-bug-report.yaml","hash":"5d742a43c376a072276dd288d95a7e694cf1c153","modified":1658449169264},{"_id":"themes/hexo-theme-volantis/.github/workflows/npm-publish.yml","hash":"178224d65c2bf2d3b867d2d2d6ba1aa0c2447b2d","modified":1658449169274},{"_id":"themes/hexo-theme-volantis/.github/ISSUE_TEMPLATE/zh-cn-9-other-issue.yaml","hash":"f4ca5c0d88683583f3135c64c0a654be7887d1ae","modified":1658449169265},{"_id":"themes/hexo-theme-volantis/.github/ISSUE_TEMPLATE/zh-cn-5-feature-request.yaml","hash":"1a393fb8e8595d2360d5e91bd9345b9b0e89a48b","modified":1658449169264},{"_id":"themes/hexo-theme-volantis/.github/workflows/pr-updater.yml","hash":"b901b909b7d5f15680a1d35ee46f2278d039e561","modified":1658449169275},{"_id":"themes/hexo-theme-volantis/layout/_meta/artalkcount.ejs","hash":"94c9e591e38ac00d6beafa44de4d29e70680c673","modified":1658449169287},{"_id":"themes/hexo-theme-volantis/layout/_meta/author.ejs","hash":"a95a474a0394a4b35b6d5d1604c98532155f6569","modified":1658449169288},{"_id":"themes/hexo-theme-volantis/.github/workflows/sync-coding.yml","hash":"a24319f5f8cbbd827d6d7f2b7afb03028ae41f53","modified":1658449169276},{"_id":"themes/hexo-theme-volantis/.github/workflows/release-please.yml","hash":"515e0b7a0cb0633b8918ec4734c18e9bc0fb01e0","modified":1658449169276},{"_id":"themes/hexo-theme-volantis/.github/workflows/test-deploy.yml","hash":"f1087b7d028a35e3e9b0cbf490d552141c4984f2","modified":1658449169277},{"_id":"themes/hexo-theme-volantis/layout/_meta/category.ejs","hash":"6d6dbb84cce90146b0e6ed130ea1c3581c54a029","modified":1658449169289},{"_id":"themes/hexo-theme-volantis/layout/_meta/counter.ejs","hash":"bdc8864ebc0be684293372c179f01605ef238bd7","modified":1658449169290},{"_id":"themes/hexo-theme-volantis/layout/_meta/music.ejs","hash":"0608d08b7f1cf6be529193c8b7fea99517b4a0d0","modified":1658449169291},{"_id":"themes/hexo-theme-volantis/layout/_meta/date.ejs","hash":"96f55772b90f582616d1adb414172c1bd8a9af2c","modified":1658449169290},{"_id":"themes/hexo-theme-volantis/layout/_meta/share.ejs","hash":"1fb300f5c2dca5d53d748fed8ccc343e69d1d9d5","modified":1658449169292},{"_id":"themes/hexo-theme-volantis/layout/_meta/tags.ejs","hash":"ff3b700a971fc3190653e2bf415f6d23a70a8f61","modified":1658449169293},{"_id":"themes/hexo-theme-volantis/layout/_meta/thumbnail.ejs","hash":"7aaa1093b8a96706cacba60d9390fbab602f65a4","modified":1658449169293},{"_id":"themes/hexo-theme-volantis/layout/_meta/updated.ejs","hash":"988a4486b768dc410541c262fef291b79390e98a","modified":1658449169294},{"_id":"themes/hexo-theme-volantis/layout/_meta/wordcount.ejs","hash":"eebaab3821af95ee64d8d56f33ca6c9c60b9b6f0","modified":1658449169295},{"_id":"themes/hexo-theme-volantis/layout/_partial/archive.ejs","hash":"7f97598ba10aa269589dbbde270e80beecf3d10a","modified":1658449169301},{"_id":"themes/hexo-theme-volantis/layout/_meta/walinecount.ejs","hash":"10b243ab927d356e682297b49b23a88c8f5ca653","modified":1658449169295},{"_id":"themes/hexo-theme-volantis/layout/_partial/categories.ejs","hash":"f7d893aee43e708865fa664d50237f9a73b240ed","modified":1658449169303},{"_id":"themes/hexo-theme-volantis/layout/_partial/article.ejs","hash":"d14654ba8d980753cccf8d60306eccc8f5be03fd","modified":1658449169302},{"_id":"themes/hexo-theme-volantis/layout/_partial/cover.ejs","hash":"7c0ff34dd099bcb24aab39c4872ff60e679c59d1","modified":1658449169303},{"_id":"themes/hexo-theme-volantis/layout/_partial/footer.ejs","hash":"07d666b807ece4befbc902ae34b6dcbcc8e59f45","modified":1658449169305},{"_id":"themes/hexo-theme-volantis/layout/_partial/header.ejs","hash":"d28f774144ec2aae2a42750e16f25fff16c9e39f","modified":1658449169307},{"_id":"themes/hexo-theme-volantis/layout/_partial/head.ejs","hash":"da5e7b8b969001d10cab1a8e6b529a92b3db5ddd","modified":1658449169306},{"_id":"themes/hexo-theme-volantis/layout/_partial/meta.ejs","hash":"ebeeb06f6c7aa167d64838f403fba6a307ad47d2","modified":1658449169307},{"_id":"themes/hexo-theme-volantis/layout/_partial/post.ejs","hash":"2184887f62ff94661e38aa98fda3b44cb3832283","modified":1658449169308},{"_id":"themes/hexo-theme-volantis/layout/_partial/side.ejs","hash":"b6d04940278e3f922f81fffeca1574de4fecf94a","modified":1658449169316},{"_id":"themes/hexo-theme-volantis/layout/_widget/blogger.ejs","hash":"29e04a487763904caee0913c6d3569bfc1fab2ec","modified":1658449169382},{"_id":"themes/hexo-theme-volantis/layout/_widget/_pre.ejs","hash":"af915f88c136595eb695820548adf028470f47b4","modified":1658449169381},{"_id":"themes/hexo-theme-volantis/layout/_widget/category.ejs","hash":"4149960a047e969d1982d2492a8d0416d3501a69","modified":1658449169382},{"_id":"themes/hexo-theme-volantis/layout/_widget/copyright.ejs","hash":"63c5129b1b94ba50b9d5ba0b8656c65a13a14444","modified":1658449169383},{"_id":"themes/hexo-theme-volantis/layout/_widget/group.ejs","hash":"1b7976d02ce069d7b738a768e6b8665a033c00f3","modified":1658449169385},{"_id":"themes/hexo-theme-volantis/layout/_widget/grid.ejs","hash":"aeafbd9f5c7bf31ad120eda3d054e9bd00666fc8","modified":1658449169384},{"_id":"themes/hexo-theme-volantis/layout/_widget/header.ejs","hash":"b54a04af22efd55585af6e76ddbb7e856c5e9601","modified":1658449169386},{"_id":"themes/hexo-theme-volantis/layout/_widget/lastupdate.ejs","hash":"c311ba4c8b255c45313dc1ab7ddafd99ec7fe8af","modified":1658449169387},{"_id":"themes/hexo-theme-volantis/layout/_widget/load.ejs","hash":"530ddefc167f0a1907f49a35e6b6d3a9f3756f21","modified":1658449169389},{"_id":"themes/hexo-theme-volantis/layout/_widget/list.ejs","hash":"98eb30970421f7cfbc2a8f4f9ffc200eba8fac43","modified":1658449169388},{"_id":"themes/hexo-theme-volantis/layout/_widget/music.ejs","hash":"0491078df052b1ce7747a1be31c7c8fcf084c25a","modified":1658449169389},{"_id":"themes/hexo-theme-volantis/layout/_widget/page.ejs","hash":"e282b46b8ad7fbd95d6b0a2b89f3cad1ecf2b2e9","modified":1658449169390},{"_id":"themes/hexo-theme-volantis/layout/_widget/qrcode.ejs","hash":"016322fb85bba433bfa096290325a199fb9ba93f","modified":1658449169391},{"_id":"themes/hexo-theme-volantis/layout/_widget/related_posts.ejs","hash":"27cae9dd94922a4134b48f2c2419fb66a07f1129","modified":1658449169392},{"_id":"themes/hexo-theme-volantis/layout/_widget/references.ejs","hash":"c4669e92b922516265bb68b1802d759cf0265fbf","modified":1658449169392},{"_id":"themes/hexo-theme-volantis/scripts/events/index.js","hash":"e5aec98e65b4aea0e1b02fd695b0cf5fe1dce2c5","modified":1658449169405},{"_id":"themes/hexo-theme-volantis/layout/_widget/tagcloud.ejs","hash":"04cbd2ae65faa22540e53ae531bc3ca2893eb0f8","modified":1658449169393},{"_id":"themes/hexo-theme-volantis/layout/_widget/text.ejs","hash":"4e978821f385c1c0cceb6aec83262f6e99c6c89e","modified":1658449169394},{"_id":"themes/hexo-theme-volantis/source/css/Readme.md","hash":"8046a2fb69589fb01b19eec6ba903b93dacc5852","modified":1658449169448},{"_id":"themes/hexo-theme-volantis/layout/_widget/toc.ejs","hash":"38e1f546e04973054c983428539b14287c647c17","modified":1658449169394},{"_id":"themes/hexo-theme-volantis/layout/_widget/webinfo.ejs","hash":"29b70c3e5882afa3045b1282d03f88d30ccf5e84","modified":1658449169395},{"_id":"themes/hexo-theme-volantis/source/css/first.styl","hash":"03d4cb5ecd71014d4d42f0e331b48532d3763b03","modified":1658449169512},{"_id":"themes/hexo-theme-volantis/source/js/app.js","hash":"764ce62e9d54222dd70cf70f51d62f109fe2c4dc","modified":1658449169514},{"_id":"themes/hexo-theme-volantis/source/css/style.styl","hash":"1c7f0dcf5e01c26de6ebcb91c3e1a14b457135c2","modified":1658449169513},{"_id":"themes/hexo-theme-volantis/scripts/helpers/custom-files.js","hash":"aee8fc2ddec0f98221cc54d6059cc575c87194a1","modified":1658449169414},{"_id":"themes/hexo-theme-volantis/scripts/helpers/related-posts.js","hash":"8f5e201ababac080de44243338f62aae61010837","modified":1658449169420},{"_id":"themes/hexo-theme-volantis/scripts/helpers/first-style.js","hash":"63d067b9ae2334d1af35e286f38f04379f37a6cd","modified":1658449169415},{"_id":"themes/hexo-theme-volantis/scripts/helpers/revisioned.js","hash":"de52e8f05e653ab376ea16254bca4210383194b9","modified":1658449169421},{"_id":"themes/hexo-theme-volantis/scripts/tags/btn.js","hash":"1691e38dc3c7eb0810a4bb3247237661f2282005","modified":1658449169429},{"_id":"themes/hexo-theme-volantis/scripts/filters/content-visibility.js","hash":"67d73133319205bc0cc0872269702c1b0a5e4558","modified":1658449169411},{"_id":"themes/hexo-theme-volantis/scripts/filters/replace.js","hash":"590e94a78490367ec0e111d4f48de5c9e57e256a","modified":1658449169412},{"_id":"themes/hexo-theme-volantis/scripts/filters/img.js","hash":"2536854025b6c105ba27f9ab9e99fda05263d9f0","modified":1658449169412},{"_id":"themes/hexo-theme-volantis/scripts/tags/btns.js","hash":"cb00611b1c60bb96edde8d8c4d508b9e62229115","modified":1658449169430},{"_id":"themes/hexo-theme-volantis/scripts/tags/checkbox.js","hash":"7ad06787a2b9ae4e1aeaf397508db357223dce9f","modified":1658449169431},{"_id":"themes/hexo-theme-volantis/scripts/filters/z-lazyload.js","hash":"2340e56c2c7cdd796cba0d0aca7d4899780fa140","modified":1658449169413},{"_id":"themes/hexo-theme-volantis/scripts/tags/contributors.js","hash":"4b88c875b00ccb880b4bc1608450ea15251981b1","modified":1658449169432},{"_id":"themes/hexo-theme-volantis/scripts/tags/dropmenu.js","hash":"af00c0b28fdff2048f1287aca794d5ca8ec479be","modified":1658449169432},{"_id":"themes/hexo-theme-volantis/scripts/tags/folding.js","hash":"87e8a902420ee31eb8558198a2a6b59e2f22de68","modified":1658449169434},{"_id":"themes/hexo-theme-volantis/scripts/tags/fancybox.js","hash":"3699f69722dca8f1c621ad9bb27ff2aa9882a25b","modified":1658449169433},{"_id":"themes/hexo-theme-volantis/scripts/tags/friends.js","hash":"3ef111f3db1af6ab5be0a1e8880dee75e8e6d0e0","modified":1658449169436},{"_id":"themes/hexo-theme-volantis/scripts/tags/frame.js","hash":"45485cab9741943fcb498563c376fae3795d5349","modified":1658449169435},{"_id":"themes/hexo-theme-volantis/scripts/tags/image.js","hash":"f879b4fee542cf51c233fe436aba2a07c5f01259","modified":1658449169437},{"_id":"themes/hexo-theme-volantis/scripts/tags/ghcard.js","hash":"95277092799e243e7b3f3347271cd1cdba794a10","modified":1658449169436},{"_id":"themes/hexo-theme-volantis/scripts/tags/inline-labels.js","hash":"eaaedc3d65384e0beb4306534ef4ed202b46da18","modified":1658449169438},{"_id":"themes/hexo-theme-volantis/scripts/tags/link.js","hash":"9a488ef5040871d7a5178e86e787ba3f682a6e13","modified":1658449169439},{"_id":"themes/hexo-theme-volantis/scripts/tags/md.js","hash":"ab2bf2fd22b171e7556718db0e254f2b8de77b58","modified":1658449169439},{"_id":"themes/hexo-theme-volantis/scripts/tags/media.js","hash":"97a19d5d0e3136a411ca130eb4db3f5577c566cf","modified":1658449169440},{"_id":"themes/hexo-theme-volantis/scripts/tags/note.js","hash":"eba9d65a2564b91cf85f1a6a4388bcd5e0a3a5ee","modified":1658449169441},{"_id":"themes/hexo-theme-volantis/scripts/tags/pandown.js","hash":"d949c2da1b5d749efd53e0f91f8311597766f384","modified":1658449169442},{"_id":"themes/hexo-theme-volantis/scripts/tags/site.js","hash":"bc0ad5d47d13a1992f62f74eb41485759b7a71d0","modified":1658449169442},{"_id":"themes/hexo-theme-volantis/scripts/tags/span.js","hash":"d73eb17fc8064da31fae2823b9cfb1031ba0d105","modified":1658449169443},{"_id":"themes/hexo-theme-volantis/scripts/tags/swiper.js","hash":"f0171f07f494c0b0f3f8af265344add15813a676","modified":1658449169444},{"_id":"themes/hexo-theme-volantis/scripts/tags/table.js","hash":"13528b4ba9caffd5ea5c9ded4d048e9b9e8da5b0","modified":1658449169445},{"_id":"themes/hexo-theme-volantis/scripts/tags/tabs.js","hash":"7678a578498b4586c022910330250d1725bbfd42","modified":1658449169446},{"_id":"themes/hexo-theme-volantis/scripts/tags/timeline.js","hash":"0ff2717c342a12d7120bb6de6bf23968e56e4d5a","modified":1658449169446},{"_id":"themes/hexo-theme-volantis/layout/_partial/_cover/dock.ejs","hash":"21d8e3fd3872b0eb69f407c7e567544a90c630aa","modified":1658449169298},{"_id":"themes/hexo-theme-volantis/layout/_partial/_cover/featured.ejs","hash":"21d8e3fd3872b0eb69f407c7e567544a90c630aa","modified":1658449169298},{"_id":"themes/hexo-theme-volantis/layout/_partial/_cover/focus.ejs","hash":"21d8e3fd3872b0eb69f407c7e567544a90c630aa","modified":1658449169299},{"_id":"themes/hexo-theme-volantis/layout/_partial/_cover/layout.ejs","hash":"a965bd46f1d9471458436202ba1fac97c13452db","modified":1658449169300},{"_id":"themes/hexo-theme-volantis/layout/_partial/_cover/search.ejs","hash":"1c90d5ebe45d378070513ca9d5034a74ca15e133","modified":1658449169301},{"_id":"themes/hexo-theme-volantis/layout/_partial/scripts/_ctrl.ejs","hash":"b3ded924f33b145a491fe3a694c82f9f39133943","modified":1658449169309},{"_id":"themes/hexo-theme-volantis/layout/_partial/scripts/content-visibility-scroll-fix.ejs","hash":"9658f32778f796219378b34512f2d0b9873e5776","modified":1658449169312},{"_id":"themes/hexo-theme-volantis/layout/_partial/scripts/global.ejs","hash":"249fbaf882bf66309fb54a250eb86d242edf6bd7","modified":1658449169313},{"_id":"themes/hexo-theme-volantis/layout/_partial/scripts/index.ejs","hash":"4bc2d68155d6208db85eb5a435e1bdbcef6977bb","modified":1658449169314},{"_id":"themes/hexo-theme-volantis/layout/_partial/scripts/toc.ejs","hash":"91cd3da7fe0888e844f08a4d2bd63e5202794b4e","modified":1658449169315},{"_id":"themes/hexo-theme-volantis/layout/_plugins/analytics/LCCounter.ejs","hash":"d165260a59866e5ee437fb1e08e452b1fb351a52","modified":1658449169329},{"_id":"themes/hexo-theme-volantis/layout/_plugins/_page_plugins/index.ejs","hash":"8566bfbdedcbc07e9dbf68cf37200db86588ad8d","modified":1658449169324},{"_id":"themes/hexo-theme-volantis/layout/_plugins/aplayer/script.ejs","hash":"8adb7d4ea61beff612c897dbbf11708feb7a09d0","modified":1658449169332},{"_id":"themes/hexo-theme-volantis/layout/_plugins/aplayer/layout.ejs","hash":"9b64c819cd0301def53d223c2f3bd89e4962fd79","modified":1658449169331},{"_id":"themes/hexo-theme-volantis/layout/_plugins/darkmode/script.ejs","hash":"6c43562b2b404f594ffe5a5f242f697a000846ed","modified":1658449169356},{"_id":"themes/hexo-theme-volantis/layout/_plugins/analytics/script.ejs","hash":"09ccc55c52f40f85bfa3c741af8f073b82c756d4","modified":1658449169330},{"_id":"themes/hexo-theme-volantis/layout/_plugins/chat/index.ejs","hash":"99d149ca778a6b956e18a3d380b36a120bcb98e4","modified":1658449169334},{"_id":"themes/hexo-theme-volantis/layout/_plugins/comments/index.ejs","hash":"45e60c3f7e12c862dd08ef310689709847ba93c9","modified":1658449169346},{"_id":"themes/hexo-theme-volantis/layout/_plugins/github-api/script.ejs","hash":"5095fa0a33c95d5b1bfcd3f554df5256994bca26","modified":1658449169359},{"_id":"themes/hexo-theme-volantis/layout/_plugins/end-of-support/script.ejs","hash":"4fccde6d5a94aa6dcecd50b176a1a014acb75667","modified":1658449169358},{"_id":"themes/hexo-theme-volantis/layout/_plugins/lazyload/script.ejs","hash":"4171b54bf116985efd7247a113e0b65b2d9302a1","modified":1658449169364},{"_id":"themes/hexo-theme-volantis/layout/_plugins/highlight/script.ejs","hash":"98a4351c0750e7a9f35e136211f2ea5cc8f2900b","modified":1658449169362},{"_id":"themes/hexo-theme-volantis/layout/_plugins/nodewaves/script.ejs","hash":"e3d227b8366f62c65d1f8bbfba7061f43b36c806","modified":1658449169365},{"_id":"themes/hexo-theme-volantis/layout/_plugins/parallax/script.ejs","hash":"ee56f58a4127c1ce56ee802c964f45134629027b","modified":1658449169366},{"_id":"themes/hexo-theme-volantis/layout/_plugins/preload/script.ejs","hash":"d8904aaf8b1e14086b4ce9de9770a89e0f1c6a2b","modified":1658449169370},{"_id":"themes/hexo-theme-volantis/layout/_plugins/rightmenus/layout.ejs","hash":"31a1787705aa13d3e0eb1aacf76bc4db869cb37a","modified":1658449169373},{"_id":"themes/hexo-theme-volantis/layout/_plugins/pjax/animate.ejs","hash":"2b6b2fe421f8195766d5fef6fc4d740a4017eb32","modified":1658449169367},{"_id":"themes/hexo-theme-volantis/layout/_plugins/rightmenu/layout.ejs","hash":"11b5c4f1ca33a3a8fb8ea0243312c55d68f4105b","modified":1658449169371},{"_id":"themes/hexo-theme-volantis/layout/_plugins/scrollreveal/script.ejs","hash":"eae0c08c5c72745529fc1b7991a329df71ea3c07","modified":1658449169374},{"_id":"themes/hexo-theme-volantis/layout/_plugins/pjax/index.ejs","hash":"c59b0cc21b9f4a46ae01e91d2fd49a294baf992c","modified":1658449169368},{"_id":"themes/hexo-theme-volantis/layout/_plugins/pjax/pdata.ejs","hash":"463987b029265f2176eeef2b1fa669a3ff54d3b8","modified":1658449169369},{"_id":"themes/hexo-theme-volantis/layout/_plugins/search/script.ejs","hash":"5e6dd52fe2d82204eb3fe46a3f7c388cd322e93f","modified":1658449169375},{"_id":"themes/hexo-theme-volantis/layout/_plugins/slow-network/script.ejs","hash":"22453b063a7e7099c626f95c68bd96935240963d","modified":1658449169378},{"_id":"themes/hexo-theme-volantis/layout/_plugins/share/layout.ejs","hash":"aa714ba68918c2b9e74997161811ca35ff57da1c","modified":1658449169377},{"_id":"themes/hexo-theme-volantis/layout/_plugins/swiper/script.ejs","hash":"231a53364b50a99a32b43a4ec8360c3891c17557","modified":1658449169379},{"_id":"themes/hexo-theme-volantis/scripts/events/lib/check-environment.js","hash":"78cee9f132174cde6c4ae90380f6b577571c6633","modified":1658449169407},{"_id":"themes/hexo-theme-volantis/scripts/events/lib/check-configuration.js","hash":"dd4767e2d59c93fc16fc6fe40453ad0e561d7ed4","modified":1658449169406},{"_id":"themes/hexo-theme-volantis/scripts/events/lib/config.js","hash":"c7f41acca0889d9fb8e4a19666612ef3891d8689","modified":1658449169408},{"_id":"themes/hexo-theme-volantis/scripts/events/lib/render-stylus.js","hash":"9f2bce5fe6e951ddc3961c9dec64d448ca3b8c5e","modified":1658449169409},{"_id":"themes/hexo-theme-volantis/scripts/events/lib/stellar-tag-utils.js","hash":"e451be9a7b23bf52a0d0b02c3ac4101ca25f7ccd","modified":1658449169410},{"_id":"themes/hexo-theme-volantis/source/css/_defines/AutoPrefixCSS.styl","hash":"18fe976fb9241ef379ebcccc0b7a9cc599f65c51","modified":1658449169449},{"_id":"themes/hexo-theme-volantis/source/css/_defines/Readme.md","hash":"75c2fa01e58095a98d463e6b9bab1f0c04e38692","modified":1658449169450},{"_id":"themes/hexo-theme-volantis/source/css/_defines/color.styl","hash":"a5b9ef5385f3931eafb42a58715498b230103cc3","modified":1658449169451},{"_id":"themes/hexo-theme-volantis/source/css/_defines/effect.styl","hash":"96b8e1b97146946469dd965e7d04cf90b22eb497","modified":1658449169452},{"_id":"themes/hexo-theme-volantis/source/css/_defines/layout.styl","hash":"192d0a3b07f95e01a3952c5c88967068e0682cca","modified":1658449169454},{"_id":"themes/hexo-theme-volantis/source/css/_first/base_first.styl","hash":"9fb2a5aa7412d420e441f204b6dbd50a016584cf","modified":1658449169455},{"_id":"themes/hexo-theme-volantis/source/css/_first/cover_first.styl","hash":"881210244593d7125337d4f810d49b9699420b43","modified":1658449169456},{"_id":"themes/hexo-theme-volantis/source/css/_defines/func.styl","hash":"d5b08a9b533c8cde12e34f9f6df1bd4a994c46d2","modified":1658449169453},{"_id":"themes/hexo-theme-volantis/source/css/_defines/fonts.styl","hash":"9601ac0c9ecfb65288fa64eae67b2a6b6e56d8dd","modified":1658449169453},{"_id":"themes/hexo-theme-volantis/source/css/_first/dark_first.styl","hash":"f7ee92842e4fa71c5b709a1cb75af3dcc06d381b","modified":1658449169457},{"_id":"themes/hexo-theme-volantis/source/css/_first/search_first.styl","hash":"4eedde6a3806741a450de0aeffa5a100d9c2d408","modified":1658449169460},{"_id":"themes/hexo-theme-volantis/source/css/_first/fontfamily_first.styl","hash":"cce88d81a8e21cce65b7fd586765e8819388d31d","modified":1658449169458},{"_id":"themes/hexo-theme-volantis/source/css/_first/navbar_first.styl","hash":"cb85492e8ae8878fc99e52b14610a9122336a2be","modified":1658449169459},{"_id":"themes/hexo-theme-volantis/source/js/plugins/aplayer.js","hash":"caa3621d74f24a00357e4d4ce3c90436c799d4e0","modified":1658449169516},{"_id":"themes/hexo-theme-volantis/source/js/plugins/parallax.js","hash":"ac6b9b60ff4a739649882723f653896a73a89ec5","modified":1658449169517},{"_id":"themes/hexo-theme-volantis/source/css/_style/index.styl","hash":"b02f576a0e909e01180e3996c3965e06a681f21b","modified":1658449169511},{"_id":"themes/hexo-theme-volantis/source/js/plugins/rightMenu.js","hash":"cb2f17ab10127065f7b9f5f87a49921d25b287e1","modified":1658449169518},{"_id":"themes/hexo-theme-volantis/source/js/search/hexo.js","hash":"dadfa36cd6c42aa6caf072fac7413fcf4de36cbd","modified":1658449169523},{"_id":"themes/hexo-theme-volantis/source/js/plugins/rightMenus.js","hash":"c45c58ab6597ffd8b5de70032c07dcd37836086f","modified":1658449169518},{"_id":"themes/hexo-theme-volantis/scripts/helpers/head/autoCanonical.js","hash":"2021e20e02651c7007245c8fd70254a282ddceba","modified":1658449169416},{"_id":"themes/hexo-theme-volantis/scripts/helpers/structured-data/index.js","hash":"61c9b7577bebb41fb0fb0ddd907f7d89abef30e7","modified":1658449169422},{"_id":"themes/hexo-theme-volantis/layout/_partial/scripts/_ctrl/coverCtrl.ejs","hash":"d99909694b96f78c48b3433fb8c6d70cc8f92e6e","modified":1658449169312},{"_id":"themes/hexo-theme-volantis/scripts/helpers/head/generate_seo.js","hash":"50d940023751baa849ab8635d662ba0348069197","modified":1658449169418},{"_id":"themes/hexo-theme-volantis/scripts/helpers/head/generate_title__keywords__description.js","hash":"64367f8563b05cf5a721f3d0883fb156c2d69964","modified":1658449169419},{"_id":"themes/hexo-theme-volantis/scripts/helpers/head/generate_preload_fontfamily.js","hash":"b4b9f902aa1b43e7814158e1bdb9b723828210d6","modified":1658449169417},{"_id":"themes/hexo-theme-volantis/layout/_partial/scripts/_ctrl/cdnCtrl.ejs","hash":"81461c1e29e342c3e16902d50785c987901ebe45","modified":1658449169311},{"_id":"themes/hexo-theme-volantis/layout/_plugins/_page_plugins/bbtalk/index.ejs","hash":"0637551061ebfa965304f6bccad02589d36e03ad","modified":1658449169319},{"_id":"themes/hexo-theme-volantis/layout/_plugins/_page_plugins/artitalk/index.ejs","hash":"e1e58a3403edd605231256dbc6dfed2840d3c5c1","modified":1658449169318},{"_id":"themes/hexo-theme-volantis/layout/_plugins/_page_plugins/gitter/index.ejs","hash":"b6e00d7d8a3201e219456dca6572518baae26dcf","modified":1658449169322},{"_id":"themes/hexo-theme-volantis/layout/_plugins/_page_plugins/fcircle/index.ejs","hash":"6b049a631b22be18417b3a9aef3b5881b30f4581","modified":1658449169320},{"_id":"themes/hexo-theme-volantis/layout/_plugins/_page_plugins/indent/index.ejs","hash":"7d112cde9b8d1785d8c541cde94361e0bfc60f30","modified":1658449169323},{"_id":"themes/hexo-theme-volantis/layout/_plugins/chat/gitter/script.ejs","hash":"2a9780cb228944d671f959610aea710e6db6bac0","modified":1658449169333},{"_id":"themes/hexo-theme-volantis/layout/_plugins/_page_plugins/katex/index.ejs","hash":"bda18a99909a011096cc9a21b253eb757603f4f0","modified":1658449169325},{"_id":"themes/hexo-theme-volantis/layout/_plugins/comments/artalk/script.ejs","hash":"9c607d5588537875f9c23ce46b7b031e78b95ff4","modified":1658449169337},{"_id":"themes/hexo-theme-volantis/layout/_plugins/_page_plugins/mathjax/index.ejs","hash":"8532590d2c82b1dfb8a6dcaae57d4465893ac9e6","modified":1658449169326},{"_id":"themes/hexo-theme-volantis/layout/_plugins/_page_plugins/snackbar/index.ejs","hash":"8d355f4f1552ffbd5099b7dea7954e6cb415a83b","modified":1658449169327},{"_id":"themes/hexo-theme-volantis/layout/_plugins/comments/beaudar/script.ejs","hash":"e41ebffd14a156ece266877f4cc94e4931b3e95e","modified":1658449169338},{"_id":"themes/hexo-theme-volantis/layout/_plugins/comments/disqus/script.ejs","hash":"5bc7f960cd0ec2a72cc150d73b004a8d0836c6ec","modified":1658449169341},{"_id":"themes/hexo-theme-volantis/layout/_plugins/chat/tidio/script.ejs","hash":"36dd36c2a4ade5f873978b554033115908959a29","modified":1658449169335},{"_id":"themes/hexo-theme-volantis/layout/_plugins/comments/discuss/script.ejs","hash":"a739252d569ee389ec80e706435142f7dbb56cd5","modified":1658449169340},{"_id":"themes/hexo-theme-volantis/layout/_plugins/comments/disqusjs/script.ejs","hash":"0da595e62782e64d6cdf67f285c576ad2d4ed653","modified":1658449169342},{"_id":"themes/hexo-theme-volantis/layout/_plugins/comments/gitalk/script.ejs","hash":"ba4922e0f07c4bb5a1c8e233d5f88130dc6f73bc","modified":1658449169345},{"_id":"themes/hexo-theme-volantis/layout/_plugins/comments/hashover/script.ejs","hash":"4410ff1f7dd6aa48b12ddec49bdeb177e85b1f53","modified":1658449169346},{"_id":"themes/hexo-theme-volantis/layout/_plugins/comments/giscus/script.ejs","hash":"7b845e839a4c03c700b6cf13590218d3e2b533b0","modified":1658449169343},{"_id":"themes/hexo-theme-volantis/layout/_plugins/comments/livere/script.ejs","hash":"ab7aa8ab3b8ca510ef7e2f47fb23a4f9a2701979","modified":1658449169349},{"_id":"themes/hexo-theme-volantis/layout/_plugins/comments/isso/script.ejs","hash":"dfbff9b81ce537a7da0ab1cc95480ebc4cb4cffa","modified":1658449169348},{"_id":"themes/hexo-theme-volantis/layout/_plugins/comments/utterances/script.ejs","hash":"844eef0906a67fa8d42a331578e5538e33521aef","modified":1658449169351},{"_id":"themes/hexo-theme-volantis/layout/_plugins/comments/twikoo/script.ejs","hash":"fa612a479809aa5052344a79c7afc638e8e79211","modified":1658449169350},{"_id":"themes/hexo-theme-volantis/layout/_plugins/comments/vssue/script.ejs","hash":"a29b1e96e939f3e8ebd1a25b296d5b27a3384d95","modified":1658449169353},{"_id":"themes/hexo-theme-volantis/layout/_plugins/highlight/highlightjs/script.ejs","hash":"662e4e3b6c911a6fdffb2c34d012f8b6f70af31f","modified":1658449169361},{"_id":"themes/hexo-theme-volantis/layout/_plugins/comments/z-custom/script.ejs","hash":"9c9c19d0de11ff183ffea60910681d9e91c13f9d","modified":1658449169355},{"_id":"themes/hexo-theme-volantis/layout/_plugins/highlight/prismjs/script.ejs","hash":"67e3d498c2d157f6828a1b8165580b542bf8affa","modified":1658449169362},{"_id":"themes/hexo-theme-volantis/layout/_plugins/comments/waline/script.ejs","hash":"a5df6ebc1eed0b23344eb72a39d4033e4fd3519f","modified":1658449169354},{"_id":"themes/hexo-theme-volantis/source/css/_style/_base/base.styl","hash":"af90d8a3cee62ef41bb141602472362c6ac1ae07","modified":1658449169461},{"_id":"themes/hexo-theme-volantis/source/css/_style/_base/fontfamily_async.styl","hash":"7b6f2da48a225b3d836d7b2e5dfa90fa18dc3174","modified":1658449169462},{"_id":"themes/hexo-theme-volantis/source/css/_style/_layout/archive.styl","hash":"93a0846f1d65d66950403aba90ed5a8b5c8a9884","modified":1658449169463},{"_id":"themes/hexo-theme-volantis/source/css/_style/_layout/friends-simpleuser.styl","hash":"3d8e963fd1c24668fc1df078c619c4126f6a8a93","modified":1658449169466},{"_id":"themes/hexo-theme-volantis/source/css/_style/_layout/article.styl","hash":"babc146cbb87951544dc915b00692956a97d6c1e","modified":1658449169464},{"_id":"themes/hexo-theme-volantis/source/css/_style/_layout/friends-traditional.styl","hash":"c5a3d30071b3208bd6af2b11df94e729b0537ea2","modified":1658449169467},{"_id":"themes/hexo-theme-volantis/source/css/_style/_layout/footer.styl","hash":"5146a149d97dfaa88ae4bf819b60bab2f8d92a53","modified":1658449169465},{"_id":"themes/hexo-theme-volantis/source/css/_style/_layout/img.styl","hash":"7f733971a7862fc5764a953ae4f8e17c171ff1b6","modified":1658449169467},{"_id":"themes/hexo-theme-volantis/source/css/_style/_layout/loading.styl","hash":"c6757684fa37ced88e181b91c873644d1bde591d","modified":1658449169468},{"_id":"themes/hexo-theme-volantis/source/css/_style/_layout/md.styl","hash":"3e43f6ddcbf010feaa1a686b212f0d7e42f51e78","modified":1658449169470},{"_id":"themes/hexo-theme-volantis/source/css/_style/_layout/main.styl","hash":"8781ae9afeb933d66346b5643b5e6b2bd4e15d16","modified":1658449169469},{"_id":"themes/hexo-theme-volantis/source/css/_style/_layout/pagination.styl","hash":"d727004c3bbe16ace26bfcd45dd7b2f1202acec4","modified":1658449169470},{"_id":"themes/hexo-theme-volantis/source/css/_style/_layout/posts.styl","hash":"df0c63cce7e7e2e7415d6efd0710cac37573389d","modified":1658449169471},{"_id":"themes/hexo-theme-volantis/source/css/_style/_layout/search.styl","hash":"411e32f7346e7f742b1e0078e641e8b5df875faf","modified":1658449169472},{"_id":"themes/hexo-theme-volantis/source/css/_style/_layout/sidebar.styl","hash":"810feced0a40373d012f47a04d62ef85cb5cdb63","modified":1658449169473},{"_id":"themes/hexo-theme-volantis/source/css/_style/_layout/snackbar.styl","hash":"c3137362a2615159565477cab19afb1fc2d22cbf","modified":1658449169474},{"_id":"themes/hexo-theme-volantis/source/css/_style/_layout/toc.styl","hash":"c22db26a72dff5d7c73171f22a66231550d93e09","modified":1658449169474},{"_id":"themes/hexo-theme-volantis/source/css/_style/_layout/video.styl","hash":"94bdeb9f28ba503a7a3fbd1148bc349983c17818","modified":1658449169475},{"_id":"themes/hexo-theme-volantis/source/css/_style/_plugins/aplayer.styl","hash":"5babeff5defa56e7d8db229ae4605f19bef9cd61","modified":1658449169489},{"_id":"themes/hexo-theme-volantis/source/css/_style/_plugins/cursor.styl","hash":"ba39aaa74ff3c20a6d13c2856a0ccbd0c111f8e5","modified":1658449169489},{"_id":"themes/hexo-theme-volantis/source/css/_style/_plugins/fontcolor.styl","hash":"de8c4f209c118c4b391223d46c2d662332cadaa1","modified":1658449169490},{"_id":"themes/hexo-theme-volantis/source/css/_style/_plugins/gitalk.styl","hash":"17938fd65f7996c71e382934553af9fdee6a0e18","modified":1658449169491},{"_id":"themes/hexo-theme-volantis/source/css/_style/_tag-plugins/Readme.md","hash":"4840c72bf8ff1cdf2e16c8bc10a2410246946090","modified":1658449169495},{"_id":"themes/hexo-theme-volantis/source/css/_style/_plugins/mathjax.styl","hash":"95b0c51b678bc3ecc607bcf52d97b9634931ccba","modified":1658449169492},{"_id":"themes/hexo-theme-volantis/source/css/_style/_plugins/index.styl","hash":"30e8ce417052487f6a08ab8c9f88a6259a958c2f","modified":1658449169492},{"_id":"themes/hexo-theme-volantis/source/css/_style/_plugins/message.styl","hash":"32eaf66de2f82e4c364b9244c5eef6380ec00bb4","modified":1658449169493},{"_id":"themes/hexo-theme-volantis/source/css/_style/_plugins/pjaxanimate.styl","hash":"9664f37f2632e17c2d6bd93eb587d4df9aefa265","modified":1658449169494},{"_id":"themes/hexo-theme-volantis/source/css/_style/_tag-plugins/btns.styl","hash":"525919d04929c2c849f3aae587ecc6a004b05e86","modified":1658449169496},{"_id":"themes/hexo-theme-volantis/source/css/_style/_tag-plugins/checkbox.styl","hash":"ae7ae8a3377525396a9163d32ca76c11647d877d","modified":1658449169497},{"_id":"themes/hexo-theme-volantis/source/css/_style/_tag-plugins/dropmenu.styl","hash":"469d3458db6531b1283768bbae30f283110d1726","modified":1658449169497},{"_id":"themes/hexo-theme-volantis/source/css/_style/_tag-plugins/folding.styl","hash":"40fe5c009ad79325b1ad8c88b6d146682035348c","modified":1658449169499},{"_id":"themes/hexo-theme-volantis/source/css/_style/_tag-plugins/fancybox.styl","hash":"671f43ec7ee5b98227ce60e4b564eee5281f92ea","modified":1658449169498},{"_id":"themes/hexo-theme-volantis/source/css/_style/_tag-plugins/frame.styl","hash":"0f6230d77f22f0969d15d092b3d973c08d2219cc","modified":1658449169500},{"_id":"themes/hexo-theme-volantis/source/css/_style/_tag-plugins/friends.styl","hash":"b76cf16571ac2099a39fe35a238e4d735b4115e1","modified":1658449169500},{"_id":"themes/hexo-theme-volantis/source/css/_style/_tag-plugins/image.styl","hash":"842f58a4c464d5ec59038cc923dbce1dd432362b","modified":1658449169502},{"_id":"themes/hexo-theme-volantis/source/css/_style/_tag-plugins/ghcard.styl","hash":"3a6fd480b244c76ac670b418e461c0f77bd9f4d4","modified":1658449169501},{"_id":"themes/hexo-theme-volantis/source/css/_style/_tag-plugins/link.styl","hash":"870a0d50082116adffe385d7695e28795542aa23","modified":1658449169502},{"_id":"themes/hexo-theme-volantis/source/css/_style/_tag-plugins/note.styl","hash":"959a9fe09cf9d0c29de76d05d6123c337a259ab5","modified":1658449169504},{"_id":"themes/hexo-theme-volantis/source/css/_style/_tag-plugins/media.styl","hash":"03c9942ed8560b923ac3535e7e80396d4a92df04","modified":1658449169503},{"_id":"themes/hexo-theme-volantis/source/css/_style/_tag-plugins/sites.styl","hash":"f20f37b20ca803db2981e8931d70f0dd78bca30e","modified":1658449169505},{"_id":"themes/hexo-theme-volantis/source/css/_style/_tag-plugins/span.styl","hash":"cdda513cbc9d95e9311a0a52c06ae7d1d250a769","modified":1658449169506},{"_id":"themes/hexo-theme-volantis/source/css/_style/_tag-plugins/swiper.styl","hash":"819385594f1825e26074ade900835a3f4031fe42","modified":1658449169507},{"_id":"themes/hexo-theme-volantis/source/js/plugins/tags/contributors.js","hash":"b3350dc951f34477cb1143cf11a53661fd0e551a","modified":1658449169520},{"_id":"themes/hexo-theme-volantis/source/css/_style/_tag-plugins/table.styl","hash":"84abe90bc0b505d35d8e702337fcbe5da6ee1217","modified":1658449169507},{"_id":"themes/hexo-theme-volantis/source/css/_style/_tag-plugins/tabs.styl","hash":"5cb4366b6ed139c952b846357e9d077b5c1b9c66","modified":1658449169508},{"_id":"themes/hexo-theme-volantis/source/js/plugins/tags/sites.js","hash":"dff484d3f64681e725868fd62613a3658660992c","modified":1658449169522},{"_id":"themes/hexo-theme-volantis/source/js/plugins/tags/friends.js","hash":"9643d9d9ef4a11ab690bd7755a92bb56fc392ed0","modified":1658449169521},{"_id":"themes/hexo-theme-volantis/source/css/_style/_tag-plugins/text.styl","hash":"7231d9c0e1e05a3ab7094d6ff4d1c37d97a1e8af","modified":1658449169510},{"_id":"themes/hexo-theme-volantis/source/css/_style/_tag-plugins/tag.json","hash":"a453d6ed0ed5de78364a8356703d250bb9cf43d6","modified":1658449169509},{"_id":"themes/hexo-theme-volantis/source/css/_style/_tag-plugins/timeline.styl","hash":"14b86f0ad0098e679d66dae7d997802c77a27141","modified":1658449169510},{"_id":"themes/hexo-theme-volantis/scripts/helpers/structured-data/lib/blogposting.js","hash":"9d3a9091b97fcea1bde3b61425bdd3c65f5368b7","modified":1658449169423},{"_id":"themes/hexo-theme-volantis/scripts/helpers/structured-data/lib/breadcrumblist.js","hash":"5cb20b6b04f018a6b5eab07c4759e743d28e050f","modified":1658449169424},{"_id":"themes/hexo-theme-volantis/scripts/helpers/structured-data/lib/config.js","hash":"f76ce54f0a2d1b951491379afebabf3590c47642","modified":1658449169425},{"_id":"themes/hexo-theme-volantis/scripts/helpers/structured-data/lib/index.js","hash":"525bbb3e0eeff380ff23a28d81797ef06a53bd08","modified":1658449169426},{"_id":"themes/hexo-theme-volantis/source/css/_style/_plugins/_dark/dark_async.styl","hash":"643453859ba9509ee1bf2487035f08e4dbfb2b48","modified":1658449169477},{"_id":"themes/hexo-theme-volantis/scripts/helpers/structured-data/lib/organization.js","hash":"21b509275f7d43b0f95bb122468d6f301ff7b76e","modified":1658449169427},{"_id":"themes/hexo-theme-volantis/source/css/_style/_plugins/_dark/dark_plugins.styl","hash":"0716f7c3af19c8911398526c734580b13f465fd5","modified":1658449169478},{"_id":"themes/hexo-theme-volantis/scripts/helpers/structured-data/lib/person.js","hash":"d19975f00233c9b7625020fdbb6142128098a10e","modified":1658449169427},{"_id":"themes/hexo-theme-volantis/scripts/helpers/structured-data/lib/website.js","hash":"d1e92abc94eaa7a141744e07b00280078b750d25","modified":1658449169428},{"_id":"themes/hexo-theme-volantis/source/css/_style/_plugins/_rightmenu/reading.styl","hash":"18cefb0667407e9dd15fde96c5577fc7ba0ecaf3","modified":1658449169487},{"_id":"themes/hexo-theme-volantis/source/css/_style/_plugins/_highlight/index.styl","hash":"c62f0c706c08ec7a830f7ede2d04996ccc721e90","modified":1658449169483},{"_id":"themes/hexo-theme-volantis/source/css/_style/_plugins/_rightmenu/rightmenu.styl","hash":"3c55aa5549e505d87652e418dae345259add247b","modified":1658449169487},{"_id":"themes/hexo-theme-volantis/source/css/_style/_plugins/_highlight/highlightjs/clipboard.styl","hash":"f2b95f90b15ad610b6f2668316233bb2e4a65cf0","modified":1658449169480},{"_id":"themes/hexo-theme-volantis/source/css/_style/_plugins/_highlight/prismjs/clipboard.styl","hash":"6dcea4963642a693869411ad40df703a716790d6","modified":1658449169484},{"_id":"themes/hexo-theme-volantis/source/css/_style/_plugins/_highlight/prismjs/language.styl","hash":"7773ed6757f1cc1f4ce4d8c991d721a5d49a8a92","modified":1658449169485},{"_id":"themes/hexo-theme-volantis/source/css/_style/_plugins/_highlight/prismjs/index.styl","hash":"273196519db0ac4e223458e002e2ad0536213ba5","modified":1658449169485},{"_id":"themes/hexo-theme-volantis/source/css/_style/_plugins/_highlight/highlightjs/color.styl","hash":"7ba7e4aeacc31b12c5fc57317d902b3742aa6c38","modified":1658449169480},{"_id":"themes/hexo-theme-volantis/source/css/_style/_plugins/_highlight/highlightjs/index.styl","hash":"661f36ee05c75465a046fcdca091f406c96cb37d","modified":1658449169481},{"_id":"themes/hexo-theme-volantis/source/css/_style/_plugins/_highlight/highlightjs/language.styl","hash":"aa98bc49ba55119529c47175eaa3e87f44eae26c","modified":1658449169482},{"_id":"themes/hexo-theme-volantis/package-lock.json","hash":"9650457278ade150d72f09d221acd1df2da1e368","modified":1658449228562},{"_id":"public/js/plugins/parallax.8bf0ab10.js","hash":"3c3210bde6e86d7d157c34c14796abe98cb1bbd0","modified":1658500277655},{"_id":"public/css/style.8593fb4d.css","hash":"eb9ecb71da30a9c2bcf2a27811b7bb4225bc5d36","modified":1658449895854},{"_id":"public/js/plugins/rightMenu.d9437285.js","hash":"58d3b19e244f20cb24b0c24120d3f00fc26dc5fe","modified":1658500277655},{"_id":"public/js/plugins/rightMenus.1aa99ff1.js","hash":"7c8aac4ab7bfd3d61723022b04d6f0584fcf6e7d","modified":1658500277655},{"_id":"public/js/plugins/tags/sites.76bf19b8.js","hash":"47b0ff4a3ccea2da9b60023cb4288f979504b0c7","modified":1658500277655},{"_id":"public/js/app.af2d54c8.js","hash":"99a253ee9b6f6c797df42785d88c8600424b65b4","modified":1658500277655},{"_id":"public/js/search/hexo.0e52f222.js","hash":"286a7bac5fad588539f9b28ddea38cde573a69f8","modified":1658500277655},{"_id":"public/js/plugins/tags/contributors.aec80453.js","hash":"cf1af362cf73c83a28ae2651eb1daafaed2ec91f","modified":1658500277655},{"_id":"public/js/plugins/tags/friends.f372da57.js","hash":"7d53cf366638d0e254f7f26de01c8892710d1d23","modified":1658500277655},{"_id":"public/js/plugins/aplayer.js","hash":"95f2e47535c8d37e90cab7726d25845cf01ca477","modified":1658449895854},{"_id":"public/css/Readme.html","hash":"942e993f16d5c13b617561506efbed0088016a5d","modified":1658449895854},{"_id":"public/css/first.css","hash":"e3211bf589cf4d6b786220773c97cb93fb123324","modified":1658449895854},{"_id":"public/js/search/hexo.js","hash":"286a7bac5fad588539f9b28ddea38cde573a69f8","modified":1658497177895},{"_id":"public/js/plugins/tags/contributors.js","hash":"cf1af362cf73c83a28ae2651eb1daafaed2ec91f","modified":1658497177895},{"_id":"public/js/plugins/parallax.js","hash":"3c3210bde6e86d7d157c34c14796abe98cb1bbd0","modified":1658497177895},{"_id":"public/js/app.js","hash":"99a253ee9b6f6c797df42785d88c8600424b65b4","modified":1658497177895},{"_id":"public/js/plugins/rightMenu.js","hash":"58d3b19e244f20cb24b0c24120d3f00fc26dc5fe","modified":1658497177895},{"_id":"public/js/plugins/rightMenus.js","hash":"7c8aac4ab7bfd3d61723022b04d6f0584fcf6e7d","modified":1658497177895},{"_id":"public/js/plugins/tags/friends.js","hash":"7d53cf366638d0e254f7f26de01c8892710d1d23","modified":1658497177895},{"_id":"public/js/plugins/tags/sites.js","hash":"47b0ff4a3ccea2da9b60023cb4288f979504b0c7","modified":1658497177895},{"_id":"themes/volantis/layout/_partial/_cover/blank.ejs","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1658450625482},{"_id":"themes/volantis/.gitignore","hash":"3b15373c917e42e63a86b5b06853c582c350f233","modified":1658450625465},{"_id":"themes/volantis/.npmignore","hash":"04b4b0d1e72dfb0f80cc763b8d010b5c080def0a","modified":1658450625466},{"_id":"themes/volantis/LICENSE","hash":"e0cbf6906cab5926a34f17852db6c05187ee1f68","modified":1658450625467},{"_id":"themes/volantis/README.md","hash":"6b6b43b65883630f87fa50c8c1aaea00efc374c7","modified":1658450625468},{"_id":"themes/volantis/CHANGELOG.md","hash":"3945674b48b1035d531952efcf0dacd902563452","modified":1658450625466},{"_id":"themes/volantis/.github/PULL_REQUEST_TEMPLATE.md","hash":"75aee6f4de93379c21ff1a2faf185def4349eb83","modified":1658450625454},{"_id":"themes/volantis/package.json","hash":"4c0de9378fd829133a84a4152195d44f9ed8c97b","modified":1658450625577},{"_id":"themes/volantis/.github/config.yml","hash":"bffc5c3d4fb49467779092628519cfc456362a67","modified":1658450625455},{"_id":"themes/volantis/.github/dependabot.yml","hash":"0529bb1480346534a85f86cfc6173e245c6ddd42","modified":1658450625456},{"_id":"themes/volantis/.github/label-commenter-config.yml","hash":"8ccc1a5153d9343507b533df9afd7d063e7b5a2b","modified":1658450625456},{"_id":"themes/volantis/languages/en.yml","hash":"f95a675710e4d803e1ca3cf733456b0943b7df17","modified":1658450625470},{"_id":"themes/volantis/_config.yml","hash":"25afde0d99484a746fb0b0d61c48fca1f5d60896","modified":1658675103417},{"_id":"themes/volantis/.github/labeler.yml","hash":"59e05f201e2486e163ea1b5ab51a722609b83869","modified":1658450625457},{"_id":"themes/volantis/.github/publish.sh","hash":"f382bbecb7b806e3b609bc11ed4666d6c17a0b01","modified":1658450625458},{"_id":"themes/volantis/layout/404.ejs","hash":"64e4710cac866085ae8a1dff9520253a848ba7ef","modified":1658450625473},{"_id":"themes/volantis/languages/zh-TW.yml","hash":"bebc38190efd292e78fecc89fd503d5e9d055864","modified":1658450625472},{"_id":"themes/volantis/layout/_pre.ejs","hash":"89a0d5adfaa111a31922bc3fb919ea3388d66726","modified":1658450625556},{"_id":"themes/volantis/languages/zh-CN.yml","hash":"a797d98b1e9d44e6bf135984f1689269e5dfb3e7","modified":1658450625471},{"_id":"themes/volantis/layout/archive.ejs","hash":"5a8469b31996ff6afd88d5e6b64e626453821c37","modified":1658450625570},{"_id":"themes/volantis/layout/friends.ejs","hash":"022496003b447057da2eb3678ee017fd63dbcaa3","modified":1658450625572},{"_id":"themes/volantis/layout/category.ejs","hash":"f85e15253c53ea05df113df7310f065c1cfc3a19","modified":1658450625571},{"_id":"themes/volantis/layout/docs.ejs","hash":"2ebefc2d265d4ffafbd96108d5e04fe84e2a5a4d","modified":1658450625571},{"_id":"themes/volantis/layout/index.ejs","hash":"570368d44c0011236671f2c043c7b5de76f7d9b9","modified":1658450625573},{"_id":"themes/volantis/layout/list.ejs","hash":"4d9f954c92ebd50a875d5474514a78b220b82166","modified":1658450625574},{"_id":"themes/volantis/layout/layout.ejs","hash":"1594191f99b6e1c3f68e278290ec99775047a772","modified":1658450625573},{"_id":"themes/volantis/layout/page.ejs","hash":"2ebefc2d265d4ffafbd96108d5e04fe84e2a5a4d","modified":1658450625575},{"_id":"themes/volantis/.github/ISSUE_TEMPLATE/config.yml","hash":"4704c14711bda8ffc88e6470e84112a571ffb15b","modified":1658450625450},{"_id":"themes/volantis/.github/ISSUE_TEMPLATE/zh-cn-1-help.yaml","hash":"92563e9f789d93587687b4ef7fbfdff51b4a7af3","modified":1658450625451},{"_id":"themes/volantis/layout/tag.ejs","hash":"8f422a11b651a03c6798a768d8fa5fb4e55dbdd2","modified":1658450625576},{"_id":"themes/volantis/layout/post.ejs","hash":"2ebefc2d265d4ffafbd96108d5e04fe84e2a5a4d","modified":1658450625575},{"_id":"themes/volantis/.github/ISSUE_TEMPLATE/zh-cn-5-feature-request.yaml","hash":"1a393fb8e8595d2360d5e91bd9345b9b0e89a48b","modified":1658450625452},{"_id":"themes/volantis/.github/workflows/label-commenter.yml","hash":"988e3ae3cdb5c60b8123405a3094be836c5a2a7d","modified":1658450625459},{"_id":"themes/volantis/.github/workflows/merge-conflicts.yml","hash":"c195cf4c97c0cfbb55b39fccf2f9e71b27c9b07b","modified":1658450625460},{"_id":"themes/volantis/.github/ISSUE_TEMPLATE/zh-cn-8-bug-report.yaml","hash":"5d742a43c376a072276dd288d95a7e694cf1c153","modified":1658450625453},{"_id":"themes/volantis/.github/workflows/labeler.yml","hash":"a8ea19facf61b6689b99cb63df271f1d0c349038","modified":1658450625460},{"_id":"themes/volantis/.github/ISSUE_TEMPLATE/zh-cn-9-other-issue.yaml","hash":"f4ca5c0d88683583f3135c64c0a654be7887d1ae","modified":1658450625453},{"_id":"themes/volantis/.github/workflows/merge-squash-main.yml","hash":"052c849e9781dfeef2baa19dcadc8c0a74711e92","modified":1658450625461},{"_id":"themes/volantis/.github/workflows/release-please.yml","hash":"515e0b7a0cb0633b8918ec4734c18e9bc0fb01e0","modified":1658450625463},{"_id":"themes/volantis/layout/_meta/artalkcount.ejs","hash":"94c9e591e38ac00d6beafa44de4d29e70680c673","modified":1658450625474},{"_id":"themes/volantis/.github/workflows/npm-publish.yml","hash":"178224d65c2bf2d3b867d2d2d6ba1aa0c2447b2d","modified":1658450625462},{"_id":"themes/volantis/.github/workflows/pr-updater.yml","hash":"b901b909b7d5f15680a1d35ee46f2278d039e561","modified":1658450625462},{"_id":"themes/volantis/layout/_meta/category.ejs","hash":"6d6dbb84cce90146b0e6ed130ea1c3581c54a029","modified":1658450625475},{"_id":"themes/volantis/.github/workflows/sync-coding.yml","hash":"a24319f5f8cbbd827d6d7f2b7afb03028ae41f53","modified":1658450625464},{"_id":"themes/volantis/.github/workflows/test-deploy.yml","hash":"f1087b7d028a35e3e9b0cbf490d552141c4984f2","modified":1658450625464},{"_id":"themes/volantis/layout/_meta/author.ejs","hash":"a95a474a0394a4b35b6d5d1604c98532155f6569","modified":1658450625475},{"_id":"themes/volantis/layout/_meta/date.ejs","hash":"96f55772b90f582616d1adb414172c1bd8a9af2c","modified":1658450625477},{"_id":"themes/volantis/layout/_meta/share.ejs","hash":"1fb300f5c2dca5d53d748fed8ccc343e69d1d9d5","modified":1658450625478},{"_id":"themes/volantis/layout/_meta/counter.ejs","hash":"bdc8864ebc0be684293372c179f01605ef238bd7","modified":1658450625476},{"_id":"themes/volantis/layout/_meta/music.ejs","hash":"0608d08b7f1cf6be529193c8b7fea99517b4a0d0","modified":1658450625477},{"_id":"themes/volantis/layout/_meta/thumbnail.ejs","hash":"7aaa1093b8a96706cacba60d9390fbab602f65a4","modified":1658450625479},{"_id":"themes/volantis/layout/_meta/tags.ejs","hash":"ff3b700a971fc3190653e2bf415f6d23a70a8f61","modified":1658450625479},{"_id":"themes/volantis/layout/_partial/archive.ejs","hash":"7f97598ba10aa269589dbbde270e80beecf3d10a","modified":1658450625487},{"_id":"themes/volantis/layout/_partial/categories.ejs","hash":"f7d893aee43e708865fa664d50237f9a73b240ed","modified":1658450625488},{"_id":"themes/volantis/layout/_meta/updated.ejs","hash":"988a4486b768dc410541c262fef291b79390e98a","modified":1658450625480},{"_id":"themes/volantis/layout/_partial/article.ejs","hash":"d14654ba8d980753cccf8d60306eccc8f5be03fd","modified":1658450625487},{"_id":"themes/volantis/layout/_partial/cover.ejs","hash":"7c0ff34dd099bcb24aab39c4872ff60e679c59d1","modified":1658450625489},{"_id":"themes/volantis/layout/_meta/wordcount.ejs","hash":"eebaab3821af95ee64d8d56f33ca6c9c60b9b6f0","modified":1658450625481},{"_id":"themes/volantis/layout/_meta/walinecount.ejs","hash":"10b243ab927d356e682297b49b23a88c8f5ca653","modified":1658450625481},{"_id":"themes/volantis/layout/_partial/footer.ejs","hash":"07d666b807ece4befbc902ae34b6dcbcc8e59f45","modified":1658450625490},{"_id":"themes/volantis/layout/_partial/head.ejs","hash":"da5e7b8b969001d10cab1a8e6b529a92b3db5ddd","modified":1658450625490},{"_id":"themes/volantis/layout/_partial/meta.ejs","hash":"ebeeb06f6c7aa167d64838f403fba6a307ad47d2","modified":1658450625492},{"_id":"themes/volantis/layout/_partial/header.ejs","hash":"d28f774144ec2aae2a42750e16f25fff16c9e39f","modified":1658450625491},{"_id":"themes/volantis/layout/_partial/side.ejs","hash":"b6d04940278e3f922f81fffeca1574de4fecf94a","modified":1658450625499},{"_id":"themes/volantis/layout/_partial/post.ejs","hash":"2184887f62ff94661e38aa98fda3b44cb3832283","modified":1658450625492},{"_id":"themes/volantis/layout/_widget/_pre.ejs","hash":"af915f88c136595eb695820548adf028470f47b4","modified":1658450625557},{"_id":"themes/volantis/layout/_widget/blogger.ejs","hash":"29e04a487763904caee0913c6d3569bfc1fab2ec","modified":1658450625558},{"_id":"themes/volantis/layout/_widget/group.ejs","hash":"1b7976d02ce069d7b738a768e6b8665a033c00f3","modified":1658450625561},{"_id":"themes/volantis/layout/_widget/grid.ejs","hash":"aeafbd9f5c7bf31ad120eda3d054e9bd00666fc8","modified":1658450625560},{"_id":"themes/volantis/layout/_widget/category.ejs","hash":"4149960a047e969d1982d2492a8d0416d3501a69","modified":1658450625558},{"_id":"themes/volantis/layout/_widget/copyright.ejs","hash":"63c5129b1b94ba50b9d5ba0b8656c65a13a14444","modified":1658450625559},{"_id":"themes/volantis/layout/_widget/header.ejs","hash":"b54a04af22efd55585af6e76ddbb7e856c5e9601","modified":1658450625561},{"_id":"themes/volantis/layout/_widget/music.ejs","hash":"0491078df052b1ce7747a1be31c7c8fcf084c25a","modified":1658450625564},{"_id":"themes/volantis/layout/_widget/lastupdate.ejs","hash":"c311ba4c8b255c45313dc1ab7ddafd99ec7fe8af","modified":1658450625562},{"_id":"themes/volantis/layout/_widget/list.ejs","hash":"98eb30970421f7cfbc2a8f4f9ffc200eba8fac43","modified":1658450625563},{"_id":"themes/volantis/layout/_widget/load.ejs","hash":"530ddefc167f0a1907f49a35e6b6d3a9f3756f21","modified":1658450625563},{"_id":"themes/volantis/layout/_widget/page.ejs","hash":"e282b46b8ad7fbd95d6b0a2b89f3cad1ecf2b2e9","modified":1658450625565},{"_id":"themes/volantis/layout/_widget/qrcode.ejs","hash":"016322fb85bba433bfa096290325a199fb9ba93f","modified":1658450625565},{"_id":"themes/volantis/layout/_widget/references.ejs","hash":"c4669e92b922516265bb68b1802d759cf0265fbf","modified":1658450625566},{"_id":"themes/volantis/layout/_widget/related_posts.ejs","hash":"27cae9dd94922a4134b48f2c2419fb66a07f1129","modified":1658450625567},{"_id":"themes/volantis/scripts/events/index.js","hash":"e5aec98e65b4aea0e1b02fd695b0cf5fe1dce2c5","modified":1658450625578},{"_id":"themes/volantis/scripts/filters/content-visibility.js","hash":"67d73133319205bc0cc0872269702c1b0a5e4558","modified":1658450625584},{"_id":"themes/volantis/layout/_widget/tagcloud.ejs","hash":"04cbd2ae65faa22540e53ae531bc3ca2893eb0f8","modified":1658450625567},{"_id":"themes/volantis/layout/_widget/toc.ejs","hash":"38e1f546e04973054c983428539b14287c647c17","modified":1658450625569},{"_id":"themes/volantis/layout/_widget/text.ejs","hash":"4e978821f385c1c0cceb6aec83262f6e99c6c89e","modified":1658450625568},{"_id":"themes/volantis/scripts/filters/img.js","hash":"2536854025b6c105ba27f9ab9e99fda05263d9f0","modified":1658450625585},{"_id":"themes/volantis/layout/_widget/webinfo.ejs","hash":"29b70c3e5882afa3045b1282d03f88d30ccf5e84","modified":1658450625569},{"_id":"themes/volantis/scripts/filters/z-lazyload.js","hash":"2340e56c2c7cdd796cba0d0aca7d4899780fa140","modified":1658450625586},{"_id":"themes/volantis/scripts/filters/replace.js","hash":"590e94a78490367ec0e111d4f48de5c9e57e256a","modified":1658450625585},{"_id":"themes/volantis/scripts/helpers/custom-files.js","hash":"aee8fc2ddec0f98221cc54d6059cc575c87194a1","modified":1658450625587},{"_id":"themes/volantis/scripts/helpers/revisioned.js","hash":"de52e8f05e653ab376ea16254bca4210383194b9","modified":1658450625593},{"_id":"themes/volantis/scripts/helpers/first-style.js","hash":"63d067b9ae2334d1af35e286f38f04379f37a6cd","modified":1658450625588},{"_id":"themes/volantis/scripts/helpers/related-posts.js","hash":"8f5e201ababac080de44243338f62aae61010837","modified":1658450625592},{"_id":"themes/volantis/scripts/tags/btn.js","hash":"1691e38dc3c7eb0810a4bb3247237661f2282005","modified":1658450625601},{"_id":"themes/volantis/scripts/tags/btns.js","hash":"cb00611b1c60bb96edde8d8c4d508b9e62229115","modified":1658450625601},{"_id":"themes/volantis/scripts/tags/checkbox.js","hash":"7ad06787a2b9ae4e1aeaf397508db357223dce9f","modified":1658450625602},{"_id":"themes/volantis/scripts/tags/contributors.js","hash":"4b88c875b00ccb880b4bc1608450ea15251981b1","modified":1658450625603},{"_id":"themes/volantis/scripts/tags/dropmenu.js","hash":"af00c0b28fdff2048f1287aca794d5ca8ec479be","modified":1658450625603},{"_id":"themes/volantis/scripts/tags/fancybox.js","hash":"3699f69722dca8f1c621ad9bb27ff2aa9882a25b","modified":1658450625604},{"_id":"themes/volantis/scripts/tags/folding.js","hash":"87e8a902420ee31eb8558198a2a6b59e2f22de68","modified":1658450625605},{"_id":"themes/volantis/scripts/tags/frame.js","hash":"45485cab9741943fcb498563c376fae3795d5349","modified":1658450625606},{"_id":"themes/volantis/scripts/tags/ghcard.js","hash":"95277092799e243e7b3f3347271cd1cdba794a10","modified":1658450625607},{"_id":"themes/volantis/scripts/tags/friends.js","hash":"3ef111f3db1af6ab5be0a1e8880dee75e8e6d0e0","modified":1658450625606},{"_id":"themes/volantis/scripts/tags/inline-labels.js","hash":"eaaedc3d65384e0beb4306534ef4ed202b46da18","modified":1658450625608},{"_id":"themes/volantis/scripts/tags/image.js","hash":"f879b4fee542cf51c233fe436aba2a07c5f01259","modified":1658450625608},{"_id":"themes/volantis/scripts/tags/link.js","hash":"9a488ef5040871d7a5178e86e787ba3f682a6e13","modified":1658450625609},{"_id":"themes/volantis/scripts/tags/md.js","hash":"ab2bf2fd22b171e7556718db0e254f2b8de77b58","modified":1658450625610},{"_id":"themes/volantis/scripts/tags/note.js","hash":"eba9d65a2564b91cf85f1a6a4388bcd5e0a3a5ee","modified":1658450625611},{"_id":"themes/volantis/scripts/tags/media.js","hash":"97a19d5d0e3136a411ca130eb4db3f5577c566cf","modified":1658450625610},{"_id":"themes/volantis/scripts/tags/site.js","hash":"bc0ad5d47d13a1992f62f74eb41485759b7a71d0","modified":1658450625613},{"_id":"themes/volantis/scripts/tags/span.js","hash":"d73eb17fc8064da31fae2823b9cfb1031ba0d105","modified":1658450625613},{"_id":"themes/volantis/scripts/tags/pandown.js","hash":"d949c2da1b5d749efd53e0f91f8311597766f384","modified":1658450625612},{"_id":"themes/volantis/scripts/tags/table.js","hash":"13528b4ba9caffd5ea5c9ded4d048e9b9e8da5b0","modified":1658450625615},{"_id":"themes/volantis/scripts/tags/swiper.js","hash":"f0171f07f494c0b0f3f8af265344add15813a676","modified":1658450625614},{"_id":"themes/volantis/scripts/tags/tabs.js","hash":"7678a578498b4586c022910330250d1725bbfd42","modified":1658450625615},{"_id":"themes/volantis/source/css/Readme.md","hash":"8046a2fb69589fb01b19eec6ba903b93dacc5852","modified":1658450625618},{"_id":"themes/volantis/source/css/style.styl","hash":"1c7f0dcf5e01c26de6ebcb91c3e1a14b457135c2","modified":1658450625676},{"_id":"themes/volantis/source/css/first.styl","hash":"03d4cb5ecd71014d4d42f0e331b48532d3763b03","modified":1658450625675},{"_id":"themes/volantis/scripts/tags/timeline.js","hash":"0ff2717c342a12d7120bb6de6bf23968e56e4d5a","modified":1658450625616},{"_id":"themes/volantis/source/js/app.js","hash":"764ce62e9d54222dd70cf70f51d62f109fe2c4dc","modified":1658450625677},{"_id":"themes/volantis/layout/_partial/_cover/dock.ejs","hash":"b3ca60e51bae7aa4ca2b1ddf8d3e1d6ac2486e3f","modified":1658453546783},{"_id":"themes/volantis/layout/_partial/_cover/featured.ejs","hash":"21d8e3fd3872b0eb69f407c7e567544a90c630aa","modified":1658453302751},{"_id":"themes/volantis/layout/_partial/_cover/focus.ejs","hash":"21d8e3fd3872b0eb69f407c7e567544a90c630aa","modified":1658450625485},{"_id":"themes/volantis/layout/_partial/scripts/_ctrl.ejs","hash":"b3ded924f33b145a491fe3a694c82f9f39133943","modified":1658450625493},{"_id":"themes/volantis/layout/_partial/scripts/content-visibility-scroll-fix.ejs","hash":"9658f32778f796219378b34512f2d0b9873e5776","modified":1658450625496},{"_id":"themes/volantis/layout/_partial/_cover/search.ejs","hash":"1c90d5ebe45d378070513ca9d5034a74ca15e133","modified":1658450625486},{"_id":"themes/volantis/layout/_partial/_cover/layout.ejs","hash":"a965bd46f1d9471458436202ba1fac97c13452db","modified":1658450625485},{"_id":"themes/volantis/layout/_partial/scripts/global.ejs","hash":"249fbaf882bf66309fb54a250eb86d242edf6bd7","modified":1658450625497},{"_id":"themes/volantis/layout/_partial/scripts/toc.ejs","hash":"91cd3da7fe0888e844f08a4d2bd63e5202794b4e","modified":1658450625498},{"_id":"themes/volantis/layout/_partial/scripts/index.ejs","hash":"4bc2d68155d6208db85eb5a435e1bdbcef6977bb","modified":1658450625498},{"_id":"themes/volantis/layout/_plugins/_page_plugins/index.ejs","hash":"8566bfbdedcbc07e9dbf68cf37200db86588ad8d","modified":1658450625506},{"_id":"themes/volantis/layout/_plugins/analytics/LCCounter.ejs","hash":"d165260a59866e5ee437fb1e08e452b1fb351a52","modified":1658450625510},{"_id":"themes/volantis/layout/_plugins/aplayer/layout.ejs","hash":"9b64c819cd0301def53d223c2f3bd89e4962fd79","modified":1658450625512},{"_id":"themes/volantis/layout/_plugins/analytics/script.ejs","hash":"09ccc55c52f40f85bfa3c741af8f073b82c756d4","modified":1658450625511},{"_id":"themes/volantis/layout/_plugins/chat/index.ejs","hash":"99d149ca778a6b956e18a3d380b36a120bcb98e4","modified":1658450625515},{"_id":"themes/volantis/layout/_plugins/aplayer/script.ejs","hash":"8adb7d4ea61beff612c897dbbf11708feb7a09d0","modified":1658450625513},{"_id":"themes/volantis/layout/_plugins/comments/index.ejs","hash":"45e60c3f7e12c862dd08ef310689709847ba93c9","modified":1658450625526},{"_id":"themes/volantis/layout/_plugins/darkmode/script.ejs","hash":"6c43562b2b404f594ffe5a5f242f697a000846ed","modified":1658450625535},{"_id":"themes/volantis/layout/_plugins/github-api/script.ejs","hash":"5095fa0a33c95d5b1bfcd3f554df5256994bca26","modified":1658450625537},{"_id":"themes/volantis/layout/_plugins/end-of-support/script.ejs","hash":"4fccde6d5a94aa6dcecd50b176a1a014acb75667","modified":1658450625536},{"_id":"themes/volantis/layout/_plugins/lazyload/script.ejs","hash":"4171b54bf116985efd7247a113e0b65b2d9302a1","modified":1658450625542},{"_id":"themes/volantis/layout/_plugins/nodewaves/script.ejs","hash":"e3d227b8366f62c65d1f8bbfba7061f43b36c806","modified":1658450625543},{"_id":"themes/volantis/layout/_plugins/highlight/script.ejs","hash":"98a4351c0750e7a9f35e136211f2ea5cc8f2900b","modified":1658450625540},{"_id":"themes/volantis/layout/_plugins/parallax/script.ejs","hash":"ee56f58a4127c1ce56ee802c964f45134629027b","modified":1658450625544},{"_id":"themes/volantis/layout/_plugins/pjax/animate.ejs","hash":"2b6b2fe421f8195766d5fef6fc4d740a4017eb32","modified":1658450625545},{"_id":"themes/volantis/layout/_plugins/preload/script.ejs","hash":"d8904aaf8b1e14086b4ce9de9770a89e0f1c6a2b","modified":1658450625547},{"_id":"themes/volantis/layout/_plugins/rightmenu/layout.ejs","hash":"11b5c4f1ca33a3a8fb8ea0243312c55d68f4105b","modified":1658450625549},{"_id":"themes/volantis/layout/_plugins/rightmenus/layout.ejs","hash":"31a1787705aa13d3e0eb1aacf76bc4db869cb37a","modified":1658450625550},{"_id":"themes/volantis/layout/_plugins/pjax/pdata.ejs","hash":"463987b029265f2176eeef2b1fa669a3ff54d3b8","modified":1658450625546},{"_id":"themes/volantis/layout/_plugins/pjax/index.ejs","hash":"c59b0cc21b9f4a46ae01e91d2fd49a294baf992c","modified":1658450625546},{"_id":"themes/volantis/layout/_plugins/search/script.ejs","hash":"5e6dd52fe2d82204eb3fe46a3f7c388cd322e93f","modified":1658450625552},{"_id":"themes/volantis/layout/_plugins/share/layout.ejs","hash":"aa714ba68918c2b9e74997161811ca35ff57da1c","modified":1658450625553},{"_id":"themes/volantis/layout/_plugins/scrollreveal/script.ejs","hash":"eae0c08c5c72745529fc1b7991a329df71ea3c07","modified":1658450625551},{"_id":"themes/volantis/layout/_plugins/slow-network/script.ejs","hash":"22453b063a7e7099c626f95c68bd96935240963d","modified":1658450625554},{"_id":"themes/volantis/layout/_plugins/swiper/script.ejs","hash":"231a53364b50a99a32b43a4ec8360c3891c17557","modified":1658450625555},{"_id":"themes/volantis/scripts/events/lib/check-configuration.js","hash":"ff8311fea5d7d46580abc324483f702a2413e70b","modified":1658554582706},{"_id":"themes/volantis/scripts/events/lib/config.js","hash":"c7f41acca0889d9fb8e4a19666612ef3891d8689","modified":1658450625581},{"_id":"themes/volantis/scripts/events/lib/check-environment.js","hash":"78cee9f132174cde6c4ae90380f6b577571c6633","modified":1658450625580},{"_id":"themes/volantis/scripts/events/lib/render-stylus.js","hash":"9f2bce5fe6e951ddc3961c9dec64d448ca3b8c5e","modified":1658450625582},{"_id":"themes/volantis/scripts/helpers/head/autoCanonical.js","hash":"2021e20e02651c7007245c8fd70254a282ddceba","modified":1658450625589},{"_id":"themes/volantis/scripts/events/lib/stellar-tag-utils.js","hash":"e451be9a7b23bf52a0d0b02c3ac4101ca25f7ccd","modified":1658450625583},{"_id":"themes/volantis/scripts/helpers/structured-data/index.js","hash":"61c9b7577bebb41fb0fb0ddd907f7d89abef30e7","modified":1658450625594},{"_id":"themes/volantis/source/css/_defines/AutoPrefixCSS.styl","hash":"18fe976fb9241ef379ebcccc0b7a9cc599f65c51","modified":1658450625619},{"_id":"themes/volantis/source/css/_defines/Readme.md","hash":"75c2fa01e58095a98d463e6b9bab1f0c04e38692","modified":1658450625620},{"_id":"themes/volantis/scripts/helpers/head/generate_preload_fontfamily.js","hash":"b4b9f902aa1b43e7814158e1bdb9b723828210d6","modified":1658450625590},{"_id":"themes/volantis/scripts/helpers/head/generate_seo.js","hash":"50d940023751baa849ab8635d662ba0348069197","modified":1658450625590},{"_id":"themes/volantis/scripts/helpers/head/generate_title__keywords__description.js","hash":"64367f8563b05cf5a721f3d0883fb156c2d69964","modified":1658450625591},{"_id":"themes/volantis/source/css/_defines/effect.styl","hash":"96b8e1b97146946469dd965e7d04cf90b22eb497","modified":1658450625621},{"_id":"themes/volantis/source/css/_defines/color.styl","hash":"a5b9ef5385f3931eafb42a58715498b230103cc3","modified":1658450625620},{"_id":"themes/volantis/source/css/_defines/fonts.styl","hash":"9601ac0c9ecfb65288fa64eae67b2a6b6e56d8dd","modified":1658450625622},{"_id":"themes/volantis/source/css/_defines/func.styl","hash":"d5b08a9b533c8cde12e34f9f6df1bd4a994c46d2","modified":1658450625622},{"_id":"themes/volantis/source/css/_defines/layout.styl","hash":"192d0a3b07f95e01a3952c5c88967068e0682cca","modified":1658450625623},{"_id":"themes/volantis/source/css/_first/base_first.styl","hash":"9fb2a5aa7412d420e441f204b6dbd50a016584cf","modified":1658450625624},{"_id":"themes/volantis/source/css/_first/cover_first.styl","hash":"881210244593d7125337d4f810d49b9699420b43","modified":1658450625625},{"_id":"themes/volantis/source/css/_first/fontfamily_first.styl","hash":"cce88d81a8e21cce65b7fd586765e8819388d31d","modified":1658450625627},{"_id":"themes/volantis/source/css/_first/dark_first.styl","hash":"f7ee92842e4fa71c5b709a1cb75af3dcc06d381b","modified":1658450625626},{"_id":"themes/volantis/source/css/_first/navbar_first.styl","hash":"cb85492e8ae8878fc99e52b14610a9122336a2be","modified":1658450625627},{"_id":"themes/volantis/source/css/_style/index.styl","hash":"b02f576a0e909e01180e3996c3965e06a681f21b","modified":1658450625675},{"_id":"themes/volantis/source/js/plugins/aplayer.js","hash":"caa3621d74f24a00357e4d4ce3c90436c799d4e0","modified":1658450625679},{"_id":"themes/volantis/source/js/search/hexo.js","hash":"dadfa36cd6c42aa6caf072fac7413fcf4de36cbd","modified":1658450625685},{"_id":"themes/volantis/source/css/_first/search_first.styl","hash":"4eedde6a3806741a450de0aeffa5a100d9c2d408","modified":1658450625628},{"_id":"themes/volantis/source/js/plugins/parallax.js","hash":"ac6b9b60ff4a739649882723f653896a73a89ec5","modified":1658450625680},{"_id":"themes/volantis/source/js/plugins/rightMenu.js","hash":"cb2f17ab10127065f7b9f5f87a49921d25b287e1","modified":1658450625680},{"_id":"themes/volantis/layout/_partial/scripts/_ctrl/cdnCtrl.ejs","hash":"81461c1e29e342c3e16902d50785c987901ebe45","modified":1658450625495},{"_id":"themes/volantis/source/js/plugins/rightMenus.js","hash":"c45c58ab6597ffd8b5de70032c07dcd37836086f","modified":1658450625681},{"_id":"themes/volantis/layout/_plugins/_page_plugins/artitalk/index.ejs","hash":"e1e58a3403edd605231256dbc6dfed2840d3c5c1","modified":1658450625501},{"_id":"themes/volantis/layout/_partial/scripts/_ctrl/coverCtrl.ejs","hash":"d99909694b96f78c48b3433fb8c6d70cc8f92e6e","modified":1658450625495},{"_id":"themes/volantis/layout/_plugins/_page_plugins/bbtalk/index.ejs","hash":"0637551061ebfa965304f6bccad02589d36e03ad","modified":1658450625502},{"_id":"themes/volantis/layout/_plugins/_page_plugins/gitter/index.ejs","hash":"b6e00d7d8a3201e219456dca6572518baae26dcf","modified":1658450625504},{"_id":"themes/volantis/layout/_plugins/_page_plugins/katex/index.ejs","hash":"bda18a99909a011096cc9a21b253eb757603f4f0","modified":1658450625507},{"_id":"themes/volantis/layout/_plugins/_page_plugins/indent/index.ejs","hash":"7d112cde9b8d1785d8c541cde94361e0bfc60f30","modified":1658450625505},{"_id":"themes/volantis/layout/_plugins/chat/tidio/script.ejs","hash":"36dd36c2a4ade5f873978b554033115908959a29","modified":1658450625516},{"_id":"themes/volantis/layout/_plugins/chat/gitter/script.ejs","hash":"2a9780cb228944d671f959610aea710e6db6bac0","modified":1658450625515},{"_id":"themes/volantis/layout/_plugins/_page_plugins/fcircle/index.ejs","hash":"6b049a631b22be18417b3a9aef3b5881b30f4581","modified":1658450625503},{"_id":"themes/volantis/layout/_plugins/_page_plugins/snackbar/index.ejs","hash":"8d355f4f1552ffbd5099b7dea7954e6cb415a83b","modified":1658450625509},{"_id":"themes/volantis/layout/_plugins/_page_plugins/mathjax/index.ejs","hash":"8532590d2c82b1dfb8a6dcaae57d4465893ac9e6","modified":1658450625508},{"_id":"themes/volantis/layout/_plugins/comments/artalk/script.ejs","hash":"9c607d5588537875f9c23ce46b7b031e78b95ff4","modified":1658450625518},{"_id":"themes/volantis/layout/_plugins/comments/discuss/script.ejs","hash":"a739252d569ee389ec80e706435142f7dbb56cd5","modified":1658450625520},{"_id":"themes/volantis/layout/_plugins/comments/beaudar/script.ejs","hash":"e41ebffd14a156ece266877f4cc94e4931b3e95e","modified":1658450625519},{"_id":"themes/volantis/layout/_plugins/comments/disqus/script.ejs","hash":"5bc7f960cd0ec2a72cc150d73b004a8d0836c6ec","modified":1658450625521},{"_id":"themes/volantis/layout/_plugins/comments/disqusjs/script.ejs","hash":"0da595e62782e64d6cdf67f285c576ad2d4ed653","modified":1658450625522},{"_id":"themes/volantis/layout/_plugins/comments/giscus/script.ejs","hash":"7b845e839a4c03c700b6cf13590218d3e2b533b0","modified":1658450625523},{"_id":"themes/volantis/layout/_plugins/comments/isso/script.ejs","hash":"dfbff9b81ce537a7da0ab1cc95480ebc4cb4cffa","modified":1658450625527},{"_id":"themes/volantis/layout/_plugins/comments/gitalk/script.ejs","hash":"ba4922e0f07c4bb5a1c8e233d5f88130dc6f73bc","modified":1658450625524},{"_id":"themes/volantis/layout/_plugins/comments/hashover/script.ejs","hash":"4410ff1f7dd6aa48b12ddec49bdeb177e85b1f53","modified":1658450625526},{"_id":"themes/volantis/layout/_plugins/comments/livere/script.ejs","hash":"ab7aa8ab3b8ca510ef7e2f47fb23a4f9a2701979","modified":1658450625528},{"_id":"themes/volantis/layout/_plugins/comments/z-custom/script.ejs","hash":"9c9c19d0de11ff183ffea60910681d9e91c13f9d","modified":1658450625534},{"_id":"themes/volantis/layout/_plugins/comments/utterances/script.ejs","hash":"844eef0906a67fa8d42a331578e5538e33521aef","modified":1658450625531},{"_id":"themes/volantis/layout/_plugins/comments/vssue/script.ejs","hash":"a29b1e96e939f3e8ebd1a25b296d5b27a3384d95","modified":1658450625532},{"_id":"themes/volantis/layout/_plugins/comments/twikoo/script.ejs","hash":"fa612a479809aa5052344a79c7afc638e8e79211","modified":1658450625529},{"_id":"themes/volantis/layout/_plugins/comments/waline/script.ejs","hash":"a5df6ebc1eed0b23344eb72a39d4033e4fd3519f","modified":1658450625533},{"_id":"themes/volantis/layout/_plugins/highlight/highlightjs/script.ejs","hash":"662e4e3b6c911a6fdffb2c34d012f8b6f70af31f","modified":1658450625539},{"_id":"themes/volantis/layout/_plugins/highlight/prismjs/script.ejs","hash":"67e3d498c2d157f6828a1b8165580b542bf8affa","modified":1658450625540},{"_id":"themes/volantis/scripts/helpers/structured-data/lib/blogposting.js","hash":"9d3a9091b97fcea1bde3b61425bdd3c65f5368b7","modified":1658450625595},{"_id":"themes/volantis/scripts/helpers/structured-data/lib/breadcrumblist.js","hash":"5cb20b6b04f018a6b5eab07c4759e743d28e050f","modified":1658450625596},{"_id":"themes/volantis/scripts/helpers/structured-data/lib/organization.js","hash":"21b509275f7d43b0f95bb122468d6f301ff7b76e","modified":1658450625598},{"_id":"themes/volantis/scripts/helpers/structured-data/lib/index.js","hash":"525bbb3e0eeff380ff23a28d81797ef06a53bd08","modified":1658450625597},{"_id":"themes/volantis/scripts/helpers/structured-data/lib/config.js","hash":"f76ce54f0a2d1b951491379afebabf3590c47642","modified":1658450625597},{"_id":"themes/volantis/source/css/_style/_base/base.styl","hash":"af90d8a3cee62ef41bb141602472362c6ac1ae07","modified":1658450625629},{"_id":"themes/volantis/source/css/_style/_base/fontfamily_async.styl","hash":"7b6f2da48a225b3d836d7b2e5dfa90fa18dc3174","modified":1658450625630},{"_id":"themes/volantis/scripts/helpers/structured-data/lib/website.js","hash":"d1e92abc94eaa7a141744e07b00280078b750d25","modified":1658450625599},{"_id":"themes/volantis/scripts/helpers/structured-data/lib/person.js","hash":"d19975f00233c9b7625020fdbb6142128098a10e","modified":1658450625599},{"_id":"themes/volantis/source/css/_style/_layout/archive.styl","hash":"93a0846f1d65d66950403aba90ed5a8b5c8a9884","modified":1658450625631},{"_id":"themes/volantis/source/css/_style/_layout/footer.styl","hash":"5146a149d97dfaa88ae4bf819b60bab2f8d92a53","modified":1658450625633},{"_id":"themes/volantis/source/css/_style/_layout/article.styl","hash":"babc146cbb87951544dc915b00692956a97d6c1e","modified":1658450625632},{"_id":"themes/volantis/source/css/_style/_layout/friends-simpleuser.styl","hash":"3d8e963fd1c24668fc1df078c619c4126f6a8a93","modified":1658450625634},{"_id":"themes/volantis/source/css/_style/_layout/friends-traditional.styl","hash":"c5a3d30071b3208bd6af2b11df94e729b0537ea2","modified":1658450625634},{"_id":"themes/volantis/source/css/_style/_layout/loading.styl","hash":"c6757684fa37ced88e181b91c873644d1bde591d","modified":1658450625636},{"_id":"themes/volantis/source/css/_style/_layout/img.styl","hash":"7f733971a7862fc5764a953ae4f8e17c171ff1b6","modified":1658450625635},{"_id":"themes/volantis/source/css/_style/_layout/main.styl","hash":"8781ae9afeb933d66346b5643b5e6b2bd4e15d16","modified":1658450625636},{"_id":"themes/volantis/source/css/_style/_layout/pagination.styl","hash":"d727004c3bbe16ace26bfcd45dd7b2f1202acec4","modified":1658450625638},{"_id":"themes/volantis/source/css/_style/_layout/posts.styl","hash":"df0c63cce7e7e2e7415d6efd0710cac37573389d","modified":1658450625639},{"_id":"themes/volantis/source/css/_style/_layout/md.styl","hash":"26ed803d47048ad81753648894fc64be0aa841ce","modified":1658450625637},{"_id":"themes/volantis/source/css/_style/_layout/sidebar.styl","hash":"810feced0a40373d012f47a04d62ef85cb5cdb63","modified":1658450625640},{"_id":"themes/volantis/source/css/_style/_layout/search.styl","hash":"411e32f7346e7f742b1e0078e641e8b5df875faf","modified":1658450625639},{"_id":"themes/volantis/source/css/_style/_layout/snackbar.styl","hash":"c3137362a2615159565477cab19afb1fc2d22cbf","modified":1658450625641},{"_id":"themes/volantis/source/css/_style/_plugins/aplayer.styl","hash":"5babeff5defa56e7d8db229ae4605f19bef9cd61","modified":1658450625654},{"_id":"themes/volantis/source/css/_style/_layout/toc.styl","hash":"c22db26a72dff5d7c73171f22a66231550d93e09","modified":1658450625641},{"_id":"themes/volantis/source/css/_style/_layout/video.styl","hash":"94bdeb9f28ba503a7a3fbd1148bc349983c17818","modified":1658450625642},{"_id":"themes/volantis/source/css/_style/_plugins/cursor.styl","hash":"ba39aaa74ff3c20a6d13c2856a0ccbd0c111f8e5","modified":1658450625655},{"_id":"themes/volantis/source/css/_style/_tag-plugins/Readme.md","hash":"4840c72bf8ff1cdf2e16c8bc10a2410246946090","modified":1658450625660},{"_id":"themes/volantis/source/css/_style/_plugins/fontcolor.styl","hash":"de8c4f209c118c4b391223d46c2d662332cadaa1","modified":1658450625656},{"_id":"themes/volantis/source/css/_style/_plugins/gitalk.styl","hash":"17938fd65f7996c71e382934553af9fdee6a0e18","modified":1658450625656},{"_id":"themes/volantis/source/css/_style/_plugins/index.styl","hash":"30e8ce417052487f6a08ab8c9f88a6259a958c2f","modified":1658450625657},{"_id":"themes/volantis/source/css/_style/_plugins/mathjax.styl","hash":"95b0c51b678bc3ecc607bcf52d97b9634931ccba","modified":1658450625658},{"_id":"themes/volantis/source/css/_style/_tag-plugins/btns.styl","hash":"525919d04929c2c849f3aae587ecc6a004b05e86","modified":1658450625661},{"_id":"themes/volantis/source/css/_style/_plugins/message.styl","hash":"32eaf66de2f82e4c364b9244c5eef6380ec00bb4","modified":1658450625658},{"_id":"themes/volantis/source/css/_style/_plugins/pjaxanimate.styl","hash":"9664f37f2632e17c2d6bd93eb587d4df9aefa265","modified":1658450625659},{"_id":"themes/volantis/source/css/_style/_tag-plugins/checkbox.styl","hash":"ae7ae8a3377525396a9163d32ca76c11647d877d","modified":1658450625662},{"_id":"themes/volantis/source/css/_style/_tag-plugins/dropmenu.styl","hash":"469d3458db6531b1283768bbae30f283110d1726","modified":1658450625662},{"_id":"themes/volantis/source/css/_style/_tag-plugins/fancybox.styl","hash":"671f43ec7ee5b98227ce60e4b564eee5281f92ea","modified":1658450625663},{"_id":"themes/volantis/source/css/_style/_tag-plugins/folding.styl","hash":"40fe5c009ad79325b1ad8c88b6d146682035348c","modified":1658450625664},{"_id":"themes/volantis/source/css/_style/_tag-plugins/frame.styl","hash":"0f6230d77f22f0969d15d092b3d973c08d2219cc","modified":1658450625664},{"_id":"themes/volantis/source/css/_style/_tag-plugins/ghcard.styl","hash":"3a6fd480b244c76ac670b418e461c0f77bd9f4d4","modified":1658450625666},{"_id":"themes/volantis/source/css/_style/_tag-plugins/image.styl","hash":"842f58a4c464d5ec59038cc923dbce1dd432362b","modified":1658450625666},{"_id":"themes/volantis/source/css/_style/_tag-plugins/friends.styl","hash":"b76cf16571ac2099a39fe35a238e4d735b4115e1","modified":1658450625665},{"_id":"themes/volantis/source/css/_style/_tag-plugins/link.styl","hash":"870a0d50082116adffe385d7695e28795542aa23","modified":1658450625667},{"_id":"themes/volantis/source/css/_style/_tag-plugins/note.styl","hash":"959a9fe09cf9d0c29de76d05d6123c337a259ab5","modified":1658450625668},{"_id":"themes/volantis/source/css/_style/_tag-plugins/media.styl","hash":"03c9942ed8560b923ac3535e7e80396d4a92df04","modified":1658450625668},{"_id":"themes/volantis/source/css/_style/_tag-plugins/sites.styl","hash":"f20f37b20ca803db2981e8931d70f0dd78bca30e","modified":1658450625669},{"_id":"themes/volantis/source/css/_style/_tag-plugins/span.styl","hash":"cdda513cbc9d95e9311a0a52c06ae7d1d250a769","modified":1658450625670},{"_id":"themes/volantis/source/css/_style/_tag-plugins/table.styl","hash":"84abe90bc0b505d35d8e702337fcbe5da6ee1217","modified":1658450625671},{"_id":"themes/volantis/source/css/_style/_tag-plugins/swiper.styl","hash":"819385594f1825e26074ade900835a3f4031fe42","modified":1658450625671},{"_id":"themes/volantis/source/css/_style/_tag-plugins/tabs.styl","hash":"5cb4366b6ed139c952b846357e9d077b5c1b9c66","modified":1658450625672},{"_id":"themes/volantis/source/css/_style/_tag-plugins/text.styl","hash":"7231d9c0e1e05a3ab7094d6ff4d1c37d97a1e8af","modified":1658450625673},{"_id":"themes/volantis/source/css/_style/_tag-plugins/tag.json","hash":"a453d6ed0ed5de78364a8356703d250bb9cf43d6","modified":1658450625673},{"_id":"themes/volantis/source/css/_style/_tag-plugins/timeline.styl","hash":"14b86f0ad0098e679d66dae7d997802c77a27141","modified":1658450625674},{"_id":"themes/volantis/source/js/plugins/tags/contributors.js","hash":"b3350dc951f34477cb1143cf11a53661fd0e551a","modified":1658450625682},{"_id":"themes/volantis/source/js/plugins/tags/friends.js","hash":"9643d9d9ef4a11ab690bd7755a92bb56fc392ed0","modified":1658450625683},{"_id":"themes/volantis/source/css/_style/_plugins/_dark/dark_async.styl","hash":"643453859ba9509ee1bf2487035f08e4dbfb2b48","modified":1658450625644},{"_id":"themes/volantis/source/js/plugins/tags/sites.js","hash":"dff484d3f64681e725868fd62613a3658660992c","modified":1658450625684},{"_id":"themes/volantis/source/css/_style/_plugins/_highlight/index.styl","hash":"c62f0c706c08ec7a830f7ede2d04996ccc721e90","modified":1658450625649},{"_id":"themes/volantis/source/css/_style/_plugins/_dark/dark_plugins.styl","hash":"0716f7c3af19c8911398526c734580b13f465fd5","modified":1658450625644},{"_id":"themes/volantis/source/css/_style/_plugins/_rightmenu/reading.styl","hash":"18cefb0667407e9dd15fde96c5577fc7ba0ecaf3","modified":1658450625653},{"_id":"themes/volantis/source/css/_style/_plugins/_highlight/highlightjs/clipboard.styl","hash":"f2b95f90b15ad610b6f2668316233bb2e4a65cf0","modified":1658450625646},{"_id":"themes/volantis/source/css/_style/_plugins/_highlight/prismjs/clipboard.styl","hash":"6dcea4963642a693869411ad40df703a716790d6","modified":1658450625650},{"_id":"themes/volantis/source/css/_style/_plugins/_rightmenu/rightmenu.styl","hash":"3c55aa5549e505d87652e418dae345259add247b","modified":1658450625653},{"_id":"themes/volantis/source/css/_style/_plugins/_highlight/highlightjs/color.styl","hash":"7ba7e4aeacc31b12c5fc57317d902b3742aa6c38","modified":1658450625647},{"_id":"themes/volantis/source/css/_style/_plugins/_highlight/prismjs/index.styl","hash":"273196519db0ac4e223458e002e2ad0536213ba5","modified":1658450625651},{"_id":"themes/volantis/source/css/_style/_plugins/_highlight/highlightjs/language.styl","hash":"aa98bc49ba55119529c47175eaa3e87f44eae26c","modified":1658450625648},{"_id":"themes/volantis/source/css/_style/_plugins/_highlight/highlightjs/index.styl","hash":"661f36ee05c75465a046fcdca091f406c96cb37d","modified":1658450625648},{"_id":"themes/volantis/source/css/_style/_plugins/_highlight/prismjs/language.styl","hash":"7773ed6757f1cc1f4ce4d8c991d721a5d49a8a92","modified":1658450625652},{"_id":"public/content.json","hash":"e22a5de99a050beb5386882d07f74e4bb1e87b62","modified":1659402212944},{"_id":"public/css/style.15050a9b.css","hash":"66c439089c6479740784ab1b8828d0c44542a23c","modified":1658450981259},{"_id":"themes/volantis/.idea/.gitignore","hash":"2651f4f8d4c0bf5a32b70ebda7b00cbbe08d36a0","modified":1658451567782},{"_id":"themes/volantis/.idea/misc.xml","hash":"a1a111b0d6a5ebccf970dfd074782074ab8a2c52","modified":1658451567560},{"_id":"themes/volantis/.idea/modules.xml","hash":"40cb66839eaa0118278b53da035b2afc8f077cb9","modified":1658451567538},{"_id":"themes/volantis/.idea/vcs.xml","hash":"e692344d8c981d4806a673b29b1a6dc3b6b6d345","modified":1658451567574},{"_id":"themes/volantis/.idea/volantis.iml","hash":"402e38def734b476c4c697c9a36892567ab6af8b","modified":1658451567525},{"_id":"themes/volantis/.idea/workspace.xml","hash":"c85b84452d81aa1575500db2126fac5e6ef68a86","modified":1658675274968},{"_id":"themes/volantis/package-lock.json","hash":"9650457278ade150d72f09d221acd1df2da1e368","modified":1658451575196},{"_id":"themes/volantis/source/img/back.jpg","hash":"57f5631599aa37b9649c62d116585681a7c90587","modified":1658123289857},{"_id":"source/_posts/并发基础中的Future异步回调模式.md","hash":"b67b3be0cb7bdcf350fa6e7aca997505f27b6feb","modified":1658285124013},{"_id":"themes/volantis/source/img/kk.jpg","hash":"fe497d04280799886e30956fc8ee5b3cab04aee4","modified":1658371861788},{"_id":"themes/volantis/source/img/logo.jpg","hash":"366359a05157d6d21d1a293b710b56411202c074","modified":1658452750931},{"_id":"public/2022/07/20/并发基础中的Future异步回调模式/index.html","hash":"4a0bb92791c6f86b4131f40cb82d4ec2280d0209","modified":1658731099580},{"_id":"public/img/kk.jpg","hash":"fe497d04280799886e30956fc8ee5b3cab04aee4","modified":1658453281265},{"_id":"public/img/logo.jpg","hash":"366359a05157d6d21d1a293b710b56411202c074","modified":1658453281265},{"_id":"themes/volantis/source/img/favicon.ico","hash":"63014c6c90c1440bce506c68593a233a8a8f52b8","modified":1658372528896},{"_id":"public/img/favicon.ico","hash":"63014c6c90c1440bce506c68593a233a8a8f52b8","modified":1658460764945},{"_id":"public/css/style.965d31a3.css","hash":"f268a7bd68fc560e2657fffe8664424741fe9535","modified":1658500277655},{"_id":"public/categories/操作系统/index.html","hash":"e40df3639a6f882d860f7dbea6c25abd40b42678","modified":1659402212944},{"_id":"source/categories/index.md","hash":"82fe094ef98ad56f8462faf0e5387a93df2f3bec","modified":1658473934907},{"_id":"public/categories/index.html","hash":"39357cfb4a58bcd7029e2638ae430f0cc5a69f1b","modified":1659402212944},{"_id":"public/2022/07/22/硬件结构/index.html","hash":"f0d6955858c61bcb8af4bab1896bbf312459bc95","modified":1658731099580},{"_id":"source/img/favicon.ico","hash":"63014c6c90c1440bce506c68593a233a8a8f52b8","modified":1658372528896},{"_id":"public/css/style.d826456f.css","hash":"9965f3a7a58e7871e7a30cf75c0692a124829d03","modified":1658500747698},{"_id":"themes/volantis/source/img/logo.png","hash":"e41b9d164ade76a173666aa738207cb028462788","modified":1658648927989},{"_id":"public/img/logo.png","hash":"e41b9d164ade76a173666aa738207cb028462788","modified":1658675140650},{"_id":"themes/volantis/source/img/logo2.png","hash":"85a7eaf9b7a6e78a0c4d26427ff0c6340d9f67c8","modified":1658650390708},{"_id":"public/img/logo2.png","hash":"85a7eaf9b7a6e78a0c4d26427ff0c6340d9f67c8","modified":1658729857999},{"_id":"source/_posts/IO多路复用.md","hash":"0dae56a6530ea06ba2c72d1b032d4c92f43c4873","modified":1658731639646},{"_id":"source/_posts/JavaNIO.md","hash":"bb6223251f48962a5375dc32bc253e50ac2e3585","modified":1658731686886},{"_id":"public/2022/01/05/IO多路复用/index.html","hash":"c1e81fe4fd4c1135fd73717d2846c7f454bfe072","modified":1658731690595},{"_id":"public/categories/netty/index.html","hash":"1c4dc2ba847d179250d13f0e16441c1636a26d58","modified":1659402212944},{"_id":"public/tags/IO模型/index.html","hash":"2e2c228ac3c65a0861d835da2e3edc7e9d924f59","modified":1659402212944},{"_id":"public/archives/2022/01/index.html","hash":"7a10962ca4d11d3de9d326725c17a0ff6bbf37b4","modified":1659402212944},{"_id":"public/2022/01/06/JavaNIO/index.html","hash":"192566b3bc96b17095830cf79de50c1c027c7191","modified":1658731690595},{"_id":"public/tags/Java/index.html","hash":"a4a11d98f29b772c782331f5b146f068e8d0c787","modified":1659402212944},{"_id":"public/tags/netty/index.html","hash":"ab586b2d4f131bd062d95d7a5e130443b3d33514","modified":1659402212944},{"_id":"public/tags/JavaNIo/index.html","hash":"2819f90330504f280cccb06b11dc4fd6ce2c398a","modified":1659402212944},{"_id":"public/tags/零拷贝/index.html","hash":"4f694f1cf6b1cb6865fc72ce018b2ce585993880","modified":1659402212944},{"_id":"source/_posts/netty/IO多路复用.md","hash":"0dae56a6530ea06ba2c72d1b032d4c92f43c4873","modified":1658731639646},{"_id":"source/_posts/netty/JavaNIO.md","hash":"bb6223251f48962a5375dc32bc253e50ac2e3585","modified":1658731686886},{"_id":"source/_posts/netty/Reactor模式.md","hash":"738e0bd3deade1a2d62659e373a981aae317f708","modified":1658732109341},{"_id":"source/_posts/netty/并发基础中的Future异步回调模式.md","hash":"0cf5f9b50a4d00a13eccba4cf073c3697f94029d","modified":1658732062462},{"_id":"public/2022/01/09/netty/并发基础中的Future异步回调模式/index.html","hash":"7211b836a2f5f4a8cdff2aa3e16de30d78aa3bc0","modified":1659402212944},{"_id":"public/2022/01/06/netty/JavaNIO/index.html","hash":"a73124da3d6b3e1c2e6730608553cf5eac7bb301","modified":1659402212944},{"_id":"public/2022/01/08/netty/Reactor模式/index.html","hash":"d625341a3db22621136495e07daa532aaced4e32","modified":1659402212944},{"_id":"public/2022/01/05/netty/IO多路复用/index.html","hash":"12e4ba3f1d3a81d329c0765c4375f3892ff79607","modified":1659402212944},{"_id":"public/tags/Reactor模式/index.html","hash":"68e9023387abb8814776a52c08abbb70d07bcdbc","modified":1659402212944},{"_id":"public/tags/Future/index.html","hash":"7bfdf61cf76acdc1862d3e960cd9c4ded9f9c181","modified":1659402212944},{"_id":"public/tags/异步回调/index.html","hash":"4d21ec100010ee07fd2888324359b143c1731922","modified":1659402212944},{"_id":"source/_posts/spring/Spring自动装配原理.md","hash":"1cf22062a1dc3d18138f345a55b453bf53c23c89","modified":1659402200162},{"_id":"source/_posts/操作系统/硬件结构.md","hash":"75da8a7043a5dec8e545485a7f6f1ad6275690df","modified":1658737702631},{"_id":"public/2020/08/01/spring/Spring自动装配原理/index.html","hash":"72a1ddb49add649f1e10ad8a060e952343067fbb","modified":1659401987697},{"_id":"public/2020/07/05/操作系统/硬件结构/index.html","hash":"3b584c87bcf04432507ee79860d3189272cd7365","modified":1659402212944},{"_id":"public/archives/2020/index.html","hash":"76d28fe8145bd634f43723070e45c52e4631ae3d","modified":1659402212944},{"_id":"public/archives/2020/08/index.html","hash":"f0dd8f3bc07941a72d66d3e5cb5d134ecde451e5","modified":1659401987697},{"_id":"public/archives/2020/07/index.html","hash":"2c6dc93293456a0af64c734000a40443d886d174","modified":1659402212944},{"_id":"public/categories/Springboot/index.html","hash":"2625dc373da52109fa5a0fcaa52be7279fb8d795","modified":1659402212944},{"_id":"public/tags/Springboot/index.html","hash":"9e80dc69c015469b061fec360b979d3ef6341303","modified":1659402212944},{"_id":"public/tags/硬件结构/index.html","hash":"51e93b7ee7022c275446299fa6fe14fe4d9c8954","modified":1659402212944},{"_id":"public/2022/08/01/spring/Spring自动装配原理/index.html","hash":"fe679e5fc907dc6c2812701ee9dbdbd47cf9c887","modified":1659402212944},{"_id":"public/archives/2022/08/index.html","hash":"f55f3927fff5bf59be799828004b2ca2b395b8cb","modified":1659402212944}],"Category":[{"name":"操作系统","_id":"cl5w4c00e0000aovc4jbh5ebp"},{"name":"netty","_id":"cl60dzolm00010gvc57s59sa7"},{"name":"Springboot","_id":"cl6bh3m3v0002cwvc1fvo7cxb"}],"Data":[],"Page":[{"title":"tags","date":"2020-08-21T16:00:00.000Z","type":"tags","layout":"tag","_content":"\n","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2020-8-22 00:00:00\ntype: \"tags\"\nlayout: \"tag\"\n---\n\n","updated":"2022-07-22T07:19:11.553Z","path":"tags/index.html","_id":"cl5uu0kxx0000hwvc1vz28hjl","comments":1,"content":"\n","site":{"data":{}},"excerpt":"","more":""},{"title":"categories","date":"2022-07-21T16:14:46.000Z","type":"categories","layout":"category","_content":"\n\n\n","source":"categories/index.md","raw":"---\ntitle: categories\ndate: 2022-7-22 00:14:46\ntype: \"categories\"\nlayout:\n- category\n---\n\n\n\n","updated":"2022-07-22T07:12:14.907Z","path":"categories/index.html","_id":"cl5w4hlm60000dsvcctq37910","comments":1,"content":"\n","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"title":"JavaNIO","date":"2022-01-05T19:00:00.000Z","_content":"\n\n\n一切还要从JavaNIO说起。\n\nJavaNIO是基于IO多路复用技术，NIO（new IO） 弥补了老式的OIO同步阻塞的不足\n\n## 他们有何不同呢？\n\n- OIO面向流， NIO面向缓冲区\n\n因为是面向流的，所以导致OIO只能顺序读取\n\n- OIO阻塞， NIO非阻塞\n- OIO没用选择器，NIO有选择器，但需要底层支持\n\n## JavaNIO有三个核心组件\n\n- Channel 通道\n- Buffer 缓冲区\n- Selector选择器\n\n可以理解为，**buffer**是存储数据的地方，**channel**是运输数据的载体，**select**用于检查**多个**channel状态变更\n\n### Buffer类\n\n能够覆盖所有基本类型，还包括用于内存映射的MappedByteBuffer\n\nByte，Char, Double, Float, Int , Long, Short\n\n**buffer类的基本属性**\n\ncapacity--容量\n\nposition--当前位置\n\nlimit--读写的最大上限\n\nmark--标记当前位置，并且能够在reset（）将position回到标记的位置\n\n**重要方法**\n\nallocate（）--创建缓冲区\n\nput（）--写入到缓冲区\n\nflip() -- 翻转，将写模式切换成读模式\n\nget()--从缓冲区取\n\nrewind（）倒带相当于重新读缓冲区里的东西\n\nmark()和reset()\n\nclear（）清空缓冲区并且变为写模式。\n\n### Channel类\n\n四种分类：\n\n1. FileChannel\n2. SocketChannel\n3. ServerSocketChannel\n4. DatagramChannel\n\n### Selector类\n\nchannel将自己的事件注册到Selector中\n\nIO事件类型有以下四种：\n\n1. 可读 SelectionKey.OP_READ \n2. 可写 SelectionKey.OP_WRITE\n3. 连接 SelectionKey.OP_CONNECT\t\n4. 接收 SelectionKey.OP_ACCEPT\n\n为什么FileChannel不能被选择器复用？\n\n1. 因为没有继承SelectableChannel\n\nSelectableChannel 提供了实现通道的可选择性所需要的公共方法\n\n1. FilChannel是阻塞的，不能设置成非阻塞\n\n```java\npublic class NoBlockServer {\n\t\n\tpublic static void main(String[] args) throws IOException {\n\t\t\n\t\t// 1.获取通道\n\t\tServerSocketChannel server = ServerSocketChannel.open();\n\t\t\n\t\t// 2.切换成非阻塞模式\n\t\tserver.configureBlocking(false);\n\t\t\n\t\t// 3. 绑定连接\n\t\tserver.bind(new InetSocketAddress(6666));\n\t\t\n\t\t// 4. 获取选择器\n\t\tSelector selector = Selector.open();\n\t\t\n\t\t// 4.1将通道注册到选择器上，指定接收“监听通道”事件\n\t\tserver.register(selector, SelectionKey.OP_ACCEPT);\n\t\t\n\t\t// 5. 轮训地获取选择器上已“就绪”的事件--->只要select()>0，说明已就绪\n\t\twhile (selector.select() > 0) {\n\t\t\t// 6. 获取当前选择器所有注册的“选择键”(已就绪的监听事件)\n\t\t\tIterator<SelectionKey> iterator = selector.selectedKeys().iterator();\n\t\t\t\n\t\t\t// 7. 获取已“就绪”的事件，(不同的事件做不同的事)\n\t\t\twhile (iterator.hasNext()) {\n\t\t\t\t\n\t\t\t\tSelectionKey selectionKey = iterator.next();\n\t\t\t\t\n\t\t\t\t// 接收事件就绪\n\t\t\t\tif (selectionKey.isAcceptable()) {\n\t\t\t\t\t\n\t\t\t\t\t// 8. 获取客户端的链接\n\t\t\t\t\tSocketChannel client = server.accept();\n\t\t\t\t\t\n\t\t\t\t\t// 8.1 切换成非阻塞状态\n\t\t\t\t\tclient.configureBlocking(false);\n\t\t\t\t\t\n\t\t\t\t\t// 8.2 注册到选择器上-->拿到客户端的连接为了读取通道的数据(监听读就绪事件)\n\t\t\t\t\tclient.register(selector, SelectionKey.OP_READ);\n\t\t\t\t\t\n\t\t\t\t} else if (selectionKey.isReadable()) { // 读事件就绪\n\t\t\t\t\t\n\t\t\t\t\t// 9. 获取当前选择器读就绪状态的通道\n\t\t\t\t\tSocketChannel client = (SocketChannel) selectionKey.channel();\n\t\t\t\t\t\n\t\t\t\t\t// 9.1读取数据\n\t\t\t\t\tByteBuffer buffer = ByteBuffer.allocate(1024);\n\t\t\t\t\t\n\t\t\t\t\t// 9.2得到文件通道，将客户端传递过来的图片写到本地项目下(写模式、没有则创建)\n\t\t\t\t\tFileChannel outChannel = FileChannel.open(Paths.get(\"2.png\"), StandardOpenOption.WRITE, StandardOpenOption.CREATE);\n\t\t\t\t\t\n\t\t\t\t\twhile (client.read(buffer) > 0) {\n\t\t\t\t\t\t// 在读之前都要切换成读模式\n\t\t\t\t\t\tbuffer.flip();\n\t\t\t\t\t\t\n\t\t\t\t\t\toutChannel.write(buffer);\n\t\t\t\t\t\t\n\t\t\t\t\t\t// 读完切换成写模式，能让管道继续读取文件的数据\n\t\t\t\t\t\tbuffer.clear();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// 10. 取消选择键(已经处理过的事件，就应该取消掉了)\n\t\t\t\titerator.remove();\n\t\t\t}\n\t\t}\n\t\t\n\t}\n}\n```\n\n\n\n```java\npublic class NoBlockClient {\n\n    public static void main(String[] args) throws IOException {\n\n        // 1. 获取通道\n        SocketChannel socketChannel = SocketChannel.open(new InetSocketAddress(\"127.0.0.1\", 6666));\n\n        // 1.1切换成非阻塞模式\n        socketChannel.configureBlocking(false);\n\n        // 1.2获取选择器\n        Selector selector = Selector.open();\n\n        // 1.3将通道注册到选择器中，获取服务端返回的数据\n        socketChannel.register(selector, SelectionKey.OP_READ);\n\n        // 2. 发送一张图片给服务端吧\n        FileChannel fileChannel = FileChannel.open(Paths.get(\"X:\\\\Users\\\\ozc\\\\Desktop\\\\面试造火箭\\\\1.png\"), StandardOpenOption.READ);\n\n        // 3.要使用NIO，有了Channel，就必然要有Buffer，Buffer是与数据打交道的呢\n        ByteBuffer buffer = ByteBuffer.allocate(1024);\n\n        // 4.读取本地文件(图片)，发送到服务器\n        while (fileChannel.read(buffer) != -1) {\n\n            // 在读之前都要切换成读模式\n            buffer.flip();\n\n            socketChannel.write(buffer);\n\n            // 读完切换成写模式，能让管道继续读取文件的数据\n            buffer.clear();\n        }\n\n\n        // 5. 轮训地获取选择器上已“就绪”的事件--->只要select()>0，说明已就绪\n        while (selector.select() > 0) {\n            // 6. 获取当前选择器所有注册的“选择键”(已就绪的监听事件)\n            Iterator<SelectionKey> iterator = selector.selectedKeys().iterator();\n\n            // 7. 获取已“就绪”的事件，(不同的事件做不同的事)\n            while (iterator.hasNext()) {\n\n                SelectionKey selectionKey = iterator.next();\n\n                // 8. 读事件就绪\n                if (selectionKey.isReadable()) {\n\n                    // 8.1得到对应的通道\n                    SocketChannel channel = (SocketChannel) selectionKey.channel();\n\n                    ByteBuffer responseBuffer = ByteBuffer.allocate(1024);\n\n                    // 9. 知道服务端要返回响应的数据给客户端，客户端在这里接收\n                    int readBytes = channel.read(responseBuffer);\n\n                    if (readBytes > 0) {\n                        // 切换读模式\n                        responseBuffer.flip();\n                        System.out.println(new String(responseBuffer.array(), 0, readBytes));\n                    }\n                }\n\n                // 10. 取消选择键(已经处理过的事件，就应该取消掉了)\n                iterator.remove();\n            }\n        }\n    }\n\n}\n```\n\n## Linux下的IO多路复用技术\n\n文件句柄数的限制\n\n默认1024,也就是一个进程最多接受1024个socket连接\n\n从基础开始讲起，文件句柄，也叫文件描述符。\n\n在linux中文件分为，普通文件、目录文件、链接文件、和设备文件\n\n文件描述符是内核为了高效管理已被打开的文件所创建的索引。是一个非负整数（通常是小数）\n\nulimit 用来显示-修改当前用户进程的一些信息，-n是与文件句柄相关。\n\n三种修改句柄方式\n\nulimit -n 10000 当终端工具退出时就会失效\n\n向 /etc/rc.local添加 ulimit -SHn 10000\n\n终极 解除 修改极限配置文件\n\nsoft nofile 10000\n\nhard nofile 10000 ElasticSearch必须修改\n\n此外，linux对文件的操作实际上是通过**文件描述符**，而**IO复用模型**就是通过一个线程监控**多个**文件描述符，当某个文件描述符准备就绪时，就去通知程序做处理。这样不仅单个连接处理的快，还能处理更多的连接。\n\n\n\nlinux下的IO复用模型就是select/epoll函数\n\n## select和epoll的区别\n\n**select**\n\n函数支持的最大的连接数是1024或者2048，因为在select函数要传入fd_set参数（看操作系统的位数）\n\nfd_set是bitmap的数据结构，可以简单理解为只要位为0，就是数据没到缓冲区，为1 到了缓冲区\n\nselect函数做的就是每次将fd_set遍历，有变化就通知处理。\n\n**epoll**\n\n使用epoll_event结构体来处理，不存在最大连接数的限制。并且不是通过遍历的方式，简单理解就是epoll把就绪的文件描述符专门维护了一块空间，每次从就绪列表里边拿。\n\n## 零拷贝\n\n和JavaNIO相关的另一个概念是**零拷贝**\n\n传统IO情况下，当用户程序发起一次读请求，会调用read相关的系统函数，然后会从用户态切换到内核态，随后CPU告诉DMA去磁盘把数据拷贝到内核空间。内核缓冲区有数据后，CPU就把内核缓冲区数据拷贝到用户缓冲区，最终用户程序拿到数据。\n\nDMA是直接内存访问，允许外部设备直接与内存设备进行数据传输不需要CPU参与的技术\n\n为了内核安全，所以将操作系统划分为**用户空间**和**内核空间,**读数据会有状态切换。\n\n**零拷贝**是指计算机执行IO操作时，CPU不需要将数据从一个存储区域复制到另一个存储区域，从而可以减少上下文切换以及CPU的拷贝时间。它是一种I/O操作优化技术。\n\n- mmap--内核缓冲区与用户缓冲区共享\n- sendfile--系统底层函数的支持\n\n\n\n下面是比较详细的解释\n\n### 传统IO过程\n\n- read ：把数据从磁盘读取到内核缓冲区，再拷贝到用户缓冲区\n- write：先把数据写入到socket缓冲区，最后写入网卡设备\n\n![img](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1657705520995-6609b87a-c626-4bf0-8a58-2e4c36e4f385.png)\n\n过程\n\n1. 用户程序通过read函数向内核发起IO，从用户态切换为内核态，然后再通过DMA将数据从磁盘读到内核缓冲区\n2. CPU将内核缓冲区数据拷贝到用户缓冲区，然后read函数返回，从内核态切换到用户态。\n3. 用户程序通过write函数向内核发起IO，从用户态切换到内核态，然后CPU将数据从用户缓冲区拷贝到内核socket缓冲区，然后write返回，从内核态切换到用户态。\n4. 最后异步传输到网卡。\n\n可以看出，发生了四次状态切换，CPU拷贝两次。\n\nhttps://blog.csdn.net/a745233700/article/details/122660332\n\n\n\n\n\n**零拷贝**指在进行数据IO时， 数据在**用户态**下经历了**零次CPU拷贝**。通过减少内核缓冲区和用户缓冲区之间不必要的cpu数据传输，与用户态和内核态的切换磁环，降低开销提高性能。零拷贝基于PageCache，提升访问缓存数据的性能，同时IO合并与预读（顺序读比随机读性能好）解决机械磁盘寻址慢。\n\n\n\nLinux中的零拷贝方式\n\n\n\n### mmap \n\nmmap就是操作系统把内核缓冲区与用户程序共享，也可以说是将用户空间内存映射到内核空间，映射成功后，用户对这段内存区域的修改可以直接反映到内核空间，反过来也一样。正因如此，就不需要在用户态与内核态之间拷贝数据。\n\n![img](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1657758444170-31a5ae57-0114-4af0-810c-54b1a8980c8e.png)\n\n过程：\n\n1. 用户程序调用mmap发起IO，从用户态切换到内核态，通过DMA将数据从磁盘拷贝到内核缓冲区。\n2. mmap返回，从内核态切换到用户态，不需要将数据从内核缓冲区复制到用户缓冲区，因为共享。\n3. 用户程序通过write发起IO，从用户态切换到内核态，CPU将数据从内核缓冲区复制到内核socket缓冲区，返回内核态切换为用户态。\n4. DMA异步将socket缓冲区拷贝到网卡\n\n\n\n### sendfile\n\n由于调用read或者write一定会发生两次上下文切换，所以想要减少状态切换，那就把read和write合并起来，在内核中完成磁盘与网卡的数据交互\n\n![img](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1657759161290-afdf51ec-0666-4a0a-84f4-368ee15c953e.png)\n\n过程：\n\n1. 用户程序发起sendfile，用户态切换到内核态，DMA将数据从磁盘复制到内存缓冲区\n2. CPU将数据从内核缓冲区复制到socket缓冲区\n3. sendfile系统调用返回，从内核态切换到用户态\n4. DMA异步将socket数据复制到网卡\n\n\n\n\n\n### 带DMA收集拷贝功能的sendfile\n\nsendfile升级后，引入了SG-DMA，就是对DMA拷贝加入了scatter、gather操作，可以直接将内存缓冲区数据复制到网卡，无需再复制到socket缓冲区，减少CPU拷贝次数。\n\n![img](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1657759464898-fe5e078a-e722-4c98-a31f-cddcbe443c4f.png)\n\n过程：\n\n1. 用户程序发起sendfile调用，从用户态切换到内核态，DMA将数据从磁盘拷贝到内核缓冲区\n2. 不需要CPU将数据复制到socket缓冲区，而是将文件描述符信息复制到socket缓冲区，该描述符包含 内核缓冲区的内存地址、内核缓冲区的偏移量\n3. sendfile返回，从内核态切换到用户态\n4. DMA根据socket缓冲区中描述的地址和偏移量直接将内核缓冲区复制到网卡。\n\n零拷贝的缺点：不允许进程对文件内容做加工再发送，比如数据压缩\n\n\n\n\n\n### 零拷贝的应用场景\n\n\n\n**JavaNIO**\n\n1. mmap+ write\n\n上文提到过buffer中有个叫mappedBuffer的家伙，同时Filechannel提供了map方法，可以再一个打开的文件和MappedByteBuffer之间建立一个虚拟内存映射，map底层是通过mmap实现的，因此磁盘文件到缓冲区后，用户和内核共享缓冲区。\n\n```java\npublic class MmapTest {\n \n    public static void main(String[] args) {\n        try {\n            FileChannel readChannel = FileChannel.open(Paths.get(\"./jay.txt\"), StandardOpenOption.READ);\n            MappedByteBuffer data = readChannel.map(FileChannel.MapMode.READ_ONLY, 0, 1024 * 1024 * 40);\n            FileChannel writeChannel = FileChannel.open(Paths.get(\"./siting.txt\"), StandardOpenOption.WRITE, StandardOpenOption.CREATE);\n            //数据传输\n            writeChannel.write(data);\n            readChannel.close();\n            writeChannel.close();\n        }catch (Exception e){\n            System.out.println(e.getMessage());\n        }\n    }\n}\n```\n\n\n\n1. sendfile\n\n   FileChannel 的 transferTo、transferFrom 如果操作系统底层支持的话，transferTo、transferFrom也会使用 sendfile 零拷贝技术来实现数据的传输\n\n```java\n@Override\npublic long transferFrom(FileChannel fileChannel, long position, long count) throws IOException {\n   return fileChannel.transferTo(position, count, socketChannel);\n}\n\npublic class SendFileTest {\n    public static void main(String[] args) {\n        try {\n            FileChannel readChannel = FileChannel.open(Paths.get(\"./jay.txt\"), StandardOpenOption.READ);\n            long len = readChannel.size();\n            long position = readChannel.position();\n            \n            FileChannel writeChannel = FileChannel.open(Paths.get(\"./siting.txt\"), StandardOpenOption.WRITE, StandardOpenOption.CREATE);\n            //数据传输\n            readChannel.transferTo(position, len, writeChannel);\n            readChannel.close();\n            writeChannel.close();\n        } catch (Exception e) {\n            System.out.println(e.getMessage());\n        }\n    }\n}\n```\n\n**Netty框架**\n\nNetty 的零拷贝主要体现在下面五个方面：\n\n\n\n（1）在网络通信上，Netty 的接收和发送 ByteBuffer 采用直接内存，使用堆外直接内存进行 Socket 读写，不需要进行字节缓冲区的二次拷贝。如果使用传统的堆内存进行 Socket 读写，JVM 会将堆内存 Buffer 拷贝一份到直接内存中（为什么拷贝？因为 JVM 会发生 GC 垃圾回收，数据的内存地址会发生变化，直接将堆内的内存地址传给内核，内存地址一旦变了就内核读不到数据了），然后才写入 Socket 中。相比于堆外直接内存，消息在发送过程中多了一次缓冲区的内存拷贝。\n\n\n\n（2）在文件传输上，Netty 的通过 FileRegion 包装的 FileChannel.tranferTo 实现文件传输，它可以直接将文件缓冲区的数据发送到目标 Channel，避免了传统通过循环 write 方式导致的内存拷贝问题。\n\n\n\n（3）在缓存操作上，Netty 提供了CompositeByteBuf 类，它可以将多个 ByteBuf 合并为一个逻辑上的 ByteBuf，避免了各个 ByteBuf 之间的拷贝。\n\n\n\n（4）通过 wrap 操作，我们可以将byte[]数组、ByteBuf、ByteBuffer等包装成一个Netty ByteBuf对象，进而避免了拷贝操作。\n\n\n\n（5）ByteBuf 支持 slice 操作，因此可以将 ByteBuf 分解为多个共享同一个存储区域的 ByteBuf，避免了内存的拷贝。\n\n[\n](https://blog.csdn.net/a745233700/article/details/122660332)\n\n\n\n**kafka**\n\nKafka 的索引文件使用的是 mmap + write 方式，数据文件使用的是 sendfile 方式\n\n[零拷贝1](https://blog.csdn.net/qq_44027353/article/details/121306224)\n\n[零拷贝2](https://blog.csdn.net/a745233700/article/details/122660332)\n\n[零拷贝3](https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&mid=2247520212&idx=1&sn=2d7a19f884fb59e3e961c640c73b8364&chksm=cea1c01ff9d649097dccaef7ba99956250f3bb9998949009b93de0043c023b05259824b9c944&mpshare=1&scene=1&srcid=0420LAxjPloJMzCu9HKGYXMz&sharer_sharetime=1650438077020&sharer_shareid=2e92f088aa52899c6eaf279275db8190&key=066c8b4d62994f4a663099da0975284f295b4b282a9acdd1c75d995ec0c06d7cfe9cd98ed4d05a4512fafd0e0616150a28829e59088dd678d804e2b1f65fdcdce4ae06b6412a0bc40e1e0bf7bb9aec85497c8983188845aea63451b37a63b5cd662409f52fc036c54ded636968ed92c73c7b394b909e3790145b4b4e3035ee94&ascene=1&uin=MTE4OTU2NTIxNQ%3D%3D&devicetype=Windows-QQBrowser&version=6103000b&lang=zh_CN&exportkey=A3zMFqmRKu%2F%2F6LRmGWqUouM%3D&acctmode=0&pass_ticket=Ie8HXClpM2EmWqTabSqVSGwtMO0c3i0ZbY%2FVPSygbfCYdwbNH6PIDhwzvZ6mGEQs&wx_header=0)\n\n","source":"_posts/netty/JavaNIO.md","raw":"---\ntitle: JavaNIO\ndate: 2022-01-06 03:00:00\ntags: \n - Java\n - JavaNIo\n - netty\n - 零拷贝\ncategories: netty\n---\n\n\n\n一切还要从JavaNIO说起。\n\nJavaNIO是基于IO多路复用技术，NIO（new IO） 弥补了老式的OIO同步阻塞的不足\n\n## 他们有何不同呢？\n\n- OIO面向流， NIO面向缓冲区\n\n因为是面向流的，所以导致OIO只能顺序读取\n\n- OIO阻塞， NIO非阻塞\n- OIO没用选择器，NIO有选择器，但需要底层支持\n\n## JavaNIO有三个核心组件\n\n- Channel 通道\n- Buffer 缓冲区\n- Selector选择器\n\n可以理解为，**buffer**是存储数据的地方，**channel**是运输数据的载体，**select**用于检查**多个**channel状态变更\n\n### Buffer类\n\n能够覆盖所有基本类型，还包括用于内存映射的MappedByteBuffer\n\nByte，Char, Double, Float, Int , Long, Short\n\n**buffer类的基本属性**\n\ncapacity--容量\n\nposition--当前位置\n\nlimit--读写的最大上限\n\nmark--标记当前位置，并且能够在reset（）将position回到标记的位置\n\n**重要方法**\n\nallocate（）--创建缓冲区\n\nput（）--写入到缓冲区\n\nflip() -- 翻转，将写模式切换成读模式\n\nget()--从缓冲区取\n\nrewind（）倒带相当于重新读缓冲区里的东西\n\nmark()和reset()\n\nclear（）清空缓冲区并且变为写模式。\n\n### Channel类\n\n四种分类：\n\n1. FileChannel\n2. SocketChannel\n3. ServerSocketChannel\n4. DatagramChannel\n\n### Selector类\n\nchannel将自己的事件注册到Selector中\n\nIO事件类型有以下四种：\n\n1. 可读 SelectionKey.OP_READ \n2. 可写 SelectionKey.OP_WRITE\n3. 连接 SelectionKey.OP_CONNECT\t\n4. 接收 SelectionKey.OP_ACCEPT\n\n为什么FileChannel不能被选择器复用？\n\n1. 因为没有继承SelectableChannel\n\nSelectableChannel 提供了实现通道的可选择性所需要的公共方法\n\n1. FilChannel是阻塞的，不能设置成非阻塞\n\n```java\npublic class NoBlockServer {\n\t\n\tpublic static void main(String[] args) throws IOException {\n\t\t\n\t\t// 1.获取通道\n\t\tServerSocketChannel server = ServerSocketChannel.open();\n\t\t\n\t\t// 2.切换成非阻塞模式\n\t\tserver.configureBlocking(false);\n\t\t\n\t\t// 3. 绑定连接\n\t\tserver.bind(new InetSocketAddress(6666));\n\t\t\n\t\t// 4. 获取选择器\n\t\tSelector selector = Selector.open();\n\t\t\n\t\t// 4.1将通道注册到选择器上，指定接收“监听通道”事件\n\t\tserver.register(selector, SelectionKey.OP_ACCEPT);\n\t\t\n\t\t// 5. 轮训地获取选择器上已“就绪”的事件--->只要select()>0，说明已就绪\n\t\twhile (selector.select() > 0) {\n\t\t\t// 6. 获取当前选择器所有注册的“选择键”(已就绪的监听事件)\n\t\t\tIterator<SelectionKey> iterator = selector.selectedKeys().iterator();\n\t\t\t\n\t\t\t// 7. 获取已“就绪”的事件，(不同的事件做不同的事)\n\t\t\twhile (iterator.hasNext()) {\n\t\t\t\t\n\t\t\t\tSelectionKey selectionKey = iterator.next();\n\t\t\t\t\n\t\t\t\t// 接收事件就绪\n\t\t\t\tif (selectionKey.isAcceptable()) {\n\t\t\t\t\t\n\t\t\t\t\t// 8. 获取客户端的链接\n\t\t\t\t\tSocketChannel client = server.accept();\n\t\t\t\t\t\n\t\t\t\t\t// 8.1 切换成非阻塞状态\n\t\t\t\t\tclient.configureBlocking(false);\n\t\t\t\t\t\n\t\t\t\t\t// 8.2 注册到选择器上-->拿到客户端的连接为了读取通道的数据(监听读就绪事件)\n\t\t\t\t\tclient.register(selector, SelectionKey.OP_READ);\n\t\t\t\t\t\n\t\t\t\t} else if (selectionKey.isReadable()) { // 读事件就绪\n\t\t\t\t\t\n\t\t\t\t\t// 9. 获取当前选择器读就绪状态的通道\n\t\t\t\t\tSocketChannel client = (SocketChannel) selectionKey.channel();\n\t\t\t\t\t\n\t\t\t\t\t// 9.1读取数据\n\t\t\t\t\tByteBuffer buffer = ByteBuffer.allocate(1024);\n\t\t\t\t\t\n\t\t\t\t\t// 9.2得到文件通道，将客户端传递过来的图片写到本地项目下(写模式、没有则创建)\n\t\t\t\t\tFileChannel outChannel = FileChannel.open(Paths.get(\"2.png\"), StandardOpenOption.WRITE, StandardOpenOption.CREATE);\n\t\t\t\t\t\n\t\t\t\t\twhile (client.read(buffer) > 0) {\n\t\t\t\t\t\t// 在读之前都要切换成读模式\n\t\t\t\t\t\tbuffer.flip();\n\t\t\t\t\t\t\n\t\t\t\t\t\toutChannel.write(buffer);\n\t\t\t\t\t\t\n\t\t\t\t\t\t// 读完切换成写模式，能让管道继续读取文件的数据\n\t\t\t\t\t\tbuffer.clear();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// 10. 取消选择键(已经处理过的事件，就应该取消掉了)\n\t\t\t\titerator.remove();\n\t\t\t}\n\t\t}\n\t\t\n\t}\n}\n```\n\n\n\n```java\npublic class NoBlockClient {\n\n    public static void main(String[] args) throws IOException {\n\n        // 1. 获取通道\n        SocketChannel socketChannel = SocketChannel.open(new InetSocketAddress(\"127.0.0.1\", 6666));\n\n        // 1.1切换成非阻塞模式\n        socketChannel.configureBlocking(false);\n\n        // 1.2获取选择器\n        Selector selector = Selector.open();\n\n        // 1.3将通道注册到选择器中，获取服务端返回的数据\n        socketChannel.register(selector, SelectionKey.OP_READ);\n\n        // 2. 发送一张图片给服务端吧\n        FileChannel fileChannel = FileChannel.open(Paths.get(\"X:\\\\Users\\\\ozc\\\\Desktop\\\\面试造火箭\\\\1.png\"), StandardOpenOption.READ);\n\n        // 3.要使用NIO，有了Channel，就必然要有Buffer，Buffer是与数据打交道的呢\n        ByteBuffer buffer = ByteBuffer.allocate(1024);\n\n        // 4.读取本地文件(图片)，发送到服务器\n        while (fileChannel.read(buffer) != -1) {\n\n            // 在读之前都要切换成读模式\n            buffer.flip();\n\n            socketChannel.write(buffer);\n\n            // 读完切换成写模式，能让管道继续读取文件的数据\n            buffer.clear();\n        }\n\n\n        // 5. 轮训地获取选择器上已“就绪”的事件--->只要select()>0，说明已就绪\n        while (selector.select() > 0) {\n            // 6. 获取当前选择器所有注册的“选择键”(已就绪的监听事件)\n            Iterator<SelectionKey> iterator = selector.selectedKeys().iterator();\n\n            // 7. 获取已“就绪”的事件，(不同的事件做不同的事)\n            while (iterator.hasNext()) {\n\n                SelectionKey selectionKey = iterator.next();\n\n                // 8. 读事件就绪\n                if (selectionKey.isReadable()) {\n\n                    // 8.1得到对应的通道\n                    SocketChannel channel = (SocketChannel) selectionKey.channel();\n\n                    ByteBuffer responseBuffer = ByteBuffer.allocate(1024);\n\n                    // 9. 知道服务端要返回响应的数据给客户端，客户端在这里接收\n                    int readBytes = channel.read(responseBuffer);\n\n                    if (readBytes > 0) {\n                        // 切换读模式\n                        responseBuffer.flip();\n                        System.out.println(new String(responseBuffer.array(), 0, readBytes));\n                    }\n                }\n\n                // 10. 取消选择键(已经处理过的事件，就应该取消掉了)\n                iterator.remove();\n            }\n        }\n    }\n\n}\n```\n\n## Linux下的IO多路复用技术\n\n文件句柄数的限制\n\n默认1024,也就是一个进程最多接受1024个socket连接\n\n从基础开始讲起，文件句柄，也叫文件描述符。\n\n在linux中文件分为，普通文件、目录文件、链接文件、和设备文件\n\n文件描述符是内核为了高效管理已被打开的文件所创建的索引。是一个非负整数（通常是小数）\n\nulimit 用来显示-修改当前用户进程的一些信息，-n是与文件句柄相关。\n\n三种修改句柄方式\n\nulimit -n 10000 当终端工具退出时就会失效\n\n向 /etc/rc.local添加 ulimit -SHn 10000\n\n终极 解除 修改极限配置文件\n\nsoft nofile 10000\n\nhard nofile 10000 ElasticSearch必须修改\n\n此外，linux对文件的操作实际上是通过**文件描述符**，而**IO复用模型**就是通过一个线程监控**多个**文件描述符，当某个文件描述符准备就绪时，就去通知程序做处理。这样不仅单个连接处理的快，还能处理更多的连接。\n\n\n\nlinux下的IO复用模型就是select/epoll函数\n\n## select和epoll的区别\n\n**select**\n\n函数支持的最大的连接数是1024或者2048，因为在select函数要传入fd_set参数（看操作系统的位数）\n\nfd_set是bitmap的数据结构，可以简单理解为只要位为0，就是数据没到缓冲区，为1 到了缓冲区\n\nselect函数做的就是每次将fd_set遍历，有变化就通知处理。\n\n**epoll**\n\n使用epoll_event结构体来处理，不存在最大连接数的限制。并且不是通过遍历的方式，简单理解就是epoll把就绪的文件描述符专门维护了一块空间，每次从就绪列表里边拿。\n\n## 零拷贝\n\n和JavaNIO相关的另一个概念是**零拷贝**\n\n传统IO情况下，当用户程序发起一次读请求，会调用read相关的系统函数，然后会从用户态切换到内核态，随后CPU告诉DMA去磁盘把数据拷贝到内核空间。内核缓冲区有数据后，CPU就把内核缓冲区数据拷贝到用户缓冲区，最终用户程序拿到数据。\n\nDMA是直接内存访问，允许外部设备直接与内存设备进行数据传输不需要CPU参与的技术\n\n为了内核安全，所以将操作系统划分为**用户空间**和**内核空间,**读数据会有状态切换。\n\n**零拷贝**是指计算机执行IO操作时，CPU不需要将数据从一个存储区域复制到另一个存储区域，从而可以减少上下文切换以及CPU的拷贝时间。它是一种I/O操作优化技术。\n\n- mmap--内核缓冲区与用户缓冲区共享\n- sendfile--系统底层函数的支持\n\n\n\n下面是比较详细的解释\n\n### 传统IO过程\n\n- read ：把数据从磁盘读取到内核缓冲区，再拷贝到用户缓冲区\n- write：先把数据写入到socket缓冲区，最后写入网卡设备\n\n![img](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1657705520995-6609b87a-c626-4bf0-8a58-2e4c36e4f385.png)\n\n过程\n\n1. 用户程序通过read函数向内核发起IO，从用户态切换为内核态，然后再通过DMA将数据从磁盘读到内核缓冲区\n2. CPU将内核缓冲区数据拷贝到用户缓冲区，然后read函数返回，从内核态切换到用户态。\n3. 用户程序通过write函数向内核发起IO，从用户态切换到内核态，然后CPU将数据从用户缓冲区拷贝到内核socket缓冲区，然后write返回，从内核态切换到用户态。\n4. 最后异步传输到网卡。\n\n可以看出，发生了四次状态切换，CPU拷贝两次。\n\nhttps://blog.csdn.net/a745233700/article/details/122660332\n\n\n\n\n\n**零拷贝**指在进行数据IO时， 数据在**用户态**下经历了**零次CPU拷贝**。通过减少内核缓冲区和用户缓冲区之间不必要的cpu数据传输，与用户态和内核态的切换磁环，降低开销提高性能。零拷贝基于PageCache，提升访问缓存数据的性能，同时IO合并与预读（顺序读比随机读性能好）解决机械磁盘寻址慢。\n\n\n\nLinux中的零拷贝方式\n\n\n\n### mmap \n\nmmap就是操作系统把内核缓冲区与用户程序共享，也可以说是将用户空间内存映射到内核空间，映射成功后，用户对这段内存区域的修改可以直接反映到内核空间，反过来也一样。正因如此，就不需要在用户态与内核态之间拷贝数据。\n\n![img](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1657758444170-31a5ae57-0114-4af0-810c-54b1a8980c8e.png)\n\n过程：\n\n1. 用户程序调用mmap发起IO，从用户态切换到内核态，通过DMA将数据从磁盘拷贝到内核缓冲区。\n2. mmap返回，从内核态切换到用户态，不需要将数据从内核缓冲区复制到用户缓冲区，因为共享。\n3. 用户程序通过write发起IO，从用户态切换到内核态，CPU将数据从内核缓冲区复制到内核socket缓冲区，返回内核态切换为用户态。\n4. DMA异步将socket缓冲区拷贝到网卡\n\n\n\n### sendfile\n\n由于调用read或者write一定会发生两次上下文切换，所以想要减少状态切换，那就把read和write合并起来，在内核中完成磁盘与网卡的数据交互\n\n![img](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1657759161290-afdf51ec-0666-4a0a-84f4-368ee15c953e.png)\n\n过程：\n\n1. 用户程序发起sendfile，用户态切换到内核态，DMA将数据从磁盘复制到内存缓冲区\n2. CPU将数据从内核缓冲区复制到socket缓冲区\n3. sendfile系统调用返回，从内核态切换到用户态\n4. DMA异步将socket数据复制到网卡\n\n\n\n\n\n### 带DMA收集拷贝功能的sendfile\n\nsendfile升级后，引入了SG-DMA，就是对DMA拷贝加入了scatter、gather操作，可以直接将内存缓冲区数据复制到网卡，无需再复制到socket缓冲区，减少CPU拷贝次数。\n\n![img](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1657759464898-fe5e078a-e722-4c98-a31f-cddcbe443c4f.png)\n\n过程：\n\n1. 用户程序发起sendfile调用，从用户态切换到内核态，DMA将数据从磁盘拷贝到内核缓冲区\n2. 不需要CPU将数据复制到socket缓冲区，而是将文件描述符信息复制到socket缓冲区，该描述符包含 内核缓冲区的内存地址、内核缓冲区的偏移量\n3. sendfile返回，从内核态切换到用户态\n4. DMA根据socket缓冲区中描述的地址和偏移量直接将内核缓冲区复制到网卡。\n\n零拷贝的缺点：不允许进程对文件内容做加工再发送，比如数据压缩\n\n\n\n\n\n### 零拷贝的应用场景\n\n\n\n**JavaNIO**\n\n1. mmap+ write\n\n上文提到过buffer中有个叫mappedBuffer的家伙，同时Filechannel提供了map方法，可以再一个打开的文件和MappedByteBuffer之间建立一个虚拟内存映射，map底层是通过mmap实现的，因此磁盘文件到缓冲区后，用户和内核共享缓冲区。\n\n```java\npublic class MmapTest {\n \n    public static void main(String[] args) {\n        try {\n            FileChannel readChannel = FileChannel.open(Paths.get(\"./jay.txt\"), StandardOpenOption.READ);\n            MappedByteBuffer data = readChannel.map(FileChannel.MapMode.READ_ONLY, 0, 1024 * 1024 * 40);\n            FileChannel writeChannel = FileChannel.open(Paths.get(\"./siting.txt\"), StandardOpenOption.WRITE, StandardOpenOption.CREATE);\n            //数据传输\n            writeChannel.write(data);\n            readChannel.close();\n            writeChannel.close();\n        }catch (Exception e){\n            System.out.println(e.getMessage());\n        }\n    }\n}\n```\n\n\n\n1. sendfile\n\n   FileChannel 的 transferTo、transferFrom 如果操作系统底层支持的话，transferTo、transferFrom也会使用 sendfile 零拷贝技术来实现数据的传输\n\n```java\n@Override\npublic long transferFrom(FileChannel fileChannel, long position, long count) throws IOException {\n   return fileChannel.transferTo(position, count, socketChannel);\n}\n\npublic class SendFileTest {\n    public static void main(String[] args) {\n        try {\n            FileChannel readChannel = FileChannel.open(Paths.get(\"./jay.txt\"), StandardOpenOption.READ);\n            long len = readChannel.size();\n            long position = readChannel.position();\n            \n            FileChannel writeChannel = FileChannel.open(Paths.get(\"./siting.txt\"), StandardOpenOption.WRITE, StandardOpenOption.CREATE);\n            //数据传输\n            readChannel.transferTo(position, len, writeChannel);\n            readChannel.close();\n            writeChannel.close();\n        } catch (Exception e) {\n            System.out.println(e.getMessage());\n        }\n    }\n}\n```\n\n**Netty框架**\n\nNetty 的零拷贝主要体现在下面五个方面：\n\n\n\n（1）在网络通信上，Netty 的接收和发送 ByteBuffer 采用直接内存，使用堆外直接内存进行 Socket 读写，不需要进行字节缓冲区的二次拷贝。如果使用传统的堆内存进行 Socket 读写，JVM 会将堆内存 Buffer 拷贝一份到直接内存中（为什么拷贝？因为 JVM 会发生 GC 垃圾回收，数据的内存地址会发生变化，直接将堆内的内存地址传给内核，内存地址一旦变了就内核读不到数据了），然后才写入 Socket 中。相比于堆外直接内存，消息在发送过程中多了一次缓冲区的内存拷贝。\n\n\n\n（2）在文件传输上，Netty 的通过 FileRegion 包装的 FileChannel.tranferTo 实现文件传输，它可以直接将文件缓冲区的数据发送到目标 Channel，避免了传统通过循环 write 方式导致的内存拷贝问题。\n\n\n\n（3）在缓存操作上，Netty 提供了CompositeByteBuf 类，它可以将多个 ByteBuf 合并为一个逻辑上的 ByteBuf，避免了各个 ByteBuf 之间的拷贝。\n\n\n\n（4）通过 wrap 操作，我们可以将byte[]数组、ByteBuf、ByteBuffer等包装成一个Netty ByteBuf对象，进而避免了拷贝操作。\n\n\n\n（5）ByteBuf 支持 slice 操作，因此可以将 ByteBuf 分解为多个共享同一个存储区域的 ByteBuf，避免了内存的拷贝。\n\n[\n](https://blog.csdn.net/a745233700/article/details/122660332)\n\n\n\n**kafka**\n\nKafka 的索引文件使用的是 mmap + write 方式，数据文件使用的是 sendfile 方式\n\n[零拷贝1](https://blog.csdn.net/qq_44027353/article/details/121306224)\n\n[零拷贝2](https://blog.csdn.net/a745233700/article/details/122660332)\n\n[零拷贝3](https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&mid=2247520212&idx=1&sn=2d7a19f884fb59e3e961c640c73b8364&chksm=cea1c01ff9d649097dccaef7ba99956250f3bb9998949009b93de0043c023b05259824b9c944&mpshare=1&scene=1&srcid=0420LAxjPloJMzCu9HKGYXMz&sharer_sharetime=1650438077020&sharer_shareid=2e92f088aa52899c6eaf279275db8190&key=066c8b4d62994f4a663099da0975284f295b4b282a9acdd1c75d995ec0c06d7cfe9cd98ed4d05a4512fafd0e0616150a28829e59088dd678d804e2b1f65fdcdce4ae06b6412a0bc40e1e0bf7bb9aec85497c8983188845aea63451b37a63b5cd662409f52fc036c54ded636968ed92c73c7b394b909e3790145b4b4e3035ee94&ascene=1&uin=MTE4OTU2NTIxNQ%3D%3D&devicetype=Windows-QQBrowser&version=6103000b&lang=zh_CN&exportkey=A3zMFqmRKu%2F%2F6LRmGWqUouM%3D&acctmode=0&pass_ticket=Ie8HXClpM2EmWqTabSqVSGwtMO0c3i0ZbY%2FVPSygbfCYdwbNH6PIDhwzvZ6mGEQs&wx_header=0)\n\n","slug":"netty/JavaNIO","published":1,"updated":"2022-07-25T06:48:06.886Z","_id":"cl60e5056000hm8vc7rkt0wfk","comments":1,"layout":"post","photos":[],"link":"","content":"<p>一切还要从JavaNIO说起。</p>\n<p>JavaNIO是基于IO多路复用技术，NIO（new IO） 弥补了老式的OIO同步阻塞的不足</p>\n<div class=\"story post-story\"><h2 id=\"他们有何不同呢？\"><a href=\"#他们有何不同呢？\" class=\"headerlink\" title=\"他们有何不同呢？\"></a>他们有何不同呢？</h2><ul>\n<li>OIO面向流， NIO面向缓冲区</li>\n</ul>\n<p>因为是面向流的，所以导致OIO只能顺序读取</p>\n<ul>\n<li>OIO阻塞， NIO非阻塞</li>\n<li>OIO没用选择器，NIO有选择器，但需要底层支持</li>\n</ul>\n</div><div class=\"story post-story\"><h2 id=\"JavaNIO有三个核心组件\"><a href=\"#JavaNIO有三个核心组件\" class=\"headerlink\" title=\"JavaNIO有三个核心组件\"></a>JavaNIO有三个核心组件</h2><ul>\n<li>Channel 通道</li>\n<li>Buffer 缓冲区</li>\n<li>Selector选择器</li>\n</ul>\n<p>可以理解为，<strong>buffer</strong>是存储数据的地方，<strong>channel</strong>是运输数据的载体，<strong>select</strong>用于检查<strong>多个</strong>channel状态变更</p>\n<h3 id=\"Buffer类\"><a href=\"#Buffer类\" class=\"headerlink\" title=\"Buffer类\"></a>Buffer类</h3><p>能够覆盖所有基本类型，还包括用于内存映射的MappedByteBuffer</p>\n<p>Byte，Char, Double, Float, Int , Long, Short</p>\n<p><strong>buffer类的基本属性</strong></p>\n<p>capacity–容量</p>\n<p>position–当前位置</p>\n<p>limit–读写的最大上限</p>\n<p>mark–标记当前位置，并且能够在reset（）将position回到标记的位置</p>\n<p><strong>重要方法</strong></p>\n<p>allocate（）–创建缓冲区</p>\n<p>put（）–写入到缓冲区</p>\n<p>flip() – 翻转，将写模式切换成读模式</p>\n<p>get()–从缓冲区取</p>\n<p>rewind（）倒带相当于重新读缓冲区里的东西</p>\n<p>mark()和reset()</p>\n<p>clear（）清空缓冲区并且变为写模式。</p>\n<h3 id=\"Channel类\"><a href=\"#Channel类\" class=\"headerlink\" title=\"Channel类\"></a>Channel类</h3><p>四种分类：</p>\n<ol>\n<li>FileChannel</li>\n<li>SocketChannel</li>\n<li>ServerSocketChannel</li>\n<li>DatagramChannel</li>\n</ol>\n<h3 id=\"Selector类\"><a href=\"#Selector类\" class=\"headerlink\" title=\"Selector类\"></a>Selector类</h3><p>channel将自己的事件注册到Selector中</p>\n<p>IO事件类型有以下四种：</p>\n<ol>\n<li>可读 SelectionKey.OP_READ </li>\n<li>可写 SelectionKey.OP_WRITE</li>\n<li>连接 SelectionKey.OP_CONNECT\t</li>\n<li>接收 SelectionKey.OP_ACCEPT</li>\n</ol>\n<p>为什么FileChannel不能被选择器复用？</p>\n<ol>\n<li>因为没有继承SelectableChannel</li>\n</ol>\n<p>SelectableChannel 提供了实现通道的可选择性所需要的公共方法</p>\n<ol>\n<li>FilChannel是阻塞的，不能设置成非阻塞</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">NoBlockServer</span> &#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"comment\">// 1.获取通道</span></span><br><span class=\"line\">\t\t<span class=\"type\">ServerSocketChannel</span> <span class=\"variable\">server</span> <span class=\"operator\">=</span> ServerSocketChannel.open();</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"comment\">// 2.切换成非阻塞模式</span></span><br><span class=\"line\">\t\tserver.configureBlocking(<span class=\"literal\">false</span>);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"comment\">// 3. 绑定连接</span></span><br><span class=\"line\">\t\tserver.bind(<span class=\"keyword\">new</span> <span class=\"title class_\">InetSocketAddress</span>(<span class=\"number\">6666</span>));</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"comment\">// 4. 获取选择器</span></span><br><span class=\"line\">\t\t<span class=\"type\">Selector</span> <span class=\"variable\">selector</span> <span class=\"operator\">=</span> Selector.open();</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"comment\">// 4.1将通道注册到选择器上，指定接收“监听通道”事件</span></span><br><span class=\"line\">\t\tserver.register(selector, SelectionKey.OP_ACCEPT);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"comment\">// 5. 轮训地获取选择器上已“就绪”的事件---&gt;只要select()&gt;0，说明已就绪</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">while</span> (selector.select() &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// 6. 获取当前选择器所有注册的“选择键”(已就绪的监听事件)</span></span><br><span class=\"line\">\t\t\tIterator&lt;SelectionKey&gt; iterator = selector.selectedKeys().iterator();</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// 7. 获取已“就绪”的事件，(不同的事件做不同的事)</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">while</span> (iterator.hasNext()) &#123;</span><br><span class=\"line\">\t\t\t\t</span><br><span class=\"line\">\t\t\t\t<span class=\"type\">SelectionKey</span> <span class=\"variable\">selectionKey</span> <span class=\"operator\">=</span> iterator.next();</span><br><span class=\"line\">\t\t\t\t</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// 接收事件就绪</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (selectionKey.isAcceptable()) &#123;</span><br><span class=\"line\">\t\t\t\t\t</span><br><span class=\"line\">\t\t\t\t\t<span class=\"comment\">// 8. 获取客户端的链接</span></span><br><span class=\"line\">\t\t\t\t\t<span class=\"type\">SocketChannel</span> <span class=\"variable\">client</span> <span class=\"operator\">=</span> server.accept();</span><br><span class=\"line\">\t\t\t\t\t</span><br><span class=\"line\">\t\t\t\t\t<span class=\"comment\">// 8.1 切换成非阻塞状态</span></span><br><span class=\"line\">\t\t\t\t\tclient.configureBlocking(<span class=\"literal\">false</span>);</span><br><span class=\"line\">\t\t\t\t\t</span><br><span class=\"line\">\t\t\t\t\t<span class=\"comment\">// 8.2 注册到选择器上--&gt;拿到客户端的连接为了读取通道的数据(监听读就绪事件)</span></span><br><span class=\"line\">\t\t\t\t\tclient.register(selector, SelectionKey.OP_READ);</span><br><span class=\"line\">\t\t\t\t\t</span><br><span class=\"line\">\t\t\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (selectionKey.isReadable()) &#123; <span class=\"comment\">// 读事件就绪</span></span><br><span class=\"line\">\t\t\t\t\t</span><br><span class=\"line\">\t\t\t\t\t<span class=\"comment\">// 9. 获取当前选择器读就绪状态的通道</span></span><br><span class=\"line\">\t\t\t\t\t<span class=\"type\">SocketChannel</span> <span class=\"variable\">client</span> <span class=\"operator\">=</span> (SocketChannel) selectionKey.channel();</span><br><span class=\"line\">\t\t\t\t\t</span><br><span class=\"line\">\t\t\t\t\t<span class=\"comment\">// 9.1读取数据</span></span><br><span class=\"line\">\t\t\t\t\t<span class=\"type\">ByteBuffer</span> <span class=\"variable\">buffer</span> <span class=\"operator\">=</span> ByteBuffer.allocate(<span class=\"number\">1024</span>);</span><br><span class=\"line\">\t\t\t\t\t</span><br><span class=\"line\">\t\t\t\t\t<span class=\"comment\">// 9.2得到文件通道，将客户端传递过来的图片写到本地项目下(写模式、没有则创建)</span></span><br><span class=\"line\">\t\t\t\t\t<span class=\"type\">FileChannel</span> <span class=\"variable\">outChannel</span> <span class=\"operator\">=</span> FileChannel.open(Paths.get(<span class=\"string\">&quot;2.png&quot;</span>), StandardOpenOption.WRITE, StandardOpenOption.CREATE);</span><br><span class=\"line\">\t\t\t\t\t</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">while</span> (client.read(buffer) &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"comment\">// 在读之前都要切换成读模式</span></span><br><span class=\"line\">\t\t\t\t\t\tbuffer.flip();</span><br><span class=\"line\">\t\t\t\t\t\t</span><br><span class=\"line\">\t\t\t\t\t\toutChannel.write(buffer);</span><br><span class=\"line\">\t\t\t\t\t\t</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"comment\">// 读完切换成写模式，能让管道继续读取文件的数据</span></span><br><span class=\"line\">\t\t\t\t\t\tbuffer.clear();</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// 10. 取消选择键(已经处理过的事件，就应该取消掉了)</span></span><br><span class=\"line\">\t\t\t\titerator.remove();</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">NoBlockClient</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 1. 获取通道</span></span><br><span class=\"line\">        <span class=\"type\">SocketChannel</span> <span class=\"variable\">socketChannel</span> <span class=\"operator\">=</span> SocketChannel.open(<span class=\"keyword\">new</span> <span class=\"title class_\">InetSocketAddress</span>(<span class=\"string\">&quot;127.0.0.1&quot;</span>, <span class=\"number\">6666</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 1.1切换成非阻塞模式</span></span><br><span class=\"line\">        socketChannel.configureBlocking(<span class=\"literal\">false</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 1.2获取选择器</span></span><br><span class=\"line\">        <span class=\"type\">Selector</span> <span class=\"variable\">selector</span> <span class=\"operator\">=</span> Selector.open();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 1.3将通道注册到选择器中，获取服务端返回的数据</span></span><br><span class=\"line\">        socketChannel.register(selector, SelectionKey.OP_READ);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 2. 发送一张图片给服务端吧</span></span><br><span class=\"line\">        <span class=\"type\">FileChannel</span> <span class=\"variable\">fileChannel</span> <span class=\"operator\">=</span> FileChannel.open(Paths.get(<span class=\"string\">&quot;X:\\\\Users\\\\ozc\\\\Desktop\\\\面试造火箭\\\\1.png&quot;</span>), StandardOpenOption.READ);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 3.要使用NIO，有了Channel，就必然要有Buffer，Buffer是与数据打交道的呢</span></span><br><span class=\"line\">        <span class=\"type\">ByteBuffer</span> <span class=\"variable\">buffer</span> <span class=\"operator\">=</span> ByteBuffer.allocate(<span class=\"number\">1024</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 4.读取本地文件(图片)，发送到服务器</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> (fileChannel.read(buffer) != -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 在读之前都要切换成读模式</span></span><br><span class=\"line\">            buffer.flip();</span><br><span class=\"line\"></span><br><span class=\"line\">            socketChannel.write(buffer);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 读完切换成写模式，能让管道继续读取文件的数据</span></span><br><span class=\"line\">            buffer.clear();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 5. 轮训地获取选择器上已“就绪”的事件---&gt;只要select()&gt;0，说明已就绪</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> (selector.select() &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 6. 获取当前选择器所有注册的“选择键”(已就绪的监听事件)</span></span><br><span class=\"line\">            Iterator&lt;SelectionKey&gt; iterator = selector.selectedKeys().iterator();</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 7. 获取已“就绪”的事件，(不同的事件做不同的事)</span></span><br><span class=\"line\">            <span class=\"keyword\">while</span> (iterator.hasNext()) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"type\">SelectionKey</span> <span class=\"variable\">selectionKey</span> <span class=\"operator\">=</span> iterator.next();</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">// 8. 读事件就绪</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (selectionKey.isReadable()) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"comment\">// 8.1得到对应的通道</span></span><br><span class=\"line\">                    <span class=\"type\">SocketChannel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> (SocketChannel) selectionKey.channel();</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"type\">ByteBuffer</span> <span class=\"variable\">responseBuffer</span> <span class=\"operator\">=</span> ByteBuffer.allocate(<span class=\"number\">1024</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"comment\">// 9. 知道服务端要返回响应的数据给客户端，客户端在这里接收</span></span><br><span class=\"line\">                    <span class=\"type\">int</span> <span class=\"variable\">readBytes</span> <span class=\"operator\">=</span> channel.read(responseBuffer);</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (readBytes &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                        <span class=\"comment\">// 切换读模式</span></span><br><span class=\"line\">                        responseBuffer.flip();</span><br><span class=\"line\">                        System.out.println(<span class=\"keyword\">new</span> <span class=\"title class_\">String</span>(responseBuffer.array(), <span class=\"number\">0</span>, readBytes));</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">// 10. 取消选择键(已经处理过的事件，就应该取消掉了)</span></span><br><span class=\"line\">                iterator.remove();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n</div><div class=\"story post-story\"><h2 id=\"Linux下的IO多路复用技术\"><a href=\"#Linux下的IO多路复用技术\" class=\"headerlink\" title=\"Linux下的IO多路复用技术\"></a>Linux下的IO多路复用技术</h2><p>文件句柄数的限制</p>\n<p>默认1024,也就是一个进程最多接受1024个socket连接</p>\n<p>从基础开始讲起，文件句柄，也叫文件描述符。</p>\n<p>在linux中文件分为，普通文件、目录文件、链接文件、和设备文件</p>\n<p>文件描述符是内核为了高效管理已被打开的文件所创建的索引。是一个非负整数（通常是小数）</p>\n<p>ulimit 用来显示-修改当前用户进程的一些信息，-n是与文件句柄相关。</p>\n<p>三种修改句柄方式</p>\n<p>ulimit -n 10000 当终端工具退出时就会失效</p>\n<p>向 &#x2F;etc&#x2F;rc.local添加 ulimit -SHn 10000</p>\n<p>终极 解除 修改极限配置文件</p>\n<p>soft nofile 10000</p>\n<p>hard nofile 10000 ElasticSearch必须修改</p>\n<p>此外，linux对文件的操作实际上是通过<strong>文件描述符</strong>，而<strong>IO复用模型</strong>就是通过一个线程监控<strong>多个</strong>文件描述符，当某个文件描述符准备就绪时，就去通知程序做处理。这样不仅单个连接处理的快，还能处理更多的连接。</p>\n<p>linux下的IO复用模型就是select&#x2F;epoll函数</p>\n</div><div class=\"story post-story\"><h2 id=\"select和epoll的区别\"><a href=\"#select和epoll的区别\" class=\"headerlink\" title=\"select和epoll的区别\"></a>select和epoll的区别</h2><p><strong>select</strong></p>\n<p>函数支持的最大的连接数是1024或者2048，因为在select函数要传入fd_set参数（看操作系统的位数）</p>\n<p>fd_set是bitmap的数据结构，可以简单理解为只要位为0，就是数据没到缓冲区，为1 到了缓冲区</p>\n<p>select函数做的就是每次将fd_set遍历，有变化就通知处理。</p>\n<p><strong>epoll</strong></p>\n<p>使用epoll_event结构体来处理，不存在最大连接数的限制。并且不是通过遍历的方式，简单理解就是epoll把就绪的文件描述符专门维护了一块空间，每次从就绪列表里边拿。</p>\n</div><div class=\"story post-story\"><h2 id=\"零拷贝\"><a href=\"#零拷贝\" class=\"headerlink\" title=\"零拷贝\"></a>零拷贝</h2><p>和JavaNIO相关的另一个概念是<strong>零拷贝</strong></p>\n<p>传统IO情况下，当用户程序发起一次读请求，会调用read相关的系统函数，然后会从用户态切换到内核态，随后CPU告诉DMA去磁盘把数据拷贝到内核空间。内核缓冲区有数据后，CPU就把内核缓冲区数据拷贝到用户缓冲区，最终用户程序拿到数据。</p>\n<p>DMA是直接内存访问，允许外部设备直接与内存设备进行数据传输不需要CPU参与的技术</p>\n<p>为了内核安全，所以将操作系统划分为<strong>用户空间</strong>和**内核空间,**读数据会有状态切换。</p>\n<p><strong>零拷贝</strong>是指计算机执行IO操作时，CPU不需要将数据从一个存储区域复制到另一个存储区域，从而可以减少上下文切换以及CPU的拷贝时间。它是一种I&#x2F;O操作优化技术。</p>\n<ul>\n<li>mmap–内核缓冲区与用户缓冲区共享</li>\n<li>sendfile–系统底层函数的支持</li>\n</ul>\n<p>下面是比较详细的解释</p>\n<h3 id=\"传统IO过程\"><a href=\"#传统IO过程\" class=\"headerlink\" title=\"传统IO过程\"></a>传统IO过程</h3><ul>\n<li>read ：把数据从磁盘读取到内核缓冲区，再拷贝到用户缓冲区</li>\n<li>write：先把数据写入到socket缓冲区，最后写入网卡设备</li>\n</ul>\n<p><img src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1657705520995-6609b87a-c626-4bf0-8a58-2e4c36e4f385.png\" class=\"lazyload\" data-srcset=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1657705520995-6609b87a-c626-4bf0-8a58-2e4c36e4f385.png\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"img\"></p>\n<p>过程</p>\n<ol>\n<li>用户程序通过read函数向内核发起IO，从用户态切换为内核态，然后再通过DMA将数据从磁盘读到内核缓冲区</li>\n<li>CPU将内核缓冲区数据拷贝到用户缓冲区，然后read函数返回，从内核态切换到用户态。</li>\n<li>用户程序通过write函数向内核发起IO，从用户态切换到内核态，然后CPU将数据从用户缓冲区拷贝到内核socket缓冲区，然后write返回，从内核态切换到用户态。</li>\n<li>最后异步传输到网卡。</li>\n</ol>\n<p>可以看出，发生了四次状态切换，CPU拷贝两次。</p>\n<p><a href=\"https://blog.csdn.net/a745233700/article/details/122660332\">https://blog.csdn.net/a745233700/article/details/122660332</a></p>\n<p><strong>零拷贝</strong>指在进行数据IO时， 数据在<strong>用户态</strong>下经历了<strong>零次CPU拷贝</strong>。通过减少内核缓冲区和用户缓冲区之间不必要的cpu数据传输，与用户态和内核态的切换磁环，降低开销提高性能。零拷贝基于PageCache，提升访问缓存数据的性能，同时IO合并与预读（顺序读比随机读性能好）解决机械磁盘寻址慢。</p>\n<p>Linux中的零拷贝方式</p>\n<h3 id=\"mmap\"><a href=\"#mmap\" class=\"headerlink\" title=\"mmap\"></a>mmap</h3><p>mmap就是操作系统把内核缓冲区与用户程序共享，也可以说是将用户空间内存映射到内核空间，映射成功后，用户对这段内存区域的修改可以直接反映到内核空间，反过来也一样。正因如此，就不需要在用户态与内核态之间拷贝数据。</p>\n<p><img src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1657758444170-31a5ae57-0114-4af0-810c-54b1a8980c8e.png\" class=\"lazyload\" data-srcset=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1657758444170-31a5ae57-0114-4af0-810c-54b1a8980c8e.png\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"img\"></p>\n<p>过程：</p>\n<ol>\n<li>用户程序调用mmap发起IO，从用户态切换到内核态，通过DMA将数据从磁盘拷贝到内核缓冲区。</li>\n<li>mmap返回，从内核态切换到用户态，不需要将数据从内核缓冲区复制到用户缓冲区，因为共享。</li>\n<li>用户程序通过write发起IO，从用户态切换到内核态，CPU将数据从内核缓冲区复制到内核socket缓冲区，返回内核态切换为用户态。</li>\n<li>DMA异步将socket缓冲区拷贝到网卡</li>\n</ol>\n<h3 id=\"sendfile\"><a href=\"#sendfile\" class=\"headerlink\" title=\"sendfile\"></a>sendfile</h3><p>由于调用read或者write一定会发生两次上下文切换，所以想要减少状态切换，那就把read和write合并起来，在内核中完成磁盘与网卡的数据交互</p>\n<p><img src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1657759161290-afdf51ec-0666-4a0a-84f4-368ee15c953e.png\" class=\"lazyload\" data-srcset=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1657759161290-afdf51ec-0666-4a0a-84f4-368ee15c953e.png\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"img\"></p>\n<p>过程：</p>\n<ol>\n<li>用户程序发起sendfile，用户态切换到内核态，DMA将数据从磁盘复制到内存缓冲区</li>\n<li>CPU将数据从内核缓冲区复制到socket缓冲区</li>\n<li>sendfile系统调用返回，从内核态切换到用户态</li>\n<li>DMA异步将socket数据复制到网卡</li>\n</ol>\n<h3 id=\"带DMA收集拷贝功能的sendfile\"><a href=\"#带DMA收集拷贝功能的sendfile\" class=\"headerlink\" title=\"带DMA收集拷贝功能的sendfile\"></a>带DMA收集拷贝功能的sendfile</h3><p>sendfile升级后，引入了SG-DMA，就是对DMA拷贝加入了scatter、gather操作，可以直接将内存缓冲区数据复制到网卡，无需再复制到socket缓冲区，减少CPU拷贝次数。</p>\n<p><img src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1657759464898-fe5e078a-e722-4c98-a31f-cddcbe443c4f.png\" class=\"lazyload\" data-srcset=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1657759464898-fe5e078a-e722-4c98-a31f-cddcbe443c4f.png\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"img\"></p>\n<p>过程：</p>\n<ol>\n<li>用户程序发起sendfile调用，从用户态切换到内核态，DMA将数据从磁盘拷贝到内核缓冲区</li>\n<li>不需要CPU将数据复制到socket缓冲区，而是将文件描述符信息复制到socket缓冲区，该描述符包含 内核缓冲区的内存地址、内核缓冲区的偏移量</li>\n<li>sendfile返回，从内核态切换到用户态</li>\n<li>DMA根据socket缓冲区中描述的地址和偏移量直接将内核缓冲区复制到网卡。</li>\n</ol>\n<p>零拷贝的缺点：不允许进程对文件内容做加工再发送，比如数据压缩</p>\n<h3 id=\"零拷贝的应用场景\"><a href=\"#零拷贝的应用场景\" class=\"headerlink\" title=\"零拷贝的应用场景\"></a>零拷贝的应用场景</h3><p><strong>JavaNIO</strong></p>\n<ol>\n<li>mmap+ write</li>\n</ol>\n<p>上文提到过buffer中有个叫mappedBuffer的家伙，同时Filechannel提供了map方法，可以再一个打开的文件和MappedByteBuffer之间建立一个虚拟内存映射，map底层是通过mmap实现的，因此磁盘文件到缓冲区后，用户和内核共享缓冲区。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MmapTest</span> &#123;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">FileChannel</span> <span class=\"variable\">readChannel</span> <span class=\"operator\">=</span> FileChannel.open(Paths.get(<span class=\"string\">&quot;./jay.txt&quot;</span>), StandardOpenOption.READ);</span><br><span class=\"line\">            <span class=\"type\">MappedByteBuffer</span> <span class=\"variable\">data</span> <span class=\"operator\">=</span> readChannel.map(FileChannel.MapMode.READ_ONLY, <span class=\"number\">0</span>, <span class=\"number\">1024</span> * <span class=\"number\">1024</span> * <span class=\"number\">40</span>);</span><br><span class=\"line\">            <span class=\"type\">FileChannel</span> <span class=\"variable\">writeChannel</span> <span class=\"operator\">=</span> FileChannel.open(Paths.get(<span class=\"string\">&quot;./siting.txt&quot;</span>), StandardOpenOption.WRITE, StandardOpenOption.CREATE);</span><br><span class=\"line\">            <span class=\"comment\">//数据传输</span></span><br><span class=\"line\">            writeChannel.write(data);</span><br><span class=\"line\">            readChannel.close();</span><br><span class=\"line\">            writeChannel.close();</span><br><span class=\"line\">        &#125;<span class=\"keyword\">catch</span> (Exception e)&#123;</span><br><span class=\"line\">            System.out.println(e.getMessage());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<ol>\n<li><p>sendfile</p>\n<p>FileChannel 的 transferTo、transferFrom 如果操作系统底层支持的话，transferTo、transferFrom也会使用 sendfile 零拷贝技术来实现数据的传输</p>\n</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">long</span> <span class=\"title function_\">transferFrom</span><span class=\"params\">(FileChannel fileChannel, <span class=\"type\">long</span> position, <span class=\"type\">long</span> count)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">   <span class=\"keyword\">return</span> fileChannel.transferTo(position, count, socketChannel);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SendFileTest</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">FileChannel</span> <span class=\"variable\">readChannel</span> <span class=\"operator\">=</span> FileChannel.open(Paths.get(<span class=\"string\">&quot;./jay.txt&quot;</span>), StandardOpenOption.READ);</span><br><span class=\"line\">            <span class=\"type\">long</span> <span class=\"variable\">len</span> <span class=\"operator\">=</span> readChannel.size();</span><br><span class=\"line\">            <span class=\"type\">long</span> <span class=\"variable\">position</span> <span class=\"operator\">=</span> readChannel.position();</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"type\">FileChannel</span> <span class=\"variable\">writeChannel</span> <span class=\"operator\">=</span> FileChannel.open(Paths.get(<span class=\"string\">&quot;./siting.txt&quot;</span>), StandardOpenOption.WRITE, StandardOpenOption.CREATE);</span><br><span class=\"line\">            <span class=\"comment\">//数据传输</span></span><br><span class=\"line\">            readChannel.transferTo(position, len, writeChannel);</span><br><span class=\"line\">            readChannel.close();</span><br><span class=\"line\">            writeChannel.close();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            System.out.println(e.getMessage());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>Netty框架</strong></p>\n<p>Netty 的零拷贝主要体现在下面五个方面：</p>\n<p>（1）在网络通信上，Netty 的接收和发送 ByteBuffer 采用直接内存，使用堆外直接内存进行 Socket 读写，不需要进行字节缓冲区的二次拷贝。如果使用传统的堆内存进行 Socket 读写，JVM 会将堆内存 Buffer 拷贝一份到直接内存中（为什么拷贝？因为 JVM 会发生 GC 垃圾回收，数据的内存地址会发生变化，直接将堆内的内存地址传给内核，内存地址一旦变了就内核读不到数据了），然后才写入 Socket 中。相比于堆外直接内存，消息在发送过程中多了一次缓冲区的内存拷贝。</p>\n<p>（2）在文件传输上，Netty 的通过 FileRegion 包装的 FileChannel.tranferTo 实现文件传输，它可以直接将文件缓冲区的数据发送到目标 Channel，避免了传统通过循环 write 方式导致的内存拷贝问题。</p>\n<p>（3）在缓存操作上，Netty 提供了CompositeByteBuf 类，它可以将多个 ByteBuf 合并为一个逻辑上的 ByteBuf，避免了各个 ByteBuf 之间的拷贝。</p>\n<p>（4）通过 wrap 操作，我们可以将byte[]数组、ByteBuf、ByteBuffer等包装成一个Netty ByteBuf对象，进而避免了拷贝操作。</p>\n<p>（5）ByteBuf 支持 slice 操作，因此可以将 ByteBuf 分解为多个共享同一个存储区域的 ByteBuf，避免了内存的拷贝。</p>\n<p><a href=\"https://blog.csdn.net/a745233700/article/details/122660332\">\n</a></p>\n<p><strong>kafka</strong></p>\n<p>Kafka 的索引文件使用的是 mmap + write 方式，数据文件使用的是 sendfile 方式</p>\n<p><a href=\"https://blog.csdn.net/qq_44027353/article/details/121306224\">零拷贝1</a></p>\n<p><a href=\"https://blog.csdn.net/a745233700/article/details/122660332\">零拷贝2</a></p>\n<p><a href=\"https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&mid=2247520212&idx=1&sn=2d7a19f884fb59e3e961c640c73b8364&chksm=cea1c01ff9d649097dccaef7ba99956250f3bb9998949009b93de0043c023b05259824b9c944&mpshare=1&scene=1&srcid=0420LAxjPloJMzCu9HKGYXMz&sharer_sharetime=1650438077020&sharer_shareid=2e92f088aa52899c6eaf279275db8190&key=066c8b4d62994f4a663099da0975284f295b4b282a9acdd1c75d995ec0c06d7cfe9cd98ed4d05a4512fafd0e0616150a28829e59088dd678d804e2b1f65fdcdce4ae06b6412a0bc40e1e0bf7bb9aec85497c8983188845aea63451b37a63b5cd662409f52fc036c54ded636968ed92c73c7b394b909e3790145b4b4e3035ee94&ascene=1&uin=MTE4OTU2NTIxNQ==&devicetype=Windows-QQBrowser&version=6103000b&lang=zh_CN&exportkey=A3zMFqmRKu//6LRmGWqUouM=&acctmode=0&pass_ticket=Ie8HXClpM2EmWqTabSqVSGwtMO0c3i0ZbY/VPSygbfCYdwbNH6PIDhwzvZ6mGEQs&wx_header=0\">零拷贝3</a></p>\n\n</div>","site":{"data":{}},"excerpt":"","more":"<p>一切还要从JavaNIO说起。</p>\n<p>JavaNIO是基于IO多路复用技术，NIO（new IO） 弥补了老式的OIO同步阻塞的不足</p>\n<h2 id=\"他们有何不同呢？\"><a href=\"#他们有何不同呢？\" class=\"headerlink\" title=\"他们有何不同呢？\"></a>他们有何不同呢？</h2><ul>\n<li>OIO面向流， NIO面向缓冲区</li>\n</ul>\n<p>因为是面向流的，所以导致OIO只能顺序读取</p>\n<ul>\n<li>OIO阻塞， NIO非阻塞</li>\n<li>OIO没用选择器，NIO有选择器，但需要底层支持</li>\n</ul>\n<h2 id=\"JavaNIO有三个核心组件\"><a href=\"#JavaNIO有三个核心组件\" class=\"headerlink\" title=\"JavaNIO有三个核心组件\"></a>JavaNIO有三个核心组件</h2><ul>\n<li>Channel 通道</li>\n<li>Buffer 缓冲区</li>\n<li>Selector选择器</li>\n</ul>\n<p>可以理解为，<strong>buffer</strong>是存储数据的地方，<strong>channel</strong>是运输数据的载体，<strong>select</strong>用于检查<strong>多个</strong>channel状态变更</p>\n<h3 id=\"Buffer类\"><a href=\"#Buffer类\" class=\"headerlink\" title=\"Buffer类\"></a>Buffer类</h3><p>能够覆盖所有基本类型，还包括用于内存映射的MappedByteBuffer</p>\n<p>Byte，Char, Double, Float, Int , Long, Short</p>\n<p><strong>buffer类的基本属性</strong></p>\n<p>capacity–容量</p>\n<p>position–当前位置</p>\n<p>limit–读写的最大上限</p>\n<p>mark–标记当前位置，并且能够在reset（）将position回到标记的位置</p>\n<p><strong>重要方法</strong></p>\n<p>allocate（）–创建缓冲区</p>\n<p>put（）–写入到缓冲区</p>\n<p>flip() – 翻转，将写模式切换成读模式</p>\n<p>get()–从缓冲区取</p>\n<p>rewind（）倒带相当于重新读缓冲区里的东西</p>\n<p>mark()和reset()</p>\n<p>clear（）清空缓冲区并且变为写模式。</p>\n<h3 id=\"Channel类\"><a href=\"#Channel类\" class=\"headerlink\" title=\"Channel类\"></a>Channel类</h3><p>四种分类：</p>\n<ol>\n<li>FileChannel</li>\n<li>SocketChannel</li>\n<li>ServerSocketChannel</li>\n<li>DatagramChannel</li>\n</ol>\n<h3 id=\"Selector类\"><a href=\"#Selector类\" class=\"headerlink\" title=\"Selector类\"></a>Selector类</h3><p>channel将自己的事件注册到Selector中</p>\n<p>IO事件类型有以下四种：</p>\n<ol>\n<li>可读 SelectionKey.OP_READ </li>\n<li>可写 SelectionKey.OP_WRITE</li>\n<li>连接 SelectionKey.OP_CONNECT\t</li>\n<li>接收 SelectionKey.OP_ACCEPT</li>\n</ol>\n<p>为什么FileChannel不能被选择器复用？</p>\n<ol>\n<li>因为没有继承SelectableChannel</li>\n</ol>\n<p>SelectableChannel 提供了实现通道的可选择性所需要的公共方法</p>\n<ol>\n<li>FilChannel是阻塞的，不能设置成非阻塞</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">NoBlockServer</span> &#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"comment\">// 1.获取通道</span></span><br><span class=\"line\">\t\t<span class=\"type\">ServerSocketChannel</span> <span class=\"variable\">server</span> <span class=\"operator\">=</span> ServerSocketChannel.open();</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"comment\">// 2.切换成非阻塞模式</span></span><br><span class=\"line\">\t\tserver.configureBlocking(<span class=\"literal\">false</span>);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"comment\">// 3. 绑定连接</span></span><br><span class=\"line\">\t\tserver.bind(<span class=\"keyword\">new</span> <span class=\"title class_\">InetSocketAddress</span>(<span class=\"number\">6666</span>));</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"comment\">// 4. 获取选择器</span></span><br><span class=\"line\">\t\t<span class=\"type\">Selector</span> <span class=\"variable\">selector</span> <span class=\"operator\">=</span> Selector.open();</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"comment\">// 4.1将通道注册到选择器上，指定接收“监听通道”事件</span></span><br><span class=\"line\">\t\tserver.register(selector, SelectionKey.OP_ACCEPT);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"comment\">// 5. 轮训地获取选择器上已“就绪”的事件---&gt;只要select()&gt;0，说明已就绪</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">while</span> (selector.select() &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// 6. 获取当前选择器所有注册的“选择键”(已就绪的监听事件)</span></span><br><span class=\"line\">\t\t\tIterator&lt;SelectionKey&gt; iterator = selector.selectedKeys().iterator();</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// 7. 获取已“就绪”的事件，(不同的事件做不同的事)</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">while</span> (iterator.hasNext()) &#123;</span><br><span class=\"line\">\t\t\t\t</span><br><span class=\"line\">\t\t\t\t<span class=\"type\">SelectionKey</span> <span class=\"variable\">selectionKey</span> <span class=\"operator\">=</span> iterator.next();</span><br><span class=\"line\">\t\t\t\t</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// 接收事件就绪</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (selectionKey.isAcceptable()) &#123;</span><br><span class=\"line\">\t\t\t\t\t</span><br><span class=\"line\">\t\t\t\t\t<span class=\"comment\">// 8. 获取客户端的链接</span></span><br><span class=\"line\">\t\t\t\t\t<span class=\"type\">SocketChannel</span> <span class=\"variable\">client</span> <span class=\"operator\">=</span> server.accept();</span><br><span class=\"line\">\t\t\t\t\t</span><br><span class=\"line\">\t\t\t\t\t<span class=\"comment\">// 8.1 切换成非阻塞状态</span></span><br><span class=\"line\">\t\t\t\t\tclient.configureBlocking(<span class=\"literal\">false</span>);</span><br><span class=\"line\">\t\t\t\t\t</span><br><span class=\"line\">\t\t\t\t\t<span class=\"comment\">// 8.2 注册到选择器上--&gt;拿到客户端的连接为了读取通道的数据(监听读就绪事件)</span></span><br><span class=\"line\">\t\t\t\t\tclient.register(selector, SelectionKey.OP_READ);</span><br><span class=\"line\">\t\t\t\t\t</span><br><span class=\"line\">\t\t\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (selectionKey.isReadable()) &#123; <span class=\"comment\">// 读事件就绪</span></span><br><span class=\"line\">\t\t\t\t\t</span><br><span class=\"line\">\t\t\t\t\t<span class=\"comment\">// 9. 获取当前选择器读就绪状态的通道</span></span><br><span class=\"line\">\t\t\t\t\t<span class=\"type\">SocketChannel</span> <span class=\"variable\">client</span> <span class=\"operator\">=</span> (SocketChannel) selectionKey.channel();</span><br><span class=\"line\">\t\t\t\t\t</span><br><span class=\"line\">\t\t\t\t\t<span class=\"comment\">// 9.1读取数据</span></span><br><span class=\"line\">\t\t\t\t\t<span class=\"type\">ByteBuffer</span> <span class=\"variable\">buffer</span> <span class=\"operator\">=</span> ByteBuffer.allocate(<span class=\"number\">1024</span>);</span><br><span class=\"line\">\t\t\t\t\t</span><br><span class=\"line\">\t\t\t\t\t<span class=\"comment\">// 9.2得到文件通道，将客户端传递过来的图片写到本地项目下(写模式、没有则创建)</span></span><br><span class=\"line\">\t\t\t\t\t<span class=\"type\">FileChannel</span> <span class=\"variable\">outChannel</span> <span class=\"operator\">=</span> FileChannel.open(Paths.get(<span class=\"string\">&quot;2.png&quot;</span>), StandardOpenOption.WRITE, StandardOpenOption.CREATE);</span><br><span class=\"line\">\t\t\t\t\t</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">while</span> (client.read(buffer) &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"comment\">// 在读之前都要切换成读模式</span></span><br><span class=\"line\">\t\t\t\t\t\tbuffer.flip();</span><br><span class=\"line\">\t\t\t\t\t\t</span><br><span class=\"line\">\t\t\t\t\t\toutChannel.write(buffer);</span><br><span class=\"line\">\t\t\t\t\t\t</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"comment\">// 读完切换成写模式，能让管道继续读取文件的数据</span></span><br><span class=\"line\">\t\t\t\t\t\tbuffer.clear();</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// 10. 取消选择键(已经处理过的事件，就应该取消掉了)</span></span><br><span class=\"line\">\t\t\t\titerator.remove();</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">NoBlockClient</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 1. 获取通道</span></span><br><span class=\"line\">        <span class=\"type\">SocketChannel</span> <span class=\"variable\">socketChannel</span> <span class=\"operator\">=</span> SocketChannel.open(<span class=\"keyword\">new</span> <span class=\"title class_\">InetSocketAddress</span>(<span class=\"string\">&quot;127.0.0.1&quot;</span>, <span class=\"number\">6666</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 1.1切换成非阻塞模式</span></span><br><span class=\"line\">        socketChannel.configureBlocking(<span class=\"literal\">false</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 1.2获取选择器</span></span><br><span class=\"line\">        <span class=\"type\">Selector</span> <span class=\"variable\">selector</span> <span class=\"operator\">=</span> Selector.open();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 1.3将通道注册到选择器中，获取服务端返回的数据</span></span><br><span class=\"line\">        socketChannel.register(selector, SelectionKey.OP_READ);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 2. 发送一张图片给服务端吧</span></span><br><span class=\"line\">        <span class=\"type\">FileChannel</span> <span class=\"variable\">fileChannel</span> <span class=\"operator\">=</span> FileChannel.open(Paths.get(<span class=\"string\">&quot;X:\\\\Users\\\\ozc\\\\Desktop\\\\面试造火箭\\\\1.png&quot;</span>), StandardOpenOption.READ);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 3.要使用NIO，有了Channel，就必然要有Buffer，Buffer是与数据打交道的呢</span></span><br><span class=\"line\">        <span class=\"type\">ByteBuffer</span> <span class=\"variable\">buffer</span> <span class=\"operator\">=</span> ByteBuffer.allocate(<span class=\"number\">1024</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 4.读取本地文件(图片)，发送到服务器</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> (fileChannel.read(buffer) != -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 在读之前都要切换成读模式</span></span><br><span class=\"line\">            buffer.flip();</span><br><span class=\"line\"></span><br><span class=\"line\">            socketChannel.write(buffer);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 读完切换成写模式，能让管道继续读取文件的数据</span></span><br><span class=\"line\">            buffer.clear();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 5. 轮训地获取选择器上已“就绪”的事件---&gt;只要select()&gt;0，说明已就绪</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> (selector.select() &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 6. 获取当前选择器所有注册的“选择键”(已就绪的监听事件)</span></span><br><span class=\"line\">            Iterator&lt;SelectionKey&gt; iterator = selector.selectedKeys().iterator();</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 7. 获取已“就绪”的事件，(不同的事件做不同的事)</span></span><br><span class=\"line\">            <span class=\"keyword\">while</span> (iterator.hasNext()) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"type\">SelectionKey</span> <span class=\"variable\">selectionKey</span> <span class=\"operator\">=</span> iterator.next();</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">// 8. 读事件就绪</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (selectionKey.isReadable()) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"comment\">// 8.1得到对应的通道</span></span><br><span class=\"line\">                    <span class=\"type\">SocketChannel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> (SocketChannel) selectionKey.channel();</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"type\">ByteBuffer</span> <span class=\"variable\">responseBuffer</span> <span class=\"operator\">=</span> ByteBuffer.allocate(<span class=\"number\">1024</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"comment\">// 9. 知道服务端要返回响应的数据给客户端，客户端在这里接收</span></span><br><span class=\"line\">                    <span class=\"type\">int</span> <span class=\"variable\">readBytes</span> <span class=\"operator\">=</span> channel.read(responseBuffer);</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (readBytes &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                        <span class=\"comment\">// 切换读模式</span></span><br><span class=\"line\">                        responseBuffer.flip();</span><br><span class=\"line\">                        System.out.println(<span class=\"keyword\">new</span> <span class=\"title class_\">String</span>(responseBuffer.array(), <span class=\"number\">0</span>, readBytes));</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">// 10. 取消选择键(已经处理过的事件，就应该取消掉了)</span></span><br><span class=\"line\">                iterator.remove();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Linux下的IO多路复用技术\"><a href=\"#Linux下的IO多路复用技术\" class=\"headerlink\" title=\"Linux下的IO多路复用技术\"></a>Linux下的IO多路复用技术</h2><p>文件句柄数的限制</p>\n<p>默认1024,也就是一个进程最多接受1024个socket连接</p>\n<p>从基础开始讲起，文件句柄，也叫文件描述符。</p>\n<p>在linux中文件分为，普通文件、目录文件、链接文件、和设备文件</p>\n<p>文件描述符是内核为了高效管理已被打开的文件所创建的索引。是一个非负整数（通常是小数）</p>\n<p>ulimit 用来显示-修改当前用户进程的一些信息，-n是与文件句柄相关。</p>\n<p>三种修改句柄方式</p>\n<p>ulimit -n 10000 当终端工具退出时就会失效</p>\n<p>向 &#x2F;etc&#x2F;rc.local添加 ulimit -SHn 10000</p>\n<p>终极 解除 修改极限配置文件</p>\n<p>soft nofile 10000</p>\n<p>hard nofile 10000 ElasticSearch必须修改</p>\n<p>此外，linux对文件的操作实际上是通过<strong>文件描述符</strong>，而<strong>IO复用模型</strong>就是通过一个线程监控<strong>多个</strong>文件描述符，当某个文件描述符准备就绪时，就去通知程序做处理。这样不仅单个连接处理的快，还能处理更多的连接。</p>\n<p>linux下的IO复用模型就是select&#x2F;epoll函数</p>\n<h2 id=\"select和epoll的区别\"><a href=\"#select和epoll的区别\" class=\"headerlink\" title=\"select和epoll的区别\"></a>select和epoll的区别</h2><p><strong>select</strong></p>\n<p>函数支持的最大的连接数是1024或者2048，因为在select函数要传入fd_set参数（看操作系统的位数）</p>\n<p>fd_set是bitmap的数据结构，可以简单理解为只要位为0，就是数据没到缓冲区，为1 到了缓冲区</p>\n<p>select函数做的就是每次将fd_set遍历，有变化就通知处理。</p>\n<p><strong>epoll</strong></p>\n<p>使用epoll_event结构体来处理，不存在最大连接数的限制。并且不是通过遍历的方式，简单理解就是epoll把就绪的文件描述符专门维护了一块空间，每次从就绪列表里边拿。</p>\n<h2 id=\"零拷贝\"><a href=\"#零拷贝\" class=\"headerlink\" title=\"零拷贝\"></a>零拷贝</h2><p>和JavaNIO相关的另一个概念是<strong>零拷贝</strong></p>\n<p>传统IO情况下，当用户程序发起一次读请求，会调用read相关的系统函数，然后会从用户态切换到内核态，随后CPU告诉DMA去磁盘把数据拷贝到内核空间。内核缓冲区有数据后，CPU就把内核缓冲区数据拷贝到用户缓冲区，最终用户程序拿到数据。</p>\n<p>DMA是直接内存访问，允许外部设备直接与内存设备进行数据传输不需要CPU参与的技术</p>\n<p>为了内核安全，所以将操作系统划分为<strong>用户空间</strong>和**内核空间,**读数据会有状态切换。</p>\n<p><strong>零拷贝</strong>是指计算机执行IO操作时，CPU不需要将数据从一个存储区域复制到另一个存储区域，从而可以减少上下文切换以及CPU的拷贝时间。它是一种I&#x2F;O操作优化技术。</p>\n<ul>\n<li>mmap–内核缓冲区与用户缓冲区共享</li>\n<li>sendfile–系统底层函数的支持</li>\n</ul>\n<p>下面是比较详细的解释</p>\n<h3 id=\"传统IO过程\"><a href=\"#传统IO过程\" class=\"headerlink\" title=\"传统IO过程\"></a>传统IO过程</h3><ul>\n<li>read ：把数据从磁盘读取到内核缓冲区，再拷贝到用户缓冲区</li>\n<li>write：先把数据写入到socket缓冲区，最后写入网卡设备</li>\n</ul>\n<p><img src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1657705520995-6609b87a-c626-4bf0-8a58-2e4c36e4f385.png\" alt=\"img\"></p>\n<p>过程</p>\n<ol>\n<li>用户程序通过read函数向内核发起IO，从用户态切换为内核态，然后再通过DMA将数据从磁盘读到内核缓冲区</li>\n<li>CPU将内核缓冲区数据拷贝到用户缓冲区，然后read函数返回，从内核态切换到用户态。</li>\n<li>用户程序通过write函数向内核发起IO，从用户态切换到内核态，然后CPU将数据从用户缓冲区拷贝到内核socket缓冲区，然后write返回，从内核态切换到用户态。</li>\n<li>最后异步传输到网卡。</li>\n</ol>\n<p>可以看出，发生了四次状态切换，CPU拷贝两次。</p>\n<p><a href=\"https://blog.csdn.net/a745233700/article/details/122660332\">https://blog.csdn.net/a745233700/article/details/122660332</a></p>\n<p><strong>零拷贝</strong>指在进行数据IO时， 数据在<strong>用户态</strong>下经历了<strong>零次CPU拷贝</strong>。通过减少内核缓冲区和用户缓冲区之间不必要的cpu数据传输，与用户态和内核态的切换磁环，降低开销提高性能。零拷贝基于PageCache，提升访问缓存数据的性能，同时IO合并与预读（顺序读比随机读性能好）解决机械磁盘寻址慢。</p>\n<p>Linux中的零拷贝方式</p>\n<h3 id=\"mmap\"><a href=\"#mmap\" class=\"headerlink\" title=\"mmap\"></a>mmap</h3><p>mmap就是操作系统把内核缓冲区与用户程序共享，也可以说是将用户空间内存映射到内核空间，映射成功后，用户对这段内存区域的修改可以直接反映到内核空间，反过来也一样。正因如此，就不需要在用户态与内核态之间拷贝数据。</p>\n<p><img src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1657758444170-31a5ae57-0114-4af0-810c-54b1a8980c8e.png\" alt=\"img\"></p>\n<p>过程：</p>\n<ol>\n<li>用户程序调用mmap发起IO，从用户态切换到内核态，通过DMA将数据从磁盘拷贝到内核缓冲区。</li>\n<li>mmap返回，从内核态切换到用户态，不需要将数据从内核缓冲区复制到用户缓冲区，因为共享。</li>\n<li>用户程序通过write发起IO，从用户态切换到内核态，CPU将数据从内核缓冲区复制到内核socket缓冲区，返回内核态切换为用户态。</li>\n<li>DMA异步将socket缓冲区拷贝到网卡</li>\n</ol>\n<h3 id=\"sendfile\"><a href=\"#sendfile\" class=\"headerlink\" title=\"sendfile\"></a>sendfile</h3><p>由于调用read或者write一定会发生两次上下文切换，所以想要减少状态切换，那就把read和write合并起来，在内核中完成磁盘与网卡的数据交互</p>\n<p><img src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1657759161290-afdf51ec-0666-4a0a-84f4-368ee15c953e.png\" alt=\"img\"></p>\n<p>过程：</p>\n<ol>\n<li>用户程序发起sendfile，用户态切换到内核态，DMA将数据从磁盘复制到内存缓冲区</li>\n<li>CPU将数据从内核缓冲区复制到socket缓冲区</li>\n<li>sendfile系统调用返回，从内核态切换到用户态</li>\n<li>DMA异步将socket数据复制到网卡</li>\n</ol>\n<h3 id=\"带DMA收集拷贝功能的sendfile\"><a href=\"#带DMA收集拷贝功能的sendfile\" class=\"headerlink\" title=\"带DMA收集拷贝功能的sendfile\"></a>带DMA收集拷贝功能的sendfile</h3><p>sendfile升级后，引入了SG-DMA，就是对DMA拷贝加入了scatter、gather操作，可以直接将内存缓冲区数据复制到网卡，无需再复制到socket缓冲区，减少CPU拷贝次数。</p>\n<p><img src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1657759464898-fe5e078a-e722-4c98-a31f-cddcbe443c4f.png\" alt=\"img\"></p>\n<p>过程：</p>\n<ol>\n<li>用户程序发起sendfile调用，从用户态切换到内核态，DMA将数据从磁盘拷贝到内核缓冲区</li>\n<li>不需要CPU将数据复制到socket缓冲区，而是将文件描述符信息复制到socket缓冲区，该描述符包含 内核缓冲区的内存地址、内核缓冲区的偏移量</li>\n<li>sendfile返回，从内核态切换到用户态</li>\n<li>DMA根据socket缓冲区中描述的地址和偏移量直接将内核缓冲区复制到网卡。</li>\n</ol>\n<p>零拷贝的缺点：不允许进程对文件内容做加工再发送，比如数据压缩</p>\n<h3 id=\"零拷贝的应用场景\"><a href=\"#零拷贝的应用场景\" class=\"headerlink\" title=\"零拷贝的应用场景\"></a>零拷贝的应用场景</h3><p><strong>JavaNIO</strong></p>\n<ol>\n<li>mmap+ write</li>\n</ol>\n<p>上文提到过buffer中有个叫mappedBuffer的家伙，同时Filechannel提供了map方法，可以再一个打开的文件和MappedByteBuffer之间建立一个虚拟内存映射，map底层是通过mmap实现的，因此磁盘文件到缓冲区后，用户和内核共享缓冲区。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MmapTest</span> &#123;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">FileChannel</span> <span class=\"variable\">readChannel</span> <span class=\"operator\">=</span> FileChannel.open(Paths.get(<span class=\"string\">&quot;./jay.txt&quot;</span>), StandardOpenOption.READ);</span><br><span class=\"line\">            <span class=\"type\">MappedByteBuffer</span> <span class=\"variable\">data</span> <span class=\"operator\">=</span> readChannel.map(FileChannel.MapMode.READ_ONLY, <span class=\"number\">0</span>, <span class=\"number\">1024</span> * <span class=\"number\">1024</span> * <span class=\"number\">40</span>);</span><br><span class=\"line\">            <span class=\"type\">FileChannel</span> <span class=\"variable\">writeChannel</span> <span class=\"operator\">=</span> FileChannel.open(Paths.get(<span class=\"string\">&quot;./siting.txt&quot;</span>), StandardOpenOption.WRITE, StandardOpenOption.CREATE);</span><br><span class=\"line\">            <span class=\"comment\">//数据传输</span></span><br><span class=\"line\">            writeChannel.write(data);</span><br><span class=\"line\">            readChannel.close();</span><br><span class=\"line\">            writeChannel.close();</span><br><span class=\"line\">        &#125;<span class=\"keyword\">catch</span> (Exception e)&#123;</span><br><span class=\"line\">            System.out.println(e.getMessage());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<ol>\n<li><p>sendfile</p>\n<p>FileChannel 的 transferTo、transferFrom 如果操作系统底层支持的话，transferTo、transferFrom也会使用 sendfile 零拷贝技术来实现数据的传输</p>\n</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">long</span> <span class=\"title function_\">transferFrom</span><span class=\"params\">(FileChannel fileChannel, <span class=\"type\">long</span> position, <span class=\"type\">long</span> count)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">   <span class=\"keyword\">return</span> fileChannel.transferTo(position, count, socketChannel);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SendFileTest</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">FileChannel</span> <span class=\"variable\">readChannel</span> <span class=\"operator\">=</span> FileChannel.open(Paths.get(<span class=\"string\">&quot;./jay.txt&quot;</span>), StandardOpenOption.READ);</span><br><span class=\"line\">            <span class=\"type\">long</span> <span class=\"variable\">len</span> <span class=\"operator\">=</span> readChannel.size();</span><br><span class=\"line\">            <span class=\"type\">long</span> <span class=\"variable\">position</span> <span class=\"operator\">=</span> readChannel.position();</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"type\">FileChannel</span> <span class=\"variable\">writeChannel</span> <span class=\"operator\">=</span> FileChannel.open(Paths.get(<span class=\"string\">&quot;./siting.txt&quot;</span>), StandardOpenOption.WRITE, StandardOpenOption.CREATE);</span><br><span class=\"line\">            <span class=\"comment\">//数据传输</span></span><br><span class=\"line\">            readChannel.transferTo(position, len, writeChannel);</span><br><span class=\"line\">            readChannel.close();</span><br><span class=\"line\">            writeChannel.close();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            System.out.println(e.getMessage());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>Netty框架</strong></p>\n<p>Netty 的零拷贝主要体现在下面五个方面：</p>\n<p>（1）在网络通信上，Netty 的接收和发送 ByteBuffer 采用直接内存，使用堆外直接内存进行 Socket 读写，不需要进行字节缓冲区的二次拷贝。如果使用传统的堆内存进行 Socket 读写，JVM 会将堆内存 Buffer 拷贝一份到直接内存中（为什么拷贝？因为 JVM 会发生 GC 垃圾回收，数据的内存地址会发生变化，直接将堆内的内存地址传给内核，内存地址一旦变了就内核读不到数据了），然后才写入 Socket 中。相比于堆外直接内存，消息在发送过程中多了一次缓冲区的内存拷贝。</p>\n<p>（2）在文件传输上，Netty 的通过 FileRegion 包装的 FileChannel.tranferTo 实现文件传输，它可以直接将文件缓冲区的数据发送到目标 Channel，避免了传统通过循环 write 方式导致的内存拷贝问题。</p>\n<p>（3）在缓存操作上，Netty 提供了CompositeByteBuf 类，它可以将多个 ByteBuf 合并为一个逻辑上的 ByteBuf，避免了各个 ByteBuf 之间的拷贝。</p>\n<p>（4）通过 wrap 操作，我们可以将byte[]数组、ByteBuf、ByteBuffer等包装成一个Netty ByteBuf对象，进而避免了拷贝操作。</p>\n<p>（5）ByteBuf 支持 slice 操作，因此可以将 ByteBuf 分解为多个共享同一个存储区域的 ByteBuf，避免了内存的拷贝。</p>\n<p><a href=\"https://blog.csdn.net/a745233700/article/details/122660332\">\n</a></p>\n<p><strong>kafka</strong></p>\n<p>Kafka 的索引文件使用的是 mmap + write 方式，数据文件使用的是 sendfile 方式</p>\n<p><a href=\"https://blog.csdn.net/qq_44027353/article/details/121306224\">零拷贝1</a></p>\n<p><a href=\"https://blog.csdn.net/a745233700/article/details/122660332\">零拷贝2</a></p>\n<p><a href=\"https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&mid=2247520212&idx=1&sn=2d7a19f884fb59e3e961c640c73b8364&chksm=cea1c01ff9d649097dccaef7ba99956250f3bb9998949009b93de0043c023b05259824b9c944&mpshare=1&scene=1&srcid=0420LAxjPloJMzCu9HKGYXMz&sharer_sharetime=1650438077020&sharer_shareid=2e92f088aa52899c6eaf279275db8190&key=066c8b4d62994f4a663099da0975284f295b4b282a9acdd1c75d995ec0c06d7cfe9cd98ed4d05a4512fafd0e0616150a28829e59088dd678d804e2b1f65fdcdce4ae06b6412a0bc40e1e0bf7bb9aec85497c8983188845aea63451b37a63b5cd662409f52fc036c54ded636968ed92c73c7b394b909e3790145b4b4e3035ee94&ascene=1&uin=MTE4OTU2NTIxNQ==&devicetype=Windows-QQBrowser&version=6103000b&lang=zh_CN&exportkey=A3zMFqmRKu//6LRmGWqUouM=&acctmode=0&pass_ticket=Ie8HXClpM2EmWqTabSqVSGwtMO0c3i0ZbY/VPSygbfCYdwbNH6PIDhwzvZ6mGEQs&wx_header=0\">零拷贝3</a></p>\n"},{"title":"IO多路复用","date":"2022-01-04T19:00:00.000Z","_content":"\n\n\n#### 什么是Netty？\n\nnetty是一个高并发的通信框架。\n\n#### IO读写的基础原理\n\n有两种IO\n\n1. 进程缓冲区和内核缓冲区的交互\n2. 内核缓冲区和物理设备的交互\n\n#### 四种IO模型\n\n同步和异步的区别：\n\n同步是用户线程发起，异步是内核空间发起的\n\n阻塞和非阻塞的区别：\n\n阻塞是发起IO后需要等待IO结束\n\n- **同步阻塞IO**\n\n优点：开发简单。阻塞期间，用户线程挂起，不会占用CPU资源\n\n缺点：一个连接一个线程，不适合高并发\n\n- **同步非阻塞NIO**\n\n优点：用户等待线程过程中不会阻塞，实时性较好\n\n缺点：不断轮询内核，占用CPU时间\n\n指的并不是Java的NIO包，\n\n- **IO多路复用**\n\n解决同步非阻塞模型中轮询等待的问题\n\nlinux对文件的操作实际上是通过文件描述符，而IO复用模型就是，通过一个进程监听多个文件描述符，一旦某个文件描述符准备就绪，就去通知程序做处理。不仅单个链接处理的快，而且能处理更多链接\n\n- **异步IO**\n\n用户线程通过系统调用注册IO操作，直到完成都不阻塞。\n\n应用程序只需要进行事件的注册与接收，其余工作都要操作系统完成，需要支持\n\nwindowsIOCP真正支持，Linux还是IO多路复用，\n\nnetty也还是IO多路复用\n\n#### 总结\n\n到此为止都是高并发IO的底层原理。但即使最先进的模型也需要合理的配置\n\n#### JavaNIO通信基础\n\n#### Reactor反应器模式\n\n#### 并发基础中的Future回调模式","source":"_posts/netty/IO多路复用.md","raw":"---\ntitle: IO多路复用\ndate: 2022-01-05 03:00:00\ntags: IO模型\ncategories: netty\n---\n\n\n\n#### 什么是Netty？\n\nnetty是一个高并发的通信框架。\n\n#### IO读写的基础原理\n\n有两种IO\n\n1. 进程缓冲区和内核缓冲区的交互\n2. 内核缓冲区和物理设备的交互\n\n#### 四种IO模型\n\n同步和异步的区别：\n\n同步是用户线程发起，异步是内核空间发起的\n\n阻塞和非阻塞的区别：\n\n阻塞是发起IO后需要等待IO结束\n\n- **同步阻塞IO**\n\n优点：开发简单。阻塞期间，用户线程挂起，不会占用CPU资源\n\n缺点：一个连接一个线程，不适合高并发\n\n- **同步非阻塞NIO**\n\n优点：用户等待线程过程中不会阻塞，实时性较好\n\n缺点：不断轮询内核，占用CPU时间\n\n指的并不是Java的NIO包，\n\n- **IO多路复用**\n\n解决同步非阻塞模型中轮询等待的问题\n\nlinux对文件的操作实际上是通过文件描述符，而IO复用模型就是，通过一个进程监听多个文件描述符，一旦某个文件描述符准备就绪，就去通知程序做处理。不仅单个链接处理的快，而且能处理更多链接\n\n- **异步IO**\n\n用户线程通过系统调用注册IO操作，直到完成都不阻塞。\n\n应用程序只需要进行事件的注册与接收，其余工作都要操作系统完成，需要支持\n\nwindowsIOCP真正支持，Linux还是IO多路复用，\n\nnetty也还是IO多路复用\n\n#### 总结\n\n到此为止都是高并发IO的底层原理。但即使最先进的模型也需要合理的配置\n\n#### JavaNIO通信基础\n\n#### Reactor反应器模式\n\n#### 并发基础中的Future回调模式","slug":"netty/IO多路复用","published":1,"updated":"2022-07-25T06:47:19.646Z","_id":"cl60e5058000im8vcdwog7ap1","comments":1,"layout":"post","photos":[],"link":"","content":"<h4 id=\"什么是Netty？\"><a href=\"#什么是Netty？\" class=\"headerlink\" title=\"什么是Netty？\"></a>什么是Netty？</h4><p>netty是一个高并发的通信框架。</p>\n<h4 id=\"IO读写的基础原理\"><a href=\"#IO读写的基础原理\" class=\"headerlink\" title=\"IO读写的基础原理\"></a>IO读写的基础原理</h4><p>有两种IO</p>\n<ol>\n<li>进程缓冲区和内核缓冲区的交互</li>\n<li>内核缓冲区和物理设备的交互</li>\n</ol>\n<h4 id=\"四种IO模型\"><a href=\"#四种IO模型\" class=\"headerlink\" title=\"四种IO模型\"></a>四种IO模型</h4><p>同步和异步的区别：</p>\n<p>同步是用户线程发起，异步是内核空间发起的</p>\n<p>阻塞和非阻塞的区别：</p>\n<p>阻塞是发起IO后需要等待IO结束</p>\n<ul>\n<li><strong>同步阻塞IO</strong></li>\n</ul>\n<p>优点：开发简单。阻塞期间，用户线程挂起，不会占用CPU资源</p>\n<p>缺点：一个连接一个线程，不适合高并发</p>\n<ul>\n<li><strong>同步非阻塞NIO</strong></li>\n</ul>\n<p>优点：用户等待线程过程中不会阻塞，实时性较好</p>\n<p>缺点：不断轮询内核，占用CPU时间</p>\n<p>指的并不是Java的NIO包，</p>\n<ul>\n<li><strong>IO多路复用</strong></li>\n</ul>\n<p>解决同步非阻塞模型中轮询等待的问题</p>\n<p>linux对文件的操作实际上是通过文件描述符，而IO复用模型就是，通过一个进程监听多个文件描述符，一旦某个文件描述符准备就绪，就去通知程序做处理。不仅单个链接处理的快，而且能处理更多链接</p>\n<ul>\n<li><strong>异步IO</strong></li>\n</ul>\n<p>用户线程通过系统调用注册IO操作，直到完成都不阻塞。</p>\n<p>应用程序只需要进行事件的注册与接收，其余工作都要操作系统完成，需要支持</p>\n<p>windowsIOCP真正支持，Linux还是IO多路复用，</p>\n<p>netty也还是IO多路复用</p>\n<h4 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h4><p>到此为止都是高并发IO的底层原理。但即使最先进的模型也需要合理的配置</p>\n<h4 id=\"JavaNIO通信基础\"><a href=\"#JavaNIO通信基础\" class=\"headerlink\" title=\"JavaNIO通信基础\"></a>JavaNIO通信基础</h4><h4 id=\"Reactor反应器模式\"><a href=\"#Reactor反应器模式\" class=\"headerlink\" title=\"Reactor反应器模式\"></a>Reactor反应器模式</h4><h4 id=\"并发基础中的Future回调模式\"><a href=\"#并发基础中的Future回调模式\" class=\"headerlink\" title=\"并发基础中的Future回调模式\"></a>并发基础中的Future回调模式</h4>\n","site":{"data":{}},"excerpt":"","more":"<h4 id=\"什么是Netty？\"><a href=\"#什么是Netty？\" class=\"headerlink\" title=\"什么是Netty？\"></a>什么是Netty？</h4><p>netty是一个高并发的通信框架。</p>\n<h4 id=\"IO读写的基础原理\"><a href=\"#IO读写的基础原理\" class=\"headerlink\" title=\"IO读写的基础原理\"></a>IO读写的基础原理</h4><p>有两种IO</p>\n<ol>\n<li>进程缓冲区和内核缓冲区的交互</li>\n<li>内核缓冲区和物理设备的交互</li>\n</ol>\n<h4 id=\"四种IO模型\"><a href=\"#四种IO模型\" class=\"headerlink\" title=\"四种IO模型\"></a>四种IO模型</h4><p>同步和异步的区别：</p>\n<p>同步是用户线程发起，异步是内核空间发起的</p>\n<p>阻塞和非阻塞的区别：</p>\n<p>阻塞是发起IO后需要等待IO结束</p>\n<ul>\n<li><strong>同步阻塞IO</strong></li>\n</ul>\n<p>优点：开发简单。阻塞期间，用户线程挂起，不会占用CPU资源</p>\n<p>缺点：一个连接一个线程，不适合高并发</p>\n<ul>\n<li><strong>同步非阻塞NIO</strong></li>\n</ul>\n<p>优点：用户等待线程过程中不会阻塞，实时性较好</p>\n<p>缺点：不断轮询内核，占用CPU时间</p>\n<p>指的并不是Java的NIO包，</p>\n<ul>\n<li><strong>IO多路复用</strong></li>\n</ul>\n<p>解决同步非阻塞模型中轮询等待的问题</p>\n<p>linux对文件的操作实际上是通过文件描述符，而IO复用模型就是，通过一个进程监听多个文件描述符，一旦某个文件描述符准备就绪，就去通知程序做处理。不仅单个链接处理的快，而且能处理更多链接</p>\n<ul>\n<li><strong>异步IO</strong></li>\n</ul>\n<p>用户线程通过系统调用注册IO操作，直到完成都不阻塞。</p>\n<p>应用程序只需要进行事件的注册与接收，其余工作都要操作系统完成，需要支持</p>\n<p>windowsIOCP真正支持，Linux还是IO多路复用，</p>\n<p>netty也还是IO多路复用</p>\n<h4 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h4><p>到此为止都是高并发IO的底层原理。但即使最先进的模型也需要合理的配置</p>\n<h4 id=\"JavaNIO通信基础\"><a href=\"#JavaNIO通信基础\" class=\"headerlink\" title=\"JavaNIO通信基础\"></a>JavaNIO通信基础</h4><h4 id=\"Reactor反应器模式\"><a href=\"#Reactor反应器模式\" class=\"headerlink\" title=\"Reactor反应器模式\"></a>Reactor反应器模式</h4><h4 id=\"并发基础中的Future回调模式\"><a href=\"#并发基础中的Future回调模式\" class=\"headerlink\" title=\"并发基础中的Future回调模式\"></a>并发基础中的Future回调模式</h4>"},{"title":"Reacotor模式","date":"2022-01-07T19:00:00.000Z","_content":"\n## 什么是Reactor模式？\n\nReactor模式有两大角色组成：\n\n1. Reactor反应器线程，负责响应IO事件，并且分发到Handles处理器中\n2. Handles处理器，非阻塞的执行业务处理逻辑\n\n\n\n## 为什么需要Reactor模式？\n\n### 多线程OIO的缺陷\n\n在最初的Java OIO程序中，使用的方式是while循环，不断地监听是否有新的连接。相当于，如果前面的handle没有处理完，就不能处理后面的连接。吞吐很低。\n\n为了解决这种情况，后来出现了一个叫做connection per thread模式。就是为每一个连接分配一个线程，包括监听也是独立的线程。\n\n如果在这种多线程OIO的情况下，每一个线程处理多个连接可以吗？当然是不可以的，因为这里的每个socket连接的读写操作都是阻塞的，无论如何都只能处理一个IO操作。缺点是，需要消耗大量的线程资源。\n\n为了做到一个线程处理多个连接，引出反应器模式的简单版本\n\n### 单线程Reactor反应器\n\n即reactor反应器和handler处理器在同一个线程\n\n缺点：由于在同一个线程，当某个handle阻塞时其他handle得不到执行。\n\n\n\n为了真正解决问题，引入\n\n### 多线程Reactor反应器\n\n**升级：**\n\n1. 升级handler处理器，线程池\n2. 多个reactor处理器\n\n将IOHandler和监听事件的反应器线程隔离，不会相互阻塞。\n\n\n\n**反应器模式和生产者消费者模式的对比**\n\n反应器是基于查询的，没有专门的队列去缓冲存储IO事件，查询到事件后，反应器会根据不同IO选择器分发。\n\n\n\n**反应器模式和观察者模式的对比**\n\n观察者模式，发布一个主题后，会通知所有观察着处理。\n\n反应器模式一般一个事件绑定一个handler","source":"_posts/netty/Reactor模式.md","raw":"---\ntitle: Reacotor模式\ndate: 2022-01-08 03:00:00\ntags: Reactor模式\ncategories: netty\n---\n\n## 什么是Reactor模式？\n\nReactor模式有两大角色组成：\n\n1. Reactor反应器线程，负责响应IO事件，并且分发到Handles处理器中\n2. Handles处理器，非阻塞的执行业务处理逻辑\n\n\n\n## 为什么需要Reactor模式？\n\n### 多线程OIO的缺陷\n\n在最初的Java OIO程序中，使用的方式是while循环，不断地监听是否有新的连接。相当于，如果前面的handle没有处理完，就不能处理后面的连接。吞吐很低。\n\n为了解决这种情况，后来出现了一个叫做connection per thread模式。就是为每一个连接分配一个线程，包括监听也是独立的线程。\n\n如果在这种多线程OIO的情况下，每一个线程处理多个连接可以吗？当然是不可以的，因为这里的每个socket连接的读写操作都是阻塞的，无论如何都只能处理一个IO操作。缺点是，需要消耗大量的线程资源。\n\n为了做到一个线程处理多个连接，引出反应器模式的简单版本\n\n### 单线程Reactor反应器\n\n即reactor反应器和handler处理器在同一个线程\n\n缺点：由于在同一个线程，当某个handle阻塞时其他handle得不到执行。\n\n\n\n为了真正解决问题，引入\n\n### 多线程Reactor反应器\n\n**升级：**\n\n1. 升级handler处理器，线程池\n2. 多个reactor处理器\n\n将IOHandler和监听事件的反应器线程隔离，不会相互阻塞。\n\n\n\n**反应器模式和生产者消费者模式的对比**\n\n反应器是基于查询的，没有专门的队列去缓冲存储IO事件，查询到事件后，反应器会根据不同IO选择器分发。\n\n\n\n**反应器模式和观察者模式的对比**\n\n观察者模式，发布一个主题后，会通知所有观察着处理。\n\n反应器模式一般一个事件绑定一个handler","slug":"netty/Reactor模式","published":1,"updated":"2022-07-25T06:55:09.341Z","_id":"cl60e5058000km8vc43236qi9","comments":1,"layout":"post","photos":[],"link":"","content":"<div class=\"story post-story\"><h2 id=\"什么是Reactor模式？\"><a href=\"#什么是Reactor模式？\" class=\"headerlink\" title=\"什么是Reactor模式？\"></a>什么是Reactor模式？</h2><p>Reactor模式有两大角色组成：</p>\n<ol>\n<li>Reactor反应器线程，负责响应IO事件，并且分发到Handles处理器中</li>\n<li>Handles处理器，非阻塞的执行业务处理逻辑</li>\n</ol>\n</div><div class=\"story post-story\"><h2 id=\"为什么需要Reactor模式？\"><a href=\"#为什么需要Reactor模式？\" class=\"headerlink\" title=\"为什么需要Reactor模式？\"></a>为什么需要Reactor模式？</h2><h3 id=\"多线程OIO的缺陷\"><a href=\"#多线程OIO的缺陷\" class=\"headerlink\" title=\"多线程OIO的缺陷\"></a>多线程OIO的缺陷</h3><p>在最初的Java OIO程序中，使用的方式是while循环，不断地监听是否有新的连接。相当于，如果前面的handle没有处理完，就不能处理后面的连接。吞吐很低。</p>\n<p>为了解决这种情况，后来出现了一个叫做connection per thread模式。就是为每一个连接分配一个线程，包括监听也是独立的线程。</p>\n<p>如果在这种多线程OIO的情况下，每一个线程处理多个连接可以吗？当然是不可以的，因为这里的每个socket连接的读写操作都是阻塞的，无论如何都只能处理一个IO操作。缺点是，需要消耗大量的线程资源。</p>\n<p>为了做到一个线程处理多个连接，引出反应器模式的简单版本</p>\n<h3 id=\"单线程Reactor反应器\"><a href=\"#单线程Reactor反应器\" class=\"headerlink\" title=\"单线程Reactor反应器\"></a>单线程Reactor反应器</h3><p>即reactor反应器和handler处理器在同一个线程</p>\n<p>缺点：由于在同一个线程，当某个handle阻塞时其他handle得不到执行。</p>\n<p>为了真正解决问题，引入</p>\n<h3 id=\"多线程Reactor反应器\"><a href=\"#多线程Reactor反应器\" class=\"headerlink\" title=\"多线程Reactor反应器\"></a>多线程Reactor反应器</h3><p><strong>升级：</strong></p>\n<ol>\n<li>升级handler处理器，线程池</li>\n<li>多个reactor处理器</li>\n</ol>\n<p>将IOHandler和监听事件的反应器线程隔离，不会相互阻塞。</p>\n<p><strong>反应器模式和生产者消费者模式的对比</strong></p>\n<p>反应器是基于查询的，没有专门的队列去缓冲存储IO事件，查询到事件后，反应器会根据不同IO选择器分发。</p>\n<p><strong>反应器模式和观察者模式的对比</strong></p>\n<p>观察者模式，发布一个主题后，会通知所有观察着处理。</p>\n<p>反应器模式一般一个事件绑定一个handler</p>\n\n</div>","site":{"data":{}},"excerpt":"","more":"<h2 id=\"什么是Reactor模式？\"><a href=\"#什么是Reactor模式？\" class=\"headerlink\" title=\"什么是Reactor模式？\"></a>什么是Reactor模式？</h2><p>Reactor模式有两大角色组成：</p>\n<ol>\n<li>Reactor反应器线程，负责响应IO事件，并且分发到Handles处理器中</li>\n<li>Handles处理器，非阻塞的执行业务处理逻辑</li>\n</ol>\n<h2 id=\"为什么需要Reactor模式？\"><a href=\"#为什么需要Reactor模式？\" class=\"headerlink\" title=\"为什么需要Reactor模式？\"></a>为什么需要Reactor模式？</h2><h3 id=\"多线程OIO的缺陷\"><a href=\"#多线程OIO的缺陷\" class=\"headerlink\" title=\"多线程OIO的缺陷\"></a>多线程OIO的缺陷</h3><p>在最初的Java OIO程序中，使用的方式是while循环，不断地监听是否有新的连接。相当于，如果前面的handle没有处理完，就不能处理后面的连接。吞吐很低。</p>\n<p>为了解决这种情况，后来出现了一个叫做connection per thread模式。就是为每一个连接分配一个线程，包括监听也是独立的线程。</p>\n<p>如果在这种多线程OIO的情况下，每一个线程处理多个连接可以吗？当然是不可以的，因为这里的每个socket连接的读写操作都是阻塞的，无论如何都只能处理一个IO操作。缺点是，需要消耗大量的线程资源。</p>\n<p>为了做到一个线程处理多个连接，引出反应器模式的简单版本</p>\n<h3 id=\"单线程Reactor反应器\"><a href=\"#单线程Reactor反应器\" class=\"headerlink\" title=\"单线程Reactor反应器\"></a>单线程Reactor反应器</h3><p>即reactor反应器和handler处理器在同一个线程</p>\n<p>缺点：由于在同一个线程，当某个handle阻塞时其他handle得不到执行。</p>\n<p>为了真正解决问题，引入</p>\n<h3 id=\"多线程Reactor反应器\"><a href=\"#多线程Reactor反应器\" class=\"headerlink\" title=\"多线程Reactor反应器\"></a>多线程Reactor反应器</h3><p><strong>升级：</strong></p>\n<ol>\n<li>升级handler处理器，线程池</li>\n<li>多个reactor处理器</li>\n</ol>\n<p>将IOHandler和监听事件的反应器线程隔离，不会相互阻塞。</p>\n<p><strong>反应器模式和生产者消费者模式的对比</strong></p>\n<p>反应器是基于查询的，没有专门的队列去缓冲存储IO事件，查询到事件后，反应器会根据不同IO选择器分发。</p>\n<p><strong>反应器模式和观察者模式的对比</strong></p>\n<p>观察者模式，发布一个主题后，会通知所有观察着处理。</p>\n<p>反应器模式一般一个事件绑定一个handler</p>\n"},{"title":"并发基础中的Future异步回调模式","date":"2022-01-08T19:00:00.000Z","_content":"\n在netty中使用了很多回调技术，并且基于java的回调设计了一整套异步回调接口和实现。\n\n这篇文章从Java Future入手，再到第三方异步回调技术--谷歌的Guava Future，最后介绍Netty的异步回调技术。\n\n\n\n在文章中的所有demo都采用“泡茶”的案例\n\n主线程：负责启动和等待其他线程\n\n清洗线程\n\n烧水线程\n\n## Join异步阻塞\n\njoin的原理与作用是，阻塞当前线程，直到准备合并的目标线程的执行完成。\n\n```java\npackage org.example;\n\npublic class JoinDemo {\n    public static final int SLEEP_GAP = 5000;\n    public static String getCurThreadName() {\n        return Thread.currentThread().getName();\n    }\n    static class HotwaterThread extends Thread {\n        public HotwaterThread() {\n            super(\"** 烧水-Thread\");\n        }\n        public void run() {\n            try {\n                System.out.println(\"洗好茶壶\");\n                System.out.println(\"灌水\");\n                System.out.println(\"放在火上\");\n                Thread.sleep(SLEEP_GAP);\n                System.out.println(\"水烧开了\");\n            } catch (InterruptedException e) {\n                System.out.println(\"发送异常被中断\");\n            }\n            System.out.println(\"运行结束\");\n        }\n    }\n    static class WashThread extends Thread {\n        public WashThread() {\n            super(\"$$ 清洗-Thread\");\n        }\n        public void run() {\n            try {\n                System.out.println(\"洗茶壶\");\n                System.out.println(\"洗茶杯\");\n                System.out.println(\"拿茶叶\");\n                Thread.sleep(SLEEP_GAP);\n                System.out.println(\"洗完了\");\n            } catch (InterruptedException e) {\n                System.out.println(\"发送异常被中断\");\n            }\n            System.out.println(\"运行结束\");\n        }\n    }\n    public static void main(String[] args) {\n        Thread h = new HotwaterThread();\n        Thread w = new WashThread();\n        h.start();\n        w.start();\n        try {\n            h.join();\n            w.join();\n            Thread.currentThread().setName(\"主线程\");\n            System.out.println(\"泡茶喝\");\n        } catch (InterruptedException e) {\n            throw new RuntimeException(e);\n        }\n        System.out.println(\"end\");\n    }\n}\n```\n\n### join有三个重载版本：\n\n- void join () : A线程等待B线程执行结束后，A线程重新恢复执行\n- void join(long millis) ：A线程等待B线程最长millis毫秒，超过后A重新恢复执行\n- void join(long millis, int nanos)A线程等待B线程最长mills毫秒 + nanos纳秒\n\n### 容易混淆的地方：\n\n1. join是实例方法，不是静态方法，所以需要用线程对象去调用join，例如thread.join\n2. join调用时，不是线程所指向的目标线程阻塞，而是当前线程阻塞。\n3. 只有等到目标线程完成或超时，当前线程才能恢复执行\n\n### join的问题:\n\n被合并的线程没有返回值，即调用join后，没有返回值。\n\n例如，在上述代码中，main进程无法得知其他线程的运行结果。\n\n\n\n所以想要获得异步线程的执行结果，下面就介绍Java的FutureTask系列\n\n\n\n## FutureTask异步回调\n\n\n\nFutureTask方式在java.util.concurrent包中。最重要的就是**FutureTask 类**和 **Callable接口**\n\n\n\n### Callable接口\n\n新事物的出现，一定是为了解决旧事物的一些缺陷。\n\n提到Callable接口，就离不开Runnable接口，Runnable有一个重要的问题，即它的run方法没有返回值的。所以Runnable不能用于需要有返回值的场景。\n\nRunnable接口是在Java多线程中表示线程的业务代码的抽象接口\n\n为了解决Runnable的问题，所以才有了Callable\n\n```java\npackage java.util.concurrent;\n@FunctionalInterface\npublic interface Callable<V> {\n    V call() throws Exception;\n}\npackage java.lang;\n@FunctionalInterface\npublic interface Runnable {\n    public abstract void run();\n}\n```\n\nCallable是一个泛型接口，唯一方法call的返回值类型为泛型形参的实际类型，并且还有一个Exception，容许方法内部的异常不经过捕获。\n\n阿Callable方法可以与Runnable相对应，可以看成更强大的Runnable。\n\n**但他们也有不同的地方：**\n\n- Callable接口的实例不能作为Thread线程实例的target来使用。Runnable接口实例可以作为Thread线程实例的target构造参数，开启一个Thread线程。\n\ntarget是什么？\n\n查看Thread源码可以得知，target是**Runable**类的，在Thread初始化时有使用。target作为参数传入Thread构造函数，构造函数调用init函数初始时也将target传入。并且在thread run中调用的也是Runnable的run方法。\n\n```java\npublic class Thread implements Runnable {\n    \n    /* What will be run. */\n    private Runnable target;\n    @Override\n    protected Object clone() throws CloneNotSupportedException {\n        throw new CloneNotSupportedException();\n    }\n\t//Thread的构造器有很多种，只列了一种\n    public Thread(Runnable target) {\n        init(null, target, \"Thread-\" + nextThreadNum(), 0);\n    }   \n    @Override\n    public void run() {\n        if (target != null) {\n            target.run();\n        }\n    }\n\n \n   \n}\n```\n\n但是呢，java的线程类型只有Thread，callable要是想利用Thread的话，就要想办法将自己赋值给Runnable类型的target，所以需要一个FutureTask类来进行所谓的搭桥。\n\n\n\n### FutureTask类\n\n```java\npublic class FutureTask<V> implements RunnableFuture<V>\npublic interface RunnableFuture<V> extends Runnable, Future<V> \npublic FutureTask(Callable<V> callable) {\n        if (callable == null)\n            throw new NullPointerException();\n        this.callable = callable;\n        this.state = NEW;       // ensure visibility of callable\n    }\n```\n\n直接查看源码可以发现，FutureTask实现了RunnableFuture，而RunnableFuture则继承了Runnable和Future\n\n所以可以作为target传递给Thread。但是想要获取到Callable的异步执行结果就不应该使用它的call方法，而是通过FutureTask类的相应方法去获取。FutureTask实现了Future接口，Future接口则是提供了判断、获取、取消并发任务结果的功能。\n\n```java\npackage java.util.concurrent;\npublic interface Future<V> {\n    boolean cancel(boolean mayInterruptIfRunning);\n    boolean isCancelled();\n    boolean isDone();\n    V get() throws InterruptedException, ExecutionException;\n    V get(long timeout, TimeUnit unit)\n        throws InterruptedException, ExecutionException, TimeoutException;\n}\n```\n\n- Future接口提供的get方法是阻塞的，如果并发任务没有完成就会等待并发任务完成。可以增加时间约束。\n\n总结一下，FutureTask通过间接继承了Runnable，从而能够作为Thread的target, 然后Callable作为参数传入其中，此外Future提供了获取异步任务执行结果的方法，FutureTask实现了其方法。到这里Future成功搭起来看Callable和Thread的桥梁，并且实现获取异步任务结果的方式。\n\n\n\n回到FutureTask中，变量Callable代表异步执行的逻辑，我们需要保存结果，保存在哪呢？\n\n查看源码可以看到，FutureTask中有一个run方法是Runnable接口的，它能作为Target目标去执行，然后\n\n```java\n public void run() {\n        if (state != NEW ||\n            !UNSAFE.compareAndSwapObject(this, runnerOffset,\n                                         null, Thread.currentThread()))\n            return;\n        try {\n            Callable<V> c = callable;\n            if (c != null && state == NEW) {\n                V result;\n                boolean ran;\n                try {\n                    result = c.call();\n                    ran = true;\n                } catch (Throwable ex) {\n                    result = null;\n                    ran = false;\n                    setException(ex);\n                }\n                if (ran)\n                    set(result);\n            }\n        } finally {\n            // runner must be non-null until state is settled to\n            // prevent concurrent calls to run()\n            runner = null;\n            // state must be re-read after nulling runner to prevent\n            // leaked interrupts\n            int s = state;\n            if (s >= INTERRUPTING)\n                handlePossibleCancellationInterrupt(s);\n        }\n    }\n```\n\nrun方法中有个set方法\n\n```java\nprotected void set(V v) {\n        if (UNSAFE.compareAndSwapInt(this, stateOffset, NEW, COMPLETING)) {\n            outcome = v;\n            UNSAFE.putOrderedInt(this, stateOffset, NORMAL); // final state\n            finishCompletion();\n        }\n    }\n```\n\n最终保存在outcome属性中\n\nprivate Object outcome\n\n```java\npackage org.example;\n\nimport java.util.concurrent.Callable;\nimport java.util.concurrent.ExecutionException;\nimport java.util.concurrent.FutureTask;\n\npublic class JavaFutureDemo {\n    public static final int SLEEP_GAP = 5000;\n    public static String getCurThreadName() {\n        return Thread.currentThread().getName();\n    }\n    static class HotWaterJob implements Callable<Boolean> {\n        @Override\n        public Boolean call() throws Exception {\n            try {\n                System.out.println(\"洗好茶壶\");\n                System.out.println(\"灌水\");\n                System.out.println(\"放在火上\");\n                Thread.sleep(SLEEP_GAP);\n                System.out.println(\"水烧开了\");\n            } catch (InterruptedException e) {\n                System.out.println(\"发送异常被中断\");\n                return false;\n            }\n            System.out.println(\"运行结束\");\n            return true;\n        }\n    }\n    static class WashJon implements Callable<Boolean> {\n        @Override\n        public Boolean call() throws Exception {\n            try {\n                System.out.println(\"洗茶壶\");\n                System.out.println(\"洗茶杯\");\n                System.out.println(\"拿茶叶\");\n                Thread.sleep(SLEEP_GAP);\n                System.out.println(\"洗完了\");\n            } catch (InterruptedException e) {\n                System.out.println(\"发送异常被中断\");\n                return false;\n            }\n            System.out.println(\"运行结束\");\n            return true;\n        }\n    }\n    public static void drinkTea(boolean waterOK, boolean cupOk) {\n        if (waterOK && cupOk) {\n            System.out.println(\"泡茶喝\");\n        } else if (!waterOK) {\n            System.out.println(\"烧水失败，没有茶喝了\");\n        } else if (!cupOk) {\n            System.out.println(\"杯子洗不了，没有茶喝了\");\n        }\n    }\n    public static void main(String args[]) {\n        Callable<Boolean> hJob = new HotWaterJob();\n        FutureTask<Boolean> hTask = new FutureTask<Boolean>(hJob);\n        Thread hThread = new Thread(hTask, \"** 烧水-Thread\");\n\n        Callable<Boolean> wJob = new WashJon();\n        FutureTask<Boolean> wTask = new FutureTask<Boolean>(wJob);\n        Thread wThread = new Thread(wTask, \"$$ 清洗-Thread\" );\n\n        hThread.start();\n        wThread.start();\n\n        Thread.currentThread().setName(\"主线程\");\n        try {\n            boolean watereOk = hTask.get();\n            boolean cupOk = wTask.get();\n            drinkTea(watereOk, cupOk);\n        } catch (ExecutionException e) {\n            throw new RuntimeException(e);\n        } catch (InterruptedException e) {\n            throw new RuntimeException(e);\n        }\n        System.out.println(\"end\");\n    }\n}\n```\n\n\n\n虽然可以通过get获取异步执行的结果，但是并不高明，因为get实际上还是阻塞的，就是主线程调用get时，主线程也会阻塞，和join差不多。\n\n原生JavaAPI除了阻塞模式的获取结果外，没有实现非阻塞的，需要引入别的框架比如谷歌的Guava。\n\n\n\n## 谷歌Guava的异步回调\n\nGuava是谷歌公司提供的Java扩展包，是一种异步回调的解决方案。\n\n- 新增了一个ListenableFuture接口，继承了Java的Future接口，使得Java的Future异步任务，在Guava中能够被监控和获得非阻塞异步执行的结果\n- 引入一个新的接口FutureCallback，根据异步执行结果完成不同的回调处理，能够处理异步结果啦。\n\n### FutureCallback\n\n负责异步任务完成后的监听逻辑，相当于处理异步结果\n\n**有两个方法：**\n\n- onSuccess 异步任务成功后被回调，异步任务的结果作为onSuccess的参数\n- onFailure 异步任务异常被回调，异步任务的结果作为onFailure的参数\n\n```java\n@GwtCompatible\npublic interface FutureCallback<V> {\n  void onSuccess(@Nullable V result);\n  void onFailure(Throwable t);\n}\n```\n\n**看起来与Callable相似，但完全不一样：**\n\nCallable代表异步执行逻辑\n\nFutureCallback代表的是异步任务完成后对结果的处理工作\n\n\n\nGuava FutureCallback只是对Java Future异步执行的增强，所以使用Guava需要Java Callable，简单来说只有Java的Callable任务执行的结果出来以后才能执行FutureCallback\n\n如何实现这种监控关系呢？\n\n引入ListenableFuture，获取异步执行结果\n\n### ListenableFuture\n\n这里直接上源码\n\n```java\n@GwtCompatible\npublic interface ListenableFuture<V> extends Future<V> {\n  void addListener(Runnable listener, Executor executor);\n}\n```\n\nListenableFuture在Future的基础上增加了addListener方法，目的是将FutureCallback的任务封装成一个内部的Runnable异步回调任务。在Callable异步完成后，回调。但是这个方法只在内部使用，一般不调用。\n\n\n\n那如何将FutureCallback绑定到ListenableFuture任务呢？\n\n使用Guava的Futures工具类，addcallback可以绑定。\n\n```java\nListenableFuture<Boolean> hotFuture = gPool.submit(hotJob);\n        Futures.addCallback(hotFuture, new FutureCallback<Boolean>() {\n            public void onSuccess(Boolean r) {\n                if (r) {\n                    mainJob.waterOk = true;\n                }\n            }\n\n            public void onFailure(Throwable throwable) {\n                System.out.println(\"烧水失败\");\n            }\n        });\n```\n\n如果Guava的ListenableFuture 是 对Java Future 的扩展，都表示异步任务，那Guava的异步任务从何而来？\n\n\n\nListenableFuture的异步任务异步任务的实例主要是通过向线程池提交Callable任务的方式获取，这里的线程池是Guava的不是Java的，另外FutureTask的异步任务实例是直接将Callable传入构造器。\n\n\n\n```java\nExecutorService jPool = Executors.newFixedThreadPool(10);\nListeningExecutorService gPool = MoreExecutors.listeningDecorator(jPool);\n```\n\n流程：\n\n1. 创建Callable异步任务\n2. 创建Guava线程池\n3. 提交Callable获取ListenableFuture异步任务实例\n4. 创建FutureCallback，绑定ListenableFuture\n\n\n\n泡茶实例\n\n```java\npackage org.example;\n\nimport com.google.common.util.concurrent.*;\n\nimport javax.annotation.Nullable;\nimport java.util.concurrent.Callable;\nimport java.util.concurrent.Executor;\nimport java.util.concurrent.ExecutorService;\nimport java.util.concurrent.Executors;\n\npublic class GuavaFutureDemo {\n    public static final int SLEEP_GAP = 5000;\n    public static String getCurThreadName() {\n        return Thread.currentThread().getName();\n    }\n\n    static class HotWaterJob implements Callable<Boolean> {\n        @Override\n        public Boolean call() throws Exception {\n            try {\n                System.out.println(\"洗好茶壶\");\n                System.out.println(\"灌水\");\n                System.out.println(\"放在火上\");\n                Thread.sleep(SLEEP_GAP);\n                System.out.println(\"水烧开了\");\n            } catch (InterruptedException e) {\n                System.out.println(\"发送异常被中断\");\n                return false;\n            }\n            System.out.println(\"运行结束\");\n            return true;\n        }\n    }\n    static class WashJon implements Callable<Boolean> {\n        @Override\n        public Boolean call() throws Exception {\n            try {\n                System.out.println(\"洗茶壶\");\n                System.out.println(\"洗茶杯\");\n                System.out.println(\"拿茶叶\");\n                Thread.sleep(SLEEP_GAP);\n                System.out.println(\"洗完了\");\n            } catch (InterruptedException e) {\n                System.out.println(\"发送异常被中断\");\n                return false;\n            }\n            System.out.println(\"运行结束\");\n            return true;\n        }\n    }\n    static class MainJob implements Runnable {\n        boolean waterOk = false;\n        boolean cupOk = false;\n        int gap = SLEEP_GAP / 10;\n        @Override\n        public  void run() {\n            while (true) {\n                try {\n                    Thread.sleep(gap);\n                    System.out.println(\"读书中\");\n                } catch (InterruptedException e) {\n                    System.out.println(getCurThreadName() + \"中断\");\n                }\n                if (waterOk && cupOk) {\n                    drinkTea(waterOk, cupOk);\n                    break;\n                }\n            }\n        }\n        public  void drinkTea(boolean waterOK, boolean cupOk) {\n            if (waterOK && cupOk) {\n                System.out.println(\"泡茶喝\");\n            } else if (!waterOK) {\n                System.out.println(\"烧水失败，没有茶喝了\");\n            } else if (!cupOk) {\n                System.out.println(\"杯子洗不了，没有茶喝了\");\n            }\n        }\n    }\n    public static void main(String[] args) {\n        final MainJob  mainJob = new MainJob();\n        Thread mainThread = new Thread(mainJob);\n        mainThread.setName(\"主线程\");\n        mainThread.start();\n\n        Callable<Boolean> hotJob = new HotWaterJob();\n        Callable<Boolean> washJob = new WashJon();\n\n        ExecutorService jPool = Executors.newFixedThreadPool(10);\n        ListeningExecutorService gPool = MoreExecutors.listeningDecorator(jPool);\n\n        ListenableFuture<Boolean> hotFuture = gPool.submit(hotJob);\n        Futures.addCallback(hotFuture, new FutureCallback<Boolean>() {\n            public void onSuccess(Boolean r) {\n                if (r) {\n                    mainJob.waterOk = true;\n                }\n            }\n\n            public void onFailure(Throwable throwable) {\n                System.out.println(\"烧水失败\");\n            }\n        });\n        ListenableFuture<Boolean> washFuture = gPool.submit(washJob);\n        Futures.addCallback(hotFuture, new FutureCallback<Boolean>() {\n            public void onSuccess(Boolean r) {\n                if (r) {\n                    mainJob.cupOk = true;\n                }\n            }\n\n            public void onFailure(Throwable throwable) {\n                System.out.println(\"杯子洗不了\");\n            }\n        });\n    }\n}\n```\n\n\n\nGuava非阻塞的原因与理解\n\n\n\n## Netty的异步回调模式\n\n在netty源码中大量使用了异步回调模式，在netty业务开发层面，netty应用的是handle处理器中的业务处理代码也是异步的。所以了解netty的异步回调是十分重要的。\n\nNetty扩展了Java Future的异步任务：\n\n- 继承Java Future接口并增强，使其方法可以非阻塞。\n- 引入GeneriFutureListener，用于表示异步任务完成的监控器，与Guava的FutureCallback不同，Netty使用的是监控器模式，异步任务完成后回调逻辑抽象成了Lisener监听器接口。可以将GenericFutureListener监听器加入Netty的异步任务Future中，实现对异步任务执行状态的事件监听。\n\n在异步非阻塞回调思路上和Guava是一致的。\n\n### GenericFutureListener接口\n\n该接口位于io.netty.util.concurrent\n\n直接上源码\n\n\n\nGenericFutureListener拥有一个回调方法operationComplete,回调代码写在这。\n\n而父接口EventListner是空接口，没有任何方法，起标识作用。\n\n### Netty Future 接口\n\nnetty对Future进行了扩展，对执行的过程进行监控，对异步回调完成事件进行监听。\n\n```java\n \n```\n\nFuture接口一般不会直接使用，而是会使用子接口。Netty有一系列的子接口，代表不同类型的异步任务如ChannelFuture接口。\n\nChannelFuture表示通道IO操作的异步任务，如果在通道的异步IO操作完成后执行回调就需要ChannelFuture","source":"_posts/netty/并发基础中的Future异步回调模式.md","raw":"---\ntitle: 并发基础中的Future异步回调模式\ndate: 2022-01-09 03:00:00\ntags: \n - 异步回调\n - Future\ncategories: netty\n---\n\n在netty中使用了很多回调技术，并且基于java的回调设计了一整套异步回调接口和实现。\n\n这篇文章从Java Future入手，再到第三方异步回调技术--谷歌的Guava Future，最后介绍Netty的异步回调技术。\n\n\n\n在文章中的所有demo都采用“泡茶”的案例\n\n主线程：负责启动和等待其他线程\n\n清洗线程\n\n烧水线程\n\n## Join异步阻塞\n\njoin的原理与作用是，阻塞当前线程，直到准备合并的目标线程的执行完成。\n\n```java\npackage org.example;\n\npublic class JoinDemo {\n    public static final int SLEEP_GAP = 5000;\n    public static String getCurThreadName() {\n        return Thread.currentThread().getName();\n    }\n    static class HotwaterThread extends Thread {\n        public HotwaterThread() {\n            super(\"** 烧水-Thread\");\n        }\n        public void run() {\n            try {\n                System.out.println(\"洗好茶壶\");\n                System.out.println(\"灌水\");\n                System.out.println(\"放在火上\");\n                Thread.sleep(SLEEP_GAP);\n                System.out.println(\"水烧开了\");\n            } catch (InterruptedException e) {\n                System.out.println(\"发送异常被中断\");\n            }\n            System.out.println(\"运行结束\");\n        }\n    }\n    static class WashThread extends Thread {\n        public WashThread() {\n            super(\"$$ 清洗-Thread\");\n        }\n        public void run() {\n            try {\n                System.out.println(\"洗茶壶\");\n                System.out.println(\"洗茶杯\");\n                System.out.println(\"拿茶叶\");\n                Thread.sleep(SLEEP_GAP);\n                System.out.println(\"洗完了\");\n            } catch (InterruptedException e) {\n                System.out.println(\"发送异常被中断\");\n            }\n            System.out.println(\"运行结束\");\n        }\n    }\n    public static void main(String[] args) {\n        Thread h = new HotwaterThread();\n        Thread w = new WashThread();\n        h.start();\n        w.start();\n        try {\n            h.join();\n            w.join();\n            Thread.currentThread().setName(\"主线程\");\n            System.out.println(\"泡茶喝\");\n        } catch (InterruptedException e) {\n            throw new RuntimeException(e);\n        }\n        System.out.println(\"end\");\n    }\n}\n```\n\n### join有三个重载版本：\n\n- void join () : A线程等待B线程执行结束后，A线程重新恢复执行\n- void join(long millis) ：A线程等待B线程最长millis毫秒，超过后A重新恢复执行\n- void join(long millis, int nanos)A线程等待B线程最长mills毫秒 + nanos纳秒\n\n### 容易混淆的地方：\n\n1. join是实例方法，不是静态方法，所以需要用线程对象去调用join，例如thread.join\n2. join调用时，不是线程所指向的目标线程阻塞，而是当前线程阻塞。\n3. 只有等到目标线程完成或超时，当前线程才能恢复执行\n\n### join的问题:\n\n被合并的线程没有返回值，即调用join后，没有返回值。\n\n例如，在上述代码中，main进程无法得知其他线程的运行结果。\n\n\n\n所以想要获得异步线程的执行结果，下面就介绍Java的FutureTask系列\n\n\n\n## FutureTask异步回调\n\n\n\nFutureTask方式在java.util.concurrent包中。最重要的就是**FutureTask 类**和 **Callable接口**\n\n\n\n### Callable接口\n\n新事物的出现，一定是为了解决旧事物的一些缺陷。\n\n提到Callable接口，就离不开Runnable接口，Runnable有一个重要的问题，即它的run方法没有返回值的。所以Runnable不能用于需要有返回值的场景。\n\nRunnable接口是在Java多线程中表示线程的业务代码的抽象接口\n\n为了解决Runnable的问题，所以才有了Callable\n\n```java\npackage java.util.concurrent;\n@FunctionalInterface\npublic interface Callable<V> {\n    V call() throws Exception;\n}\npackage java.lang;\n@FunctionalInterface\npublic interface Runnable {\n    public abstract void run();\n}\n```\n\nCallable是一个泛型接口，唯一方法call的返回值类型为泛型形参的实际类型，并且还有一个Exception，容许方法内部的异常不经过捕获。\n\n阿Callable方法可以与Runnable相对应，可以看成更强大的Runnable。\n\n**但他们也有不同的地方：**\n\n- Callable接口的实例不能作为Thread线程实例的target来使用。Runnable接口实例可以作为Thread线程实例的target构造参数，开启一个Thread线程。\n\ntarget是什么？\n\n查看Thread源码可以得知，target是**Runable**类的，在Thread初始化时有使用。target作为参数传入Thread构造函数，构造函数调用init函数初始时也将target传入。并且在thread run中调用的也是Runnable的run方法。\n\n```java\npublic class Thread implements Runnable {\n    \n    /* What will be run. */\n    private Runnable target;\n    @Override\n    protected Object clone() throws CloneNotSupportedException {\n        throw new CloneNotSupportedException();\n    }\n\t//Thread的构造器有很多种，只列了一种\n    public Thread(Runnable target) {\n        init(null, target, \"Thread-\" + nextThreadNum(), 0);\n    }   \n    @Override\n    public void run() {\n        if (target != null) {\n            target.run();\n        }\n    }\n\n \n   \n}\n```\n\n但是呢，java的线程类型只有Thread，callable要是想利用Thread的话，就要想办法将自己赋值给Runnable类型的target，所以需要一个FutureTask类来进行所谓的搭桥。\n\n\n\n### FutureTask类\n\n```java\npublic class FutureTask<V> implements RunnableFuture<V>\npublic interface RunnableFuture<V> extends Runnable, Future<V> \npublic FutureTask(Callable<V> callable) {\n        if (callable == null)\n            throw new NullPointerException();\n        this.callable = callable;\n        this.state = NEW;       // ensure visibility of callable\n    }\n```\n\n直接查看源码可以发现，FutureTask实现了RunnableFuture，而RunnableFuture则继承了Runnable和Future\n\n所以可以作为target传递给Thread。但是想要获取到Callable的异步执行结果就不应该使用它的call方法，而是通过FutureTask类的相应方法去获取。FutureTask实现了Future接口，Future接口则是提供了判断、获取、取消并发任务结果的功能。\n\n```java\npackage java.util.concurrent;\npublic interface Future<V> {\n    boolean cancel(boolean mayInterruptIfRunning);\n    boolean isCancelled();\n    boolean isDone();\n    V get() throws InterruptedException, ExecutionException;\n    V get(long timeout, TimeUnit unit)\n        throws InterruptedException, ExecutionException, TimeoutException;\n}\n```\n\n- Future接口提供的get方法是阻塞的，如果并发任务没有完成就会等待并发任务完成。可以增加时间约束。\n\n总结一下，FutureTask通过间接继承了Runnable，从而能够作为Thread的target, 然后Callable作为参数传入其中，此外Future提供了获取异步任务执行结果的方法，FutureTask实现了其方法。到这里Future成功搭起来看Callable和Thread的桥梁，并且实现获取异步任务结果的方式。\n\n\n\n回到FutureTask中，变量Callable代表异步执行的逻辑，我们需要保存结果，保存在哪呢？\n\n查看源码可以看到，FutureTask中有一个run方法是Runnable接口的，它能作为Target目标去执行，然后\n\n```java\n public void run() {\n        if (state != NEW ||\n            !UNSAFE.compareAndSwapObject(this, runnerOffset,\n                                         null, Thread.currentThread()))\n            return;\n        try {\n            Callable<V> c = callable;\n            if (c != null && state == NEW) {\n                V result;\n                boolean ran;\n                try {\n                    result = c.call();\n                    ran = true;\n                } catch (Throwable ex) {\n                    result = null;\n                    ran = false;\n                    setException(ex);\n                }\n                if (ran)\n                    set(result);\n            }\n        } finally {\n            // runner must be non-null until state is settled to\n            // prevent concurrent calls to run()\n            runner = null;\n            // state must be re-read after nulling runner to prevent\n            // leaked interrupts\n            int s = state;\n            if (s >= INTERRUPTING)\n                handlePossibleCancellationInterrupt(s);\n        }\n    }\n```\n\nrun方法中有个set方法\n\n```java\nprotected void set(V v) {\n        if (UNSAFE.compareAndSwapInt(this, stateOffset, NEW, COMPLETING)) {\n            outcome = v;\n            UNSAFE.putOrderedInt(this, stateOffset, NORMAL); // final state\n            finishCompletion();\n        }\n    }\n```\n\n最终保存在outcome属性中\n\nprivate Object outcome\n\n```java\npackage org.example;\n\nimport java.util.concurrent.Callable;\nimport java.util.concurrent.ExecutionException;\nimport java.util.concurrent.FutureTask;\n\npublic class JavaFutureDemo {\n    public static final int SLEEP_GAP = 5000;\n    public static String getCurThreadName() {\n        return Thread.currentThread().getName();\n    }\n    static class HotWaterJob implements Callable<Boolean> {\n        @Override\n        public Boolean call() throws Exception {\n            try {\n                System.out.println(\"洗好茶壶\");\n                System.out.println(\"灌水\");\n                System.out.println(\"放在火上\");\n                Thread.sleep(SLEEP_GAP);\n                System.out.println(\"水烧开了\");\n            } catch (InterruptedException e) {\n                System.out.println(\"发送异常被中断\");\n                return false;\n            }\n            System.out.println(\"运行结束\");\n            return true;\n        }\n    }\n    static class WashJon implements Callable<Boolean> {\n        @Override\n        public Boolean call() throws Exception {\n            try {\n                System.out.println(\"洗茶壶\");\n                System.out.println(\"洗茶杯\");\n                System.out.println(\"拿茶叶\");\n                Thread.sleep(SLEEP_GAP);\n                System.out.println(\"洗完了\");\n            } catch (InterruptedException e) {\n                System.out.println(\"发送异常被中断\");\n                return false;\n            }\n            System.out.println(\"运行结束\");\n            return true;\n        }\n    }\n    public static void drinkTea(boolean waterOK, boolean cupOk) {\n        if (waterOK && cupOk) {\n            System.out.println(\"泡茶喝\");\n        } else if (!waterOK) {\n            System.out.println(\"烧水失败，没有茶喝了\");\n        } else if (!cupOk) {\n            System.out.println(\"杯子洗不了，没有茶喝了\");\n        }\n    }\n    public static void main(String args[]) {\n        Callable<Boolean> hJob = new HotWaterJob();\n        FutureTask<Boolean> hTask = new FutureTask<Boolean>(hJob);\n        Thread hThread = new Thread(hTask, \"** 烧水-Thread\");\n\n        Callable<Boolean> wJob = new WashJon();\n        FutureTask<Boolean> wTask = new FutureTask<Boolean>(wJob);\n        Thread wThread = new Thread(wTask, \"$$ 清洗-Thread\" );\n\n        hThread.start();\n        wThread.start();\n\n        Thread.currentThread().setName(\"主线程\");\n        try {\n            boolean watereOk = hTask.get();\n            boolean cupOk = wTask.get();\n            drinkTea(watereOk, cupOk);\n        } catch (ExecutionException e) {\n            throw new RuntimeException(e);\n        } catch (InterruptedException e) {\n            throw new RuntimeException(e);\n        }\n        System.out.println(\"end\");\n    }\n}\n```\n\n\n\n虽然可以通过get获取异步执行的结果，但是并不高明，因为get实际上还是阻塞的，就是主线程调用get时，主线程也会阻塞，和join差不多。\n\n原生JavaAPI除了阻塞模式的获取结果外，没有实现非阻塞的，需要引入别的框架比如谷歌的Guava。\n\n\n\n## 谷歌Guava的异步回调\n\nGuava是谷歌公司提供的Java扩展包，是一种异步回调的解决方案。\n\n- 新增了一个ListenableFuture接口，继承了Java的Future接口，使得Java的Future异步任务，在Guava中能够被监控和获得非阻塞异步执行的结果\n- 引入一个新的接口FutureCallback，根据异步执行结果完成不同的回调处理，能够处理异步结果啦。\n\n### FutureCallback\n\n负责异步任务完成后的监听逻辑，相当于处理异步结果\n\n**有两个方法：**\n\n- onSuccess 异步任务成功后被回调，异步任务的结果作为onSuccess的参数\n- onFailure 异步任务异常被回调，异步任务的结果作为onFailure的参数\n\n```java\n@GwtCompatible\npublic interface FutureCallback<V> {\n  void onSuccess(@Nullable V result);\n  void onFailure(Throwable t);\n}\n```\n\n**看起来与Callable相似，但完全不一样：**\n\nCallable代表异步执行逻辑\n\nFutureCallback代表的是异步任务完成后对结果的处理工作\n\n\n\nGuava FutureCallback只是对Java Future异步执行的增强，所以使用Guava需要Java Callable，简单来说只有Java的Callable任务执行的结果出来以后才能执行FutureCallback\n\n如何实现这种监控关系呢？\n\n引入ListenableFuture，获取异步执行结果\n\n### ListenableFuture\n\n这里直接上源码\n\n```java\n@GwtCompatible\npublic interface ListenableFuture<V> extends Future<V> {\n  void addListener(Runnable listener, Executor executor);\n}\n```\n\nListenableFuture在Future的基础上增加了addListener方法，目的是将FutureCallback的任务封装成一个内部的Runnable异步回调任务。在Callable异步完成后，回调。但是这个方法只在内部使用，一般不调用。\n\n\n\n那如何将FutureCallback绑定到ListenableFuture任务呢？\n\n使用Guava的Futures工具类，addcallback可以绑定。\n\n```java\nListenableFuture<Boolean> hotFuture = gPool.submit(hotJob);\n        Futures.addCallback(hotFuture, new FutureCallback<Boolean>() {\n            public void onSuccess(Boolean r) {\n                if (r) {\n                    mainJob.waterOk = true;\n                }\n            }\n\n            public void onFailure(Throwable throwable) {\n                System.out.println(\"烧水失败\");\n            }\n        });\n```\n\n如果Guava的ListenableFuture 是 对Java Future 的扩展，都表示异步任务，那Guava的异步任务从何而来？\n\n\n\nListenableFuture的异步任务异步任务的实例主要是通过向线程池提交Callable任务的方式获取，这里的线程池是Guava的不是Java的，另外FutureTask的异步任务实例是直接将Callable传入构造器。\n\n\n\n```java\nExecutorService jPool = Executors.newFixedThreadPool(10);\nListeningExecutorService gPool = MoreExecutors.listeningDecorator(jPool);\n```\n\n流程：\n\n1. 创建Callable异步任务\n2. 创建Guava线程池\n3. 提交Callable获取ListenableFuture异步任务实例\n4. 创建FutureCallback，绑定ListenableFuture\n\n\n\n泡茶实例\n\n```java\npackage org.example;\n\nimport com.google.common.util.concurrent.*;\n\nimport javax.annotation.Nullable;\nimport java.util.concurrent.Callable;\nimport java.util.concurrent.Executor;\nimport java.util.concurrent.ExecutorService;\nimport java.util.concurrent.Executors;\n\npublic class GuavaFutureDemo {\n    public static final int SLEEP_GAP = 5000;\n    public static String getCurThreadName() {\n        return Thread.currentThread().getName();\n    }\n\n    static class HotWaterJob implements Callable<Boolean> {\n        @Override\n        public Boolean call() throws Exception {\n            try {\n                System.out.println(\"洗好茶壶\");\n                System.out.println(\"灌水\");\n                System.out.println(\"放在火上\");\n                Thread.sleep(SLEEP_GAP);\n                System.out.println(\"水烧开了\");\n            } catch (InterruptedException e) {\n                System.out.println(\"发送异常被中断\");\n                return false;\n            }\n            System.out.println(\"运行结束\");\n            return true;\n        }\n    }\n    static class WashJon implements Callable<Boolean> {\n        @Override\n        public Boolean call() throws Exception {\n            try {\n                System.out.println(\"洗茶壶\");\n                System.out.println(\"洗茶杯\");\n                System.out.println(\"拿茶叶\");\n                Thread.sleep(SLEEP_GAP);\n                System.out.println(\"洗完了\");\n            } catch (InterruptedException e) {\n                System.out.println(\"发送异常被中断\");\n                return false;\n            }\n            System.out.println(\"运行结束\");\n            return true;\n        }\n    }\n    static class MainJob implements Runnable {\n        boolean waterOk = false;\n        boolean cupOk = false;\n        int gap = SLEEP_GAP / 10;\n        @Override\n        public  void run() {\n            while (true) {\n                try {\n                    Thread.sleep(gap);\n                    System.out.println(\"读书中\");\n                } catch (InterruptedException e) {\n                    System.out.println(getCurThreadName() + \"中断\");\n                }\n                if (waterOk && cupOk) {\n                    drinkTea(waterOk, cupOk);\n                    break;\n                }\n            }\n        }\n        public  void drinkTea(boolean waterOK, boolean cupOk) {\n            if (waterOK && cupOk) {\n                System.out.println(\"泡茶喝\");\n            } else if (!waterOK) {\n                System.out.println(\"烧水失败，没有茶喝了\");\n            } else if (!cupOk) {\n                System.out.println(\"杯子洗不了，没有茶喝了\");\n            }\n        }\n    }\n    public static void main(String[] args) {\n        final MainJob  mainJob = new MainJob();\n        Thread mainThread = new Thread(mainJob);\n        mainThread.setName(\"主线程\");\n        mainThread.start();\n\n        Callable<Boolean> hotJob = new HotWaterJob();\n        Callable<Boolean> washJob = new WashJon();\n\n        ExecutorService jPool = Executors.newFixedThreadPool(10);\n        ListeningExecutorService gPool = MoreExecutors.listeningDecorator(jPool);\n\n        ListenableFuture<Boolean> hotFuture = gPool.submit(hotJob);\n        Futures.addCallback(hotFuture, new FutureCallback<Boolean>() {\n            public void onSuccess(Boolean r) {\n                if (r) {\n                    mainJob.waterOk = true;\n                }\n            }\n\n            public void onFailure(Throwable throwable) {\n                System.out.println(\"烧水失败\");\n            }\n        });\n        ListenableFuture<Boolean> washFuture = gPool.submit(washJob);\n        Futures.addCallback(hotFuture, new FutureCallback<Boolean>() {\n            public void onSuccess(Boolean r) {\n                if (r) {\n                    mainJob.cupOk = true;\n                }\n            }\n\n            public void onFailure(Throwable throwable) {\n                System.out.println(\"杯子洗不了\");\n            }\n        });\n    }\n}\n```\n\n\n\nGuava非阻塞的原因与理解\n\n\n\n## Netty的异步回调模式\n\n在netty源码中大量使用了异步回调模式，在netty业务开发层面，netty应用的是handle处理器中的业务处理代码也是异步的。所以了解netty的异步回调是十分重要的。\n\nNetty扩展了Java Future的异步任务：\n\n- 继承Java Future接口并增强，使其方法可以非阻塞。\n- 引入GeneriFutureListener，用于表示异步任务完成的监控器，与Guava的FutureCallback不同，Netty使用的是监控器模式，异步任务完成后回调逻辑抽象成了Lisener监听器接口。可以将GenericFutureListener监听器加入Netty的异步任务Future中，实现对异步任务执行状态的事件监听。\n\n在异步非阻塞回调思路上和Guava是一致的。\n\n### GenericFutureListener接口\n\n该接口位于io.netty.util.concurrent\n\n直接上源码\n\n\n\nGenericFutureListener拥有一个回调方法operationComplete,回调代码写在这。\n\n而父接口EventListner是空接口，没有任何方法，起标识作用。\n\n### Netty Future 接口\n\nnetty对Future进行了扩展，对执行的过程进行监控，对异步回调完成事件进行监听。\n\n```java\n \n```\n\nFuture接口一般不会直接使用，而是会使用子接口。Netty有一系列的子接口，代表不同类型的异步任务如ChannelFuture接口。\n\nChannelFuture表示通道IO操作的异步任务，如果在通道的异步IO操作完成后执行回调就需要ChannelFuture","slug":"netty/并发基础中的Future异步回调模式","published":1,"updated":"2022-07-25T06:54:22.462Z","_id":"cl60e60tz000vm8vc2htq7u1w","comments":1,"layout":"post","photos":[],"link":"","content":"<p>在netty中使用了很多回调技术，并且基于java的回调设计了一整套异步回调接口和实现。</p>\n<p>这篇文章从Java Future入手，再到第三方异步回调技术–谷歌的Guava Future，最后介绍Netty的异步回调技术。</p>\n<p>在文章中的所有demo都采用“泡茶”的案例</p>\n<p>主线程：负责启动和等待其他线程</p>\n<p>清洗线程</p>\n<p>烧水线程</p>\n<div class=\"story post-story\"><h2 id=\"Join异步阻塞\"><a href=\"#Join异步阻塞\" class=\"headerlink\" title=\"Join异步阻塞\"></a>Join异步阻塞</h2><p>join的原理与作用是，阻塞当前线程，直到准备合并的目标线程的执行完成。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> org.example;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">JoinDemo</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">SLEEP_GAP</span> <span class=\"operator\">=</span> <span class=\"number\">5000</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title function_\">getCurThreadName</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Thread.currentThread().getName();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">HotwaterThread</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">Thread</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"title function_\">HotwaterThread</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">super</span>(<span class=\"string\">&quot;** 烧水-Thread&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;洗好茶壶&quot;</span>);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;灌水&quot;</span>);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;放在火上&quot;</span>);</span><br><span class=\"line\">                Thread.sleep(SLEEP_GAP);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;水烧开了&quot;</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;发送异常被中断&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;运行结束&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WashThread</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">Thread</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"title function_\">WashThread</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">super</span>(<span class=\"string\">&quot;$$ 清洗-Thread&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;洗茶壶&quot;</span>);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;洗茶杯&quot;</span>);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;拿茶叶&quot;</span>);</span><br><span class=\"line\">                Thread.sleep(SLEEP_GAP);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;洗完了&quot;</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;发送异常被中断&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;运行结束&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">h</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">HotwaterThread</span>();</span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">w</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">WashThread</span>();</span><br><span class=\"line\">        h.start();</span><br><span class=\"line\">        w.start();</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            h.join();</span><br><span class=\"line\">            w.join();</span><br><span class=\"line\">            Thread.currentThread().setName(<span class=\"string\">&quot;主线程&quot;</span>);</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;泡茶喝&quot;</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>(e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;end&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"join有三个重载版本：\"><a href=\"#join有三个重载版本：\" class=\"headerlink\" title=\"join有三个重载版本：\"></a>join有三个重载版本：</h3><ul>\n<li>void join () : A线程等待B线程执行结束后，A线程重新恢复执行</li>\n<li>void join(long millis) ：A线程等待B线程最长millis毫秒，超过后A重新恢复执行</li>\n<li>void join(long millis, int nanos)A线程等待B线程最长mills毫秒 + nanos纳秒</li>\n</ul>\n<h3 id=\"容易混淆的地方：\"><a href=\"#容易混淆的地方：\" class=\"headerlink\" title=\"容易混淆的地方：\"></a>容易混淆的地方：</h3><ol>\n<li>join是实例方法，不是静态方法，所以需要用线程对象去调用join，例如thread.join</li>\n<li>join调用时，不是线程所指向的目标线程阻塞，而是当前线程阻塞。</li>\n<li>只有等到目标线程完成或超时，当前线程才能恢复执行</li>\n</ol>\n<h3 id=\"join的问题\"><a href=\"#join的问题\" class=\"headerlink\" title=\"join的问题:\"></a>join的问题:</h3><p>被合并的线程没有返回值，即调用join后，没有返回值。</p>\n<p>例如，在上述代码中，main进程无法得知其他线程的运行结果。</p>\n<p>所以想要获得异步线程的执行结果，下面就介绍Java的FutureTask系列</p>\n</div><div class=\"story post-story\"><h2 id=\"FutureTask异步回调\"><a href=\"#FutureTask异步回调\" class=\"headerlink\" title=\"FutureTask异步回调\"></a>FutureTask异步回调</h2><p>FutureTask方式在java.util.concurrent包中。最重要的就是<strong>FutureTask 类</strong>和 <strong>Callable接口</strong></p>\n<h3 id=\"Callable接口\"><a href=\"#Callable接口\" class=\"headerlink\" title=\"Callable接口\"></a>Callable接口</h3><p>新事物的出现，一定是为了解决旧事物的一些缺陷。</p>\n<p>提到Callable接口，就离不开Runnable接口，Runnable有一个重要的问题，即它的run方法没有返回值的。所以Runnable不能用于需要有返回值的场景。</p>\n<p>Runnable接口是在Java多线程中表示线程的业务代码的抽象接口</p>\n<p>为了解决Runnable的问题，所以才有了Callable</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> java.util.concurrent;</span><br><span class=\"line\"><span class=\"meta\">@FunctionalInterface</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">Callable</span>&lt;V&gt; &#123;</span><br><span class=\"line\">    V <span class=\"title function_\">call</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">package</span> java.lang;</span><br><span class=\"line\"><span class=\"meta\">@FunctionalInterface</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">Runnable</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Callable是一个泛型接口，唯一方法call的返回值类型为泛型形参的实际类型，并且还有一个Exception，容许方法内部的异常不经过捕获。</p>\n<p>阿Callable方法可以与Runnable相对应，可以看成更强大的Runnable。</p>\n<p><strong>但他们也有不同的地方：</strong></p>\n<ul>\n<li>Callable接口的实例不能作为Thread线程实例的target来使用。Runnable接口实例可以作为Thread线程实例的target构造参数，开启一个Thread线程。</li>\n</ul>\n<p>target是什么？</p>\n<p>查看Thread源码可以得知，target是<strong>Runable</strong>类的，在Thread初始化时有使用。target作为参数传入Thread构造函数，构造函数调用init函数初始时也将target传入。并且在thread run中调用的也是Runnable的run方法。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Thread</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Runnable</span> &#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">/* What will be run. */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Runnable target;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> Object <span class=\"title function_\">clone</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> CloneNotSupportedException &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">CloneNotSupportedException</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">\t<span class=\"comment\">//Thread的构造器有很多种，只列了一种</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">Thread</span><span class=\"params\">(Runnable target)</span> &#123;</span><br><span class=\"line\">        init(<span class=\"literal\">null</span>, target, <span class=\"string\">&quot;Thread-&quot;</span> + nextThreadNum(), <span class=\"number\">0</span>);</span><br><span class=\"line\">    &#125;   </span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (target != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            target.run();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"> </span><br><span class=\"line\">   </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>但是呢，java的线程类型只有Thread，callable要是想利用Thread的话，就要想办法将自己赋值给Runnable类型的target，所以需要一个FutureTask类来进行所谓的搭桥。</p>\n<h3 id=\"FutureTask类\"><a href=\"#FutureTask类\" class=\"headerlink\" title=\"FutureTask类\"></a>FutureTask类</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">FutureTask</span>&lt;V&gt; <span class=\"keyword\">implements</span> <span class=\"title class_\">RunnableFuture</span>&lt;V&gt;</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">RunnableFuture</span>&lt;V&gt; <span class=\"keyword\">extends</span> <span class=\"title class_\">Runnable</span>, Future&lt;V&gt; </span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"title function_\">FutureTask</span><span class=\"params\">(Callable&lt;V&gt; callable)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (callable == <span class=\"literal\">null</span>)</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">NullPointerException</span>();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.callable = callable;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.state = NEW;       <span class=\"comment\">// ensure visibility of callable</span></span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>直接查看源码可以发现，FutureTask实现了RunnableFuture，而RunnableFuture则继承了Runnable和Future</p>\n<p>所以可以作为target传递给Thread。但是想要获取到Callable的异步执行结果就不应该使用它的call方法，而是通过FutureTask类的相应方法去获取。FutureTask实现了Future接口，Future接口则是提供了判断、获取、取消并发任务结果的功能。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> java.util.concurrent;</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">Future</span>&lt;V&gt; &#123;</span><br><span class=\"line\">    <span class=\"type\">boolean</span> <span class=\"title function_\">cancel</span><span class=\"params\">(<span class=\"type\">boolean</span> mayInterruptIfRunning)</span>;</span><br><span class=\"line\">    <span class=\"type\">boolean</span> <span class=\"title function_\">isCancelled</span><span class=\"params\">()</span>;</span><br><span class=\"line\">    <span class=\"type\">boolean</span> <span class=\"title function_\">isDone</span><span class=\"params\">()</span>;</span><br><span class=\"line\">    V <span class=\"title function_\">get</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> InterruptedException, ExecutionException;</span><br><span class=\"line\">    V <span class=\"title function_\">get</span><span class=\"params\">(<span class=\"type\">long</span> timeout, TimeUnit unit)</span></span><br><span class=\"line\">        <span class=\"keyword\">throws</span> InterruptedException, ExecutionException, TimeoutException;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Future接口提供的get方法是阻塞的，如果并发任务没有完成就会等待并发任务完成。可以增加时间约束。</li>\n</ul>\n<p>总结一下，FutureTask通过间接继承了Runnable，从而能够作为Thread的target, 然后Callable作为参数传入其中，此外Future提供了获取异步任务执行结果的方法，FutureTask实现了其方法。到这里Future成功搭起来看Callable和Thread的桥梁，并且实现获取异步任务结果的方式。</p>\n<p>回到FutureTask中，变量Callable代表异步执行的逻辑，我们需要保存结果，保存在哪呢？</p>\n<p>查看源码可以看到，FutureTask中有一个run方法是Runnable接口的，它能作为Target目标去执行，然后</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">       <span class=\"keyword\">if</span> (state != NEW ||</span><br><span class=\"line\">           !UNSAFE.compareAndSwapObject(<span class=\"built_in\">this</span>, runnerOffset,</span><br><span class=\"line\">                                        <span class=\"literal\">null</span>, Thread.currentThread()))</span><br><span class=\"line\">           <span class=\"keyword\">return</span>;</span><br><span class=\"line\">       <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">           Callable&lt;V&gt; c = callable;</span><br><span class=\"line\">           <span class=\"keyword\">if</span> (c != <span class=\"literal\">null</span> &amp;&amp; state == NEW) &#123;</span><br><span class=\"line\">               V result;</span><br><span class=\"line\">               <span class=\"type\">boolean</span> ran;</span><br><span class=\"line\">               <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                   result = c.call();</span><br><span class=\"line\">                   ran = <span class=\"literal\">true</span>;</span><br><span class=\"line\">               &#125; <span class=\"keyword\">catch</span> (Throwable ex) &#123;</span><br><span class=\"line\">                   result = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                   ran = <span class=\"literal\">false</span>;</span><br><span class=\"line\">                   setException(ex);</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">               <span class=\"keyword\">if</span> (ran)</span><br><span class=\"line\">                   set(result);</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">       &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">           <span class=\"comment\">// runner must be non-null until state is settled to</span></span><br><span class=\"line\">           <span class=\"comment\">// prevent concurrent calls to run()</span></span><br><span class=\"line\">           runner = <span class=\"literal\">null</span>;</span><br><span class=\"line\">           <span class=\"comment\">// state must be re-read after nulling runner to prevent</span></span><br><span class=\"line\">           <span class=\"comment\">// leaked interrupts</span></span><br><span class=\"line\">           <span class=\"type\">int</span> <span class=\"variable\">s</span> <span class=\"operator\">=</span> state;</span><br><span class=\"line\">           <span class=\"keyword\">if</span> (s &gt;= INTERRUPTING)</span><br><span class=\"line\">               handlePossibleCancellationInterrupt(s);</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">   &#125;</span><br></pre></td></tr></table></figure>\n\n<p>run方法中有个set方法</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title function_\">set</span><span class=\"params\">(V v)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (UNSAFE.compareAndSwapInt(<span class=\"built_in\">this</span>, stateOffset, NEW, COMPLETING)) &#123;</span><br><span class=\"line\">            outcome = v;</span><br><span class=\"line\">            UNSAFE.putOrderedInt(<span class=\"built_in\">this</span>, stateOffset, NORMAL); <span class=\"comment\">// final state</span></span><br><span class=\"line\">            finishCompletion();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>最终保存在outcome属性中</p>\n<p>private Object outcome</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> org.example;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.Callable;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.ExecutionException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.FutureTask;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">JavaFutureDemo</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">SLEEP_GAP</span> <span class=\"operator\">=</span> <span class=\"number\">5000</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title function_\">getCurThreadName</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Thread.currentThread().getName();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">HotWaterJob</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Callable</span>&lt;Boolean&gt; &#123;</span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> Boolean <span class=\"title function_\">call</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;洗好茶壶&quot;</span>);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;灌水&quot;</span>);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;放在火上&quot;</span>);</span><br><span class=\"line\">                Thread.sleep(SLEEP_GAP);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;水烧开了&quot;</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;发送异常被中断&quot;</span>);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;运行结束&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WashJon</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Callable</span>&lt;Boolean&gt; &#123;</span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> Boolean <span class=\"title function_\">call</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;洗茶壶&quot;</span>);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;洗茶杯&quot;</span>);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;拿茶叶&quot;</span>);</span><br><span class=\"line\">                Thread.sleep(SLEEP_GAP);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;洗完了&quot;</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;发送异常被中断&quot;</span>);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;运行结束&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">drinkTea</span><span class=\"params\">(<span class=\"type\">boolean</span> waterOK, <span class=\"type\">boolean</span> cupOk)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (waterOK &amp;&amp; cupOk) &#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;泡茶喝&quot;</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (!waterOK) &#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;烧水失败，没有茶喝了&quot;</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (!cupOk) &#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;杯子洗不了，没有茶喝了&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String args[])</span> &#123;</span><br><span class=\"line\">        Callable&lt;Boolean&gt; hJob = <span class=\"keyword\">new</span> <span class=\"title class_\">HotWaterJob</span>();</span><br><span class=\"line\">        FutureTask&lt;Boolean&gt; hTask = <span class=\"keyword\">new</span> <span class=\"title class_\">FutureTask</span>&lt;Boolean&gt;(hJob);</span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">hThread</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(hTask, <span class=\"string\">&quot;** 烧水-Thread&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        Callable&lt;Boolean&gt; wJob = <span class=\"keyword\">new</span> <span class=\"title class_\">WashJon</span>();</span><br><span class=\"line\">        FutureTask&lt;Boolean&gt; wTask = <span class=\"keyword\">new</span> <span class=\"title class_\">FutureTask</span>&lt;Boolean&gt;(wJob);</span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">wThread</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(wTask, <span class=\"string\">&quot;$$ 清洗-Thread&quot;</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">        hThread.start();</span><br><span class=\"line\">        wThread.start();</span><br><span class=\"line\"></span><br><span class=\"line\">        Thread.currentThread().setName(<span class=\"string\">&quot;主线程&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">boolean</span> <span class=\"variable\">watereOk</span> <span class=\"operator\">=</span> hTask.get();</span><br><span class=\"line\">            <span class=\"type\">boolean</span> <span class=\"variable\">cupOk</span> <span class=\"operator\">=</span> wTask.get();</span><br><span class=\"line\">            drinkTea(watereOk, cupOk);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (ExecutionException e) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>(e);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>(e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;end&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>虽然可以通过get获取异步执行的结果，但是并不高明，因为get实际上还是阻塞的，就是主线程调用get时，主线程也会阻塞，和join差不多。</p>\n<p>原生JavaAPI除了阻塞模式的获取结果外，没有实现非阻塞的，需要引入别的框架比如谷歌的Guava。</p>\n</div><div class=\"story post-story\"><h2 id=\"谷歌Guava的异步回调\"><a href=\"#谷歌Guava的异步回调\" class=\"headerlink\" title=\"谷歌Guava的异步回调\"></a>谷歌Guava的异步回调</h2><p>Guava是谷歌公司提供的Java扩展包，是一种异步回调的解决方案。</p>\n<ul>\n<li>新增了一个ListenableFuture接口，继承了Java的Future接口，使得Java的Future异步任务，在Guava中能够被监控和获得非阻塞异步执行的结果</li>\n<li>引入一个新的接口FutureCallback，根据异步执行结果完成不同的回调处理，能够处理异步结果啦。</li>\n</ul>\n<h3 id=\"FutureCallback\"><a href=\"#FutureCallback\" class=\"headerlink\" title=\"FutureCallback\"></a>FutureCallback</h3><p>负责异步任务完成后的监听逻辑，相当于处理异步结果</p>\n<p><strong>有两个方法：</strong></p>\n<ul>\n<li>onSuccess 异步任务成功后被回调，异步任务的结果作为onSuccess的参数</li>\n<li>onFailure 异步任务异常被回调，异步任务的结果作为onFailure的参数</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@GwtCompatible</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">FutureCallback</span>&lt;V&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">void</span> <span class=\"title function_\">onSuccess</span><span class=\"params\">(<span class=\"meta\">@Nullable</span> V result)</span>;</span><br><span class=\"line\">  <span class=\"keyword\">void</span> <span class=\"title function_\">onFailure</span><span class=\"params\">(Throwable t)</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>看起来与Callable相似，但完全不一样：</strong></p>\n<p>Callable代表异步执行逻辑</p>\n<p>FutureCallback代表的是异步任务完成后对结果的处理工作</p>\n<p>Guava FutureCallback只是对Java Future异步执行的增强，所以使用Guava需要Java Callable，简单来说只有Java的Callable任务执行的结果出来以后才能执行FutureCallback</p>\n<p>如何实现这种监控关系呢？</p>\n<p>引入ListenableFuture，获取异步执行结果</p>\n<h3 id=\"ListenableFuture\"><a href=\"#ListenableFuture\" class=\"headerlink\" title=\"ListenableFuture\"></a>ListenableFuture</h3><p>这里直接上源码</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@GwtCompatible</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">ListenableFuture</span>&lt;V&gt; <span class=\"keyword\">extends</span> <span class=\"title class_\">Future</span>&lt;V&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">void</span> <span class=\"title function_\">addListener</span><span class=\"params\">(Runnable listener, Executor executor)</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ListenableFuture在Future的基础上增加了addListener方法，目的是将FutureCallback的任务封装成一个内部的Runnable异步回调任务。在Callable异步完成后，回调。但是这个方法只在内部使用，一般不调用。</p>\n<p>那如何将FutureCallback绑定到ListenableFuture任务呢？</p>\n<p>使用Guava的Futures工具类，addcallback可以绑定。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ListenableFuture&lt;Boolean&gt; hotFuture = gPool.submit(hotJob);</span><br><span class=\"line\">        Futures.addCallback(hotFuture, <span class=\"keyword\">new</span> <span class=\"title class_\">FutureCallback</span>&lt;Boolean&gt;() &#123;</span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">onSuccess</span><span class=\"params\">(Boolean r)</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (r) &#123;</span><br><span class=\"line\">                    mainJob.waterOk = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">onFailure</span><span class=\"params\">(Throwable throwable)</span> &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;烧水失败&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br></pre></td></tr></table></figure>\n\n<p>如果Guava的ListenableFuture 是 对Java Future 的扩展，都表示异步任务，那Guava的异步任务从何而来？</p>\n<p>ListenableFuture的异步任务异步任务的实例主要是通过向线程池提交Callable任务的方式获取，这里的线程池是Guava的不是Java的，另外FutureTask的异步任务实例是直接将Callable传入构造器。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">ExecutorService</span> <span class=\"variable\">jPool</span> <span class=\"operator\">=</span> Executors.newFixedThreadPool(<span class=\"number\">10</span>);</span><br><span class=\"line\"><span class=\"type\">ListeningExecutorService</span> <span class=\"variable\">gPool</span> <span class=\"operator\">=</span> MoreExecutors.listeningDecorator(jPool);</span><br></pre></td></tr></table></figure>\n\n<p>流程：</p>\n<ol>\n<li>创建Callable异步任务</li>\n<li>创建Guava线程池</li>\n<li>提交Callable获取ListenableFuture异步任务实例</li>\n<li>创建FutureCallback，绑定ListenableFuture</li>\n</ol>\n<p>泡茶实例</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> org.example;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.google.common.util.concurrent.*;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.annotation.Nullable;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.Callable;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.Executor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.ExecutorService;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.Executors;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">GuavaFutureDemo</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">SLEEP_GAP</span> <span class=\"operator\">=</span> <span class=\"number\">5000</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title function_\">getCurThreadName</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Thread.currentThread().getName();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">HotWaterJob</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Callable</span>&lt;Boolean&gt; &#123;</span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> Boolean <span class=\"title function_\">call</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;洗好茶壶&quot;</span>);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;灌水&quot;</span>);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;放在火上&quot;</span>);</span><br><span class=\"line\">                Thread.sleep(SLEEP_GAP);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;水烧开了&quot;</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;发送异常被中断&quot;</span>);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;运行结束&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WashJon</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Callable</span>&lt;Boolean&gt; &#123;</span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> Boolean <span class=\"title function_\">call</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;洗茶壶&quot;</span>);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;洗茶杯&quot;</span>);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;拿茶叶&quot;</span>);</span><br><span class=\"line\">                Thread.sleep(SLEEP_GAP);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;洗完了&quot;</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;发送异常被中断&quot;</span>);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;运行结束&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MainJob</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Runnable</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">boolean</span> <span class=\"variable\">waterOk</span> <span class=\"operator\">=</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        <span class=\"type\">boolean</span> <span class=\"variable\">cupOk</span> <span class=\"operator\">=</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">gap</span> <span class=\"operator\">=</span> SLEEP_GAP / <span class=\"number\">10</span>;</span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span>  <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">while</span> (<span class=\"literal\">true</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    Thread.sleep(gap);</span><br><span class=\"line\">                    System.out.println(<span class=\"string\">&quot;读书中&quot;</span>);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                    System.out.println(getCurThreadName() + <span class=\"string\">&quot;中断&quot;</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (waterOk &amp;&amp; cupOk) &#123;</span><br><span class=\"line\">                    drinkTea(waterOk, cupOk);</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">public</span>  <span class=\"keyword\">void</span> <span class=\"title function_\">drinkTea</span><span class=\"params\">(<span class=\"type\">boolean</span> waterOK, <span class=\"type\">boolean</span> cupOk)</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (waterOK &amp;&amp; cupOk) &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;泡茶喝&quot;</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (!waterOK) &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;烧水失败，没有茶喝了&quot;</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (!cupOk) &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;杯子洗不了，没有茶喝了&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">MainJob</span>  <span class=\"variable\">mainJob</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">MainJob</span>();</span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">mainThread</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(mainJob);</span><br><span class=\"line\">        mainThread.setName(<span class=\"string\">&quot;主线程&quot;</span>);</span><br><span class=\"line\">        mainThread.start();</span><br><span class=\"line\"></span><br><span class=\"line\">        Callable&lt;Boolean&gt; hotJob = <span class=\"keyword\">new</span> <span class=\"title class_\">HotWaterJob</span>();</span><br><span class=\"line\">        Callable&lt;Boolean&gt; washJob = <span class=\"keyword\">new</span> <span class=\"title class_\">WashJon</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">ExecutorService</span> <span class=\"variable\">jPool</span> <span class=\"operator\">=</span> Executors.newFixedThreadPool(<span class=\"number\">10</span>);</span><br><span class=\"line\">        <span class=\"type\">ListeningExecutorService</span> <span class=\"variable\">gPool</span> <span class=\"operator\">=</span> MoreExecutors.listeningDecorator(jPool);</span><br><span class=\"line\"></span><br><span class=\"line\">        ListenableFuture&lt;Boolean&gt; hotFuture = gPool.submit(hotJob);</span><br><span class=\"line\">        Futures.addCallback(hotFuture, <span class=\"keyword\">new</span> <span class=\"title class_\">FutureCallback</span>&lt;Boolean&gt;() &#123;</span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">onSuccess</span><span class=\"params\">(Boolean r)</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (r) &#123;</span><br><span class=\"line\">                    mainJob.waterOk = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">onFailure</span><span class=\"params\">(Throwable throwable)</span> &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;烧水失败&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        ListenableFuture&lt;Boolean&gt; washFuture = gPool.submit(washJob);</span><br><span class=\"line\">        Futures.addCallback(hotFuture, <span class=\"keyword\">new</span> <span class=\"title class_\">FutureCallback</span>&lt;Boolean&gt;() &#123;</span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">onSuccess</span><span class=\"params\">(Boolean r)</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (r) &#123;</span><br><span class=\"line\">                    mainJob.cupOk = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">onFailure</span><span class=\"params\">(Throwable throwable)</span> &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;杯子洗不了&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>Guava非阻塞的原因与理解</p>\n</div><div class=\"story post-story\"><h2 id=\"Netty的异步回调模式\"><a href=\"#Netty的异步回调模式\" class=\"headerlink\" title=\"Netty的异步回调模式\"></a>Netty的异步回调模式</h2><p>在netty源码中大量使用了异步回调模式，在netty业务开发层面，netty应用的是handle处理器中的业务处理代码也是异步的。所以了解netty的异步回调是十分重要的。</p>\n<p>Netty扩展了Java Future的异步任务：</p>\n<ul>\n<li>继承Java Future接口并增强，使其方法可以非阻塞。</li>\n<li>引入GeneriFutureListener，用于表示异步任务完成的监控器，与Guava的FutureCallback不同，Netty使用的是监控器模式，异步任务完成后回调逻辑抽象成了Lisener监听器接口。可以将GenericFutureListener监听器加入Netty的异步任务Future中，实现对异步任务执行状态的事件监听。</li>\n</ul>\n<p>在异步非阻塞回调思路上和Guava是一致的。</p>\n<h3 id=\"GenericFutureListener接口\"><a href=\"#GenericFutureListener接口\" class=\"headerlink\" title=\"GenericFutureListener接口\"></a>GenericFutureListener接口</h3><p>该接口位于io.netty.util.concurrent</p>\n<p>直接上源码</p>\n<p>GenericFutureListener拥有一个回调方法operationComplete,回调代码写在这。</p>\n<p>而父接口EventListner是空接口，没有任何方法，起标识作用。</p>\n<h3 id=\"Netty-Future-接口\"><a href=\"#Netty-Future-接口\" class=\"headerlink\" title=\"Netty Future 接口\"></a>Netty Future 接口</h3><p>netty对Future进行了扩展，对执行的过程进行监控，对异步回调完成事件进行监听。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> </span><br></pre></td></tr></table></figure>\n\n<p>Future接口一般不会直接使用，而是会使用子接口。Netty有一系列的子接口，代表不同类型的异步任务如ChannelFuture接口。</p>\n<p>ChannelFuture表示通道IO操作的异步任务，如果在通道的异步IO操作完成后执行回调就需要ChannelFuture</p>\n\n</div>","site":{"data":{}},"excerpt":"","more":"<p>在netty中使用了很多回调技术，并且基于java的回调设计了一整套异步回调接口和实现。</p>\n<p>这篇文章从Java Future入手，再到第三方异步回调技术–谷歌的Guava Future，最后介绍Netty的异步回调技术。</p>\n<p>在文章中的所有demo都采用“泡茶”的案例</p>\n<p>主线程：负责启动和等待其他线程</p>\n<p>清洗线程</p>\n<p>烧水线程</p>\n<h2 id=\"Join异步阻塞\"><a href=\"#Join异步阻塞\" class=\"headerlink\" title=\"Join异步阻塞\"></a>Join异步阻塞</h2><p>join的原理与作用是，阻塞当前线程，直到准备合并的目标线程的执行完成。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> org.example;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">JoinDemo</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">SLEEP_GAP</span> <span class=\"operator\">=</span> <span class=\"number\">5000</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title function_\">getCurThreadName</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Thread.currentThread().getName();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">HotwaterThread</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">Thread</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"title function_\">HotwaterThread</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">super</span>(<span class=\"string\">&quot;** 烧水-Thread&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;洗好茶壶&quot;</span>);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;灌水&quot;</span>);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;放在火上&quot;</span>);</span><br><span class=\"line\">                Thread.sleep(SLEEP_GAP);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;水烧开了&quot;</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;发送异常被中断&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;运行结束&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WashThread</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">Thread</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"title function_\">WashThread</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">super</span>(<span class=\"string\">&quot;$$ 清洗-Thread&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;洗茶壶&quot;</span>);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;洗茶杯&quot;</span>);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;拿茶叶&quot;</span>);</span><br><span class=\"line\">                Thread.sleep(SLEEP_GAP);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;洗完了&quot;</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;发送异常被中断&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;运行结束&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">h</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">HotwaterThread</span>();</span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">w</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">WashThread</span>();</span><br><span class=\"line\">        h.start();</span><br><span class=\"line\">        w.start();</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            h.join();</span><br><span class=\"line\">            w.join();</span><br><span class=\"line\">            Thread.currentThread().setName(<span class=\"string\">&quot;主线程&quot;</span>);</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;泡茶喝&quot;</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>(e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;end&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"join有三个重载版本：\"><a href=\"#join有三个重载版本：\" class=\"headerlink\" title=\"join有三个重载版本：\"></a>join有三个重载版本：</h3><ul>\n<li>void join () : A线程等待B线程执行结束后，A线程重新恢复执行</li>\n<li>void join(long millis) ：A线程等待B线程最长millis毫秒，超过后A重新恢复执行</li>\n<li>void join(long millis, int nanos)A线程等待B线程最长mills毫秒 + nanos纳秒</li>\n</ul>\n<h3 id=\"容易混淆的地方：\"><a href=\"#容易混淆的地方：\" class=\"headerlink\" title=\"容易混淆的地方：\"></a>容易混淆的地方：</h3><ol>\n<li>join是实例方法，不是静态方法，所以需要用线程对象去调用join，例如thread.join</li>\n<li>join调用时，不是线程所指向的目标线程阻塞，而是当前线程阻塞。</li>\n<li>只有等到目标线程完成或超时，当前线程才能恢复执行</li>\n</ol>\n<h3 id=\"join的问题\"><a href=\"#join的问题\" class=\"headerlink\" title=\"join的问题:\"></a>join的问题:</h3><p>被合并的线程没有返回值，即调用join后，没有返回值。</p>\n<p>例如，在上述代码中，main进程无法得知其他线程的运行结果。</p>\n<p>所以想要获得异步线程的执行结果，下面就介绍Java的FutureTask系列</p>\n<h2 id=\"FutureTask异步回调\"><a href=\"#FutureTask异步回调\" class=\"headerlink\" title=\"FutureTask异步回调\"></a>FutureTask异步回调</h2><p>FutureTask方式在java.util.concurrent包中。最重要的就是<strong>FutureTask 类</strong>和 <strong>Callable接口</strong></p>\n<h3 id=\"Callable接口\"><a href=\"#Callable接口\" class=\"headerlink\" title=\"Callable接口\"></a>Callable接口</h3><p>新事物的出现，一定是为了解决旧事物的一些缺陷。</p>\n<p>提到Callable接口，就离不开Runnable接口，Runnable有一个重要的问题，即它的run方法没有返回值的。所以Runnable不能用于需要有返回值的场景。</p>\n<p>Runnable接口是在Java多线程中表示线程的业务代码的抽象接口</p>\n<p>为了解决Runnable的问题，所以才有了Callable</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> java.util.concurrent;</span><br><span class=\"line\"><span class=\"meta\">@FunctionalInterface</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">Callable</span>&lt;V&gt; &#123;</span><br><span class=\"line\">    V <span class=\"title function_\">call</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">package</span> java.lang;</span><br><span class=\"line\"><span class=\"meta\">@FunctionalInterface</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">Runnable</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Callable是一个泛型接口，唯一方法call的返回值类型为泛型形参的实际类型，并且还有一个Exception，容许方法内部的异常不经过捕获。</p>\n<p>阿Callable方法可以与Runnable相对应，可以看成更强大的Runnable。</p>\n<p><strong>但他们也有不同的地方：</strong></p>\n<ul>\n<li>Callable接口的实例不能作为Thread线程实例的target来使用。Runnable接口实例可以作为Thread线程实例的target构造参数，开启一个Thread线程。</li>\n</ul>\n<p>target是什么？</p>\n<p>查看Thread源码可以得知，target是<strong>Runable</strong>类的，在Thread初始化时有使用。target作为参数传入Thread构造函数，构造函数调用init函数初始时也将target传入。并且在thread run中调用的也是Runnable的run方法。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Thread</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Runnable</span> &#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">/* What will be run. */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Runnable target;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> Object <span class=\"title function_\">clone</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> CloneNotSupportedException &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">CloneNotSupportedException</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">\t<span class=\"comment\">//Thread的构造器有很多种，只列了一种</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">Thread</span><span class=\"params\">(Runnable target)</span> &#123;</span><br><span class=\"line\">        init(<span class=\"literal\">null</span>, target, <span class=\"string\">&quot;Thread-&quot;</span> + nextThreadNum(), <span class=\"number\">0</span>);</span><br><span class=\"line\">    &#125;   </span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (target != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            target.run();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"> </span><br><span class=\"line\">   </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>但是呢，java的线程类型只有Thread，callable要是想利用Thread的话，就要想办法将自己赋值给Runnable类型的target，所以需要一个FutureTask类来进行所谓的搭桥。</p>\n<h3 id=\"FutureTask类\"><a href=\"#FutureTask类\" class=\"headerlink\" title=\"FutureTask类\"></a>FutureTask类</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">FutureTask</span>&lt;V&gt; <span class=\"keyword\">implements</span> <span class=\"title class_\">RunnableFuture</span>&lt;V&gt;</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">RunnableFuture</span>&lt;V&gt; <span class=\"keyword\">extends</span> <span class=\"title class_\">Runnable</span>, Future&lt;V&gt; </span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"title function_\">FutureTask</span><span class=\"params\">(Callable&lt;V&gt; callable)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (callable == <span class=\"literal\">null</span>)</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">NullPointerException</span>();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.callable = callable;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.state = NEW;       <span class=\"comment\">// ensure visibility of callable</span></span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>直接查看源码可以发现，FutureTask实现了RunnableFuture，而RunnableFuture则继承了Runnable和Future</p>\n<p>所以可以作为target传递给Thread。但是想要获取到Callable的异步执行结果就不应该使用它的call方法，而是通过FutureTask类的相应方法去获取。FutureTask实现了Future接口，Future接口则是提供了判断、获取、取消并发任务结果的功能。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> java.util.concurrent;</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">Future</span>&lt;V&gt; &#123;</span><br><span class=\"line\">    <span class=\"type\">boolean</span> <span class=\"title function_\">cancel</span><span class=\"params\">(<span class=\"type\">boolean</span> mayInterruptIfRunning)</span>;</span><br><span class=\"line\">    <span class=\"type\">boolean</span> <span class=\"title function_\">isCancelled</span><span class=\"params\">()</span>;</span><br><span class=\"line\">    <span class=\"type\">boolean</span> <span class=\"title function_\">isDone</span><span class=\"params\">()</span>;</span><br><span class=\"line\">    V <span class=\"title function_\">get</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> InterruptedException, ExecutionException;</span><br><span class=\"line\">    V <span class=\"title function_\">get</span><span class=\"params\">(<span class=\"type\">long</span> timeout, TimeUnit unit)</span></span><br><span class=\"line\">        <span class=\"keyword\">throws</span> InterruptedException, ExecutionException, TimeoutException;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Future接口提供的get方法是阻塞的，如果并发任务没有完成就会等待并发任务完成。可以增加时间约束。</li>\n</ul>\n<p>总结一下，FutureTask通过间接继承了Runnable，从而能够作为Thread的target, 然后Callable作为参数传入其中，此外Future提供了获取异步任务执行结果的方法，FutureTask实现了其方法。到这里Future成功搭起来看Callable和Thread的桥梁，并且实现获取异步任务结果的方式。</p>\n<p>回到FutureTask中，变量Callable代表异步执行的逻辑，我们需要保存结果，保存在哪呢？</p>\n<p>查看源码可以看到，FutureTask中有一个run方法是Runnable接口的，它能作为Target目标去执行，然后</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">       <span class=\"keyword\">if</span> (state != NEW ||</span><br><span class=\"line\">           !UNSAFE.compareAndSwapObject(<span class=\"built_in\">this</span>, runnerOffset,</span><br><span class=\"line\">                                        <span class=\"literal\">null</span>, Thread.currentThread()))</span><br><span class=\"line\">           <span class=\"keyword\">return</span>;</span><br><span class=\"line\">       <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">           Callable&lt;V&gt; c = callable;</span><br><span class=\"line\">           <span class=\"keyword\">if</span> (c != <span class=\"literal\">null</span> &amp;&amp; state == NEW) &#123;</span><br><span class=\"line\">               V result;</span><br><span class=\"line\">               <span class=\"type\">boolean</span> ran;</span><br><span class=\"line\">               <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                   result = c.call();</span><br><span class=\"line\">                   ran = <span class=\"literal\">true</span>;</span><br><span class=\"line\">               &#125; <span class=\"keyword\">catch</span> (Throwable ex) &#123;</span><br><span class=\"line\">                   result = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                   ran = <span class=\"literal\">false</span>;</span><br><span class=\"line\">                   setException(ex);</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">               <span class=\"keyword\">if</span> (ran)</span><br><span class=\"line\">                   set(result);</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">       &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">           <span class=\"comment\">// runner must be non-null until state is settled to</span></span><br><span class=\"line\">           <span class=\"comment\">// prevent concurrent calls to run()</span></span><br><span class=\"line\">           runner = <span class=\"literal\">null</span>;</span><br><span class=\"line\">           <span class=\"comment\">// state must be re-read after nulling runner to prevent</span></span><br><span class=\"line\">           <span class=\"comment\">// leaked interrupts</span></span><br><span class=\"line\">           <span class=\"type\">int</span> <span class=\"variable\">s</span> <span class=\"operator\">=</span> state;</span><br><span class=\"line\">           <span class=\"keyword\">if</span> (s &gt;= INTERRUPTING)</span><br><span class=\"line\">               handlePossibleCancellationInterrupt(s);</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">   &#125;</span><br></pre></td></tr></table></figure>\n\n<p>run方法中有个set方法</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title function_\">set</span><span class=\"params\">(V v)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (UNSAFE.compareAndSwapInt(<span class=\"built_in\">this</span>, stateOffset, NEW, COMPLETING)) &#123;</span><br><span class=\"line\">            outcome = v;</span><br><span class=\"line\">            UNSAFE.putOrderedInt(<span class=\"built_in\">this</span>, stateOffset, NORMAL); <span class=\"comment\">// final state</span></span><br><span class=\"line\">            finishCompletion();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>最终保存在outcome属性中</p>\n<p>private Object outcome</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> org.example;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.Callable;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.ExecutionException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.FutureTask;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">JavaFutureDemo</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">SLEEP_GAP</span> <span class=\"operator\">=</span> <span class=\"number\">5000</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title function_\">getCurThreadName</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Thread.currentThread().getName();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">HotWaterJob</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Callable</span>&lt;Boolean&gt; &#123;</span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> Boolean <span class=\"title function_\">call</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;洗好茶壶&quot;</span>);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;灌水&quot;</span>);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;放在火上&quot;</span>);</span><br><span class=\"line\">                Thread.sleep(SLEEP_GAP);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;水烧开了&quot;</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;发送异常被中断&quot;</span>);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;运行结束&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WashJon</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Callable</span>&lt;Boolean&gt; &#123;</span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> Boolean <span class=\"title function_\">call</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;洗茶壶&quot;</span>);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;洗茶杯&quot;</span>);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;拿茶叶&quot;</span>);</span><br><span class=\"line\">                Thread.sleep(SLEEP_GAP);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;洗完了&quot;</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;发送异常被中断&quot;</span>);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;运行结束&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">drinkTea</span><span class=\"params\">(<span class=\"type\">boolean</span> waterOK, <span class=\"type\">boolean</span> cupOk)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (waterOK &amp;&amp; cupOk) &#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;泡茶喝&quot;</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (!waterOK) &#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;烧水失败，没有茶喝了&quot;</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (!cupOk) &#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;杯子洗不了，没有茶喝了&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String args[])</span> &#123;</span><br><span class=\"line\">        Callable&lt;Boolean&gt; hJob = <span class=\"keyword\">new</span> <span class=\"title class_\">HotWaterJob</span>();</span><br><span class=\"line\">        FutureTask&lt;Boolean&gt; hTask = <span class=\"keyword\">new</span> <span class=\"title class_\">FutureTask</span>&lt;Boolean&gt;(hJob);</span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">hThread</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(hTask, <span class=\"string\">&quot;** 烧水-Thread&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        Callable&lt;Boolean&gt; wJob = <span class=\"keyword\">new</span> <span class=\"title class_\">WashJon</span>();</span><br><span class=\"line\">        FutureTask&lt;Boolean&gt; wTask = <span class=\"keyword\">new</span> <span class=\"title class_\">FutureTask</span>&lt;Boolean&gt;(wJob);</span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">wThread</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(wTask, <span class=\"string\">&quot;$$ 清洗-Thread&quot;</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">        hThread.start();</span><br><span class=\"line\">        wThread.start();</span><br><span class=\"line\"></span><br><span class=\"line\">        Thread.currentThread().setName(<span class=\"string\">&quot;主线程&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">boolean</span> <span class=\"variable\">watereOk</span> <span class=\"operator\">=</span> hTask.get();</span><br><span class=\"line\">            <span class=\"type\">boolean</span> <span class=\"variable\">cupOk</span> <span class=\"operator\">=</span> wTask.get();</span><br><span class=\"line\">            drinkTea(watereOk, cupOk);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (ExecutionException e) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>(e);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>(e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;end&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>虽然可以通过get获取异步执行的结果，但是并不高明，因为get实际上还是阻塞的，就是主线程调用get时，主线程也会阻塞，和join差不多。</p>\n<p>原生JavaAPI除了阻塞模式的获取结果外，没有实现非阻塞的，需要引入别的框架比如谷歌的Guava。</p>\n<h2 id=\"谷歌Guava的异步回调\"><a href=\"#谷歌Guava的异步回调\" class=\"headerlink\" title=\"谷歌Guava的异步回调\"></a>谷歌Guava的异步回调</h2><p>Guava是谷歌公司提供的Java扩展包，是一种异步回调的解决方案。</p>\n<ul>\n<li>新增了一个ListenableFuture接口，继承了Java的Future接口，使得Java的Future异步任务，在Guava中能够被监控和获得非阻塞异步执行的结果</li>\n<li>引入一个新的接口FutureCallback，根据异步执行结果完成不同的回调处理，能够处理异步结果啦。</li>\n</ul>\n<h3 id=\"FutureCallback\"><a href=\"#FutureCallback\" class=\"headerlink\" title=\"FutureCallback\"></a>FutureCallback</h3><p>负责异步任务完成后的监听逻辑，相当于处理异步结果</p>\n<p><strong>有两个方法：</strong></p>\n<ul>\n<li>onSuccess 异步任务成功后被回调，异步任务的结果作为onSuccess的参数</li>\n<li>onFailure 异步任务异常被回调，异步任务的结果作为onFailure的参数</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@GwtCompatible</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">FutureCallback</span>&lt;V&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">void</span> <span class=\"title function_\">onSuccess</span><span class=\"params\">(<span class=\"meta\">@Nullable</span> V result)</span>;</span><br><span class=\"line\">  <span class=\"keyword\">void</span> <span class=\"title function_\">onFailure</span><span class=\"params\">(Throwable t)</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>看起来与Callable相似，但完全不一样：</strong></p>\n<p>Callable代表异步执行逻辑</p>\n<p>FutureCallback代表的是异步任务完成后对结果的处理工作</p>\n<p>Guava FutureCallback只是对Java Future异步执行的增强，所以使用Guava需要Java Callable，简单来说只有Java的Callable任务执行的结果出来以后才能执行FutureCallback</p>\n<p>如何实现这种监控关系呢？</p>\n<p>引入ListenableFuture，获取异步执行结果</p>\n<h3 id=\"ListenableFuture\"><a href=\"#ListenableFuture\" class=\"headerlink\" title=\"ListenableFuture\"></a>ListenableFuture</h3><p>这里直接上源码</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@GwtCompatible</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">ListenableFuture</span>&lt;V&gt; <span class=\"keyword\">extends</span> <span class=\"title class_\">Future</span>&lt;V&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">void</span> <span class=\"title function_\">addListener</span><span class=\"params\">(Runnable listener, Executor executor)</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ListenableFuture在Future的基础上增加了addListener方法，目的是将FutureCallback的任务封装成一个内部的Runnable异步回调任务。在Callable异步完成后，回调。但是这个方法只在内部使用，一般不调用。</p>\n<p>那如何将FutureCallback绑定到ListenableFuture任务呢？</p>\n<p>使用Guava的Futures工具类，addcallback可以绑定。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ListenableFuture&lt;Boolean&gt; hotFuture = gPool.submit(hotJob);</span><br><span class=\"line\">        Futures.addCallback(hotFuture, <span class=\"keyword\">new</span> <span class=\"title class_\">FutureCallback</span>&lt;Boolean&gt;() &#123;</span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">onSuccess</span><span class=\"params\">(Boolean r)</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (r) &#123;</span><br><span class=\"line\">                    mainJob.waterOk = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">onFailure</span><span class=\"params\">(Throwable throwable)</span> &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;烧水失败&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br></pre></td></tr></table></figure>\n\n<p>如果Guava的ListenableFuture 是 对Java Future 的扩展，都表示异步任务，那Guava的异步任务从何而来？</p>\n<p>ListenableFuture的异步任务异步任务的实例主要是通过向线程池提交Callable任务的方式获取，这里的线程池是Guava的不是Java的，另外FutureTask的异步任务实例是直接将Callable传入构造器。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">ExecutorService</span> <span class=\"variable\">jPool</span> <span class=\"operator\">=</span> Executors.newFixedThreadPool(<span class=\"number\">10</span>);</span><br><span class=\"line\"><span class=\"type\">ListeningExecutorService</span> <span class=\"variable\">gPool</span> <span class=\"operator\">=</span> MoreExecutors.listeningDecorator(jPool);</span><br></pre></td></tr></table></figure>\n\n<p>流程：</p>\n<ol>\n<li>创建Callable异步任务</li>\n<li>创建Guava线程池</li>\n<li>提交Callable获取ListenableFuture异步任务实例</li>\n<li>创建FutureCallback，绑定ListenableFuture</li>\n</ol>\n<p>泡茶实例</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> org.example;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.google.common.util.concurrent.*;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.annotation.Nullable;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.Callable;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.Executor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.ExecutorService;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.Executors;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">GuavaFutureDemo</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">SLEEP_GAP</span> <span class=\"operator\">=</span> <span class=\"number\">5000</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title function_\">getCurThreadName</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Thread.currentThread().getName();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">HotWaterJob</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Callable</span>&lt;Boolean&gt; &#123;</span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> Boolean <span class=\"title function_\">call</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;洗好茶壶&quot;</span>);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;灌水&quot;</span>);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;放在火上&quot;</span>);</span><br><span class=\"line\">                Thread.sleep(SLEEP_GAP);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;水烧开了&quot;</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;发送异常被中断&quot;</span>);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;运行结束&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WashJon</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Callable</span>&lt;Boolean&gt; &#123;</span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> Boolean <span class=\"title function_\">call</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;洗茶壶&quot;</span>);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;洗茶杯&quot;</span>);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;拿茶叶&quot;</span>);</span><br><span class=\"line\">                Thread.sleep(SLEEP_GAP);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;洗完了&quot;</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;发送异常被中断&quot;</span>);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;运行结束&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MainJob</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Runnable</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">boolean</span> <span class=\"variable\">waterOk</span> <span class=\"operator\">=</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        <span class=\"type\">boolean</span> <span class=\"variable\">cupOk</span> <span class=\"operator\">=</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">gap</span> <span class=\"operator\">=</span> SLEEP_GAP / <span class=\"number\">10</span>;</span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span>  <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">while</span> (<span class=\"literal\">true</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    Thread.sleep(gap);</span><br><span class=\"line\">                    System.out.println(<span class=\"string\">&quot;读书中&quot;</span>);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                    System.out.println(getCurThreadName() + <span class=\"string\">&quot;中断&quot;</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (waterOk &amp;&amp; cupOk) &#123;</span><br><span class=\"line\">                    drinkTea(waterOk, cupOk);</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">public</span>  <span class=\"keyword\">void</span> <span class=\"title function_\">drinkTea</span><span class=\"params\">(<span class=\"type\">boolean</span> waterOK, <span class=\"type\">boolean</span> cupOk)</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (waterOK &amp;&amp; cupOk) &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;泡茶喝&quot;</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (!waterOK) &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;烧水失败，没有茶喝了&quot;</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (!cupOk) &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;杯子洗不了，没有茶喝了&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">MainJob</span>  <span class=\"variable\">mainJob</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">MainJob</span>();</span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">mainThread</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(mainJob);</span><br><span class=\"line\">        mainThread.setName(<span class=\"string\">&quot;主线程&quot;</span>);</span><br><span class=\"line\">        mainThread.start();</span><br><span class=\"line\"></span><br><span class=\"line\">        Callable&lt;Boolean&gt; hotJob = <span class=\"keyword\">new</span> <span class=\"title class_\">HotWaterJob</span>();</span><br><span class=\"line\">        Callable&lt;Boolean&gt; washJob = <span class=\"keyword\">new</span> <span class=\"title class_\">WashJon</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">ExecutorService</span> <span class=\"variable\">jPool</span> <span class=\"operator\">=</span> Executors.newFixedThreadPool(<span class=\"number\">10</span>);</span><br><span class=\"line\">        <span class=\"type\">ListeningExecutorService</span> <span class=\"variable\">gPool</span> <span class=\"operator\">=</span> MoreExecutors.listeningDecorator(jPool);</span><br><span class=\"line\"></span><br><span class=\"line\">        ListenableFuture&lt;Boolean&gt; hotFuture = gPool.submit(hotJob);</span><br><span class=\"line\">        Futures.addCallback(hotFuture, <span class=\"keyword\">new</span> <span class=\"title class_\">FutureCallback</span>&lt;Boolean&gt;() &#123;</span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">onSuccess</span><span class=\"params\">(Boolean r)</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (r) &#123;</span><br><span class=\"line\">                    mainJob.waterOk = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">onFailure</span><span class=\"params\">(Throwable throwable)</span> &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;烧水失败&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        ListenableFuture&lt;Boolean&gt; washFuture = gPool.submit(washJob);</span><br><span class=\"line\">        Futures.addCallback(hotFuture, <span class=\"keyword\">new</span> <span class=\"title class_\">FutureCallback</span>&lt;Boolean&gt;() &#123;</span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">onSuccess</span><span class=\"params\">(Boolean r)</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (r) &#123;</span><br><span class=\"line\">                    mainJob.cupOk = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">onFailure</span><span class=\"params\">(Throwable throwable)</span> &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;杯子洗不了&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>Guava非阻塞的原因与理解</p>\n<h2 id=\"Netty的异步回调模式\"><a href=\"#Netty的异步回调模式\" class=\"headerlink\" title=\"Netty的异步回调模式\"></a>Netty的异步回调模式</h2><p>在netty源码中大量使用了异步回调模式，在netty业务开发层面，netty应用的是handle处理器中的业务处理代码也是异步的。所以了解netty的异步回调是十分重要的。</p>\n<p>Netty扩展了Java Future的异步任务：</p>\n<ul>\n<li>继承Java Future接口并增强，使其方法可以非阻塞。</li>\n<li>引入GeneriFutureListener，用于表示异步任务完成的监控器，与Guava的FutureCallback不同，Netty使用的是监控器模式，异步任务完成后回调逻辑抽象成了Lisener监听器接口。可以将GenericFutureListener监听器加入Netty的异步任务Future中，实现对异步任务执行状态的事件监听。</li>\n</ul>\n<p>在异步非阻塞回调思路上和Guava是一致的。</p>\n<h3 id=\"GenericFutureListener接口\"><a href=\"#GenericFutureListener接口\" class=\"headerlink\" title=\"GenericFutureListener接口\"></a>GenericFutureListener接口</h3><p>该接口位于io.netty.util.concurrent</p>\n<p>直接上源码</p>\n<p>GenericFutureListener拥有一个回调方法operationComplete,回调代码写在这。</p>\n<p>而父接口EventListner是空接口，没有任何方法，起标识作用。</p>\n<h3 id=\"Netty-Future-接口\"><a href=\"#Netty-Future-接口\" class=\"headerlink\" title=\"Netty Future 接口\"></a>Netty Future 接口</h3><p>netty对Future进行了扩展，对执行的过程进行监控，对异步回调完成事件进行监听。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> </span><br></pre></td></tr></table></figure>\n\n<p>Future接口一般不会直接使用，而是会使用子接口。Netty有一系列的子接口，代表不同类型的异步任务如ChannelFuture接口。</p>\n<p>ChannelFuture表示通道IO操作的异步任务，如果在通道的异步IO操作完成后执行回调就需要ChannelFuture</p>\n"},{"title":"Spring自动装配原理","date":"2022-07-31T16:00:00.000Z","_content":"\n# 一句话解释\n\n提到自动装配原理，就会提到Springboot的注解@SpringBootApplication，这个注解由@SpringbootConfiguration 和 @EnableAutoConfiguration以及@ComponentScan最重要的注解组成。其中@EnableAutoConfiguration注解通过读取META-INF/spring.factories文件中的信息，以读取一些基础配置，比如redis、kafka。@ComponentScan注解则是用来扫描应用程序中的配置类，比如自己写的bean的配置类。@SpringbootConfiguration，功能与@Configuration差不多，其加在启动类上的作用是，将启动类也标志为配置类，在启动时，将自己也扫描进去。\n\n\n\n# 详细的解释\n\n@SpringBootApplication的其中3个重要注解：\n\n- @SpringBootConfiguration 标识是一个配置类\n- @EnableAutoConfiguration 启用Spring Boot 的自动配置机制\n- @ComponentScan 扫描应用程序中的配置类\n\n## 对注解 @EnableAutoConfiguration 的解释\n\n看了几片八股文，说一说自己的理解吧\n\n![image-20220801230956201](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/image-20220801230956201.png)\n\n@EnabkeAutoConfiguration中有一个重要的注解--@Import ，import的内容按照字面意思则是自动配置导入选择器。\n\n其中有个process（）方法，方法中调用getAutoConfigurationEntry方法\n\n![image-20220801232327905](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/image-20220801232327905.png)\n\n再进入其中，其中调用了getCandidateConfigurations方法\n\n![image-20220801232456680](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/image-20220801232456680.png)\n\n再进入getCandidateConfigurations方法，方法中调用了SpringFactoriesLoader的loadFactoryNames方法\n\n![image-20220801232543951](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/image-20220801232543951.png)\n\n再进入loadFactoryNames其中，调用了loadSpringFactories方法\n\n![image-20220801232943516](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/image-20220801232943516.png)\n\n最后会发现，这里加载了META-INF/spring.factories中的配置信息。\n\n![image-20220801233037132](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/image-20220801233037132.png)\n\n我们进入spring-boot-autoconfigure包中的META-INF/spring.factories，能够看到类似于这样的一些配置类信息。\n\n![image-20220801233331015](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/image-20220801233331015.png)\n\n# 总结\n\n用官方的话来说，Springboot的自动配置，就是尝试根据用户添加的jar依赖项配置您的Spring应用程序。\n\n要是想对自动配置的理解更深的话，应该去体会一下Spring是如何配置的。\n\n# 参考的文章\n\n[SpringBoot系列--自动装配原理1](https://learnku.com/articles/56208)\n\n[Spring官方文档](https://docs.spring.io/spring-boot/docs/2.3.12.RELEASE/reference/html/using-spring-boot.html#using-boot-auto-configuration)\n\n[自动装配脑图](https://www.processon.com/view/link/5efc4ffa6376891e81f3895d)\n\n# Tips\n\ncreate：2022/8/1 内容比较简陋，将会在后期深入学习后继续补充和更新相关内容。","source":"_posts/spring/Spring自动装配原理.md","raw":"---\ntitle: Spring自动装配原理\ndate: 2022-08-01 00:00:00\ntags: Springboot\ncategories: Springboot\n---\n\n# 一句话解释\n\n提到自动装配原理，就会提到Springboot的注解@SpringBootApplication，这个注解由@SpringbootConfiguration 和 @EnableAutoConfiguration以及@ComponentScan最重要的注解组成。其中@EnableAutoConfiguration注解通过读取META-INF/spring.factories文件中的信息，以读取一些基础配置，比如redis、kafka。@ComponentScan注解则是用来扫描应用程序中的配置类，比如自己写的bean的配置类。@SpringbootConfiguration，功能与@Configuration差不多，其加在启动类上的作用是，将启动类也标志为配置类，在启动时，将自己也扫描进去。\n\n\n\n# 详细的解释\n\n@SpringBootApplication的其中3个重要注解：\n\n- @SpringBootConfiguration 标识是一个配置类\n- @EnableAutoConfiguration 启用Spring Boot 的自动配置机制\n- @ComponentScan 扫描应用程序中的配置类\n\n## 对注解 @EnableAutoConfiguration 的解释\n\n看了几片八股文，说一说自己的理解吧\n\n![image-20220801230956201](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/image-20220801230956201.png)\n\n@EnabkeAutoConfiguration中有一个重要的注解--@Import ，import的内容按照字面意思则是自动配置导入选择器。\n\n其中有个process（）方法，方法中调用getAutoConfigurationEntry方法\n\n![image-20220801232327905](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/image-20220801232327905.png)\n\n再进入其中，其中调用了getCandidateConfigurations方法\n\n![image-20220801232456680](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/image-20220801232456680.png)\n\n再进入getCandidateConfigurations方法，方法中调用了SpringFactoriesLoader的loadFactoryNames方法\n\n![image-20220801232543951](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/image-20220801232543951.png)\n\n再进入loadFactoryNames其中，调用了loadSpringFactories方法\n\n![image-20220801232943516](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/image-20220801232943516.png)\n\n最后会发现，这里加载了META-INF/spring.factories中的配置信息。\n\n![image-20220801233037132](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/image-20220801233037132.png)\n\n我们进入spring-boot-autoconfigure包中的META-INF/spring.factories，能够看到类似于这样的一些配置类信息。\n\n![image-20220801233331015](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/image-20220801233331015.png)\n\n# 总结\n\n用官方的话来说，Springboot的自动配置，就是尝试根据用户添加的jar依赖项配置您的Spring应用程序。\n\n要是想对自动配置的理解更深的话，应该去体会一下Spring是如何配置的。\n\n# 参考的文章\n\n[SpringBoot系列--自动装配原理1](https://learnku.com/articles/56208)\n\n[Spring官方文档](https://docs.spring.io/spring-boot/docs/2.3.12.RELEASE/reference/html/using-spring-boot.html#using-boot-auto-configuration)\n\n[自动装配脑图](https://www.processon.com/view/link/5efc4ffa6376891e81f3895d)\n\n# Tips\n\ncreate：2022/8/1 内容比较简陋，将会在后期深入学习后继续补充和更新相关内容。","slug":"spring/Spring自动装配原理","published":1,"updated":"2022-08-02T01:03:20.162Z","_id":"cl6bh3m3q0000cwvc7urt8sp3","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"一句话解释\"><a href=\"#一句话解释\" class=\"headerlink\" title=\"一句话解释\"></a>一句话解释</h1><p>提到自动装配原理，就会提到Springboot的注解@SpringBootApplication，这个注解由@SpringbootConfiguration 和 @EnableAutoConfiguration以及@ComponentScan最重要的注解组成。其中@EnableAutoConfiguration注解通过读取META-INF&#x2F;spring.factories文件中的信息，以读取一些基础配置，比如redis、kafka。@ComponentScan注解则是用来扫描应用程序中的配置类，比如自己写的bean的配置类。@SpringbootConfiguration，功能与@Configuration差不多，其加在启动类上的作用是，将启动类也标志为配置类，在启动时，将自己也扫描进去。</p>\n<h1 id=\"详细的解释\"><a href=\"#详细的解释\" class=\"headerlink\" title=\"详细的解释\"></a>详细的解释</h1><p>@SpringBootApplication的其中3个重要注解：</p>\n<ul>\n<li>@SpringBootConfiguration 标识是一个配置类</li>\n<li>@EnableAutoConfiguration 启用Spring Boot 的自动配置机制</li>\n<li>@ComponentScan 扫描应用程序中的配置类</li>\n</ul>\n<div class=\"story post-story\"><h2 id=\"对注解-EnableAutoConfiguration-的解释\"><a href=\"#对注解-EnableAutoConfiguration-的解释\" class=\"headerlink\" title=\"对注解 @EnableAutoConfiguration 的解释\"></a>对注解 @EnableAutoConfiguration 的解释</h2><p>看了几片八股文，说一说自己的理解吧</p>\n<p><img src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/image-20220801230956201.png\" class=\"lazyload\" data-srcset=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/image-20220801230956201.png\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"image-20220801230956201\"></p>\n<p>@EnabkeAutoConfiguration中有一个重要的注解--@Import ，import的内容按照字面意思则是自动配置导入选择器。</p>\n<p>其中有个process（）方法，方法中调用getAutoConfigurationEntry方法</p>\n<p><img src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/image-20220801232327905.png\" class=\"lazyload\" data-srcset=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/image-20220801232327905.png\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"image-20220801232327905\"></p>\n<p>再进入其中，其中调用了getCandidateConfigurations方法</p>\n<p><img src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/image-20220801232456680.png\" class=\"lazyload\" data-srcset=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/image-20220801232456680.png\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"image-20220801232456680\"></p>\n<p>再进入getCandidateConfigurations方法，方法中调用了SpringFactoriesLoader的loadFactoryNames方法</p>\n<p><img src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/image-20220801232543951.png\" class=\"lazyload\" data-srcset=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/image-20220801232543951.png\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"image-20220801232543951\"></p>\n<p>再进入loadFactoryNames其中，调用了loadSpringFactories方法</p>\n<p><img src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/image-20220801232943516.png\" class=\"lazyload\" data-srcset=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/image-20220801232943516.png\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"image-20220801232943516\"></p>\n<p>最后会发现，这里加载了META-INF&#x2F;spring.factories中的配置信息。</p>\n<p><img src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/image-20220801233037132.png\" class=\"lazyload\" data-srcset=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/image-20220801233037132.png\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"image-20220801233037132\"></p>\n<p>我们进入spring-boot-autoconfigure包中的META-INF&#x2F;spring.factories，能够看到类似于这样的一些配置类信息。</p>\n<p><img src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/image-20220801233331015.png\" class=\"lazyload\" data-srcset=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/image-20220801233331015.png\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"image-20220801233331015\"></p>\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p>用官方的话来说，Springboot的自动配置，就是尝试根据用户添加的jar依赖项配置您的Spring应用程序。</p>\n<p>要是想对自动配置的理解更深的话，应该去体会一下Spring是如何配置的。</p>\n<h1 id=\"参考的文章\"><a href=\"#参考的文章\" class=\"headerlink\" title=\"参考的文章\"></a>参考的文章</h1><p><a href=\"https://learnku.com/articles/56208\">SpringBoot系列–自动装配原理1</a></p>\n<p><a href=\"https://docs.spring.io/spring-boot/docs/2.3.12.RELEASE/reference/html/using-spring-boot.html#using-boot-auto-configuration\">Spring官方文档</a></p>\n<p><a href=\"https://www.processon.com/view/link/5efc4ffa6376891e81f3895d\">自动装配脑图</a></p>\n<h1 id=\"Tips\"><a href=\"#Tips\" class=\"headerlink\" title=\"Tips\"></a>Tips</h1><p>create：2022&#x2F;8&#x2F;1 内容比较简陋，将会在后期深入学习后继续补充和更新相关内容。</p>\n\n</div>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"一句话解释\"><a href=\"#一句话解释\" class=\"headerlink\" title=\"一句话解释\"></a>一句话解释</h1><p>提到自动装配原理，就会提到Springboot的注解@SpringBootApplication，这个注解由@SpringbootConfiguration 和 @EnableAutoConfiguration以及@ComponentScan最重要的注解组成。其中@EnableAutoConfiguration注解通过读取META-INF&#x2F;spring.factories文件中的信息，以读取一些基础配置，比如redis、kafka。@ComponentScan注解则是用来扫描应用程序中的配置类，比如自己写的bean的配置类。@SpringbootConfiguration，功能与@Configuration差不多，其加在启动类上的作用是，将启动类也标志为配置类，在启动时，将自己也扫描进去。</p>\n<h1 id=\"详细的解释\"><a href=\"#详细的解释\" class=\"headerlink\" title=\"详细的解释\"></a>详细的解释</h1><p>@SpringBootApplication的其中3个重要注解：</p>\n<ul>\n<li>@SpringBootConfiguration 标识是一个配置类</li>\n<li>@EnableAutoConfiguration 启用Spring Boot 的自动配置机制</li>\n<li>@ComponentScan 扫描应用程序中的配置类</li>\n</ul>\n<h2 id=\"对注解-EnableAutoConfiguration-的解释\"><a href=\"#对注解-EnableAutoConfiguration-的解释\" class=\"headerlink\" title=\"对注解 @EnableAutoConfiguration 的解释\"></a>对注解 @EnableAutoConfiguration 的解释</h2><p>看了几片八股文，说一说自己的理解吧</p>\n<p><img src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/image-20220801230956201.png\" alt=\"image-20220801230956201\"></p>\n<p>@EnabkeAutoConfiguration中有一个重要的注解--@Import ，import的内容按照字面意思则是自动配置导入选择器。</p>\n<p>其中有个process（）方法，方法中调用getAutoConfigurationEntry方法</p>\n<p><img src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/image-20220801232327905.png\" alt=\"image-20220801232327905\"></p>\n<p>再进入其中，其中调用了getCandidateConfigurations方法</p>\n<p><img src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/image-20220801232456680.png\" alt=\"image-20220801232456680\"></p>\n<p>再进入getCandidateConfigurations方法，方法中调用了SpringFactoriesLoader的loadFactoryNames方法</p>\n<p><img src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/image-20220801232543951.png\" alt=\"image-20220801232543951\"></p>\n<p>再进入loadFactoryNames其中，调用了loadSpringFactories方法</p>\n<p><img src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/image-20220801232943516.png\" alt=\"image-20220801232943516\"></p>\n<p>最后会发现，这里加载了META-INF&#x2F;spring.factories中的配置信息。</p>\n<p><img src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/image-20220801233037132.png\" alt=\"image-20220801233037132\"></p>\n<p>我们进入spring-boot-autoconfigure包中的META-INF&#x2F;spring.factories，能够看到类似于这样的一些配置类信息。</p>\n<p><img src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/image-20220801233331015.png\" alt=\"image-20220801233331015\"></p>\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p>用官方的话来说，Springboot的自动配置，就是尝试根据用户添加的jar依赖项配置您的Spring应用程序。</p>\n<p>要是想对自动配置的理解更深的话，应该去体会一下Spring是如何配置的。</p>\n<h1 id=\"参考的文章\"><a href=\"#参考的文章\" class=\"headerlink\" title=\"参考的文章\"></a>参考的文章</h1><p><a href=\"https://learnku.com/articles/56208\">SpringBoot系列–自动装配原理1</a></p>\n<p><a href=\"https://docs.spring.io/spring-boot/docs/2.3.12.RELEASE/reference/html/using-spring-boot.html#using-boot-auto-configuration\">Spring官方文档</a></p>\n<p><a href=\"https://www.processon.com/view/link/5efc4ffa6376891e81f3895d\">自动装配脑图</a></p>\n<h1 id=\"Tips\"><a href=\"#Tips\" class=\"headerlink\" title=\"Tips\"></a>Tips</h1><p>create：2022&#x2F;8&#x2F;1 内容比较简陋，将会在后期深入学习后继续补充和更新相关内容。</p>\n"},{"title":"硬件结构","date":"2020-07-04T19:00:00.000Z","_content":"\n# 1.1 CPU是如何执行程序的？\n\n有这么几个问题：\n\n- a = 1 + 2 这条指令是怎么被CPU运行起来的？\n- 软件32位和64位的区别？32位操作系统可以运行在64位系统上吗？64位可以运行在32位上吗？原因又是什么？\n- CPU分为32位和64位，64位优势在哪呢，64位性能一定比32位好吗？\n\n\n\n本章大纲\n\n- 图灵机的工作方式\n- 冯诺依曼模型\n- 线路位宽与CPU位宽\n- 程序执行的基本过程\n- a = 1 + 2 执行具体过程\n\n## 图灵机的工作方式\n\n当我们不太清楚一个事物为什么是这样子的时候，我们应该去看看它的历史。它在时间潮流中的变化决定它现在出现在你面前的模样。\n\n图灵机是很早就提出的抽象计算模型，下面是它的大概模样\n\n![img](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1657878607869-80563d9d-6634-4abe-825b-11a0f9d7b0af.png)\n\n图灵机的基本组成如下：\n\n- 有一条纸带，由一个一个的格子组成，纸带好比内存，格子中的数据就像内存中的数据。\n- 有一个读写头，读写头可以读取纸带上的任意格子的字符\n- 头上有一些部件，比如存储单元、控制单元、以及运算单元。分别用于存储数据，识别字符以及控制程序流程，执行运算指令\n\n## 冯诺依曼模型\n\n冯诺依曼遵循图灵机的设计提出了在现在依旧符合的冯诺依曼模型\n\n定义了计算机基本机构：**运算器、控制器、存储器、输入、输出设备**。这五个部分被称为**冯诺依曼模型**\n\n![img](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1657879160879-c965c3d7-a5fe-4a79-bb24-0099d7d72971.svg)\n\n运算器、控制器是在中央处理器里的，存储器就是我们常见的内存，输入输出设备就是计算机外接的设备。\n\n存储器和输入输出设备要是与中央处理器打交道的话，离不开总线。\n\n\n\n![img](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1657879168530-48d6f832-9a09-4454-8f88-772b04d45b3a.webp)\n\n下面介绍 内存、中央处理器、总线、输入输出设备\n\n### 内存\n\n内存这一个存储区域是线性的。存储数据的基本单位是字节（byte），1字节==8位（bit）。每一个字节对应一个内存地址。\n\n内存地址是从0开始的，自增，最后一个地址为总大小 - 1，和数组差不多性质。所以内存读写任何一个数据的速度是一样的\n\n### 中央处理器\n\n即CPU，有32位和64位，区别在于一次能计算多少字节数据。\n\n- 32位 -- 4个字节\n- 64位 -- 8个字节\n\n这么设计是为了计算更大的数值。\n\nCPU内部还有常见的如寄存器、控制单元、和逻辑运算单元。\n\n为什么已经有存储器内存存储了，还需要寄存器来存储？\n\n因为内存离CPU远，计算速度比较慢\n\n常见的寄存器种类：\n\n- 通用寄存器：用来存放需要进行运算的数据\n- 程序计数器：用来存放CPU要执行的下一条指令的**内存地址**\n- 指令寄存器：用来存放程序计数器存放的指令，指令本身\n\n### 总线\n\nCPU和内存以及其他设备的通信\n\n分类：\n\n- 地址总线：用于CPU要操作的内存地址\n- 数据总线：用于读写内存的数据\n- 控制总线：用于发送和接受信号，比如中断、设备复位等信号\n\n读写内存时\n\n- 地址总线指定内存地址\n- 控制总线控制读写命令\n- 数据总线传输数据\n\n### 输出输出设备\n\n外界与CPU交互，用到了控制总线\n\n------\n\n## 线路位宽与CPU位宽\n\n数据通过线路传输是通过操作电压完成，低电压是0，高电压是1。\n\n一位一位的传输就是串行方式。想一次多传输就应该增加线路。\n\n为了避免低效率的串行传输方式，线路的位宽最好一次就能访问到所有的内存地址。\n\n\n\n**CPU要操作内存地址就需要地址总线：**\n\n- 如果地址总线只有一根，能够表示的只有0 和 1所以能够操作的内存地址最大为2，不是同时操作的地址。\n- 两条就是 00 01 10 11 四个地址，\n\n即2 ^ 根数\n\n那么要操作4g内存，就需要32条总线，2 ^ 32 = 4 G\n\n\n\n上面的是线路位宽，下面是CPU位宽\n\n\n\nCPU的位宽不应该小于线路位宽，因为32位的CPU一次只能操作32位的地址总线和数据总线\n\n### 32位如何计算64位大小的数字？\n\n拆分成高低位，然后先算地位，再算进位，再算高位。\n\n而64位CPU就能一次性计算。\n\n所以如果32位和64位一起计算32位可能没什么差别，但是当计算64位时64位才会有优势。\n\n另外，32位CPU最大只能操作4GB内存条，装了8g也没有用。64位则是2^64\n\n## 程序执行的基本过程\n\n![img](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1658114475515-c4d516d0-05b1-437a-a853-5320156fd4d6.png)\n\n- 第一步，CPU根据**程序计数器**获取到**存储指令的内存地址**，然后控制单元操作**地址总线**访问内存地址，通知内存准备数据，准备好数据后，通过**数据总线**将指令内容传给CPU，CPU收到后存入到**指令寄存器**\n- CPU分析**指令寄存器**中的指令，确定**指令的类型和参数**，如果是**计算**类型的指令，就把指令交给**逻辑运算单元**运算，如果是**存储**类型的指令，就交给**控制单元**执行。\n- 第三步**，CPU执行完指令后，程序计数器自增**，表示指向下一条指令，大小由CPU位宽决定，比如**32位CPU，一条指令大小就是4字节，需要4个地址存放，程序计数器就自增4**\n\n这个往复过程就是CPU的指令周期\n\n\n\n## a = 1 + 2执行具体过程\n\n首先CPU是不认识 a =  1 + 2的，所以要想跑起程序就需要把整个程序翻译成汇编语言，整个过程就叫汇编。\n\n\n\n针对汇编代码，需要汇编器翻译成机器码，由01组成，这个就是计算机指令，CPU能够认识。\n\n\n\n### a = 1 + 2 在 32位CPU的执行过程：\n\n程序编译过程中，编译器通过分析代码，能够发现1 和 2 是数据，内存会有个叫数据段的区域来存放这些数据。\n\n如图\n\n- 数据 1 被存放到 0x100 位置；\n- 数据 2 被存放到 0x104 位置；\n\n![img](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1658115884206-69b9c67f-9703-4f7d-85ce-b0aa3e6424a5.png)\n\n存放指令的地方叫正文段\n\n存放数据的地方叫数据段\n\n编译器会把a = 1 + 2 翻译成4条指令存放到正文段。\n\n- 0x200 load 将数据1 装入 R0寄存器\n- 0x204 load 将数据2 装入 R1寄存器\n- 0x208 add 将R0 和 R1 相机，并把结果放到寄存器R2\n- 0x20c store 将寄存器R2的数据存回0x108地址就是变量a的地址\n\n再提一句就是，32位CPU一条指令4个字节，也就是4个内存地址\n\n\n\n## 指令\n\n指令其实指的是机器码，但是为了方便理解，这里说的是汇编代码。CPU通过解析机器码来知道指令的内容。\n\n不同的CPU有不同的指令集，也对应不同的机器码，下面是最简单的MIPS指令集，来了解机器码是如何生成的。\n\nMIPS 的指令是一个 32 位的整数，高 6 位代表着操作码，表示这条指令是一条什么样的指令，剩下的 26 位不同指令类型所表示的内容也就不相同，主要有三种类型R、I 和 J。\n\n![img](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1658116311398-3ca455e0-d06f-4008-829d-7c88b2a1a32c.png)\n\n- R指令，用在算术和逻辑操作，里面有读取和写入数据的寄存器地址。如果是逻辑位移后面还有唯一操作的位移量，最后的功能码则是前面的操作码不够的时候，扩展操作码来表示对应的具体指令的。\n- I指令，用在数据传输、条件分支等。没有位移量、功能码、和第三个寄存器。三部分合并成一个地址值或一个常数\n- J指令用于跳转，后面26位全表示跳转后的地址 \n\n下面举例：add指令将寄存器R0和R1的数据相加，并把结果放入到R2，翻译成机器码\n\n![img](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1658135226787-eaf98ecc-c75b-46c2-bb1e-81b91a7f1a2c.png)\n\n加和运算add指令属于R指令类型\n\n\n\n编译器在编译程序的时候会构造指令，CPU执行时会解析指令。指令的编码与解码。\n\n在此基础上，现代大多是CPU都是使用**流水线**的方式来执行指令。\n\n![img](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1658135540524-9416d824-4a33-46cd-b57b-bff21e82587b.png)\n\n四个阶段的具体含义？\n\n1. 通过程序计数器读取响应内存地址的指令 Fetch 取得指令\n2. 对指令进行解码 Decode 指令译码\n3. 执行指令 Execution 执行指令\n4. 将计算结果放入寄存器或者内存，Store 数据回写\n\n\n\n上面4个步骤叫做指令周期。\n\n不同阶段由不同计算机组件完成：\n\n![img](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1658135759860-dbf333db-a228-473b-8d15-fabf1e2486da.png)\n\n- 指令都是存储在存储器中，通过程序计数器和指令寄存器取指令的过程都是由控制器操作的。\n- 译码--控制器\n- 执行时，算术由算术逻辑单元负责，跳转啥的由控制器负责\n\n### 指令的类型\n\n从功能出发，和上面不要混肴，上面有一个是指令集，是具体的体现：\n\n- 数据传输类型 store/load 寄存器与内存 mov 内存与内存\n- 运算类型 加减乘除\n- 跳转类型 if-else swit-case 函数调用\n- 信号类型 trap 中断\n- 闲置类型 nop CPU空转\n\n\n\n### 指令的执行速度\n\nCPU的硬件参数GHZ ，1GHZ表示1秒能够产生1G次脉冲信\n\n号，每一次脉冲信号高低电平的转换就是一个时钟周期。\n\nCPU在一个时钟周期内，只能完成一次最基本的动作，时钟频率越高时钟周期越短，工作速度越快。\n\n**一个时钟周期能够执行一条指令吗？**\n\n不能。大多数指令都不能，而且不同的指令需要的时钟周期也不一样。乘法比加法多。\n\n\n\n**如何让程序跑的更快？**\n\n消耗的CPU时间少，说明程序是快的，对于程序的CPU执行时间可以拆解成CPU时钟周期数和时钟周期时间的乘积\n\n![img](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1658152623983-d07caff1-d575-4e7a-b987-52e22952aac7.png)\n\n时钟周期时间即主频。主频越高说明运行速度越快。比如2.4GHZCPU，时钟周期时间就是 1/2.4G\n\n但是主频一般来说是相对固定的，所以我们应该去减少CPU时钟周期数。\n\nCPU时钟周期数 = 指令数 * 每天指令的平均时钟周期数CPI\n\n那对于如何让程序跑的更快这个问题的答案就出来了？\n\n- 指令数，可以靠编译器，同样的代码在不同的编译器中编译出来的指令不一样\n- 每条指令的平均时钟周期数CPI：大多数CPU已使用**流水线**技术，让一条指令所需要的CPU时钟周期数尽可能的少。\n- 时钟周期时间：超频技术，打开超频意味着把CPU内部时钟调快了。代价是热量和崩溃。\n\n很多厂商为了跑分而跑分，基本都是在这三个方面入手的哦，特别是超频这一块\n\n\n\n## 总结\n\n# 1.2 磁盘比内存缓慢几万倍？\n\n1\n\n2","source":"_posts/操作系统/硬件结构.md","raw":"---\ntitle: 硬件结构\ndate: 2020-07-05 03:00:00\ntags: 硬件结构\ncategories: 操作系统\n---\n\n# 1.1 CPU是如何执行程序的？\n\n有这么几个问题：\n\n- a = 1 + 2 这条指令是怎么被CPU运行起来的？\n- 软件32位和64位的区别？32位操作系统可以运行在64位系统上吗？64位可以运行在32位上吗？原因又是什么？\n- CPU分为32位和64位，64位优势在哪呢，64位性能一定比32位好吗？\n\n\n\n本章大纲\n\n- 图灵机的工作方式\n- 冯诺依曼模型\n- 线路位宽与CPU位宽\n- 程序执行的基本过程\n- a = 1 + 2 执行具体过程\n\n## 图灵机的工作方式\n\n当我们不太清楚一个事物为什么是这样子的时候，我们应该去看看它的历史。它在时间潮流中的变化决定它现在出现在你面前的模样。\n\n图灵机是很早就提出的抽象计算模型，下面是它的大概模样\n\n![img](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1657878607869-80563d9d-6634-4abe-825b-11a0f9d7b0af.png)\n\n图灵机的基本组成如下：\n\n- 有一条纸带，由一个一个的格子组成，纸带好比内存，格子中的数据就像内存中的数据。\n- 有一个读写头，读写头可以读取纸带上的任意格子的字符\n- 头上有一些部件，比如存储单元、控制单元、以及运算单元。分别用于存储数据，识别字符以及控制程序流程，执行运算指令\n\n## 冯诺依曼模型\n\n冯诺依曼遵循图灵机的设计提出了在现在依旧符合的冯诺依曼模型\n\n定义了计算机基本机构：**运算器、控制器、存储器、输入、输出设备**。这五个部分被称为**冯诺依曼模型**\n\n![img](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1657879160879-c965c3d7-a5fe-4a79-bb24-0099d7d72971.svg)\n\n运算器、控制器是在中央处理器里的，存储器就是我们常见的内存，输入输出设备就是计算机外接的设备。\n\n存储器和输入输出设备要是与中央处理器打交道的话，离不开总线。\n\n\n\n![img](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1657879168530-48d6f832-9a09-4454-8f88-772b04d45b3a.webp)\n\n下面介绍 内存、中央处理器、总线、输入输出设备\n\n### 内存\n\n内存这一个存储区域是线性的。存储数据的基本单位是字节（byte），1字节==8位（bit）。每一个字节对应一个内存地址。\n\n内存地址是从0开始的，自增，最后一个地址为总大小 - 1，和数组差不多性质。所以内存读写任何一个数据的速度是一样的\n\n### 中央处理器\n\n即CPU，有32位和64位，区别在于一次能计算多少字节数据。\n\n- 32位 -- 4个字节\n- 64位 -- 8个字节\n\n这么设计是为了计算更大的数值。\n\nCPU内部还有常见的如寄存器、控制单元、和逻辑运算单元。\n\n为什么已经有存储器内存存储了，还需要寄存器来存储？\n\n因为内存离CPU远，计算速度比较慢\n\n常见的寄存器种类：\n\n- 通用寄存器：用来存放需要进行运算的数据\n- 程序计数器：用来存放CPU要执行的下一条指令的**内存地址**\n- 指令寄存器：用来存放程序计数器存放的指令，指令本身\n\n### 总线\n\nCPU和内存以及其他设备的通信\n\n分类：\n\n- 地址总线：用于CPU要操作的内存地址\n- 数据总线：用于读写内存的数据\n- 控制总线：用于发送和接受信号，比如中断、设备复位等信号\n\n读写内存时\n\n- 地址总线指定内存地址\n- 控制总线控制读写命令\n- 数据总线传输数据\n\n### 输出输出设备\n\n外界与CPU交互，用到了控制总线\n\n------\n\n## 线路位宽与CPU位宽\n\n数据通过线路传输是通过操作电压完成，低电压是0，高电压是1。\n\n一位一位的传输就是串行方式。想一次多传输就应该增加线路。\n\n为了避免低效率的串行传输方式，线路的位宽最好一次就能访问到所有的内存地址。\n\n\n\n**CPU要操作内存地址就需要地址总线：**\n\n- 如果地址总线只有一根，能够表示的只有0 和 1所以能够操作的内存地址最大为2，不是同时操作的地址。\n- 两条就是 00 01 10 11 四个地址，\n\n即2 ^ 根数\n\n那么要操作4g内存，就需要32条总线，2 ^ 32 = 4 G\n\n\n\n上面的是线路位宽，下面是CPU位宽\n\n\n\nCPU的位宽不应该小于线路位宽，因为32位的CPU一次只能操作32位的地址总线和数据总线\n\n### 32位如何计算64位大小的数字？\n\n拆分成高低位，然后先算地位，再算进位，再算高位。\n\n而64位CPU就能一次性计算。\n\n所以如果32位和64位一起计算32位可能没什么差别，但是当计算64位时64位才会有优势。\n\n另外，32位CPU最大只能操作4GB内存条，装了8g也没有用。64位则是2^64\n\n## 程序执行的基本过程\n\n![img](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1658114475515-c4d516d0-05b1-437a-a853-5320156fd4d6.png)\n\n- 第一步，CPU根据**程序计数器**获取到**存储指令的内存地址**，然后控制单元操作**地址总线**访问内存地址，通知内存准备数据，准备好数据后，通过**数据总线**将指令内容传给CPU，CPU收到后存入到**指令寄存器**\n- CPU分析**指令寄存器**中的指令，确定**指令的类型和参数**，如果是**计算**类型的指令，就把指令交给**逻辑运算单元**运算，如果是**存储**类型的指令，就交给**控制单元**执行。\n- 第三步**，CPU执行完指令后，程序计数器自增**，表示指向下一条指令，大小由CPU位宽决定，比如**32位CPU，一条指令大小就是4字节，需要4个地址存放，程序计数器就自增4**\n\n这个往复过程就是CPU的指令周期\n\n\n\n## a = 1 + 2执行具体过程\n\n首先CPU是不认识 a =  1 + 2的，所以要想跑起程序就需要把整个程序翻译成汇编语言，整个过程就叫汇编。\n\n\n\n针对汇编代码，需要汇编器翻译成机器码，由01组成，这个就是计算机指令，CPU能够认识。\n\n\n\n### a = 1 + 2 在 32位CPU的执行过程：\n\n程序编译过程中，编译器通过分析代码，能够发现1 和 2 是数据，内存会有个叫数据段的区域来存放这些数据。\n\n如图\n\n- 数据 1 被存放到 0x100 位置；\n- 数据 2 被存放到 0x104 位置；\n\n![img](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1658115884206-69b9c67f-9703-4f7d-85ce-b0aa3e6424a5.png)\n\n存放指令的地方叫正文段\n\n存放数据的地方叫数据段\n\n编译器会把a = 1 + 2 翻译成4条指令存放到正文段。\n\n- 0x200 load 将数据1 装入 R0寄存器\n- 0x204 load 将数据2 装入 R1寄存器\n- 0x208 add 将R0 和 R1 相机，并把结果放到寄存器R2\n- 0x20c store 将寄存器R2的数据存回0x108地址就是变量a的地址\n\n再提一句就是，32位CPU一条指令4个字节，也就是4个内存地址\n\n\n\n## 指令\n\n指令其实指的是机器码，但是为了方便理解，这里说的是汇编代码。CPU通过解析机器码来知道指令的内容。\n\n不同的CPU有不同的指令集，也对应不同的机器码，下面是最简单的MIPS指令集，来了解机器码是如何生成的。\n\nMIPS 的指令是一个 32 位的整数，高 6 位代表着操作码，表示这条指令是一条什么样的指令，剩下的 26 位不同指令类型所表示的内容也就不相同，主要有三种类型R、I 和 J。\n\n![img](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1658116311398-3ca455e0-d06f-4008-829d-7c88b2a1a32c.png)\n\n- R指令，用在算术和逻辑操作，里面有读取和写入数据的寄存器地址。如果是逻辑位移后面还有唯一操作的位移量，最后的功能码则是前面的操作码不够的时候，扩展操作码来表示对应的具体指令的。\n- I指令，用在数据传输、条件分支等。没有位移量、功能码、和第三个寄存器。三部分合并成一个地址值或一个常数\n- J指令用于跳转，后面26位全表示跳转后的地址 \n\n下面举例：add指令将寄存器R0和R1的数据相加，并把结果放入到R2，翻译成机器码\n\n![img](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1658135226787-eaf98ecc-c75b-46c2-bb1e-81b91a7f1a2c.png)\n\n加和运算add指令属于R指令类型\n\n\n\n编译器在编译程序的时候会构造指令，CPU执行时会解析指令。指令的编码与解码。\n\n在此基础上，现代大多是CPU都是使用**流水线**的方式来执行指令。\n\n![img](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1658135540524-9416d824-4a33-46cd-b57b-bff21e82587b.png)\n\n四个阶段的具体含义？\n\n1. 通过程序计数器读取响应内存地址的指令 Fetch 取得指令\n2. 对指令进行解码 Decode 指令译码\n3. 执行指令 Execution 执行指令\n4. 将计算结果放入寄存器或者内存，Store 数据回写\n\n\n\n上面4个步骤叫做指令周期。\n\n不同阶段由不同计算机组件完成：\n\n![img](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1658135759860-dbf333db-a228-473b-8d15-fabf1e2486da.png)\n\n- 指令都是存储在存储器中，通过程序计数器和指令寄存器取指令的过程都是由控制器操作的。\n- 译码--控制器\n- 执行时，算术由算术逻辑单元负责，跳转啥的由控制器负责\n\n### 指令的类型\n\n从功能出发，和上面不要混肴，上面有一个是指令集，是具体的体现：\n\n- 数据传输类型 store/load 寄存器与内存 mov 内存与内存\n- 运算类型 加减乘除\n- 跳转类型 if-else swit-case 函数调用\n- 信号类型 trap 中断\n- 闲置类型 nop CPU空转\n\n\n\n### 指令的执行速度\n\nCPU的硬件参数GHZ ，1GHZ表示1秒能够产生1G次脉冲信\n\n号，每一次脉冲信号高低电平的转换就是一个时钟周期。\n\nCPU在一个时钟周期内，只能完成一次最基本的动作，时钟频率越高时钟周期越短，工作速度越快。\n\n**一个时钟周期能够执行一条指令吗？**\n\n不能。大多数指令都不能，而且不同的指令需要的时钟周期也不一样。乘法比加法多。\n\n\n\n**如何让程序跑的更快？**\n\n消耗的CPU时间少，说明程序是快的，对于程序的CPU执行时间可以拆解成CPU时钟周期数和时钟周期时间的乘积\n\n![img](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1658152623983-d07caff1-d575-4e7a-b987-52e22952aac7.png)\n\n时钟周期时间即主频。主频越高说明运行速度越快。比如2.4GHZCPU，时钟周期时间就是 1/2.4G\n\n但是主频一般来说是相对固定的，所以我们应该去减少CPU时钟周期数。\n\nCPU时钟周期数 = 指令数 * 每天指令的平均时钟周期数CPI\n\n那对于如何让程序跑的更快这个问题的答案就出来了？\n\n- 指令数，可以靠编译器，同样的代码在不同的编译器中编译出来的指令不一样\n- 每条指令的平均时钟周期数CPI：大多数CPU已使用**流水线**技术，让一条指令所需要的CPU时钟周期数尽可能的少。\n- 时钟周期时间：超频技术，打开超频意味着把CPU内部时钟调快了。代价是热量和崩溃。\n\n很多厂商为了跑分而跑分，基本都是在这三个方面入手的哦，特别是超频这一块\n\n\n\n## 总结\n\n# 1.2 磁盘比内存缓慢几万倍？\n\n1\n\n2","slug":"操作系统/硬件结构","published":1,"updated":"2022-07-25T08:28:22.631Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl6bh3m3u0001cwvc7u1ib7oe","content":"<h1 id=\"1-1-CPU是如何执行程序的？\"><a href=\"#1-1-CPU是如何执行程序的？\" class=\"headerlink\" title=\"1.1 CPU是如何执行程序的？\"></a>1.1 CPU是如何执行程序的？</h1><p>有这么几个问题：</p>\n<ul>\n<li>a &#x3D; 1 + 2 这条指令是怎么被CPU运行起来的？</li>\n<li>软件32位和64位的区别？32位操作系统可以运行在64位系统上吗？64位可以运行在32位上吗？原因又是什么？</li>\n<li>CPU分为32位和64位，64位优势在哪呢，64位性能一定比32位好吗？</li>\n</ul>\n<p>本章大纲</p>\n<ul>\n<li>图灵机的工作方式</li>\n<li>冯诺依曼模型</li>\n<li>线路位宽与CPU位宽</li>\n<li>程序执行的基本过程</li>\n<li>a &#x3D; 1 + 2 执行具体过程</li>\n</ul>\n<div class=\"story post-story\"><h2 id=\"图灵机的工作方式\"><a href=\"#图灵机的工作方式\" class=\"headerlink\" title=\"图灵机的工作方式\"></a>图灵机的工作方式</h2><p>当我们不太清楚一个事物为什么是这样子的时候，我们应该去看看它的历史。它在时间潮流中的变化决定它现在出现在你面前的模样。</p>\n<p>图灵机是很早就提出的抽象计算模型，下面是它的大概模样</p>\n<p><img src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1657878607869-80563d9d-6634-4abe-825b-11a0f9d7b0af.png\" class=\"lazyload\" data-srcset=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1657878607869-80563d9d-6634-4abe-825b-11a0f9d7b0af.png\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"img\"></p>\n<p>图灵机的基本组成如下：</p>\n<ul>\n<li>有一条纸带，由一个一个的格子组成，纸带好比内存，格子中的数据就像内存中的数据。</li>\n<li>有一个读写头，读写头可以读取纸带上的任意格子的字符</li>\n<li>头上有一些部件，比如存储单元、控制单元、以及运算单元。分别用于存储数据，识别字符以及控制程序流程，执行运算指令</li>\n</ul>\n</div><div class=\"story post-story\"><h2 id=\"冯诺依曼模型\"><a href=\"#冯诺依曼模型\" class=\"headerlink\" title=\"冯诺依曼模型\"></a>冯诺依曼模型</h2><p>冯诺依曼遵循图灵机的设计提出了在现在依旧符合的冯诺依曼模型</p>\n<p>定义了计算机基本机构：<strong>运算器、控制器、存储器、输入、输出设备</strong>。这五个部分被称为<strong>冯诺依曼模型</strong></p>\n<p><img src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1657879160879-c965c3d7-a5fe-4a79-bb24-0099d7d72971.svg\" class=\"lazyload\" data-srcset=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1657879160879-c965c3d7-a5fe-4a79-bb24-0099d7d72971.svg\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"img\"></p>\n<p>运算器、控制器是在中央处理器里的，存储器就是我们常见的内存，输入输出设备就是计算机外接的设备。</p>\n<p>存储器和输入输出设备要是与中央处理器打交道的话，离不开总线。</p>\n<p><img src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1657879168530-48d6f832-9a09-4454-8f88-772b04d45b3a.webp\" class=\"lazyload\" data-srcset=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1657879168530-48d6f832-9a09-4454-8f88-772b04d45b3a.webp\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"img\"></p>\n<p>下面介绍 内存、中央处理器、总线、输入输出设备</p>\n<h3 id=\"内存\"><a href=\"#内存\" class=\"headerlink\" title=\"内存\"></a>内存</h3><p>内存这一个存储区域是线性的。存储数据的基本单位是字节（byte），1字节&#x3D;&#x3D;8位（bit）。每一个字节对应一个内存地址。</p>\n<p>内存地址是从0开始的，自增，最后一个地址为总大小 - 1，和数组差不多性质。所以内存读写任何一个数据的速度是一样的</p>\n<h3 id=\"中央处理器\"><a href=\"#中央处理器\" class=\"headerlink\" title=\"中央处理器\"></a>中央处理器</h3><p>即CPU，有32位和64位，区别在于一次能计算多少字节数据。</p>\n<ul>\n<li>32位 – 4个字节</li>\n<li>64位 – 8个字节</li>\n</ul>\n<p>这么设计是为了计算更大的数值。</p>\n<p>CPU内部还有常见的如寄存器、控制单元、和逻辑运算单元。</p>\n<p>为什么已经有存储器内存存储了，还需要寄存器来存储？</p>\n<p>因为内存离CPU远，计算速度比较慢</p>\n<p>常见的寄存器种类：</p>\n<ul>\n<li>通用寄存器：用来存放需要进行运算的数据</li>\n<li>程序计数器：用来存放CPU要执行的下一条指令的<strong>内存地址</strong></li>\n<li>指令寄存器：用来存放程序计数器存放的指令，指令本身</li>\n</ul>\n<h3 id=\"总线\"><a href=\"#总线\" class=\"headerlink\" title=\"总线\"></a>总线</h3><p>CPU和内存以及其他设备的通信</p>\n<p>分类：</p>\n<ul>\n<li>地址总线：用于CPU要操作的内存地址</li>\n<li>数据总线：用于读写内存的数据</li>\n<li>控制总线：用于发送和接受信号，比如中断、设备复位等信号</li>\n</ul>\n<p>读写内存时</p>\n<ul>\n<li>地址总线指定内存地址</li>\n<li>控制总线控制读写命令</li>\n<li>数据总线传输数据</li>\n</ul>\n<h3 id=\"输出输出设备\"><a href=\"#输出输出设备\" class=\"headerlink\" title=\"输出输出设备\"></a>输出输出设备</h3><p>外界与CPU交互，用到了控制总线</p>\n<hr>\n</div><div class=\"story post-story\"><h2 id=\"线路位宽与CPU位宽\"><a href=\"#线路位宽与CPU位宽\" class=\"headerlink\" title=\"线路位宽与CPU位宽\"></a>线路位宽与CPU位宽</h2><p>数据通过线路传输是通过操作电压完成，低电压是0，高电压是1。</p>\n<p>一位一位的传输就是串行方式。想一次多传输就应该增加线路。</p>\n<p>为了避免低效率的串行传输方式，线路的位宽最好一次就能访问到所有的内存地址。</p>\n<p><strong>CPU要操作内存地址就需要地址总线：</strong></p>\n<ul>\n<li>如果地址总线只有一根，能够表示的只有0 和 1所以能够操作的内存地址最大为2，不是同时操作的地址。</li>\n<li>两条就是 00 01 10 11 四个地址，</li>\n</ul>\n<p>即2 ^ 根数</p>\n<p>那么要操作4g内存，就需要32条总线，2 ^ 32 &#x3D; 4 G</p>\n<p>上面的是线路位宽，下面是CPU位宽</p>\n<p>CPU的位宽不应该小于线路位宽，因为32位的CPU一次只能操作32位的地址总线和数据总线</p>\n<h3 id=\"32位如何计算64位大小的数字？\"><a href=\"#32位如何计算64位大小的数字？\" class=\"headerlink\" title=\"32位如何计算64位大小的数字？\"></a>32位如何计算64位大小的数字？</h3><p>拆分成高低位，然后先算地位，再算进位，再算高位。</p>\n<p>而64位CPU就能一次性计算。</p>\n<p>所以如果32位和64位一起计算32位可能没什么差别，但是当计算64位时64位才会有优势。</p>\n<p>另外，32位CPU最大只能操作4GB内存条，装了8g也没有用。64位则是2^64</p>\n</div><div class=\"story post-story\"><h2 id=\"程序执行的基本过程\"><a href=\"#程序执行的基本过程\" class=\"headerlink\" title=\"程序执行的基本过程\"></a>程序执行的基本过程</h2><p><img src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1658114475515-c4d516d0-05b1-437a-a853-5320156fd4d6.png\" class=\"lazyload\" data-srcset=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1658114475515-c4d516d0-05b1-437a-a853-5320156fd4d6.png\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"img\"></p>\n<ul>\n<li>第一步，CPU根据<strong>程序计数器</strong>获取到<strong>存储指令的内存地址</strong>，然后控制单元操作<strong>地址总线</strong>访问内存地址，通知内存准备数据，准备好数据后，通过<strong>数据总线</strong>将指令内容传给CPU，CPU收到后存入到<strong>指令寄存器</strong></li>\n<li>CPU分析<strong>指令寄存器</strong>中的指令，确定<strong>指令的类型和参数</strong>，如果是<strong>计算</strong>类型的指令，就把指令交给<strong>逻辑运算单元</strong>运算，如果是<strong>存储</strong>类型的指令，就交给<strong>控制单元</strong>执行。</li>\n<li>第三步<strong>，CPU执行完指令后，程序计数器自增</strong>，表示指向下一条指令，大小由CPU位宽决定，比如<strong>32位CPU，一条指令大小就是4字节，需要4个地址存放，程序计数器就自增4</strong></li>\n</ul>\n<p>这个往复过程就是CPU的指令周期</p>\n</div><div class=\"story post-story\"><h2 id=\"a-x3D-1-2执行具体过程\"><a href=\"#a-x3D-1-2执行具体过程\" class=\"headerlink\" title=\"a &#x3D; 1 + 2执行具体过程\"></a>a &#x3D; 1 + 2执行具体过程</h2><p>首先CPU是不认识 a &#x3D;  1 + 2的，所以要想跑起程序就需要把整个程序翻译成汇编语言，整个过程就叫汇编。</p>\n<p>针对汇编代码，需要汇编器翻译成机器码，由01组成，这个就是计算机指令，CPU能够认识。</p>\n<h3 id=\"a-x3D-1-2-在-32位CPU的执行过程：\"><a href=\"#a-x3D-1-2-在-32位CPU的执行过程：\" class=\"headerlink\" title=\"a &#x3D; 1 + 2 在 32位CPU的执行过程：\"></a>a &#x3D; 1 + 2 在 32位CPU的执行过程：</h3><p>程序编译过程中，编译器通过分析代码，能够发现1 和 2 是数据，内存会有个叫数据段的区域来存放这些数据。</p>\n<p>如图</p>\n<ul>\n<li>数据 1 被存放到 0x100 位置；</li>\n<li>数据 2 被存放到 0x104 位置；</li>\n</ul>\n<p><img src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1658115884206-69b9c67f-9703-4f7d-85ce-b0aa3e6424a5.png\" class=\"lazyload\" data-srcset=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1658115884206-69b9c67f-9703-4f7d-85ce-b0aa3e6424a5.png\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"img\"></p>\n<p>存放指令的地方叫正文段</p>\n<p>存放数据的地方叫数据段</p>\n<p>编译器会把a &#x3D; 1 + 2 翻译成4条指令存放到正文段。</p>\n<ul>\n<li>0x200 load 将数据1 装入 R0寄存器</li>\n<li>0x204 load 将数据2 装入 R1寄存器</li>\n<li>0x208 add 将R0 和 R1 相机，并把结果放到寄存器R2</li>\n<li>0x20c store 将寄存器R2的数据存回0x108地址就是变量a的地址</li>\n</ul>\n<p>再提一句就是，32位CPU一条指令4个字节，也就是4个内存地址</p>\n</div><div class=\"story post-story\"><h2 id=\"指令\"><a href=\"#指令\" class=\"headerlink\" title=\"指令\"></a>指令</h2><p>指令其实指的是机器码，但是为了方便理解，这里说的是汇编代码。CPU通过解析机器码来知道指令的内容。</p>\n<p>不同的CPU有不同的指令集，也对应不同的机器码，下面是最简单的MIPS指令集，来了解机器码是如何生成的。</p>\n<p>MIPS 的指令是一个 32 位的整数，高 6 位代表着操作码，表示这条指令是一条什么样的指令，剩下的 26 位不同指令类型所表示的内容也就不相同，主要有三种类型R、I 和 J。</p>\n<p><img src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1658116311398-3ca455e0-d06f-4008-829d-7c88b2a1a32c.png\" class=\"lazyload\" data-srcset=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1658116311398-3ca455e0-d06f-4008-829d-7c88b2a1a32c.png\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"img\"></p>\n<ul>\n<li>R指令，用在算术和逻辑操作，里面有读取和写入数据的寄存器地址。如果是逻辑位移后面还有唯一操作的位移量，最后的功能码则是前面的操作码不够的时候，扩展操作码来表示对应的具体指令的。</li>\n<li>I指令，用在数据传输、条件分支等。没有位移量、功能码、和第三个寄存器。三部分合并成一个地址值或一个常数</li>\n<li>J指令用于跳转，后面26位全表示跳转后的地址</li>\n</ul>\n<p>下面举例：add指令将寄存器R0和R1的数据相加，并把结果放入到R2，翻译成机器码</p>\n<p><img src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1658135226787-eaf98ecc-c75b-46c2-bb1e-81b91a7f1a2c.png\" class=\"lazyload\" data-srcset=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1658135226787-eaf98ecc-c75b-46c2-bb1e-81b91a7f1a2c.png\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"img\"></p>\n<p>加和运算add指令属于R指令类型</p>\n<p>编译器在编译程序的时候会构造指令，CPU执行时会解析指令。指令的编码与解码。</p>\n<p>在此基础上，现代大多是CPU都是使用<strong>流水线</strong>的方式来执行指令。</p>\n<p><img src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1658135540524-9416d824-4a33-46cd-b57b-bff21e82587b.png\" class=\"lazyload\" data-srcset=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1658135540524-9416d824-4a33-46cd-b57b-bff21e82587b.png\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"img\"></p>\n<p>四个阶段的具体含义？</p>\n<ol>\n<li>通过程序计数器读取响应内存地址的指令 Fetch 取得指令</li>\n<li>对指令进行解码 Decode 指令译码</li>\n<li>执行指令 Execution 执行指令</li>\n<li>将计算结果放入寄存器或者内存，Store 数据回写</li>\n</ol>\n<p>上面4个步骤叫做指令周期。</p>\n<p>不同阶段由不同计算机组件完成：</p>\n<p><img src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1658135759860-dbf333db-a228-473b-8d15-fabf1e2486da.png\" class=\"lazyload\" data-srcset=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1658135759860-dbf333db-a228-473b-8d15-fabf1e2486da.png\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"img\"></p>\n<ul>\n<li>指令都是存储在存储器中，通过程序计数器和指令寄存器取指令的过程都是由控制器操作的。</li>\n<li>译码–控制器</li>\n<li>执行时，算术由算术逻辑单元负责，跳转啥的由控制器负责</li>\n</ul>\n<h3 id=\"指令的类型\"><a href=\"#指令的类型\" class=\"headerlink\" title=\"指令的类型\"></a>指令的类型</h3><p>从功能出发，和上面不要混肴，上面有一个是指令集，是具体的体现：</p>\n<ul>\n<li>数据传输类型 store&#x2F;load 寄存器与内存 mov 内存与内存</li>\n<li>运算类型 加减乘除</li>\n<li>跳转类型 if-else swit-case 函数调用</li>\n<li>信号类型 trap 中断</li>\n<li>闲置类型 nop CPU空转</li>\n</ul>\n<h3 id=\"指令的执行速度\"><a href=\"#指令的执行速度\" class=\"headerlink\" title=\"指令的执行速度\"></a>指令的执行速度</h3><p>CPU的硬件参数GHZ ，1GHZ表示1秒能够产生1G次脉冲信</p>\n<p>号，每一次脉冲信号高低电平的转换就是一个时钟周期。</p>\n<p>CPU在一个时钟周期内，只能完成一次最基本的动作，时钟频率越高时钟周期越短，工作速度越快。</p>\n<p><strong>一个时钟周期能够执行一条指令吗？</strong></p>\n<p>不能。大多数指令都不能，而且不同的指令需要的时钟周期也不一样。乘法比加法多。</p>\n<p><strong>如何让程序跑的更快？</strong></p>\n<p>消耗的CPU时间少，说明程序是快的，对于程序的CPU执行时间可以拆解成CPU时钟周期数和时钟周期时间的乘积</p>\n<p><img src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1658152623983-d07caff1-d575-4e7a-b987-52e22952aac7.png\" class=\"lazyload\" data-srcset=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1658152623983-d07caff1-d575-4e7a-b987-52e22952aac7.png\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"img\"></p>\n<p>时钟周期时间即主频。主频越高说明运行速度越快。比如2.4GHZCPU，时钟周期时间就是 1&#x2F;2.4G</p>\n<p>但是主频一般来说是相对固定的，所以我们应该去减少CPU时钟周期数。</p>\n<p>CPU时钟周期数 &#x3D; 指令数 * 每天指令的平均时钟周期数CPI</p>\n<p>那对于如何让程序跑的更快这个问题的答案就出来了？</p>\n<ul>\n<li>指令数，可以靠编译器，同样的代码在不同的编译器中编译出来的指令不一样</li>\n<li>每条指令的平均时钟周期数CPI：大多数CPU已使用<strong>流水线</strong>技术，让一条指令所需要的CPU时钟周期数尽可能的少。</li>\n<li>时钟周期时间：超频技术，打开超频意味着把CPU内部时钟调快了。代价是热量和崩溃。</li>\n</ul>\n<p>很多厂商为了跑分而跑分，基本都是在这三个方面入手的哦，特别是超频这一块</p>\n</div><div class=\"story post-story\"><h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><h1 id=\"1-2-磁盘比内存缓慢几万倍？\"><a href=\"#1-2-磁盘比内存缓慢几万倍？\" class=\"headerlink\" title=\"1.2 磁盘比内存缓慢几万倍？\"></a>1.2 磁盘比内存缓慢几万倍？</h1><p>1</p>\n<p>2</p>\n\n</div>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"1-1-CPU是如何执行程序的？\"><a href=\"#1-1-CPU是如何执行程序的？\" class=\"headerlink\" title=\"1.1 CPU是如何执行程序的？\"></a>1.1 CPU是如何执行程序的？</h1><p>有这么几个问题：</p>\n<ul>\n<li>a &#x3D; 1 + 2 这条指令是怎么被CPU运行起来的？</li>\n<li>软件32位和64位的区别？32位操作系统可以运行在64位系统上吗？64位可以运行在32位上吗？原因又是什么？</li>\n<li>CPU分为32位和64位，64位优势在哪呢，64位性能一定比32位好吗？</li>\n</ul>\n<p>本章大纲</p>\n<ul>\n<li>图灵机的工作方式</li>\n<li>冯诺依曼模型</li>\n<li>线路位宽与CPU位宽</li>\n<li>程序执行的基本过程</li>\n<li>a &#x3D; 1 + 2 执行具体过程</li>\n</ul>\n<h2 id=\"图灵机的工作方式\"><a href=\"#图灵机的工作方式\" class=\"headerlink\" title=\"图灵机的工作方式\"></a>图灵机的工作方式</h2><p>当我们不太清楚一个事物为什么是这样子的时候，我们应该去看看它的历史。它在时间潮流中的变化决定它现在出现在你面前的模样。</p>\n<p>图灵机是很早就提出的抽象计算模型，下面是它的大概模样</p>\n<p><img src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1657878607869-80563d9d-6634-4abe-825b-11a0f9d7b0af.png\" alt=\"img\"></p>\n<p>图灵机的基本组成如下：</p>\n<ul>\n<li>有一条纸带，由一个一个的格子组成，纸带好比内存，格子中的数据就像内存中的数据。</li>\n<li>有一个读写头，读写头可以读取纸带上的任意格子的字符</li>\n<li>头上有一些部件，比如存储单元、控制单元、以及运算单元。分别用于存储数据，识别字符以及控制程序流程，执行运算指令</li>\n</ul>\n<h2 id=\"冯诺依曼模型\"><a href=\"#冯诺依曼模型\" class=\"headerlink\" title=\"冯诺依曼模型\"></a>冯诺依曼模型</h2><p>冯诺依曼遵循图灵机的设计提出了在现在依旧符合的冯诺依曼模型</p>\n<p>定义了计算机基本机构：<strong>运算器、控制器、存储器、输入、输出设备</strong>。这五个部分被称为<strong>冯诺依曼模型</strong></p>\n<p><img src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1657879160879-c965c3d7-a5fe-4a79-bb24-0099d7d72971.svg\" alt=\"img\"></p>\n<p>运算器、控制器是在中央处理器里的，存储器就是我们常见的内存，输入输出设备就是计算机外接的设备。</p>\n<p>存储器和输入输出设备要是与中央处理器打交道的话，离不开总线。</p>\n<p><img src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1657879168530-48d6f832-9a09-4454-8f88-772b04d45b3a.webp\" alt=\"img\"></p>\n<p>下面介绍 内存、中央处理器、总线、输入输出设备</p>\n<h3 id=\"内存\"><a href=\"#内存\" class=\"headerlink\" title=\"内存\"></a>内存</h3><p>内存这一个存储区域是线性的。存储数据的基本单位是字节（byte），1字节&#x3D;&#x3D;8位（bit）。每一个字节对应一个内存地址。</p>\n<p>内存地址是从0开始的，自增，最后一个地址为总大小 - 1，和数组差不多性质。所以内存读写任何一个数据的速度是一样的</p>\n<h3 id=\"中央处理器\"><a href=\"#中央处理器\" class=\"headerlink\" title=\"中央处理器\"></a>中央处理器</h3><p>即CPU，有32位和64位，区别在于一次能计算多少字节数据。</p>\n<ul>\n<li>32位 – 4个字节</li>\n<li>64位 – 8个字节</li>\n</ul>\n<p>这么设计是为了计算更大的数值。</p>\n<p>CPU内部还有常见的如寄存器、控制单元、和逻辑运算单元。</p>\n<p>为什么已经有存储器内存存储了，还需要寄存器来存储？</p>\n<p>因为内存离CPU远，计算速度比较慢</p>\n<p>常见的寄存器种类：</p>\n<ul>\n<li>通用寄存器：用来存放需要进行运算的数据</li>\n<li>程序计数器：用来存放CPU要执行的下一条指令的<strong>内存地址</strong></li>\n<li>指令寄存器：用来存放程序计数器存放的指令，指令本身</li>\n</ul>\n<h3 id=\"总线\"><a href=\"#总线\" class=\"headerlink\" title=\"总线\"></a>总线</h3><p>CPU和内存以及其他设备的通信</p>\n<p>分类：</p>\n<ul>\n<li>地址总线：用于CPU要操作的内存地址</li>\n<li>数据总线：用于读写内存的数据</li>\n<li>控制总线：用于发送和接受信号，比如中断、设备复位等信号</li>\n</ul>\n<p>读写内存时</p>\n<ul>\n<li>地址总线指定内存地址</li>\n<li>控制总线控制读写命令</li>\n<li>数据总线传输数据</li>\n</ul>\n<h3 id=\"输出输出设备\"><a href=\"#输出输出设备\" class=\"headerlink\" title=\"输出输出设备\"></a>输出输出设备</h3><p>外界与CPU交互，用到了控制总线</p>\n<hr>\n<h2 id=\"线路位宽与CPU位宽\"><a href=\"#线路位宽与CPU位宽\" class=\"headerlink\" title=\"线路位宽与CPU位宽\"></a>线路位宽与CPU位宽</h2><p>数据通过线路传输是通过操作电压完成，低电压是0，高电压是1。</p>\n<p>一位一位的传输就是串行方式。想一次多传输就应该增加线路。</p>\n<p>为了避免低效率的串行传输方式，线路的位宽最好一次就能访问到所有的内存地址。</p>\n<p><strong>CPU要操作内存地址就需要地址总线：</strong></p>\n<ul>\n<li>如果地址总线只有一根，能够表示的只有0 和 1所以能够操作的内存地址最大为2，不是同时操作的地址。</li>\n<li>两条就是 00 01 10 11 四个地址，</li>\n</ul>\n<p>即2 ^ 根数</p>\n<p>那么要操作4g内存，就需要32条总线，2 ^ 32 &#x3D; 4 G</p>\n<p>上面的是线路位宽，下面是CPU位宽</p>\n<p>CPU的位宽不应该小于线路位宽，因为32位的CPU一次只能操作32位的地址总线和数据总线</p>\n<h3 id=\"32位如何计算64位大小的数字？\"><a href=\"#32位如何计算64位大小的数字？\" class=\"headerlink\" title=\"32位如何计算64位大小的数字？\"></a>32位如何计算64位大小的数字？</h3><p>拆分成高低位，然后先算地位，再算进位，再算高位。</p>\n<p>而64位CPU就能一次性计算。</p>\n<p>所以如果32位和64位一起计算32位可能没什么差别，但是当计算64位时64位才会有优势。</p>\n<p>另外，32位CPU最大只能操作4GB内存条，装了8g也没有用。64位则是2^64</p>\n<h2 id=\"程序执行的基本过程\"><a href=\"#程序执行的基本过程\" class=\"headerlink\" title=\"程序执行的基本过程\"></a>程序执行的基本过程</h2><p><img src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1658114475515-c4d516d0-05b1-437a-a853-5320156fd4d6.png\" alt=\"img\"></p>\n<ul>\n<li>第一步，CPU根据<strong>程序计数器</strong>获取到<strong>存储指令的内存地址</strong>，然后控制单元操作<strong>地址总线</strong>访问内存地址，通知内存准备数据，准备好数据后，通过<strong>数据总线</strong>将指令内容传给CPU，CPU收到后存入到<strong>指令寄存器</strong></li>\n<li>CPU分析<strong>指令寄存器</strong>中的指令，确定<strong>指令的类型和参数</strong>，如果是<strong>计算</strong>类型的指令，就把指令交给<strong>逻辑运算单元</strong>运算，如果是<strong>存储</strong>类型的指令，就交给<strong>控制单元</strong>执行。</li>\n<li>第三步<strong>，CPU执行完指令后，程序计数器自增</strong>，表示指向下一条指令，大小由CPU位宽决定，比如<strong>32位CPU，一条指令大小就是4字节，需要4个地址存放，程序计数器就自增4</strong></li>\n</ul>\n<p>这个往复过程就是CPU的指令周期</p>\n<h2 id=\"a-x3D-1-2执行具体过程\"><a href=\"#a-x3D-1-2执行具体过程\" class=\"headerlink\" title=\"a &#x3D; 1 + 2执行具体过程\"></a>a &#x3D; 1 + 2执行具体过程</h2><p>首先CPU是不认识 a &#x3D;  1 + 2的，所以要想跑起程序就需要把整个程序翻译成汇编语言，整个过程就叫汇编。</p>\n<p>针对汇编代码，需要汇编器翻译成机器码，由01组成，这个就是计算机指令，CPU能够认识。</p>\n<h3 id=\"a-x3D-1-2-在-32位CPU的执行过程：\"><a href=\"#a-x3D-1-2-在-32位CPU的执行过程：\" class=\"headerlink\" title=\"a &#x3D; 1 + 2 在 32位CPU的执行过程：\"></a>a &#x3D; 1 + 2 在 32位CPU的执行过程：</h3><p>程序编译过程中，编译器通过分析代码，能够发现1 和 2 是数据，内存会有个叫数据段的区域来存放这些数据。</p>\n<p>如图</p>\n<ul>\n<li>数据 1 被存放到 0x100 位置；</li>\n<li>数据 2 被存放到 0x104 位置；</li>\n</ul>\n<p><img src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1658115884206-69b9c67f-9703-4f7d-85ce-b0aa3e6424a5.png\" alt=\"img\"></p>\n<p>存放指令的地方叫正文段</p>\n<p>存放数据的地方叫数据段</p>\n<p>编译器会把a &#x3D; 1 + 2 翻译成4条指令存放到正文段。</p>\n<ul>\n<li>0x200 load 将数据1 装入 R0寄存器</li>\n<li>0x204 load 将数据2 装入 R1寄存器</li>\n<li>0x208 add 将R0 和 R1 相机，并把结果放到寄存器R2</li>\n<li>0x20c store 将寄存器R2的数据存回0x108地址就是变量a的地址</li>\n</ul>\n<p>再提一句就是，32位CPU一条指令4个字节，也就是4个内存地址</p>\n<h2 id=\"指令\"><a href=\"#指令\" class=\"headerlink\" title=\"指令\"></a>指令</h2><p>指令其实指的是机器码，但是为了方便理解，这里说的是汇编代码。CPU通过解析机器码来知道指令的内容。</p>\n<p>不同的CPU有不同的指令集，也对应不同的机器码，下面是最简单的MIPS指令集，来了解机器码是如何生成的。</p>\n<p>MIPS 的指令是一个 32 位的整数，高 6 位代表着操作码，表示这条指令是一条什么样的指令，剩下的 26 位不同指令类型所表示的内容也就不相同，主要有三种类型R、I 和 J。</p>\n<p><img src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1658116311398-3ca455e0-d06f-4008-829d-7c88b2a1a32c.png\" alt=\"img\"></p>\n<ul>\n<li>R指令，用在算术和逻辑操作，里面有读取和写入数据的寄存器地址。如果是逻辑位移后面还有唯一操作的位移量，最后的功能码则是前面的操作码不够的时候，扩展操作码来表示对应的具体指令的。</li>\n<li>I指令，用在数据传输、条件分支等。没有位移量、功能码、和第三个寄存器。三部分合并成一个地址值或一个常数</li>\n<li>J指令用于跳转，后面26位全表示跳转后的地址</li>\n</ul>\n<p>下面举例：add指令将寄存器R0和R1的数据相加，并把结果放入到R2，翻译成机器码</p>\n<p><img src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1658135226787-eaf98ecc-c75b-46c2-bb1e-81b91a7f1a2c.png\" alt=\"img\"></p>\n<p>加和运算add指令属于R指令类型</p>\n<p>编译器在编译程序的时候会构造指令，CPU执行时会解析指令。指令的编码与解码。</p>\n<p>在此基础上，现代大多是CPU都是使用<strong>流水线</strong>的方式来执行指令。</p>\n<p><img src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1658135540524-9416d824-4a33-46cd-b57b-bff21e82587b.png\" alt=\"img\"></p>\n<p>四个阶段的具体含义？</p>\n<ol>\n<li>通过程序计数器读取响应内存地址的指令 Fetch 取得指令</li>\n<li>对指令进行解码 Decode 指令译码</li>\n<li>执行指令 Execution 执行指令</li>\n<li>将计算结果放入寄存器或者内存，Store 数据回写</li>\n</ol>\n<p>上面4个步骤叫做指令周期。</p>\n<p>不同阶段由不同计算机组件完成：</p>\n<p><img src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1658135759860-dbf333db-a228-473b-8d15-fabf1e2486da.png\" alt=\"img\"></p>\n<ul>\n<li>指令都是存储在存储器中，通过程序计数器和指令寄存器取指令的过程都是由控制器操作的。</li>\n<li>译码–控制器</li>\n<li>执行时，算术由算术逻辑单元负责，跳转啥的由控制器负责</li>\n</ul>\n<h3 id=\"指令的类型\"><a href=\"#指令的类型\" class=\"headerlink\" title=\"指令的类型\"></a>指令的类型</h3><p>从功能出发，和上面不要混肴，上面有一个是指令集，是具体的体现：</p>\n<ul>\n<li>数据传输类型 store&#x2F;load 寄存器与内存 mov 内存与内存</li>\n<li>运算类型 加减乘除</li>\n<li>跳转类型 if-else swit-case 函数调用</li>\n<li>信号类型 trap 中断</li>\n<li>闲置类型 nop CPU空转</li>\n</ul>\n<h3 id=\"指令的执行速度\"><a href=\"#指令的执行速度\" class=\"headerlink\" title=\"指令的执行速度\"></a>指令的执行速度</h3><p>CPU的硬件参数GHZ ，1GHZ表示1秒能够产生1G次脉冲信</p>\n<p>号，每一次脉冲信号高低电平的转换就是一个时钟周期。</p>\n<p>CPU在一个时钟周期内，只能完成一次最基本的动作，时钟频率越高时钟周期越短，工作速度越快。</p>\n<p><strong>一个时钟周期能够执行一条指令吗？</strong></p>\n<p>不能。大多数指令都不能，而且不同的指令需要的时钟周期也不一样。乘法比加法多。</p>\n<p><strong>如何让程序跑的更快？</strong></p>\n<p>消耗的CPU时间少，说明程序是快的，对于程序的CPU执行时间可以拆解成CPU时钟周期数和时钟周期时间的乘积</p>\n<p><img src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/2054/1658152623983-d07caff1-d575-4e7a-b987-52e22952aac7.png\" alt=\"img\"></p>\n<p>时钟周期时间即主频。主频越高说明运行速度越快。比如2.4GHZCPU，时钟周期时间就是 1&#x2F;2.4G</p>\n<p>但是主频一般来说是相对固定的，所以我们应该去减少CPU时钟周期数。</p>\n<p>CPU时钟周期数 &#x3D; 指令数 * 每天指令的平均时钟周期数CPI</p>\n<p>那对于如何让程序跑的更快这个问题的答案就出来了？</p>\n<ul>\n<li>指令数，可以靠编译器，同样的代码在不同的编译器中编译出来的指令不一样</li>\n<li>每条指令的平均时钟周期数CPI：大多数CPU已使用<strong>流水线</strong>技术，让一条指令所需要的CPU时钟周期数尽可能的少。</li>\n<li>时钟周期时间：超频技术，打开超频意味着把CPU内部时钟调快了。代价是热量和崩溃。</li>\n</ul>\n<p>很多厂商为了跑分而跑分，基本都是在这三个方面入手的哦，特别是超频这一块</p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><h1 id=\"1-2-磁盘比内存缓慢几万倍？\"><a href=\"#1-2-磁盘比内存缓慢几万倍？\" class=\"headerlink\" title=\"1.2 磁盘比内存缓慢几万倍？\"></a>1.2 磁盘比内存缓慢几万倍？</h1><p>1</p>\n<p>2</p>\n"}],"PostAsset":[],"PostCategory":[{"post_id":"cl60e5056000hm8vc7rkt0wfk","category_id":"cl60dzolm00010gvc57s59sa7","_id":"cl60e5059000mm8vchp8f3eia"},{"post_id":"cl60e5058000im8vcdwog7ap1","category_id":"cl60dzolm00010gvc57s59sa7","_id":"cl60e5059000om8vc78xebef7"},{"post_id":"cl60e5058000km8vc43236qi9","category_id":"cl60dzolm00010gvc57s59sa7","_id":"cl60e5059000qm8vc5zku4igv"},{"post_id":"cl60e60tz000vm8vc2htq7u1w","category_id":"cl60dzolm00010gvc57s59sa7","_id":"cl60e66bf000xm8vc17eb0ml7"},{"post_id":"cl6bh3m3u0001cwvc7u1ib7oe","category_id":"cl5w4c00e0000aovc4jbh5ebp","_id":"cl6bh3m3x0004cwvcakgw2lmt"},{"post_id":"cl6bh3m3q0000cwvc7urt8sp3","category_id":"cl6bh3m3v0002cwvc1fvo7cxb","_id":"cl6bh3m3y0007cwvc1j685jdl"}],"PostTag":[{"post_id":"cl60e5056000hm8vc7rkt0wfk","tag_id":"cl60e0jiu0001pwvc63sx511m","_id":"cl60e5058000jm8vcfu0w2kq7"},{"post_id":"cl60e5056000hm8vc7rkt0wfk","tag_id":"cl60e0jiv0003pwvc4jjj0wmc","_id":"cl60e5059000lm8vcecio90xf"},{"post_id":"cl60e5056000hm8vc7rkt0wfk","tag_id":"cl60e0jiv0004pwvcbje301nv","_id":"cl60e5059000nm8vc5uzb8elu"},{"post_id":"cl60e5056000hm8vc7rkt0wfk","tag_id":"cl60e0jiw0005pwvcgfzp9ltq","_id":"cl60e5059000pm8vc1bjnc0sv"},{"post_id":"cl60e5058000im8vcdwog7ap1","tag_id":"cl60dzolm00020gvcd7c21msx","_id":"cl60e5059000rm8vc44bdc8u3"},{"post_id":"cl60e5058000km8vc43236qi9","tag_id":"cl60e3p3k000fm8vc9vzb0klc","_id":"cl60e5059000sm8vc4prxh6z3"},{"post_id":"cl60e60tz000vm8vc2htq7u1w","tag_id":"cl60e8iae0010m8vcfvxqef9y","_id":"cl60e8iaf0011m8vc4t9pamkx"},{"post_id":"cl60e60tz000vm8vc2htq7u1w","tag_id":"cl60e8n9t0012m8vcgj5b63wl","_id":"cl60e8n9t0013m8vc0g0h838s"},{"post_id":"cl6bh3m3q0000cwvc7urt8sp3","tag_id":"cl6bh3m3w0003cwvc4e2ecvtf","_id":"cl6bh3m3y0006cwvca7gph6ih"},{"post_id":"cl6bh3m3u0001cwvc7u1ib7oe","tag_id":"cl6bh3m3x0005cwvc59ii2mkp","_id":"cl6bh3m3y0008cwvcevp70erk"}],"Tag":[{"name":"操作系统","_id":"cl5uu0ky50003hwvc3gxfeot6"},{"name":"IO模型","_id":"cl60dzolm00020gvcd7c21msx"},{"name":"Java","_id":"cl60e0jiu0001pwvc63sx511m"},{"name":"JavaNIo","_id":"cl60e0jiv0003pwvc4jjj0wmc"},{"name":"netty","_id":"cl60e0jiv0004pwvcbje301nv"},{"name":"零拷贝","_id":"cl60e0jiw0005pwvcgfzp9ltq"},{"name":"Reaa","_id":"cl60e3jp50007m8vcbyxo3gwh"},{"name":"Reaco","_id":"cl60e3kob0009m8vchkk19coc"},{"name":"React","_id":"cl60e3naq000bm8vc0uch9rk0"},{"name":"Reactormo","_id":"cl60e3o3w000dm8vc9ebn09qn"},{"name":"Reactor模式","_id":"cl60e3p3k000fm8vc9vzb0klc"},{"name":"异步hui'da","_id":"cl60e8gif000ym8vc15d3claa"},{"name":"异步回调","_id":"cl60e8iae0010m8vcfvxqef9y"},{"name":"Future","_id":"cl60e8n9t0012m8vcgj5b63wl"},{"name":"Springboot","_id":"cl6bh3m3w0003cwvc4e2ecvtf"},{"name":"硬件结构","_id":"cl6bh3m3x0005cwvc59ii2mkp"}]}}